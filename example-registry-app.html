<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Example OPDS Registry with MeBooks Integration</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .catalog-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .catalog-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .catalog-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .catalog-title {
            font-size: 1.2em;
            font-weight: 600;
            margin: 0 0 10px 0;
            color: #333;
        }

        .catalog-description {
            color: #666;
            margin: 0 0 15px 0;
            line-height: 1.4;
        }

        .catalog-url {
            font-size: 0.9em;
            color: #888;
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 5px 8px;
            border-radius: 4px;
            margin: 10px 0;
            word-break: break-all;
        }

        .add-button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.2s;
            width: 100%;
        }

        .add-button:hover {
            background: #005a99;
        }

        .add-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .status {
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            font-size: 0.9em;
            text-align: center;
            min-height: 20px;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .mebooks-status {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .check-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
        }

        .check-button:hover {
            background: #218838;
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>ðŸ“š Example OPDS Registry</h1>
        <p>Discover and add OPDS catalogs to your MeBooks library</p>

        <div class="mebooks-status">
            <span id="mebooks-status-text">MeBooks Status: Unknown</span>
            <button id="check-mebooks" class="check-button">Check Status</button>
        </div>
    </div>

    <div class="catalog-grid" id="catalog-grid">
        <!-- Catalogs will be populated by JavaScript -->
    </div>

    <!-- Include MeBooks Integration Library -->
    <script src="http://localhost:3000/JamesEnglish1028-My-Ebook-Reader/mebooks-integration.js"></script>

    <script>
        // Sample OPDS catalogs
        const catalogs = [
            {
                name: "Standard Ebooks",
                description: "High-quality public domain ebooks with beautiful typography and formatting. Classic literature made readable for modern devices.",
                opdsUrl: "https://standardebooks.org/opds/all",
                website: "https://standardebooks.org"
            },
            {
                name: "Feedbooks Public Domain",
                description: "Free public domain books in multiple formats. Classic works from renowned authors available for immediate download.",
                opdsUrl: "https://www.feedbooks.com/publicdomain/catalog.atom",
                website: "https://www.feedbooks.com"
            },
            {
                name: "Internet Archive",
                description: "Millions of free books, movies, music, and other media from the Internet Archive digital library.",
                opdsUrl: "https://bookserver.archive.org/catalog/",
                website: "https://archive.org"
            },
            {
                name: "Project Gutenberg",
                description: "Over 60,000 free ebooks in multiple formats. The oldest digital library with classic literature and reference works.",
                opdsUrl: "https://www.gutenberg.org/ebooks/search.opds/",
                website: "https://www.gutenberg.org"
            },
            {
                name: "Open Library",
                description: "An open, editable library catalog with millions of books. Borrow or read classic and contemporary works.",
                opdsUrl: "https://openlibrary.org/api/volumes/brief/json/opds",
                website: "https://openlibrary.org"
            },
            {
                name: "BiblioBoard",
                description: "Community-sourced ebooks and digital content from libraries and educational institutions worldwide.",
                opdsUrl: "https://catalog.biblioboard.com/",
                website: "https://biblioboard.com"
            }
        ];

        // Initialize MeBooks integration
        const mebooksIntegration = new MeBooksIntegration('http://localhost:3000/JamesEnglish1028-My-Ebook-Reader/');

        // Create catalog cards
        function createCatalogCards() {
            const grid = document.getElementById('catalog-grid');

            catalogs.forEach((catalog, index) => {
                const card = document.createElement('div');
                card.className = 'catalog-card';
                card.innerHTML = `
                    <div class="catalog-title">${catalog.name}</div>
                    <div class="catalog-description">${catalog.description}</div>
                    <div class="catalog-url">${catalog.opdsUrl}</div>
                    <button class="add-button" onclick="addCatalogToMeBooks(${index})">
                        Add to MeBooks
                    </button>
                    <div class="status" id="status-${index}"></div>
                `;
                grid.appendChild(card);
            });
        }

        // Add catalog to MeBooks
        async function addCatalogToMeBooks(catalogIndex) {
            const catalog = catalogs[catalogIndex];
            const statusEl = document.getElementById(`status-${catalogIndex}`);
            const button = document.querySelector(`#catalog-grid .catalog-card:nth-child(${catalogIndex + 1}) .add-button`);

            // Update UI
            button.disabled = true;
            statusEl.className = 'status info';
            statusEl.textContent = `Adding "${catalog.name}" to MeBooks...`;

            try {
                const result = await mebooksIntegration.importCatalog(catalog.opdsUrl, catalog.name);

                if (result.success) {
                    statusEl.className = 'status success';
                    statusEl.textContent = `âœ… ${result.message}`;
                } else {
                    statusEl.className = 'status error';
                    statusEl.textContent = `âŒ ${result.message}`;
                }

                console.log('Import result:', result);

            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = `âŒ Error: ${error.message}`;
                console.error('Integration failed:', error);
            } finally {
                button.disabled = false;
            }
        }

        // Check MeBooks status
        async function checkMeBooksStatus() {
            const statusEl = document.getElementById('mebooks-status-text');
            const button = document.getElementById('check-mebooks');

            button.disabled = true;
            statusEl.textContent = 'Checking MeBooks status...';

            try {
                const isRunning = await mebooksIntegration.checkMeBooksRunning();
                statusEl.textContent = isRunning ?
                    'âœ… MeBooks is running and ready!' :
                    'âŒ MeBooks is not currently running';
            } catch (error) {
                statusEl.textContent = 'âŒ Error checking MeBooks status';
                console.error('Status check failed:', error);
            } finally {
                button.disabled = false;
            }
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', () => {
            createCatalogCards();
            checkMeBooksStatus(); // Check status on page load
        });

        // Add event listener for check button
        document.getElementById('check-mebooks').addEventListener('click', checkMeBooksStatus);

        // Make functions globally available
        window.addCatalogToMeBooks = addCatalogToMeBooks;
        window.checkMeBooksStatus = checkMeBooksStatus;
    </script>
</body>

</html>
