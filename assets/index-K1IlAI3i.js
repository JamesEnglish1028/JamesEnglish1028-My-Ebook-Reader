function mm(r,i){for(var n=0;n<i.length;n++){const o=i[n];if(typeof o!="string"&&!Array.isArray(o)){for(const u in o)if(u!=="default"&&!(u in r)){const l=Object.getOwnPropertyDescriptor(o,u);l&&Object.defineProperty(r,u,l.get?l:{enumerable:!0,get:()=>o[u]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))o(u);new MutationObserver(u=>{for(const l of u)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function n(u){const l={};return u.integrity&&(l.integrity=u.integrity),u.referrerPolicy&&(l.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?l.credentials="include":u.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(u){if(u.ep)return;u.ep=!0;const l=n(u);fetch(u.href,l)}})();var ho=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $l(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var vl={exports:{}},Ys={},xl={exports:{}},Ke={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Cd;function gm(){if(Cd)return Ke;Cd=1;var r=Symbol.for("react.element"),i=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),u=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),d=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),y=Symbol.for("react.memo"),k=Symbol.for("react.lazy"),w=Symbol.iterator;function x(A){return A===null||typeof A!="object"?null:(A=w&&A[w]||A["@@iterator"],typeof A=="function"?A:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C=Object.assign,m={};function S(A,B,me){this.props=A,this.context=B,this.refs=m,this.updater=me||b}S.prototype.isReactComponent={},S.prototype.setState=function(A,B){if(typeof A!="object"&&typeof A!="function"&&A!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,A,B,"setState")},S.prototype.forceUpdate=function(A){this.updater.enqueueForceUpdate(this,A,"forceUpdate")};function j(){}j.prototype=S.prototype;function _(A,B,me){this.props=A,this.context=B,this.refs=m,this.updater=me||b}var L=_.prototype=new j;L.constructor=_,C(L,S.prototype),L.isPureReactComponent=!0;var U=Array.isArray,M=Object.prototype.hasOwnProperty,re={current:null},J={key:!0,ref:!0,__self:!0,__source:!0};function $(A,B,me){var he,se={},we=null,Ee=null;if(B!=null)for(he in B.ref!==void 0&&(Ee=B.ref),B.key!==void 0&&(we=""+B.key),B)M.call(B,he)&&!J.hasOwnProperty(he)&&(se[he]=B[he]);var xe=arguments.length-2;if(xe===1)se.children=me;else if(1<xe){for(var je=Array(xe),Te=0;Te<xe;Te++)je[Te]=arguments[Te+2];se.children=je}if(A&&A.defaultProps)for(he in xe=A.defaultProps,xe)se[he]===void 0&&(se[he]=xe[he]);return{$$typeof:r,type:A,key:we,ref:Ee,props:se,_owner:re.current}}function z(A,B){return{$$typeof:r,type:A.type,key:B,ref:A.ref,props:A.props,_owner:A._owner}}function Q(A){return typeof A=="object"&&A!==null&&A.$$typeof===r}function ae(A){var B={"=":"=0",":":"=2"};return"$"+A.replace(/[=:]/g,function(me){return B[me]})}var F=/\/+/g;function te(A,B){return typeof A=="object"&&A!==null&&A.key!=null?ae(""+A.key):B.toString(36)}function N(A,B,me,he,se){var we=typeof A;(we==="undefined"||we==="boolean")&&(A=null);var Ee=!1;if(A===null)Ee=!0;else switch(we){case"string":case"number":Ee=!0;break;case"object":switch(A.$$typeof){case r:case i:Ee=!0}}if(Ee)return Ee=A,se=se(Ee),A=he===""?"."+te(Ee,0):he,U(se)?(me="",A!=null&&(me=A.replace(F,"$&/")+"/"),N(se,B,me,"",function(Te){return Te})):se!=null&&(Q(se)&&(se=z(se,me+(!se.key||Ee&&Ee.key===se.key?"":(""+se.key).replace(F,"$&/")+"/")+A)),B.push(se)),1;if(Ee=0,he=he===""?".":he+":",U(A))for(var xe=0;xe<A.length;xe++){we=A[xe];var je=he+te(we,xe);Ee+=N(we,B,me,je,se)}else if(je=x(A),typeof je=="function")for(A=je.call(A),xe=0;!(we=A.next()).done;)we=we.value,je=he+te(we,xe++),Ee+=N(we,B,me,je,se);else if(we==="object")throw B=String(A),Error("Objects are not valid as a React child (found: "+(B==="[object Object]"?"object with keys {"+Object.keys(A).join(", ")+"}":B)+"). If you meant to render a collection of children, use an array instead.");return Ee}function K(A,B,me){if(A==null)return A;var he=[],se=0;return N(A,he,"","",function(we){return B.call(me,we,se++)}),he}function ge(A){if(A._status===-1){var B=A._result;B=B(),B.then(function(me){(A._status===0||A._status===-1)&&(A._status=1,A._result=me)},function(me){(A._status===0||A._status===-1)&&(A._status=2,A._result=me)}),A._status===-1&&(A._status=0,A._result=B)}if(A._status===1)return A._result.default;throw A._result}var ne={current:null},le={transition:null},ie={ReactCurrentDispatcher:ne,ReactCurrentBatchConfig:le,ReactCurrentOwner:re};function ue(){throw Error("act(...) is not supported in production builds of React.")}return Ke.Children={map:K,forEach:function(A,B,me){K(A,function(){B.apply(this,arguments)},me)},count:function(A){var B=0;return K(A,function(){B++}),B},toArray:function(A){return K(A,function(B){return B})||[]},only:function(A){if(!Q(A))throw Error("React.Children.only expected to receive a single React element child.");return A}},Ke.Component=S,Ke.Fragment=n,Ke.Profiler=u,Ke.PureComponent=_,Ke.StrictMode=o,Ke.Suspense=h,Ke.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ie,Ke.act=ue,Ke.cloneElement=function(A,B,me){if(A==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+A+".");var he=C({},A.props),se=A.key,we=A.ref,Ee=A._owner;if(B!=null){if(B.ref!==void 0&&(we=B.ref,Ee=re.current),B.key!==void 0&&(se=""+B.key),A.type&&A.type.defaultProps)var xe=A.type.defaultProps;for(je in B)M.call(B,je)&&!J.hasOwnProperty(je)&&(he[je]=B[je]===void 0&&xe!==void 0?xe[je]:B[je])}var je=arguments.length-2;if(je===1)he.children=me;else if(1<je){xe=Array(je);for(var Te=0;Te<je;Te++)xe[Te]=arguments[Te+2];he.children=xe}return{$$typeof:r,type:A.type,key:se,ref:we,props:he,_owner:Ee}},Ke.createContext=function(A){return A={$$typeof:d,_currentValue:A,_currentValue2:A,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},A.Provider={$$typeof:l,_context:A},A.Consumer=A},Ke.createElement=$,Ke.createFactory=function(A){var B=$.bind(null,A);return B.type=A,B},Ke.createRef=function(){return{current:null}},Ke.forwardRef=function(A){return{$$typeof:f,render:A}},Ke.isValidElement=Q,Ke.lazy=function(A){return{$$typeof:k,_payload:{_status:-1,_result:A},_init:ge}},Ke.memo=function(A,B){return{$$typeof:y,type:A,compare:B===void 0?null:B}},Ke.startTransition=function(A){var B=le.transition;le.transition={};try{A()}finally{le.transition=B}},Ke.unstable_act=ue,Ke.useCallback=function(A,B){return ne.current.useCallback(A,B)},Ke.useContext=function(A){return ne.current.useContext(A)},Ke.useDebugValue=function(){},Ke.useDeferredValue=function(A){return ne.current.useDeferredValue(A)},Ke.useEffect=function(A,B){return ne.current.useEffect(A,B)},Ke.useId=function(){return ne.current.useId()},Ke.useImperativeHandle=function(A,B,me){return ne.current.useImperativeHandle(A,B,me)},Ke.useInsertionEffect=function(A,B){return ne.current.useInsertionEffect(A,B)},Ke.useLayoutEffect=function(A,B){return ne.current.useLayoutEffect(A,B)},Ke.useMemo=function(A,B){return ne.current.useMemo(A,B)},Ke.useReducer=function(A,B,me){return ne.current.useReducer(A,B,me)},Ke.useRef=function(A){return ne.current.useRef(A)},Ke.useState=function(A){return ne.current.useState(A)},Ke.useSyncExternalStore=function(A,B,me){return ne.current.useSyncExternalStore(A,B,me)},Ke.useTransition=function(){return ne.current.useTransition()},Ke.version="18.3.1",Ke}var jd;function Wl(){return jd||(jd=1,xl.exports=gm()),xl.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nd;function ym(){if(Nd)return Ys;Nd=1;var r=Wl(),i=Symbol.for("react.element"),n=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,u=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function d(f,h,y){var k,w={},x=null,b=null;y!==void 0&&(x=""+y),h.key!==void 0&&(x=""+h.key),h.ref!==void 0&&(b=h.ref);for(k in h)o.call(h,k)&&!l.hasOwnProperty(k)&&(w[k]=h[k]);if(f&&f.defaultProps)for(k in h=f.defaultProps,h)w[k]===void 0&&(w[k]=h[k]);return{$$typeof:i,type:f,key:x,ref:b,props:w,_owner:u.current}}return Ys.Fragment=n,Ys.jsx=d,Ys.jsxs=d,Ys}var Ed;function vm(){return Ed||(Ed=1,vl.exports=ym()),vl.exports}var a=vm(),P=Wl();const ps=$l(P),xm=mm({__proto__:null,default:ps},[P]);var po={},wl={exports:{}},Yt={},bl={exports:{}},kl={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _d;function wm(){return _d||(_d=1,(function(r){function i(le,ie){var ue=le.length;le.push(ie);e:for(;0<ue;){var A=ue-1>>>1,B=le[A];if(0<u(B,ie))le[A]=ie,le[ue]=B,ue=A;else break e}}function n(le){return le.length===0?null:le[0]}function o(le){if(le.length===0)return null;var ie=le[0],ue=le.pop();if(ue!==ie){le[0]=ue;e:for(var A=0,B=le.length,me=B>>>1;A<me;){var he=2*(A+1)-1,se=le[he],we=he+1,Ee=le[we];if(0>u(se,ue))we<B&&0>u(Ee,se)?(le[A]=Ee,le[we]=ue,A=we):(le[A]=se,le[he]=ue,A=he);else if(we<B&&0>u(Ee,ue))le[A]=Ee,le[we]=ue,A=we;else break e}}return ie}function u(le,ie){var ue=le.sortIndex-ie.sortIndex;return ue!==0?ue:le.id-ie.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;r.unstable_now=function(){return l.now()}}else{var d=Date,f=d.now();r.unstable_now=function(){return d.now()-f}}var h=[],y=[],k=1,w=null,x=3,b=!1,C=!1,m=!1,S=typeof setTimeout=="function"?setTimeout:null,j=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function L(le){for(var ie=n(y);ie!==null;){if(ie.callback===null)o(y);else if(ie.startTime<=le)o(y),ie.sortIndex=ie.expirationTime,i(h,ie);else break;ie=n(y)}}function U(le){if(m=!1,L(le),!C)if(n(h)!==null)C=!0,ge(M);else{var ie=n(y);ie!==null&&ne(U,ie.startTime-le)}}function M(le,ie){C=!1,m&&(m=!1,j($),$=-1),b=!0;var ue=x;try{for(L(ie),w=n(h);w!==null&&(!(w.expirationTime>ie)||le&&!ae());){var A=w.callback;if(typeof A=="function"){w.callback=null,x=w.priorityLevel;var B=A(w.expirationTime<=ie);ie=r.unstable_now(),typeof B=="function"?w.callback=B:w===n(h)&&o(h),L(ie)}else o(h);w=n(h)}if(w!==null)var me=!0;else{var he=n(y);he!==null&&ne(U,he.startTime-ie),me=!1}return me}finally{w=null,x=ue,b=!1}}var re=!1,J=null,$=-1,z=5,Q=-1;function ae(){return!(r.unstable_now()-Q<z)}function F(){if(J!==null){var le=r.unstable_now();Q=le;var ie=!0;try{ie=J(!0,le)}finally{ie?te():(re=!1,J=null)}}else re=!1}var te;if(typeof _=="function")te=function(){_(F)};else if(typeof MessageChannel<"u"){var N=new MessageChannel,K=N.port2;N.port1.onmessage=F,te=function(){K.postMessage(null)}}else te=function(){S(F,0)};function ge(le){J=le,re||(re=!0,te())}function ne(le,ie){$=S(function(){le(r.unstable_now())},ie)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(le){le.callback=null},r.unstable_continueExecution=function(){C||b||(C=!0,ge(M))},r.unstable_forceFrameRate=function(le){0>le||125<le?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):z=0<le?Math.floor(1e3/le):5},r.unstable_getCurrentPriorityLevel=function(){return x},r.unstable_getFirstCallbackNode=function(){return n(h)},r.unstable_next=function(le){switch(x){case 1:case 2:case 3:var ie=3;break;default:ie=x}var ue=x;x=ie;try{return le()}finally{x=ue}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(le,ie){switch(le){case 1:case 2:case 3:case 4:case 5:break;default:le=3}var ue=x;x=le;try{return ie()}finally{x=ue}},r.unstable_scheduleCallback=function(le,ie,ue){var A=r.unstable_now();switch(typeof ue=="object"&&ue!==null?(ue=ue.delay,ue=typeof ue=="number"&&0<ue?A+ue:A):ue=A,le){case 1:var B=-1;break;case 2:B=250;break;case 5:B=1073741823;break;case 4:B=1e4;break;default:B=5e3}return B=ue+B,le={id:k++,callback:ie,priorityLevel:le,startTime:ue,expirationTime:B,sortIndex:-1},ue>A?(le.sortIndex=ue,i(y,le),n(h)===null&&le===n(y)&&(m?(j($),$=-1):m=!0,ne(U,ue-A))):(le.sortIndex=B,i(h,le),C||b||(C=!0,ge(M))),le},r.unstable_shouldYield=ae,r.unstable_wrapCallback=function(le){var ie=x;return function(){var ue=x;x=ie;try{return le.apply(this,arguments)}finally{x=ue}}}})(kl)),kl}var Rd;function bm(){return Rd||(Rd=1,bl.exports=wm()),bl.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ad;function km(){if(Ad)return Yt;Ad=1;var r=Wl(),i=bm();function n(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,s=1;s<arguments.length;s++)t+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,u={};function l(e,t){d(e,t),d(e+"Capture",t)}function d(e,t){for(u[e]=t,e=0;e<t.length;e++)o.add(t[e])}var f=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),h=Object.prototype.hasOwnProperty,y=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,k={},w={};function x(e){return h.call(w,e)?!0:h.call(k,e)?!1:y.test(e)?w[e]=!0:(k[e]=!0,!1)}function b(e,t,s,c){if(s!==null&&s.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return c?!1:s!==null?!s.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function C(e,t,s,c){if(t===null||typeof t>"u"||b(e,t,s,c))return!0;if(c)return!1;if(s!==null)switch(s.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function m(e,t,s,c,p,g,R){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=c,this.attributeNamespace=p,this.mustUseProperty=s,this.propertyName=e,this.type=t,this.sanitizeURL=g,this.removeEmptyString=R}var S={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){S[e]=new m(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];S[t]=new m(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){S[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){S[e]=new m(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){S[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){S[e]=new m(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){S[e]=new m(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){S[e]=new m(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){S[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)});var j=/[\-:]([a-z])/g;function _(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(j,_);S[t]=new m(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(j,_);S[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(j,_);S[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){S[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)}),S.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){S[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)});function L(e,t,s,c){var p=S.hasOwnProperty(t)?S[t]:null;(p!==null?p.type!==0:c||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(C(t,s,p,c)&&(s=null),c||p===null?x(t)&&(s===null?e.removeAttribute(t):e.setAttribute(t,""+s)):p.mustUseProperty?e[p.propertyName]=s===null?p.type===3?!1:"":s:(t=p.attributeName,c=p.attributeNamespace,s===null?e.removeAttribute(t):(p=p.type,s=p===3||p===4&&s===!0?"":""+s,c?e.setAttributeNS(c,t,s):e.setAttribute(t,s))))}var U=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,M=Symbol.for("react.element"),re=Symbol.for("react.portal"),J=Symbol.for("react.fragment"),$=Symbol.for("react.strict_mode"),z=Symbol.for("react.profiler"),Q=Symbol.for("react.provider"),ae=Symbol.for("react.context"),F=Symbol.for("react.forward_ref"),te=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),K=Symbol.for("react.memo"),ge=Symbol.for("react.lazy"),ne=Symbol.for("react.offscreen"),le=Symbol.iterator;function ie(e){return e===null||typeof e!="object"?null:(e=le&&e[le]||e["@@iterator"],typeof e=="function"?e:null)}var ue=Object.assign,A;function B(e){if(A===void 0)try{throw Error()}catch(s){var t=s.stack.trim().match(/\n( *(at )?)/);A=t&&t[1]||""}return`
`+A+e}var me=!1;function he(e,t){if(!e||me)return"";me=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(pe){var c=pe}Reflect.construct(e,[],t)}else{try{t.call()}catch(pe){c=pe}e.call(t.prototype)}else{try{throw Error()}catch(pe){c=pe}e()}}catch(pe){if(pe&&c&&typeof pe.stack=="string"){for(var p=pe.stack.split(`
`),g=c.stack.split(`
`),R=p.length-1,W=g.length-1;1<=R&&0<=W&&p[R]!==g[W];)W--;for(;1<=R&&0<=W;R--,W--)if(p[R]!==g[W]){if(R!==1||W!==1)do if(R--,W--,0>W||p[R]!==g[W]){var Z=`
`+p[R].replace(" at new "," at ");return e.displayName&&Z.includes("<anonymous>")&&(Z=Z.replace("<anonymous>",e.displayName)),Z}while(1<=R&&0<=W);break}}}finally{me=!1,Error.prepareStackTrace=s}return(e=e?e.displayName||e.name:"")?B(e):""}function se(e){switch(e.tag){case 5:return B(e.type);case 16:return B("Lazy");case 13:return B("Suspense");case 19:return B("SuspenseList");case 0:case 2:case 15:return e=he(e.type,!1),e;case 11:return e=he(e.type.render,!1),e;case 1:return e=he(e.type,!0),e;default:return""}}function we(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case J:return"Fragment";case re:return"Portal";case z:return"Profiler";case $:return"StrictMode";case te:return"Suspense";case N:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case ae:return(e.displayName||"Context")+".Consumer";case Q:return(e._context.displayName||"Context")+".Provider";case F:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case K:return t=e.displayName||null,t!==null?t:we(e.type)||"Memo";case ge:t=e._payload,e=e._init;try{return we(e(t))}catch{}}return null}function Ee(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return we(t);case 8:return t===$?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function xe(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function je(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Te(e){var t=je(e)?"checked":"value",s=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),c=""+e[t];if(!e.hasOwnProperty(t)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var p=s.get,g=s.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return p.call(this)},set:function(R){c=""+R,g.call(this,R)}}),Object.defineProperty(e,t,{enumerable:s.enumerable}),{getValue:function(){return c},setValue:function(R){c=""+R},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Fe(e){e._valueTracker||(e._valueTracker=Te(e))}function He(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var s=t.getValue(),c="";return e&&(c=je(e)?e.checked?"true":"false":e.value),e=c,e!==s?(t.setValue(e),!0):!1}function Me(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function v(e,t){var s=t.checked;return ue({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:s??e._wrapperState.initialChecked})}function X(e,t){var s=t.defaultValue==null?"":t.defaultValue,c=t.checked!=null?t.checked:t.defaultChecked;s=xe(t.value!=null?t.value:s),e._wrapperState={initialChecked:c,initialValue:s,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function H(e,t){t=t.checked,t!=null&&L(e,"checked",t,!1)}function I(e,t){H(e,t);var s=xe(t.value),c=t.type;if(s!=null)c==="number"?(s===0&&e.value===""||e.value!=s)&&(e.value=""+s):e.value!==""+s&&(e.value=""+s);else if(c==="submit"||c==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?V(e,t.type,s):t.hasOwnProperty("defaultValue")&&V(e,t.type,xe(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function O(e,t,s){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var c=t.type;if(!(c!=="submit"&&c!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,s||t===e.value||(e.value=t),e.defaultValue=t}s=e.name,s!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,s!==""&&(e.name=s)}function V(e,t,s){(t!=="number"||Me(e.ownerDocument)!==e)&&(s==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+s&&(e.defaultValue=""+s))}var G=Array.isArray;function oe(e,t,s,c){if(e=e.options,t){t={};for(var p=0;p<s.length;p++)t["$"+s[p]]=!0;for(s=0;s<e.length;s++)p=t.hasOwnProperty("$"+e[s].value),e[s].selected!==p&&(e[s].selected=p),p&&c&&(e[s].defaultSelected=!0)}else{for(s=""+xe(s),t=null,p=0;p<e.length;p++){if(e[p].value===s){e[p].selected=!0,c&&(e[p].defaultSelected=!0);return}t!==null||e[p].disabled||(t=e[p])}t!==null&&(t.selected=!0)}}function Y(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(n(91));return ue({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function E(e,t){var s=t.value;if(s==null){if(s=t.children,t=t.defaultValue,s!=null){if(t!=null)throw Error(n(92));if(G(s)){if(1<s.length)throw Error(n(93));s=s[0]}t=s}t==null&&(t=""),s=t}e._wrapperState={initialValue:xe(s)}}function T(e,t){var s=xe(t.value),c=xe(t.defaultValue);s!=null&&(s=""+s,s!==e.value&&(e.value=s),t.defaultValue==null&&e.defaultValue!==s&&(e.defaultValue=s)),c!=null&&(e.defaultValue=""+c)}function D(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function q(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ve(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?q(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Ce,$e=(function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,s,c,p){MSApp.execUnsafeLocalFunction(function(){return e(t,s,c,p)})}:e})(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Ce=Ce||document.createElement("div"),Ce.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function We(e,t){if(t){var s=e.firstChild;if(s&&s===e.lastChild&&s.nodeType===3){s.nodeValue=t;return}}e.textContent=t}var Qe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Je=["Webkit","ms","Moz","O"];Object.keys(Qe).forEach(function(e){Je.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Qe[t]=Qe[e]})});function Be(e,t,s){return t==null||typeof t=="boolean"||t===""?"":s||typeof t!="number"||t===0||Qe.hasOwnProperty(e)&&Qe[e]?(""+t).trim():t+"px"}function ut(e,t){e=e.style;for(var s in t)if(t.hasOwnProperty(s)){var c=s.indexOf("--")===0,p=Be(s,t[s],c);s==="float"&&(s="cssFloat"),c?e.setProperty(s,p):e[s]=p}}var Lt=ue({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ze(e,t){if(t){if(Lt[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(n(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(n(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(n(61))}if(t.style!=null&&typeof t.style!="object")throw Error(n(62))}}function Jt(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var It=null;function kr(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Rr=null,Dt=null,Ct=null;function Wt(e){if(e=Fs(e)){if(typeof Rr!="function")throw Error(n(280));var t=e.stateNode;t&&(t=Ei(t),Rr(e.stateNode,e.type,t))}}function mn(e){Dt?Ct?Ct.push(e):Ct=[e]:Dt=e}function zn(){if(Dt){var e=Dt,t=Ct;if(Ct=Dt=null,Wt(e),t)for(e=0;e<t.length;e++)Wt(t[e])}}function zr(e,t){return e(t)}function At(){}var gn=!1;function gs(e,t,s){if(gn)return e(t,s);gn=!0;try{return zr(e,t,s)}finally{gn=!1,(Dt!==null||Ct!==null)&&(At(),zn())}}function Mr(e,t){var s=e.stateNode;if(s===null)return null;var c=Ei(s);if(c===null)return null;s=c[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(e=e.type,c=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!c;break e;default:e=!1}if(e)return null;if(s&&typeof s!="function")throw Error(n(231,t,typeof s));return s}var Mn=!1;if(f)try{var er={};Object.defineProperty(er,"passive",{get:function(){Mn=!0}}),window.addEventListener("test",er,er),window.removeEventListener("test",er,er)}catch{Mn=!1}function $r(e,t,s,c,p,g,R,W,Z){var pe=Array.prototype.slice.call(arguments,3);try{t.apply(s,pe)}catch(ke){this.onError(ke)}}var yn=!1,or=null,$n=!1,ys=null,Oo={onError:function(e){yn=!0,or=e}};function Lo(e,t,s,c,p,g,R,W,Z){yn=!1,or=null,$r.apply(Oo,arguments)}function vs(e,t,s,c,p,g,R,W,Z){if(Lo.apply(this,arguments),yn){if(yn){var pe=or;yn=!1,or=null}else throw Error(n(198));$n||($n=!0,ys=pe)}}function Ar(e){var t=e,s=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(s=t.return),e=t.return;while(e)}return t.tag===3?s:null}function li(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function vn(e){if(Ar(e)!==e)throw Error(n(188))}function Io(e){var t=e.alternate;if(!t){if(t=Ar(e),t===null)throw Error(n(188));return t!==e?null:e}for(var s=e,c=t;;){var p=s.return;if(p===null)break;var g=p.alternate;if(g===null){if(c=p.return,c!==null){s=c;continue}break}if(p.child===g.child){for(g=p.child;g;){if(g===s)return vn(p),e;if(g===c)return vn(p),t;g=g.sibling}throw Error(n(188))}if(s.return!==c.return)s=p,c=g;else{for(var R=!1,W=p.child;W;){if(W===s){R=!0,s=p,c=g;break}if(W===c){R=!0,c=p,s=g;break}W=W.sibling}if(!R){for(W=g.child;W;){if(W===s){R=!0,s=g,c=p;break}if(W===c){R=!0,c=g,s=p;break}W=W.sibling}if(!R)throw Error(n(189))}}if(s.alternate!==c)throw Error(n(190))}if(s.tag!==3)throw Error(n(188));return s.stateNode.current===s?e:t}function xs(e){return e=Io(e),e!==null?ci(e):null}function ci(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=ci(e);if(t!==null)return t;e=e.sibling}return null}var ui=i.unstable_scheduleCallback,di=i.unstable_cancelCallback,Do=i.unstable_shouldYield,Fo=i.unstable_requestPaint,ht=i.unstable_now,Bo=i.unstable_getCurrentPriorityLevel,ye=i.unstable_ImmediatePriority,Re=i.unstable_UserBlockingPriority,Oe=i.unstable_NormalPriority,qe=i.unstable_LowPriority,Le=i.unstable_IdlePriority,Xe=null,nt=null;function Wr(e){if(nt&&typeof nt.onCommitFiberRoot=="function")try{nt.onCommitFiberRoot(Xe,e,void 0,(e.current.flags&128)===128)}catch{}}var st=Math.clz32?Math.clz32:dt,at=Math.log,jt=Math.LN2;function dt(e){return e>>>=0,e===0?32:31-(at(e)/jt|0)|0}var Ye=64,Nt=4194304;function Tt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Vr(e,t){var s=e.pendingLanes;if(s===0)return 0;var c=0,p=e.suspendedLanes,g=e.pingedLanes,R=s&268435455;if(R!==0){var W=R&~p;W!==0?c=Tt(W):(g&=R,g!==0&&(c=Tt(g)))}else R=s&~p,R!==0?c=Tt(R):g!==0&&(c=Tt(g));if(c===0)return 0;if(t!==0&&t!==c&&(t&p)===0&&(p=c&-c,g=t&-t,p>=g||p===16&&(g&4194240)!==0))return t;if((c&4)!==0&&(c|=s&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=c;0<t;)s=31-st(t),p=1<<s,c|=e[s],t&=~p;return c}function Lh(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ih(e,t){for(var s=e.suspendedLanes,c=e.pingedLanes,p=e.expirationTimes,g=e.pendingLanes;0<g;){var R=31-st(g),W=1<<R,Z=p[R];Z===-1?((W&s)===0||(W&c)!==0)&&(p[R]=Lh(W,t)):Z<=t&&(e.expiredLanes|=W),g&=~W}}function Uo(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function tc(){var e=Ye;return Ye<<=1,(Ye&4194240)===0&&(Ye=64),e}function zo(e){for(var t=[],s=0;31>s;s++)t.push(e);return t}function ws(e,t,s){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-st(t),e[t]=s}function Dh(e,t){var s=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var c=e.eventTimes;for(e=e.expirationTimes;0<s;){var p=31-st(s),g=1<<p;t[p]=0,c[p]=-1,e[p]=-1,s&=~g}}function Mo(e,t){var s=e.entangledLanes|=t;for(e=e.entanglements;s;){var c=31-st(s),p=1<<c;p&t|e[c]&t&&(e[c]|=t),s&=~p}}var rt=0;function rc(e){return e&=-e,1<e?4<e?(e&268435455)!==0?16:536870912:4:1}var nc,$o,sc,ic,oc,Wo=!1,fi=[],Hr=null,qr=null,Qr=null,bs=new Map,ks=new Map,Kr=[],Fh="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ac(e,t){switch(e){case"focusin":case"focusout":Hr=null;break;case"dragenter":case"dragleave":qr=null;break;case"mouseover":case"mouseout":Qr=null;break;case"pointerover":case"pointerout":bs.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ks.delete(t.pointerId)}}function Ss(e,t,s,c,p,g){return e===null||e.nativeEvent!==g?(e={blockedOn:t,domEventName:s,eventSystemFlags:c,nativeEvent:g,targetContainers:[p]},t!==null&&(t=Fs(t),t!==null&&$o(t)),e):(e.eventSystemFlags|=c,t=e.targetContainers,p!==null&&t.indexOf(p)===-1&&t.push(p),e)}function Bh(e,t,s,c,p){switch(t){case"focusin":return Hr=Ss(Hr,e,t,s,c,p),!0;case"dragenter":return qr=Ss(qr,e,t,s,c,p),!0;case"mouseover":return Qr=Ss(Qr,e,t,s,c,p),!0;case"pointerover":var g=p.pointerId;return bs.set(g,Ss(bs.get(g)||null,e,t,s,c,p)),!0;case"gotpointercapture":return g=p.pointerId,ks.set(g,Ss(ks.get(g)||null,e,t,s,c,p)),!0}return!1}function lc(e){var t=xn(e.target);if(t!==null){var s=Ar(t);if(s!==null){if(t=s.tag,t===13){if(t=li(s),t!==null){e.blockedOn=t,oc(e.priority,function(){sc(s)});return}}else if(t===3&&s.stateNode.current.memoizedState.isDehydrated){e.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}e.blockedOn=null}function hi(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var s=Ho(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(s===null){s=e.nativeEvent;var c=new s.constructor(s.type,s);It=c,s.target.dispatchEvent(c),It=null}else return t=Fs(s),t!==null&&$o(t),e.blockedOn=s,!1;t.shift()}return!0}function cc(e,t,s){hi(e)&&s.delete(t)}function Uh(){Wo=!1,Hr!==null&&hi(Hr)&&(Hr=null),qr!==null&&hi(qr)&&(qr=null),Qr!==null&&hi(Qr)&&(Qr=null),bs.forEach(cc),ks.forEach(cc)}function Cs(e,t){e.blockedOn===t&&(e.blockedOn=null,Wo||(Wo=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Uh)))}function js(e){function t(p){return Cs(p,e)}if(0<fi.length){Cs(fi[0],e);for(var s=1;s<fi.length;s++){var c=fi[s];c.blockedOn===e&&(c.blockedOn=null)}}for(Hr!==null&&Cs(Hr,e),qr!==null&&Cs(qr,e),Qr!==null&&Cs(Qr,e),bs.forEach(t),ks.forEach(t),s=0;s<Kr.length;s++)c=Kr[s],c.blockedOn===e&&(c.blockedOn=null);for(;0<Kr.length&&(s=Kr[0],s.blockedOn===null);)lc(s),s.blockedOn===null&&Kr.shift()}var Wn=U.ReactCurrentBatchConfig,pi=!0;function zh(e,t,s,c){var p=rt,g=Wn.transition;Wn.transition=null;try{rt=1,Vo(e,t,s,c)}finally{rt=p,Wn.transition=g}}function Mh(e,t,s,c){var p=rt,g=Wn.transition;Wn.transition=null;try{rt=4,Vo(e,t,s,c)}finally{rt=p,Wn.transition=g}}function Vo(e,t,s,c){if(pi){var p=Ho(e,t,s,c);if(p===null)la(e,t,c,mi,s),ac(e,c);else if(Bh(p,e,t,s,c))c.stopPropagation();else if(ac(e,c),t&4&&-1<Fh.indexOf(e)){for(;p!==null;){var g=Fs(p);if(g!==null&&nc(g),g=Ho(e,t,s,c),g===null&&la(e,t,c,mi,s),g===p)break;p=g}p!==null&&c.stopPropagation()}else la(e,t,c,null,s)}}var mi=null;function Ho(e,t,s,c){if(mi=null,e=kr(c),e=xn(e),e!==null)if(t=Ar(e),t===null)e=null;else if(s=t.tag,s===13){if(e=li(t),e!==null)return e;e=null}else if(s===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return mi=e,null}function uc(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Bo()){case ye:return 1;case Re:return 4;case Oe:case qe:return 16;case Le:return 536870912;default:return 16}default:return 16}}var Gr=null,qo=null,gi=null;function dc(){if(gi)return gi;var e,t=qo,s=t.length,c,p="value"in Gr?Gr.value:Gr.textContent,g=p.length;for(e=0;e<s&&t[e]===p[e];e++);var R=s-e;for(c=1;c<=R&&t[s-c]===p[g-c];c++);return gi=p.slice(e,1<c?1-c:void 0)}function yi(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function vi(){return!0}function fc(){return!1}function tr(e){function t(s,c,p,g,R){this._reactName=s,this._targetInst=p,this.type=c,this.nativeEvent=g,this.target=R,this.currentTarget=null;for(var W in e)e.hasOwnProperty(W)&&(s=e[W],this[W]=s?s(g):g[W]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?vi:fc,this.isPropagationStopped=fc,this}return ue(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=vi)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=vi)},persist:function(){},isPersistent:vi}),t}var Vn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Qo=tr(Vn),Ns=ue({},Vn,{view:0,detail:0}),$h=tr(Ns),Ko,Go,Es,xi=ue({},Ns,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Xo,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Es&&(Es&&e.type==="mousemove"?(Ko=e.screenX-Es.screenX,Go=e.screenY-Es.screenY):Go=Ko=0,Es=e),Ko)},movementY:function(e){return"movementY"in e?e.movementY:Go}}),hc=tr(xi),Wh=ue({},xi,{dataTransfer:0}),Vh=tr(Wh),Hh=ue({},Ns,{relatedTarget:0}),Zo=tr(Hh),qh=ue({},Vn,{animationName:0,elapsedTime:0,pseudoElement:0}),Qh=tr(qh),Kh=ue({},Vn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Gh=tr(Kh),Zh=ue({},Vn,{data:0}),pc=tr(Zh),Xh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Yh={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Jh={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ep(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Jh[e])?!!t[e]:!1}function Xo(){return ep}var tp=ue({},Ns,{key:function(e){if(e.key){var t=Xh[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=yi(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Yh[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Xo,charCode:function(e){return e.type==="keypress"?yi(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?yi(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),rp=tr(tp),np=ue({},xi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),mc=tr(np),sp=ue({},Ns,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Xo}),ip=tr(sp),op=ue({},Vn,{propertyName:0,elapsedTime:0,pseudoElement:0}),ap=tr(op),lp=ue({},xi,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),cp=tr(lp),up=[9,13,27,32],Yo=f&&"CompositionEvent"in window,_s=null;f&&"documentMode"in document&&(_s=document.documentMode);var dp=f&&"TextEvent"in window&&!_s,gc=f&&(!Yo||_s&&8<_s&&11>=_s),yc=" ",vc=!1;function xc(e,t){switch(e){case"keyup":return up.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function wc(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Hn=!1;function fp(e,t){switch(e){case"compositionend":return wc(t);case"keypress":return t.which!==32?null:(vc=!0,yc);case"textInput":return e=t.data,e===yc&&vc?null:e;default:return null}}function hp(e,t){if(Hn)return e==="compositionend"||!Yo&&xc(e,t)?(e=dc(),gi=qo=Gr=null,Hn=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return gc&&t.locale!=="ko"?null:t.data;default:return null}}var pp={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function bc(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!pp[e.type]:t==="textarea"}function kc(e,t,s,c){mn(c),t=Ci(t,"onChange"),0<t.length&&(s=new Qo("onChange","change",null,s,c),e.push({event:s,listeners:t}))}var Rs=null,As=null;function mp(e){zc(e,0)}function wi(e){var t=Zn(e);if(He(t))return e}function gp(e,t){if(e==="change")return t}var Sc=!1;if(f){var Jo;if(f){var ea="oninput"in document;if(!ea){var Cc=document.createElement("div");Cc.setAttribute("oninput","return;"),ea=typeof Cc.oninput=="function"}Jo=ea}else Jo=!1;Sc=Jo&&(!document.documentMode||9<document.documentMode)}function jc(){Rs&&(Rs.detachEvent("onpropertychange",Nc),As=Rs=null)}function Nc(e){if(e.propertyName==="value"&&wi(As)){var t=[];kc(t,As,e,kr(e)),gs(mp,t)}}function yp(e,t,s){e==="focusin"?(jc(),Rs=t,As=s,Rs.attachEvent("onpropertychange",Nc)):e==="focusout"&&jc()}function vp(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return wi(As)}function xp(e,t){if(e==="click")return wi(t)}function wp(e,t){if(e==="input"||e==="change")return wi(t)}function bp(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var pr=typeof Object.is=="function"?Object.is:bp;function Ts(e,t){if(pr(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var s=Object.keys(e),c=Object.keys(t);if(s.length!==c.length)return!1;for(c=0;c<s.length;c++){var p=s[c];if(!h.call(t,p)||!pr(e[p],t[p]))return!1}return!0}function Ec(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function _c(e,t){var s=Ec(e);e=0;for(var c;s;){if(s.nodeType===3){if(c=e+s.textContent.length,e<=t&&c>=t)return{node:s,offset:t-e};e=c}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=Ec(s)}}function Rc(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Rc(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Ac(){for(var e=window,t=Me();t instanceof e.HTMLIFrameElement;){try{var s=typeof t.contentWindow.location.href=="string"}catch{s=!1}if(s)e=t.contentWindow;else break;t=Me(e.document)}return t}function ta(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function kp(e){var t=Ac(),s=e.focusedElem,c=e.selectionRange;if(t!==s&&s&&s.ownerDocument&&Rc(s.ownerDocument.documentElement,s)){if(c!==null&&ta(s)){if(t=c.start,e=c.end,e===void 0&&(e=t),"selectionStart"in s)s.selectionStart=t,s.selectionEnd=Math.min(e,s.value.length);else if(e=(t=s.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var p=s.textContent.length,g=Math.min(c.start,p);c=c.end===void 0?g:Math.min(c.end,p),!e.extend&&g>c&&(p=c,c=g,g=p),p=_c(s,g);var R=_c(s,c);p&&R&&(e.rangeCount!==1||e.anchorNode!==p.node||e.anchorOffset!==p.offset||e.focusNode!==R.node||e.focusOffset!==R.offset)&&(t=t.createRange(),t.setStart(p.node,p.offset),e.removeAllRanges(),g>c?(e.addRange(t),e.extend(R.node,R.offset)):(t.setEnd(R.node,R.offset),e.addRange(t)))}}for(t=[],e=s;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof s.focus=="function"&&s.focus(),s=0;s<t.length;s++)e=t[s],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Sp=f&&"documentMode"in document&&11>=document.documentMode,qn=null,ra=null,Ps=null,na=!1;function Tc(e,t,s){var c=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;na||qn==null||qn!==Me(c)||(c=qn,"selectionStart"in c&&ta(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),Ps&&Ts(Ps,c)||(Ps=c,c=Ci(ra,"onSelect"),0<c.length&&(t=new Qo("onSelect","select",null,t,s),e.push({event:t,listeners:c}),t.target=qn)))}function bi(e,t){var s={};return s[e.toLowerCase()]=t.toLowerCase(),s["Webkit"+e]="webkit"+t,s["Moz"+e]="moz"+t,s}var Qn={animationend:bi("Animation","AnimationEnd"),animationiteration:bi("Animation","AnimationIteration"),animationstart:bi("Animation","AnimationStart"),transitionend:bi("Transition","TransitionEnd")},sa={},Pc={};f&&(Pc=document.createElement("div").style,"AnimationEvent"in window||(delete Qn.animationend.animation,delete Qn.animationiteration.animation,delete Qn.animationstart.animation),"TransitionEvent"in window||delete Qn.transitionend.transition);function ki(e){if(sa[e])return sa[e];if(!Qn[e])return e;var t=Qn[e],s;for(s in t)if(t.hasOwnProperty(s)&&s in Pc)return sa[e]=t[s];return e}var Oc=ki("animationend"),Lc=ki("animationiteration"),Ic=ki("animationstart"),Dc=ki("transitionend"),Fc=new Map,Bc="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Zr(e,t){Fc.set(e,t),l(t,[e])}for(var ia=0;ia<Bc.length;ia++){var oa=Bc[ia],Cp=oa.toLowerCase(),jp=oa[0].toUpperCase()+oa.slice(1);Zr(Cp,"on"+jp)}Zr(Oc,"onAnimationEnd"),Zr(Lc,"onAnimationIteration"),Zr(Ic,"onAnimationStart"),Zr("dblclick","onDoubleClick"),Zr("focusin","onFocus"),Zr("focusout","onBlur"),Zr(Dc,"onTransitionEnd"),d("onMouseEnter",["mouseout","mouseover"]),d("onMouseLeave",["mouseout","mouseover"]),d("onPointerEnter",["pointerout","pointerover"]),d("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Os="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Np=new Set("cancel close invalid load scroll toggle".split(" ").concat(Os));function Uc(e,t,s){var c=e.type||"unknown-event";e.currentTarget=s,vs(c,t,void 0,e),e.currentTarget=null}function zc(e,t){t=(t&4)!==0;for(var s=0;s<e.length;s++){var c=e[s],p=c.event;c=c.listeners;e:{var g=void 0;if(t)for(var R=c.length-1;0<=R;R--){var W=c[R],Z=W.instance,pe=W.currentTarget;if(W=W.listener,Z!==g&&p.isPropagationStopped())break e;Uc(p,W,pe),g=Z}else for(R=0;R<c.length;R++){if(W=c[R],Z=W.instance,pe=W.currentTarget,W=W.listener,Z!==g&&p.isPropagationStopped())break e;Uc(p,W,pe),g=Z}}}if($n)throw e=ys,$n=!1,ys=null,e}function lt(e,t){var s=t[pa];s===void 0&&(s=t[pa]=new Set);var c=e+"__bubble";s.has(c)||(Mc(t,e,2,!1),s.add(c))}function aa(e,t,s){var c=0;t&&(c|=4),Mc(s,e,c,t)}var Si="_reactListening"+Math.random().toString(36).slice(2);function Ls(e){if(!e[Si]){e[Si]=!0,o.forEach(function(s){s!=="selectionchange"&&(Np.has(s)||aa(s,!1,e),aa(s,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Si]||(t[Si]=!0,aa("selectionchange",!1,t))}}function Mc(e,t,s,c){switch(uc(t)){case 1:var p=zh;break;case 4:p=Mh;break;default:p=Vo}s=p.bind(null,t,s,e),p=void 0,!Mn||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(p=!0),c?p!==void 0?e.addEventListener(t,s,{capture:!0,passive:p}):e.addEventListener(t,s,!0):p!==void 0?e.addEventListener(t,s,{passive:p}):e.addEventListener(t,s,!1)}function la(e,t,s,c,p){var g=c;if((t&1)===0&&(t&2)===0&&c!==null)e:for(;;){if(c===null)return;var R=c.tag;if(R===3||R===4){var W=c.stateNode.containerInfo;if(W===p||W.nodeType===8&&W.parentNode===p)break;if(R===4)for(R=c.return;R!==null;){var Z=R.tag;if((Z===3||Z===4)&&(Z=R.stateNode.containerInfo,Z===p||Z.nodeType===8&&Z.parentNode===p))return;R=R.return}for(;W!==null;){if(R=xn(W),R===null)return;if(Z=R.tag,Z===5||Z===6){c=g=R;continue e}W=W.parentNode}}c=c.return}gs(function(){var pe=g,ke=kr(s),Se=[];e:{var be=Fc.get(e);if(be!==void 0){var _e=Qo,Pe=e;switch(e){case"keypress":if(yi(s)===0)break e;case"keydown":case"keyup":_e=rp;break;case"focusin":Pe="focus",_e=Zo;break;case"focusout":Pe="blur",_e=Zo;break;case"beforeblur":case"afterblur":_e=Zo;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":_e=hc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":_e=Vh;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":_e=ip;break;case Oc:case Lc:case Ic:_e=Qh;break;case Dc:_e=ap;break;case"scroll":_e=$h;break;case"wheel":_e=cp;break;case"copy":case"cut":case"paste":_e=Gh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":_e=mc}var Ie=(t&4)!==0,vt=!Ie&&e==="scroll",de=Ie?be!==null?be+"Capture":null:be;Ie=[];for(var ee=pe,fe;ee!==null;){fe=ee;var Ne=fe.stateNode;if(fe.tag===5&&Ne!==null&&(fe=Ne,de!==null&&(Ne=Mr(ee,de),Ne!=null&&Ie.push(Is(ee,Ne,fe)))),vt)break;ee=ee.return}0<Ie.length&&(be=new _e(be,Pe,null,s,ke),Se.push({event:be,listeners:Ie}))}}if((t&7)===0){e:{if(be=e==="mouseover"||e==="pointerover",_e=e==="mouseout"||e==="pointerout",be&&s!==It&&(Pe=s.relatedTarget||s.fromElement)&&(xn(Pe)||Pe[Tr]))break e;if((_e||be)&&(be=ke.window===ke?ke:(be=ke.ownerDocument)?be.defaultView||be.parentWindow:window,_e?(Pe=s.relatedTarget||s.toElement,_e=pe,Pe=Pe?xn(Pe):null,Pe!==null&&(vt=Ar(Pe),Pe!==vt||Pe.tag!==5&&Pe.tag!==6)&&(Pe=null)):(_e=null,Pe=pe),_e!==Pe)){if(Ie=hc,Ne="onMouseLeave",de="onMouseEnter",ee="mouse",(e==="pointerout"||e==="pointerover")&&(Ie=mc,Ne="onPointerLeave",de="onPointerEnter",ee="pointer"),vt=_e==null?be:Zn(_e),fe=Pe==null?be:Zn(Pe),be=new Ie(Ne,ee+"leave",_e,s,ke),be.target=vt,be.relatedTarget=fe,Ne=null,xn(ke)===pe&&(Ie=new Ie(de,ee+"enter",Pe,s,ke),Ie.target=fe,Ie.relatedTarget=vt,Ne=Ie),vt=Ne,_e&&Pe)t:{for(Ie=_e,de=Pe,ee=0,fe=Ie;fe;fe=Kn(fe))ee++;for(fe=0,Ne=de;Ne;Ne=Kn(Ne))fe++;for(;0<ee-fe;)Ie=Kn(Ie),ee--;for(;0<fe-ee;)de=Kn(de),fe--;for(;ee--;){if(Ie===de||de!==null&&Ie===de.alternate)break t;Ie=Kn(Ie),de=Kn(de)}Ie=null}else Ie=null;_e!==null&&$c(Se,be,_e,Ie,!1),Pe!==null&&vt!==null&&$c(Se,vt,Pe,Ie,!0)}}e:{if(be=pe?Zn(pe):window,_e=be.nodeName&&be.nodeName.toLowerCase(),_e==="select"||_e==="input"&&be.type==="file")var De=gp;else if(bc(be))if(Sc)De=wp;else{De=vp;var Ue=yp}else(_e=be.nodeName)&&_e.toLowerCase()==="input"&&(be.type==="checkbox"||be.type==="radio")&&(De=xp);if(De&&(De=De(e,pe))){kc(Se,De,s,ke);break e}Ue&&Ue(e,be,pe),e==="focusout"&&(Ue=be._wrapperState)&&Ue.controlled&&be.type==="number"&&V(be,"number",be.value)}switch(Ue=pe?Zn(pe):window,e){case"focusin":(bc(Ue)||Ue.contentEditable==="true")&&(qn=Ue,ra=pe,Ps=null);break;case"focusout":Ps=ra=qn=null;break;case"mousedown":na=!0;break;case"contextmenu":case"mouseup":case"dragend":na=!1,Tc(Se,s,ke);break;case"selectionchange":if(Sp)break;case"keydown":case"keyup":Tc(Se,s,ke)}var ze;if(Yo)e:{switch(e){case"compositionstart":var Ve="onCompositionStart";break e;case"compositionend":Ve="onCompositionEnd";break e;case"compositionupdate":Ve="onCompositionUpdate";break e}Ve=void 0}else Hn?xc(e,s)&&(Ve="onCompositionEnd"):e==="keydown"&&s.keyCode===229&&(Ve="onCompositionStart");Ve&&(gc&&s.locale!=="ko"&&(Hn||Ve!=="onCompositionStart"?Ve==="onCompositionEnd"&&Hn&&(ze=dc()):(Gr=ke,qo="value"in Gr?Gr.value:Gr.textContent,Hn=!0)),Ue=Ci(pe,Ve),0<Ue.length&&(Ve=new pc(Ve,e,null,s,ke),Se.push({event:Ve,listeners:Ue}),ze?Ve.data=ze:(ze=wc(s),ze!==null&&(Ve.data=ze)))),(ze=dp?fp(e,s):hp(e,s))&&(pe=Ci(pe,"onBeforeInput"),0<pe.length&&(ke=new pc("onBeforeInput","beforeinput",null,s,ke),Se.push({event:ke,listeners:pe}),ke.data=ze))}zc(Se,t)})}function Is(e,t,s){return{instance:e,listener:t,currentTarget:s}}function Ci(e,t){for(var s=t+"Capture",c=[];e!==null;){var p=e,g=p.stateNode;p.tag===5&&g!==null&&(p=g,g=Mr(e,s),g!=null&&c.unshift(Is(e,g,p)),g=Mr(e,t),g!=null&&c.push(Is(e,g,p))),e=e.return}return c}function Kn(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function $c(e,t,s,c,p){for(var g=t._reactName,R=[];s!==null&&s!==c;){var W=s,Z=W.alternate,pe=W.stateNode;if(Z!==null&&Z===c)break;W.tag===5&&pe!==null&&(W=pe,p?(Z=Mr(s,g),Z!=null&&R.unshift(Is(s,Z,W))):p||(Z=Mr(s,g),Z!=null&&R.push(Is(s,Z,W)))),s=s.return}R.length!==0&&e.push({event:t,listeners:R})}var Ep=/\r\n?/g,_p=/\u0000|\uFFFD/g;function Wc(e){return(typeof e=="string"?e:""+e).replace(Ep,`
`).replace(_p,"")}function ji(e,t,s){if(t=Wc(t),Wc(e)!==t&&s)throw Error(n(425))}function Ni(){}var ca=null,ua=null;function da(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var fa=typeof setTimeout=="function"?setTimeout:void 0,Rp=typeof clearTimeout=="function"?clearTimeout:void 0,Vc=typeof Promise=="function"?Promise:void 0,Ap=typeof queueMicrotask=="function"?queueMicrotask:typeof Vc<"u"?function(e){return Vc.resolve(null).then(e).catch(Tp)}:fa;function Tp(e){setTimeout(function(){throw e})}function ha(e,t){var s=t,c=0;do{var p=s.nextSibling;if(e.removeChild(s),p&&p.nodeType===8)if(s=p.data,s==="/$"){if(c===0){e.removeChild(p),js(t);return}c--}else s!=="$"&&s!=="$?"&&s!=="$!"||c++;s=p}while(s);js(t)}function Xr(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Hc(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var s=e.data;if(s==="$"||s==="$!"||s==="$?"){if(t===0)return e;t--}else s==="/$"&&t++}e=e.previousSibling}return null}var Gn=Math.random().toString(36).slice(2),Sr="__reactFiber$"+Gn,Ds="__reactProps$"+Gn,Tr="__reactContainer$"+Gn,pa="__reactEvents$"+Gn,Pp="__reactListeners$"+Gn,Op="__reactHandles$"+Gn;function xn(e){var t=e[Sr];if(t)return t;for(var s=e.parentNode;s;){if(t=s[Tr]||s[Sr]){if(s=t.alternate,t.child!==null||s!==null&&s.child!==null)for(e=Hc(e);e!==null;){if(s=e[Sr])return s;e=Hc(e)}return t}e=s,s=e.parentNode}return null}function Fs(e){return e=e[Sr]||e[Tr],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Zn(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(n(33))}function Ei(e){return e[Ds]||null}var ma=[],Xn=-1;function Yr(e){return{current:e}}function ct(e){0>Xn||(e.current=ma[Xn],ma[Xn]=null,Xn--)}function ot(e,t){Xn++,ma[Xn]=e.current,e.current=t}var Jr={},Ft=Yr(Jr),Qt=Yr(!1),wn=Jr;function Yn(e,t){var s=e.type.contextTypes;if(!s)return Jr;var c=e.stateNode;if(c&&c.__reactInternalMemoizedUnmaskedChildContext===t)return c.__reactInternalMemoizedMaskedChildContext;var p={},g;for(g in s)p[g]=t[g];return c&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=p),p}function Kt(e){return e=e.childContextTypes,e!=null}function _i(){ct(Qt),ct(Ft)}function qc(e,t,s){if(Ft.current!==Jr)throw Error(n(168));ot(Ft,t),ot(Qt,s)}function Qc(e,t,s){var c=e.stateNode;if(t=t.childContextTypes,typeof c.getChildContext!="function")return s;c=c.getChildContext();for(var p in c)if(!(p in t))throw Error(n(108,Ee(e)||"Unknown",p));return ue({},s,c)}function Ri(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Jr,wn=Ft.current,ot(Ft,e),ot(Qt,Qt.current),!0}function Kc(e,t,s){var c=e.stateNode;if(!c)throw Error(n(169));s?(e=Qc(e,t,wn),c.__reactInternalMemoizedMergedChildContext=e,ct(Qt),ct(Ft),ot(Ft,e)):ct(Qt),ot(Qt,s)}var Pr=null,Ai=!1,ga=!1;function Gc(e){Pr===null?Pr=[e]:Pr.push(e)}function Lp(e){Ai=!0,Gc(e)}function en(){if(!ga&&Pr!==null){ga=!0;var e=0,t=rt;try{var s=Pr;for(rt=1;e<s.length;e++){var c=s[e];do c=c(!0);while(c!==null)}Pr=null,Ai=!1}catch(p){throw Pr!==null&&(Pr=Pr.slice(e+1)),ui(ye,en),p}finally{rt=t,ga=!1}}return null}var Jn=[],es=0,Ti=null,Pi=0,ar=[],lr=0,bn=null,Or=1,Lr="";function kn(e,t){Jn[es++]=Pi,Jn[es++]=Ti,Ti=e,Pi=t}function Zc(e,t,s){ar[lr++]=Or,ar[lr++]=Lr,ar[lr++]=bn,bn=e;var c=Or;e=Lr;var p=32-st(c)-1;c&=~(1<<p),s+=1;var g=32-st(t)+p;if(30<g){var R=p-p%5;g=(c&(1<<R)-1).toString(32),c>>=R,p-=R,Or=1<<32-st(t)+p|s<<p|c,Lr=g+e}else Or=1<<g|s<<p|c,Lr=e}function ya(e){e.return!==null&&(kn(e,1),Zc(e,1,0))}function va(e){for(;e===Ti;)Ti=Jn[--es],Jn[es]=null,Pi=Jn[--es],Jn[es]=null;for(;e===bn;)bn=ar[--lr],ar[lr]=null,Lr=ar[--lr],ar[lr]=null,Or=ar[--lr],ar[lr]=null}var rr=null,nr=null,ft=!1,mr=null;function Xc(e,t){var s=fr(5,null,null,0);s.elementType="DELETED",s.stateNode=t,s.return=e,t=e.deletions,t===null?(e.deletions=[s],e.flags|=16):t.push(s)}function Yc(e,t){switch(e.tag){case 5:var s=e.type;return t=t.nodeType!==1||s.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,rr=e,nr=Xr(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,rr=e,nr=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(s=bn!==null?{id:Or,overflow:Lr}:null,e.memoizedState={dehydrated:t,treeContext:s,retryLane:1073741824},s=fr(18,null,null,0),s.stateNode=t,s.return=e,e.child=s,rr=e,nr=null,!0):!1;default:return!1}}function xa(e){return(e.mode&1)!==0&&(e.flags&128)===0}function wa(e){if(ft){var t=nr;if(t){var s=t;if(!Yc(e,t)){if(xa(e))throw Error(n(418));t=Xr(s.nextSibling);var c=rr;t&&Yc(e,t)?Xc(c,s):(e.flags=e.flags&-4097|2,ft=!1,rr=e)}}else{if(xa(e))throw Error(n(418));e.flags=e.flags&-4097|2,ft=!1,rr=e}}}function Jc(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;rr=e}function Oi(e){if(e!==rr)return!1;if(!ft)return Jc(e),ft=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!da(e.type,e.memoizedProps)),t&&(t=nr)){if(xa(e))throw eu(),Error(n(418));for(;t;)Xc(e,t),t=Xr(t.nextSibling)}if(Jc(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(n(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var s=e.data;if(s==="/$"){if(t===0){nr=Xr(e.nextSibling);break e}t--}else s!=="$"&&s!=="$!"&&s!=="$?"||t++}e=e.nextSibling}nr=null}}else nr=rr?Xr(e.stateNode.nextSibling):null;return!0}function eu(){for(var e=nr;e;)e=Xr(e.nextSibling)}function ts(){nr=rr=null,ft=!1}function ba(e){mr===null?mr=[e]:mr.push(e)}var Ip=U.ReactCurrentBatchConfig;function Bs(e,t,s){if(e=s.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(s._owner){if(s=s._owner,s){if(s.tag!==1)throw Error(n(309));var c=s.stateNode}if(!c)throw Error(n(147,e));var p=c,g=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===g?t.ref:(t=function(R){var W=p.refs;R===null?delete W[g]:W[g]=R},t._stringRef=g,t)}if(typeof e!="string")throw Error(n(284));if(!s._owner)throw Error(n(290,e))}return e}function Li(e,t){throw e=Object.prototype.toString.call(t),Error(n(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function tu(e){var t=e._init;return t(e._payload)}function ru(e){function t(de,ee){if(e){var fe=de.deletions;fe===null?(de.deletions=[ee],de.flags|=16):fe.push(ee)}}function s(de,ee){if(!e)return null;for(;ee!==null;)t(de,ee),ee=ee.sibling;return null}function c(de,ee){for(de=new Map;ee!==null;)ee.key!==null?de.set(ee.key,ee):de.set(ee.index,ee),ee=ee.sibling;return de}function p(de,ee){return de=cn(de,ee),de.index=0,de.sibling=null,de}function g(de,ee,fe){return de.index=fe,e?(fe=de.alternate,fe!==null?(fe=fe.index,fe<ee?(de.flags|=2,ee):fe):(de.flags|=2,ee)):(de.flags|=1048576,ee)}function R(de){return e&&de.alternate===null&&(de.flags|=2),de}function W(de,ee,fe,Ne){return ee===null||ee.tag!==6?(ee=fl(fe,de.mode,Ne),ee.return=de,ee):(ee=p(ee,fe),ee.return=de,ee)}function Z(de,ee,fe,Ne){var De=fe.type;return De===J?ke(de,ee,fe.props.children,Ne,fe.key):ee!==null&&(ee.elementType===De||typeof De=="object"&&De!==null&&De.$$typeof===ge&&tu(De)===ee.type)?(Ne=p(ee,fe.props),Ne.ref=Bs(de,ee,fe),Ne.return=de,Ne):(Ne=so(fe.type,fe.key,fe.props,null,de.mode,Ne),Ne.ref=Bs(de,ee,fe),Ne.return=de,Ne)}function pe(de,ee,fe,Ne){return ee===null||ee.tag!==4||ee.stateNode.containerInfo!==fe.containerInfo||ee.stateNode.implementation!==fe.implementation?(ee=hl(fe,de.mode,Ne),ee.return=de,ee):(ee=p(ee,fe.children||[]),ee.return=de,ee)}function ke(de,ee,fe,Ne,De){return ee===null||ee.tag!==7?(ee=An(fe,de.mode,Ne,De),ee.return=de,ee):(ee=p(ee,fe),ee.return=de,ee)}function Se(de,ee,fe){if(typeof ee=="string"&&ee!==""||typeof ee=="number")return ee=fl(""+ee,de.mode,fe),ee.return=de,ee;if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case M:return fe=so(ee.type,ee.key,ee.props,null,de.mode,fe),fe.ref=Bs(de,null,ee),fe.return=de,fe;case re:return ee=hl(ee,de.mode,fe),ee.return=de,ee;case ge:var Ne=ee._init;return Se(de,Ne(ee._payload),fe)}if(G(ee)||ie(ee))return ee=An(ee,de.mode,fe,null),ee.return=de,ee;Li(de,ee)}return null}function be(de,ee,fe,Ne){var De=ee!==null?ee.key:null;if(typeof fe=="string"&&fe!==""||typeof fe=="number")return De!==null?null:W(de,ee,""+fe,Ne);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case M:return fe.key===De?Z(de,ee,fe,Ne):null;case re:return fe.key===De?pe(de,ee,fe,Ne):null;case ge:return De=fe._init,be(de,ee,De(fe._payload),Ne)}if(G(fe)||ie(fe))return De!==null?null:ke(de,ee,fe,Ne,null);Li(de,fe)}return null}function _e(de,ee,fe,Ne,De){if(typeof Ne=="string"&&Ne!==""||typeof Ne=="number")return de=de.get(fe)||null,W(ee,de,""+Ne,De);if(typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case M:return de=de.get(Ne.key===null?fe:Ne.key)||null,Z(ee,de,Ne,De);case re:return de=de.get(Ne.key===null?fe:Ne.key)||null,pe(ee,de,Ne,De);case ge:var Ue=Ne._init;return _e(de,ee,fe,Ue(Ne._payload),De)}if(G(Ne)||ie(Ne))return de=de.get(fe)||null,ke(ee,de,Ne,De,null);Li(ee,Ne)}return null}function Pe(de,ee,fe,Ne){for(var De=null,Ue=null,ze=ee,Ve=ee=0,Rt=null;ze!==null&&Ve<fe.length;Ve++){ze.index>Ve?(Rt=ze,ze=null):Rt=ze.sibling;var tt=be(de,ze,fe[Ve],Ne);if(tt===null){ze===null&&(ze=Rt);break}e&&ze&&tt.alternate===null&&t(de,ze),ee=g(tt,ee,Ve),Ue===null?De=tt:Ue.sibling=tt,Ue=tt,ze=Rt}if(Ve===fe.length)return s(de,ze),ft&&kn(de,Ve),De;if(ze===null){for(;Ve<fe.length;Ve++)ze=Se(de,fe[Ve],Ne),ze!==null&&(ee=g(ze,ee,Ve),Ue===null?De=ze:Ue.sibling=ze,Ue=ze);return ft&&kn(de,Ve),De}for(ze=c(de,ze);Ve<fe.length;Ve++)Rt=_e(ze,de,Ve,fe[Ve],Ne),Rt!==null&&(e&&Rt.alternate!==null&&ze.delete(Rt.key===null?Ve:Rt.key),ee=g(Rt,ee,Ve),Ue===null?De=Rt:Ue.sibling=Rt,Ue=Rt);return e&&ze.forEach(function(un){return t(de,un)}),ft&&kn(de,Ve),De}function Ie(de,ee,fe,Ne){var De=ie(fe);if(typeof De!="function")throw Error(n(150));if(fe=De.call(fe),fe==null)throw Error(n(151));for(var Ue=De=null,ze=ee,Ve=ee=0,Rt=null,tt=fe.next();ze!==null&&!tt.done;Ve++,tt=fe.next()){ze.index>Ve?(Rt=ze,ze=null):Rt=ze.sibling;var un=be(de,ze,tt.value,Ne);if(un===null){ze===null&&(ze=Rt);break}e&&ze&&un.alternate===null&&t(de,ze),ee=g(un,ee,Ve),Ue===null?De=un:Ue.sibling=un,Ue=un,ze=Rt}if(tt.done)return s(de,ze),ft&&kn(de,Ve),De;if(ze===null){for(;!tt.done;Ve++,tt=fe.next())tt=Se(de,tt.value,Ne),tt!==null&&(ee=g(tt,ee,Ve),Ue===null?De=tt:Ue.sibling=tt,Ue=tt);return ft&&kn(de,Ve),De}for(ze=c(de,ze);!tt.done;Ve++,tt=fe.next())tt=_e(ze,de,Ve,tt.value,Ne),tt!==null&&(e&&tt.alternate!==null&&ze.delete(tt.key===null?Ve:tt.key),ee=g(tt,ee,Ve),Ue===null?De=tt:Ue.sibling=tt,Ue=tt);return e&&ze.forEach(function(pm){return t(de,pm)}),ft&&kn(de,Ve),De}function vt(de,ee,fe,Ne){if(typeof fe=="object"&&fe!==null&&fe.type===J&&fe.key===null&&(fe=fe.props.children),typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case M:e:{for(var De=fe.key,Ue=ee;Ue!==null;){if(Ue.key===De){if(De=fe.type,De===J){if(Ue.tag===7){s(de,Ue.sibling),ee=p(Ue,fe.props.children),ee.return=de,de=ee;break e}}else if(Ue.elementType===De||typeof De=="object"&&De!==null&&De.$$typeof===ge&&tu(De)===Ue.type){s(de,Ue.sibling),ee=p(Ue,fe.props),ee.ref=Bs(de,Ue,fe),ee.return=de,de=ee;break e}s(de,Ue);break}else t(de,Ue);Ue=Ue.sibling}fe.type===J?(ee=An(fe.props.children,de.mode,Ne,fe.key),ee.return=de,de=ee):(Ne=so(fe.type,fe.key,fe.props,null,de.mode,Ne),Ne.ref=Bs(de,ee,fe),Ne.return=de,de=Ne)}return R(de);case re:e:{for(Ue=fe.key;ee!==null;){if(ee.key===Ue)if(ee.tag===4&&ee.stateNode.containerInfo===fe.containerInfo&&ee.stateNode.implementation===fe.implementation){s(de,ee.sibling),ee=p(ee,fe.children||[]),ee.return=de,de=ee;break e}else{s(de,ee);break}else t(de,ee);ee=ee.sibling}ee=hl(fe,de.mode,Ne),ee.return=de,de=ee}return R(de);case ge:return Ue=fe._init,vt(de,ee,Ue(fe._payload),Ne)}if(G(fe))return Pe(de,ee,fe,Ne);if(ie(fe))return Ie(de,ee,fe,Ne);Li(de,fe)}return typeof fe=="string"&&fe!==""||typeof fe=="number"?(fe=""+fe,ee!==null&&ee.tag===6?(s(de,ee.sibling),ee=p(ee,fe),ee.return=de,de=ee):(s(de,ee),ee=fl(fe,de.mode,Ne),ee.return=de,de=ee),R(de)):s(de,ee)}return vt}var rs=ru(!0),nu=ru(!1),Ii=Yr(null),Di=null,ns=null,ka=null;function Sa(){ka=ns=Di=null}function Ca(e){var t=Ii.current;ct(Ii),e._currentValue=t}function ja(e,t,s){for(;e!==null;){var c=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,c!==null&&(c.childLanes|=t)):c!==null&&(c.childLanes&t)!==t&&(c.childLanes|=t),e===s)break;e=e.return}}function ss(e,t){Di=e,ka=ns=null,e=e.dependencies,e!==null&&e.firstContext!==null&&((e.lanes&t)!==0&&(Gt=!0),e.firstContext=null)}function cr(e){var t=e._currentValue;if(ka!==e)if(e={context:e,memoizedValue:t,next:null},ns===null){if(Di===null)throw Error(n(308));ns=e,Di.dependencies={lanes:0,firstContext:e}}else ns=ns.next=e;return t}var Sn=null;function Na(e){Sn===null?Sn=[e]:Sn.push(e)}function su(e,t,s,c){var p=t.interleaved;return p===null?(s.next=s,Na(t)):(s.next=p.next,p.next=s),t.interleaved=s,Ir(e,c)}function Ir(e,t){e.lanes|=t;var s=e.alternate;for(s!==null&&(s.lanes|=t),s=e,e=e.return;e!==null;)e.childLanes|=t,s=e.alternate,s!==null&&(s.childLanes|=t),s=e,e=e.return;return s.tag===3?s.stateNode:null}var tn=!1;function Ea(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function iu(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Dr(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function rn(e,t,s){var c=e.updateQueue;if(c===null)return null;if(c=c.shared,(et&2)!==0){var p=c.pending;return p===null?t.next=t:(t.next=p.next,p.next=t),c.pending=t,Ir(e,s)}return p=c.interleaved,p===null?(t.next=t,Na(c)):(t.next=p.next,p.next=t),c.interleaved=t,Ir(e,s)}function Fi(e,t,s){if(t=t.updateQueue,t!==null&&(t=t.shared,(s&4194240)!==0)){var c=t.lanes;c&=e.pendingLanes,s|=c,t.lanes=s,Mo(e,s)}}function ou(e,t){var s=e.updateQueue,c=e.alternate;if(c!==null&&(c=c.updateQueue,s===c)){var p=null,g=null;if(s=s.firstBaseUpdate,s!==null){do{var R={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};g===null?p=g=R:g=g.next=R,s=s.next}while(s!==null);g===null?p=g=t:g=g.next=t}else p=g=t;s={baseState:c.baseState,firstBaseUpdate:p,lastBaseUpdate:g,shared:c.shared,effects:c.effects},e.updateQueue=s;return}e=s.lastBaseUpdate,e===null?s.firstBaseUpdate=t:e.next=t,s.lastBaseUpdate=t}function Bi(e,t,s,c){var p=e.updateQueue;tn=!1;var g=p.firstBaseUpdate,R=p.lastBaseUpdate,W=p.shared.pending;if(W!==null){p.shared.pending=null;var Z=W,pe=Z.next;Z.next=null,R===null?g=pe:R.next=pe,R=Z;var ke=e.alternate;ke!==null&&(ke=ke.updateQueue,W=ke.lastBaseUpdate,W!==R&&(W===null?ke.firstBaseUpdate=pe:W.next=pe,ke.lastBaseUpdate=Z))}if(g!==null){var Se=p.baseState;R=0,ke=pe=Z=null,W=g;do{var be=W.lane,_e=W.eventTime;if((c&be)===be){ke!==null&&(ke=ke.next={eventTime:_e,lane:0,tag:W.tag,payload:W.payload,callback:W.callback,next:null});e:{var Pe=e,Ie=W;switch(be=t,_e=s,Ie.tag){case 1:if(Pe=Ie.payload,typeof Pe=="function"){Se=Pe.call(_e,Se,be);break e}Se=Pe;break e;case 3:Pe.flags=Pe.flags&-65537|128;case 0:if(Pe=Ie.payload,be=typeof Pe=="function"?Pe.call(_e,Se,be):Pe,be==null)break e;Se=ue({},Se,be);break e;case 2:tn=!0}}W.callback!==null&&W.lane!==0&&(e.flags|=64,be=p.effects,be===null?p.effects=[W]:be.push(W))}else _e={eventTime:_e,lane:be,tag:W.tag,payload:W.payload,callback:W.callback,next:null},ke===null?(pe=ke=_e,Z=Se):ke=ke.next=_e,R|=be;if(W=W.next,W===null){if(W=p.shared.pending,W===null)break;be=W,W=be.next,be.next=null,p.lastBaseUpdate=be,p.shared.pending=null}}while(!0);if(ke===null&&(Z=Se),p.baseState=Z,p.firstBaseUpdate=pe,p.lastBaseUpdate=ke,t=p.shared.interleaved,t!==null){p=t;do R|=p.lane,p=p.next;while(p!==t)}else g===null&&(p.shared.lanes=0);Nn|=R,e.lanes=R,e.memoizedState=Se}}function au(e,t,s){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var c=e[t],p=c.callback;if(p!==null){if(c.callback=null,c=s,typeof p!="function")throw Error(n(191,p));p.call(c)}}}var Us={},Cr=Yr(Us),zs=Yr(Us),Ms=Yr(Us);function Cn(e){if(e===Us)throw Error(n(174));return e}function _a(e,t){switch(ot(Ms,t),ot(zs,e),ot(Cr,Us),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ve(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=ve(t,e)}ct(Cr),ot(Cr,t)}function is(){ct(Cr),ct(zs),ct(Ms)}function lu(e){Cn(Ms.current);var t=Cn(Cr.current),s=ve(t,e.type);t!==s&&(ot(zs,e),ot(Cr,s))}function Ra(e){zs.current===e&&(ct(Cr),ct(zs))}var pt=Yr(0);function Ui(e){for(var t=e;t!==null;){if(t.tag===13){var s=t.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||s.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Aa=[];function Ta(){for(var e=0;e<Aa.length;e++)Aa[e]._workInProgressVersionPrimary=null;Aa.length=0}var zi=U.ReactCurrentDispatcher,Pa=U.ReactCurrentBatchConfig,jn=0,mt=null,wt=null,Et=null,Mi=!1,$s=!1,Ws=0,Dp=0;function Bt(){throw Error(n(321))}function Oa(e,t){if(t===null)return!1;for(var s=0;s<t.length&&s<e.length;s++)if(!pr(e[s],t[s]))return!1;return!0}function La(e,t,s,c,p,g){if(jn=g,mt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,zi.current=e===null||e.memoizedState===null?zp:Mp,e=s(c,p),$s){g=0;do{if($s=!1,Ws=0,25<=g)throw Error(n(301));g+=1,Et=wt=null,t.updateQueue=null,zi.current=$p,e=s(c,p)}while($s)}if(zi.current=Vi,t=wt!==null&&wt.next!==null,jn=0,Et=wt=mt=null,Mi=!1,t)throw Error(n(300));return e}function Ia(){var e=Ws!==0;return Ws=0,e}function jr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Et===null?mt.memoizedState=Et=e:Et=Et.next=e,Et}function ur(){if(wt===null){var e=mt.alternate;e=e!==null?e.memoizedState:null}else e=wt.next;var t=Et===null?mt.memoizedState:Et.next;if(t!==null)Et=t,wt=e;else{if(e===null)throw Error(n(310));wt=e,e={memoizedState:wt.memoizedState,baseState:wt.baseState,baseQueue:wt.baseQueue,queue:wt.queue,next:null},Et===null?mt.memoizedState=Et=e:Et=Et.next=e}return Et}function Vs(e,t){return typeof t=="function"?t(e):t}function Da(e){var t=ur(),s=t.queue;if(s===null)throw Error(n(311));s.lastRenderedReducer=e;var c=wt,p=c.baseQueue,g=s.pending;if(g!==null){if(p!==null){var R=p.next;p.next=g.next,g.next=R}c.baseQueue=p=g,s.pending=null}if(p!==null){g=p.next,c=c.baseState;var W=R=null,Z=null,pe=g;do{var ke=pe.lane;if((jn&ke)===ke)Z!==null&&(Z=Z.next={lane:0,action:pe.action,hasEagerState:pe.hasEagerState,eagerState:pe.eagerState,next:null}),c=pe.hasEagerState?pe.eagerState:e(c,pe.action);else{var Se={lane:ke,action:pe.action,hasEagerState:pe.hasEagerState,eagerState:pe.eagerState,next:null};Z===null?(W=Z=Se,R=c):Z=Z.next=Se,mt.lanes|=ke,Nn|=ke}pe=pe.next}while(pe!==null&&pe!==g);Z===null?R=c:Z.next=W,pr(c,t.memoizedState)||(Gt=!0),t.memoizedState=c,t.baseState=R,t.baseQueue=Z,s.lastRenderedState=c}if(e=s.interleaved,e!==null){p=e;do g=p.lane,mt.lanes|=g,Nn|=g,p=p.next;while(p!==e)}else p===null&&(s.lanes=0);return[t.memoizedState,s.dispatch]}function Fa(e){var t=ur(),s=t.queue;if(s===null)throw Error(n(311));s.lastRenderedReducer=e;var c=s.dispatch,p=s.pending,g=t.memoizedState;if(p!==null){s.pending=null;var R=p=p.next;do g=e(g,R.action),R=R.next;while(R!==p);pr(g,t.memoizedState)||(Gt=!0),t.memoizedState=g,t.baseQueue===null&&(t.baseState=g),s.lastRenderedState=g}return[g,c]}function cu(){}function uu(e,t){var s=mt,c=ur(),p=t(),g=!pr(c.memoizedState,p);if(g&&(c.memoizedState=p,Gt=!0),c=c.queue,Ba(hu.bind(null,s,c,e),[e]),c.getSnapshot!==t||g||Et!==null&&Et.memoizedState.tag&1){if(s.flags|=2048,Hs(9,fu.bind(null,s,c,p,t),void 0,null),_t===null)throw Error(n(349));(jn&30)!==0||du(s,t,p)}return p}function du(e,t,s){e.flags|=16384,e={getSnapshot:t,value:s},t=mt.updateQueue,t===null?(t={lastEffect:null,stores:null},mt.updateQueue=t,t.stores=[e]):(s=t.stores,s===null?t.stores=[e]:s.push(e))}function fu(e,t,s,c){t.value=s,t.getSnapshot=c,pu(t)&&mu(e)}function hu(e,t,s){return s(function(){pu(t)&&mu(e)})}function pu(e){var t=e.getSnapshot;e=e.value;try{var s=t();return!pr(e,s)}catch{return!0}}function mu(e){var t=Ir(e,1);t!==null&&xr(t,e,1,-1)}function gu(e){var t=jr();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vs,lastRenderedState:e},t.queue=e,e=e.dispatch=Up.bind(null,mt,e),[t.memoizedState,e]}function Hs(e,t,s,c){return e={tag:e,create:t,destroy:s,deps:c,next:null},t=mt.updateQueue,t===null?(t={lastEffect:null,stores:null},mt.updateQueue=t,t.lastEffect=e.next=e):(s=t.lastEffect,s===null?t.lastEffect=e.next=e:(c=s.next,s.next=e,e.next=c,t.lastEffect=e)),e}function yu(){return ur().memoizedState}function $i(e,t,s,c){var p=jr();mt.flags|=e,p.memoizedState=Hs(1|t,s,void 0,c===void 0?null:c)}function Wi(e,t,s,c){var p=ur();c=c===void 0?null:c;var g=void 0;if(wt!==null){var R=wt.memoizedState;if(g=R.destroy,c!==null&&Oa(c,R.deps)){p.memoizedState=Hs(t,s,g,c);return}}mt.flags|=e,p.memoizedState=Hs(1|t,s,g,c)}function vu(e,t){return $i(8390656,8,e,t)}function Ba(e,t){return Wi(2048,8,e,t)}function xu(e,t){return Wi(4,2,e,t)}function wu(e,t){return Wi(4,4,e,t)}function bu(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function ku(e,t,s){return s=s!=null?s.concat([e]):null,Wi(4,4,bu.bind(null,t,e),s)}function Ua(){}function Su(e,t){var s=ur();t=t===void 0?null:t;var c=s.memoizedState;return c!==null&&t!==null&&Oa(t,c[1])?c[0]:(s.memoizedState=[e,t],e)}function Cu(e,t){var s=ur();t=t===void 0?null:t;var c=s.memoizedState;return c!==null&&t!==null&&Oa(t,c[1])?c[0]:(e=e(),s.memoizedState=[e,t],e)}function ju(e,t,s){return(jn&21)===0?(e.baseState&&(e.baseState=!1,Gt=!0),e.memoizedState=s):(pr(s,t)||(s=tc(),mt.lanes|=s,Nn|=s,e.baseState=!0),t)}function Fp(e,t){var s=rt;rt=s!==0&&4>s?s:4,e(!0);var c=Pa.transition;Pa.transition={};try{e(!1),t()}finally{rt=s,Pa.transition=c}}function Nu(){return ur().memoizedState}function Bp(e,t,s){var c=an(e);if(s={lane:c,action:s,hasEagerState:!1,eagerState:null,next:null},Eu(e))_u(t,s);else if(s=su(e,t,s,c),s!==null){var p=Ht();xr(s,e,c,p),Ru(s,t,c)}}function Up(e,t,s){var c=an(e),p={lane:c,action:s,hasEagerState:!1,eagerState:null,next:null};if(Eu(e))_u(t,p);else{var g=e.alternate;if(e.lanes===0&&(g===null||g.lanes===0)&&(g=t.lastRenderedReducer,g!==null))try{var R=t.lastRenderedState,W=g(R,s);if(p.hasEagerState=!0,p.eagerState=W,pr(W,R)){var Z=t.interleaved;Z===null?(p.next=p,Na(t)):(p.next=Z.next,Z.next=p),t.interleaved=p;return}}catch{}finally{}s=su(e,t,p,c),s!==null&&(p=Ht(),xr(s,e,c,p),Ru(s,t,c))}}function Eu(e){var t=e.alternate;return e===mt||t!==null&&t===mt}function _u(e,t){$s=Mi=!0;var s=e.pending;s===null?t.next=t:(t.next=s.next,s.next=t),e.pending=t}function Ru(e,t,s){if((s&4194240)!==0){var c=t.lanes;c&=e.pendingLanes,s|=c,t.lanes=s,Mo(e,s)}}var Vi={readContext:cr,useCallback:Bt,useContext:Bt,useEffect:Bt,useImperativeHandle:Bt,useInsertionEffect:Bt,useLayoutEffect:Bt,useMemo:Bt,useReducer:Bt,useRef:Bt,useState:Bt,useDebugValue:Bt,useDeferredValue:Bt,useTransition:Bt,useMutableSource:Bt,useSyncExternalStore:Bt,useId:Bt,unstable_isNewReconciler:!1},zp={readContext:cr,useCallback:function(e,t){return jr().memoizedState=[e,t===void 0?null:t],e},useContext:cr,useEffect:vu,useImperativeHandle:function(e,t,s){return s=s!=null?s.concat([e]):null,$i(4194308,4,bu.bind(null,t,e),s)},useLayoutEffect:function(e,t){return $i(4194308,4,e,t)},useInsertionEffect:function(e,t){return $i(4,2,e,t)},useMemo:function(e,t){var s=jr();return t=t===void 0?null:t,e=e(),s.memoizedState=[e,t],e},useReducer:function(e,t,s){var c=jr();return t=s!==void 0?s(t):t,c.memoizedState=c.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},c.queue=e,e=e.dispatch=Bp.bind(null,mt,e),[c.memoizedState,e]},useRef:function(e){var t=jr();return e={current:e},t.memoizedState=e},useState:gu,useDebugValue:Ua,useDeferredValue:function(e){return jr().memoizedState=e},useTransition:function(){var e=gu(!1),t=e[0];return e=Fp.bind(null,e[1]),jr().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,s){var c=mt,p=jr();if(ft){if(s===void 0)throw Error(n(407));s=s()}else{if(s=t(),_t===null)throw Error(n(349));(jn&30)!==0||du(c,t,s)}p.memoizedState=s;var g={value:s,getSnapshot:t};return p.queue=g,vu(hu.bind(null,c,g,e),[e]),c.flags|=2048,Hs(9,fu.bind(null,c,g,s,t),void 0,null),s},useId:function(){var e=jr(),t=_t.identifierPrefix;if(ft){var s=Lr,c=Or;s=(c&~(1<<32-st(c)-1)).toString(32)+s,t=":"+t+"R"+s,s=Ws++,0<s&&(t+="H"+s.toString(32)),t+=":"}else s=Dp++,t=":"+t+"r"+s.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Mp={readContext:cr,useCallback:Su,useContext:cr,useEffect:Ba,useImperativeHandle:ku,useInsertionEffect:xu,useLayoutEffect:wu,useMemo:Cu,useReducer:Da,useRef:yu,useState:function(){return Da(Vs)},useDebugValue:Ua,useDeferredValue:function(e){var t=ur();return ju(t,wt.memoizedState,e)},useTransition:function(){var e=Da(Vs)[0],t=ur().memoizedState;return[e,t]},useMutableSource:cu,useSyncExternalStore:uu,useId:Nu,unstable_isNewReconciler:!1},$p={readContext:cr,useCallback:Su,useContext:cr,useEffect:Ba,useImperativeHandle:ku,useInsertionEffect:xu,useLayoutEffect:wu,useMemo:Cu,useReducer:Fa,useRef:yu,useState:function(){return Fa(Vs)},useDebugValue:Ua,useDeferredValue:function(e){var t=ur();return wt===null?t.memoizedState=e:ju(t,wt.memoizedState,e)},useTransition:function(){var e=Fa(Vs)[0],t=ur().memoizedState;return[e,t]},useMutableSource:cu,useSyncExternalStore:uu,useId:Nu,unstable_isNewReconciler:!1};function gr(e,t){if(e&&e.defaultProps){t=ue({},t),e=e.defaultProps;for(var s in e)t[s]===void 0&&(t[s]=e[s]);return t}return t}function za(e,t,s,c){t=e.memoizedState,s=s(c,t),s=s==null?t:ue({},t,s),e.memoizedState=s,e.lanes===0&&(e.updateQueue.baseState=s)}var Hi={isMounted:function(e){return(e=e._reactInternals)?Ar(e)===e:!1},enqueueSetState:function(e,t,s){e=e._reactInternals;var c=Ht(),p=an(e),g=Dr(c,p);g.payload=t,s!=null&&(g.callback=s),t=rn(e,g,p),t!==null&&(xr(t,e,p,c),Fi(t,e,p))},enqueueReplaceState:function(e,t,s){e=e._reactInternals;var c=Ht(),p=an(e),g=Dr(c,p);g.tag=1,g.payload=t,s!=null&&(g.callback=s),t=rn(e,g,p),t!==null&&(xr(t,e,p,c),Fi(t,e,p))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var s=Ht(),c=an(e),p=Dr(s,c);p.tag=2,t!=null&&(p.callback=t),t=rn(e,p,c),t!==null&&(xr(t,e,c,s),Fi(t,e,c))}};function Au(e,t,s,c,p,g,R){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(c,g,R):t.prototype&&t.prototype.isPureReactComponent?!Ts(s,c)||!Ts(p,g):!0}function Tu(e,t,s){var c=!1,p=Jr,g=t.contextType;return typeof g=="object"&&g!==null?g=cr(g):(p=Kt(t)?wn:Ft.current,c=t.contextTypes,g=(c=c!=null)?Yn(e,p):Jr),t=new t(s,g),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Hi,e.stateNode=t,t._reactInternals=e,c&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=p,e.__reactInternalMemoizedMaskedChildContext=g),t}function Pu(e,t,s,c){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(s,c),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(s,c),t.state!==e&&Hi.enqueueReplaceState(t,t.state,null)}function Ma(e,t,s,c){var p=e.stateNode;p.props=s,p.state=e.memoizedState,p.refs={},Ea(e);var g=t.contextType;typeof g=="object"&&g!==null?p.context=cr(g):(g=Kt(t)?wn:Ft.current,p.context=Yn(e,g)),p.state=e.memoizedState,g=t.getDerivedStateFromProps,typeof g=="function"&&(za(e,t,g,s),p.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(t=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),t!==p.state&&Hi.enqueueReplaceState(p,p.state,null),Bi(e,s,p,c),p.state=e.memoizedState),typeof p.componentDidMount=="function"&&(e.flags|=4194308)}function os(e,t){try{var s="",c=t;do s+=se(c),c=c.return;while(c);var p=s}catch(g){p=`
Error generating stack: `+g.message+`
`+g.stack}return{value:e,source:t,stack:p,digest:null}}function $a(e,t,s){return{value:e,source:null,stack:s??null,digest:t??null}}function Wa(e,t){try{console.error(t.value)}catch(s){setTimeout(function(){throw s})}}var Wp=typeof WeakMap=="function"?WeakMap:Map;function Ou(e,t,s){s=Dr(-1,s),s.tag=3,s.payload={element:null};var c=t.value;return s.callback=function(){Yi||(Yi=!0,sl=c),Wa(e,t)},s}function Lu(e,t,s){s=Dr(-1,s),s.tag=3;var c=e.type.getDerivedStateFromError;if(typeof c=="function"){var p=t.value;s.payload=function(){return c(p)},s.callback=function(){Wa(e,t)}}var g=e.stateNode;return g!==null&&typeof g.componentDidCatch=="function"&&(s.callback=function(){Wa(e,t),typeof c!="function"&&(sn===null?sn=new Set([this]):sn.add(this));var R=t.stack;this.componentDidCatch(t.value,{componentStack:R!==null?R:""})}),s}function Iu(e,t,s){var c=e.pingCache;if(c===null){c=e.pingCache=new Wp;var p=new Set;c.set(t,p)}else p=c.get(t),p===void 0&&(p=new Set,c.set(t,p));p.has(s)||(p.add(s),e=nm.bind(null,e,t,s),t.then(e,e))}function Du(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Fu(e,t,s,c,p){return(e.mode&1)===0?(e===t?e.flags|=65536:(e.flags|=128,s.flags|=131072,s.flags&=-52805,s.tag===1&&(s.alternate===null?s.tag=17:(t=Dr(-1,1),t.tag=2,rn(s,t,1))),s.lanes|=1),e):(e.flags|=65536,e.lanes=p,e)}var Vp=U.ReactCurrentOwner,Gt=!1;function Vt(e,t,s,c){t.child=e===null?nu(t,null,s,c):rs(t,e.child,s,c)}function Bu(e,t,s,c,p){s=s.render;var g=t.ref;return ss(t,p),c=La(e,t,s,c,g,p),s=Ia(),e!==null&&!Gt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~p,Fr(e,t,p)):(ft&&s&&ya(t),t.flags|=1,Vt(e,t,c,p),t.child)}function Uu(e,t,s,c,p){if(e===null){var g=s.type;return typeof g=="function"&&!dl(g)&&g.defaultProps===void 0&&s.compare===null&&s.defaultProps===void 0?(t.tag=15,t.type=g,zu(e,t,g,c,p)):(e=so(s.type,null,c,t,t.mode,p),e.ref=t.ref,e.return=t,t.child=e)}if(g=e.child,(e.lanes&p)===0){var R=g.memoizedProps;if(s=s.compare,s=s!==null?s:Ts,s(R,c)&&e.ref===t.ref)return Fr(e,t,p)}return t.flags|=1,e=cn(g,c),e.ref=t.ref,e.return=t,t.child=e}function zu(e,t,s,c,p){if(e!==null){var g=e.memoizedProps;if(Ts(g,c)&&e.ref===t.ref)if(Gt=!1,t.pendingProps=c=g,(e.lanes&p)!==0)(e.flags&131072)!==0&&(Gt=!0);else return t.lanes=e.lanes,Fr(e,t,p)}return Va(e,t,s,c,p)}function Mu(e,t,s){var c=t.pendingProps,p=c.children,g=e!==null?e.memoizedState:null;if(c.mode==="hidden")if((t.mode&1)===0)t.memoizedState={baseLanes:0,cachePool:null,transitions:null},ot(ls,sr),sr|=s;else{if((s&1073741824)===0)return e=g!==null?g.baseLanes|s:s,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,ot(ls,sr),sr|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},c=g!==null?g.baseLanes:s,ot(ls,sr),sr|=c}else g!==null?(c=g.baseLanes|s,t.memoizedState=null):c=s,ot(ls,sr),sr|=c;return Vt(e,t,p,s),t.child}function $u(e,t){var s=t.ref;(e===null&&s!==null||e!==null&&e.ref!==s)&&(t.flags|=512,t.flags|=2097152)}function Va(e,t,s,c,p){var g=Kt(s)?wn:Ft.current;return g=Yn(t,g),ss(t,p),s=La(e,t,s,c,g,p),c=Ia(),e!==null&&!Gt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~p,Fr(e,t,p)):(ft&&c&&ya(t),t.flags|=1,Vt(e,t,s,p),t.child)}function Wu(e,t,s,c,p){if(Kt(s)){var g=!0;Ri(t)}else g=!1;if(ss(t,p),t.stateNode===null)Qi(e,t),Tu(t,s,c),Ma(t,s,c,p),c=!0;else if(e===null){var R=t.stateNode,W=t.memoizedProps;R.props=W;var Z=R.context,pe=s.contextType;typeof pe=="object"&&pe!==null?pe=cr(pe):(pe=Kt(s)?wn:Ft.current,pe=Yn(t,pe));var ke=s.getDerivedStateFromProps,Se=typeof ke=="function"||typeof R.getSnapshotBeforeUpdate=="function";Se||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(W!==c||Z!==pe)&&Pu(t,R,c,pe),tn=!1;var be=t.memoizedState;R.state=be,Bi(t,c,R,p),Z=t.memoizedState,W!==c||be!==Z||Qt.current||tn?(typeof ke=="function"&&(za(t,s,ke,c),Z=t.memoizedState),(W=tn||Au(t,s,W,c,be,Z,pe))?(Se||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount()),typeof R.componentDidMount=="function"&&(t.flags|=4194308)):(typeof R.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=c,t.memoizedState=Z),R.props=c,R.state=Z,R.context=pe,c=W):(typeof R.componentDidMount=="function"&&(t.flags|=4194308),c=!1)}else{R=t.stateNode,iu(e,t),W=t.memoizedProps,pe=t.type===t.elementType?W:gr(t.type,W),R.props=pe,Se=t.pendingProps,be=R.context,Z=s.contextType,typeof Z=="object"&&Z!==null?Z=cr(Z):(Z=Kt(s)?wn:Ft.current,Z=Yn(t,Z));var _e=s.getDerivedStateFromProps;(ke=typeof _e=="function"||typeof R.getSnapshotBeforeUpdate=="function")||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(W!==Se||be!==Z)&&Pu(t,R,c,Z),tn=!1,be=t.memoizedState,R.state=be,Bi(t,c,R,p);var Pe=t.memoizedState;W!==Se||be!==Pe||Qt.current||tn?(typeof _e=="function"&&(za(t,s,_e,c),Pe=t.memoizedState),(pe=tn||Au(t,s,pe,c,be,Pe,Z)||!1)?(ke||typeof R.UNSAFE_componentWillUpdate!="function"&&typeof R.componentWillUpdate!="function"||(typeof R.componentWillUpdate=="function"&&R.componentWillUpdate(c,Pe,Z),typeof R.UNSAFE_componentWillUpdate=="function"&&R.UNSAFE_componentWillUpdate(c,Pe,Z)),typeof R.componentDidUpdate=="function"&&(t.flags|=4),typeof R.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof R.componentDidUpdate!="function"||W===e.memoizedProps&&be===e.memoizedState||(t.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||W===e.memoizedProps&&be===e.memoizedState||(t.flags|=1024),t.memoizedProps=c,t.memoizedState=Pe),R.props=c,R.state=Pe,R.context=Z,c=pe):(typeof R.componentDidUpdate!="function"||W===e.memoizedProps&&be===e.memoizedState||(t.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||W===e.memoizedProps&&be===e.memoizedState||(t.flags|=1024),c=!1)}return Ha(e,t,s,c,g,p)}function Ha(e,t,s,c,p,g){$u(e,t);var R=(t.flags&128)!==0;if(!c&&!R)return p&&Kc(t,s,!1),Fr(e,t,g);c=t.stateNode,Vp.current=t;var W=R&&typeof s.getDerivedStateFromError!="function"?null:c.render();return t.flags|=1,e!==null&&R?(t.child=rs(t,e.child,null,g),t.child=rs(t,null,W,g)):Vt(e,t,W,g),t.memoizedState=c.state,p&&Kc(t,s,!0),t.child}function Vu(e){var t=e.stateNode;t.pendingContext?qc(e,t.pendingContext,t.pendingContext!==t.context):t.context&&qc(e,t.context,!1),_a(e,t.containerInfo)}function Hu(e,t,s,c,p){return ts(),ba(p),t.flags|=256,Vt(e,t,s,c),t.child}var qa={dehydrated:null,treeContext:null,retryLane:0};function Qa(e){return{baseLanes:e,cachePool:null,transitions:null}}function qu(e,t,s){var c=t.pendingProps,p=pt.current,g=!1,R=(t.flags&128)!==0,W;if((W=R)||(W=e!==null&&e.memoizedState===null?!1:(p&2)!==0),W?(g=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(p|=1),ot(pt,p&1),e===null)return wa(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?((t.mode&1)===0?t.lanes=1:e.data==="$!"?t.lanes=8:t.lanes=1073741824,null):(R=c.children,e=c.fallback,g?(c=t.mode,g=t.child,R={mode:"hidden",children:R},(c&1)===0&&g!==null?(g.childLanes=0,g.pendingProps=R):g=io(R,c,0,null),e=An(e,c,s,null),g.return=t,e.return=t,g.sibling=e,t.child=g,t.child.memoizedState=Qa(s),t.memoizedState=qa,e):Ka(t,R));if(p=e.memoizedState,p!==null&&(W=p.dehydrated,W!==null))return Hp(e,t,R,c,W,p,s);if(g){g=c.fallback,R=t.mode,p=e.child,W=p.sibling;var Z={mode:"hidden",children:c.children};return(R&1)===0&&t.child!==p?(c=t.child,c.childLanes=0,c.pendingProps=Z,t.deletions=null):(c=cn(p,Z),c.subtreeFlags=p.subtreeFlags&14680064),W!==null?g=cn(W,g):(g=An(g,R,s,null),g.flags|=2),g.return=t,c.return=t,c.sibling=g,t.child=c,c=g,g=t.child,R=e.child.memoizedState,R=R===null?Qa(s):{baseLanes:R.baseLanes|s,cachePool:null,transitions:R.transitions},g.memoizedState=R,g.childLanes=e.childLanes&~s,t.memoizedState=qa,c}return g=e.child,e=g.sibling,c=cn(g,{mode:"visible",children:c.children}),(t.mode&1)===0&&(c.lanes=s),c.return=t,c.sibling=null,e!==null&&(s=t.deletions,s===null?(t.deletions=[e],t.flags|=16):s.push(e)),t.child=c,t.memoizedState=null,c}function Ka(e,t){return t=io({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function qi(e,t,s,c){return c!==null&&ba(c),rs(t,e.child,null,s),e=Ka(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Hp(e,t,s,c,p,g,R){if(s)return t.flags&256?(t.flags&=-257,c=$a(Error(n(422))),qi(e,t,R,c)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(g=c.fallback,p=t.mode,c=io({mode:"visible",children:c.children},p,0,null),g=An(g,p,R,null),g.flags|=2,c.return=t,g.return=t,c.sibling=g,t.child=c,(t.mode&1)!==0&&rs(t,e.child,null,R),t.child.memoizedState=Qa(R),t.memoizedState=qa,g);if((t.mode&1)===0)return qi(e,t,R,null);if(p.data==="$!"){if(c=p.nextSibling&&p.nextSibling.dataset,c)var W=c.dgst;return c=W,g=Error(n(419)),c=$a(g,c,void 0),qi(e,t,R,c)}if(W=(R&e.childLanes)!==0,Gt||W){if(c=_t,c!==null){switch(R&-R){case 4:p=2;break;case 16:p=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:p=32;break;case 536870912:p=268435456;break;default:p=0}p=(p&(c.suspendedLanes|R))!==0?0:p,p!==0&&p!==g.retryLane&&(g.retryLane=p,Ir(e,p),xr(c,e,p,-1))}return ul(),c=$a(Error(n(421))),qi(e,t,R,c)}return p.data==="$?"?(t.flags|=128,t.child=e.child,t=sm.bind(null,e),p._reactRetry=t,null):(e=g.treeContext,nr=Xr(p.nextSibling),rr=t,ft=!0,mr=null,e!==null&&(ar[lr++]=Or,ar[lr++]=Lr,ar[lr++]=bn,Or=e.id,Lr=e.overflow,bn=t),t=Ka(t,c.children),t.flags|=4096,t)}function Qu(e,t,s){e.lanes|=t;var c=e.alternate;c!==null&&(c.lanes|=t),ja(e.return,t,s)}function Ga(e,t,s,c,p){var g=e.memoizedState;g===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:c,tail:s,tailMode:p}:(g.isBackwards=t,g.rendering=null,g.renderingStartTime=0,g.last=c,g.tail=s,g.tailMode=p)}function Ku(e,t,s){var c=t.pendingProps,p=c.revealOrder,g=c.tail;if(Vt(e,t,c.children,s),c=pt.current,(c&2)!==0)c=c&1|2,t.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Qu(e,s,t);else if(e.tag===19)Qu(e,s,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}c&=1}if(ot(pt,c),(t.mode&1)===0)t.memoizedState=null;else switch(p){case"forwards":for(s=t.child,p=null;s!==null;)e=s.alternate,e!==null&&Ui(e)===null&&(p=s),s=s.sibling;s=p,s===null?(p=t.child,t.child=null):(p=s.sibling,s.sibling=null),Ga(t,!1,p,s,g);break;case"backwards":for(s=null,p=t.child,t.child=null;p!==null;){if(e=p.alternate,e!==null&&Ui(e)===null){t.child=p;break}e=p.sibling,p.sibling=s,s=p,p=e}Ga(t,!0,s,null,g);break;case"together":Ga(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Qi(e,t){(t.mode&1)===0&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Fr(e,t,s){if(e!==null&&(t.dependencies=e.dependencies),Nn|=t.lanes,(s&t.childLanes)===0)return null;if(e!==null&&t.child!==e.child)throw Error(n(153));if(t.child!==null){for(e=t.child,s=cn(e,e.pendingProps),t.child=s,s.return=t;e.sibling!==null;)e=e.sibling,s=s.sibling=cn(e,e.pendingProps),s.return=t;s.sibling=null}return t.child}function qp(e,t,s){switch(t.tag){case 3:Vu(t),ts();break;case 5:lu(t);break;case 1:Kt(t.type)&&Ri(t);break;case 4:_a(t,t.stateNode.containerInfo);break;case 10:var c=t.type._context,p=t.memoizedProps.value;ot(Ii,c._currentValue),c._currentValue=p;break;case 13:if(c=t.memoizedState,c!==null)return c.dehydrated!==null?(ot(pt,pt.current&1),t.flags|=128,null):(s&t.child.childLanes)!==0?qu(e,t,s):(ot(pt,pt.current&1),e=Fr(e,t,s),e!==null?e.sibling:null);ot(pt,pt.current&1);break;case 19:if(c=(s&t.childLanes)!==0,(e.flags&128)!==0){if(c)return Ku(e,t,s);t.flags|=128}if(p=t.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),ot(pt,pt.current),c)break;return null;case 22:case 23:return t.lanes=0,Mu(e,t,s)}return Fr(e,t,s)}var Gu,Za,Zu,Xu;Gu=function(e,t){for(var s=t.child;s!==null;){if(s.tag===5||s.tag===6)e.appendChild(s.stateNode);else if(s.tag!==4&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===t)break;for(;s.sibling===null;){if(s.return===null||s.return===t)return;s=s.return}s.sibling.return=s.return,s=s.sibling}},Za=function(){},Zu=function(e,t,s,c){var p=e.memoizedProps;if(p!==c){e=t.stateNode,Cn(Cr.current);var g=null;switch(s){case"input":p=v(e,p),c=v(e,c),g=[];break;case"select":p=ue({},p,{value:void 0}),c=ue({},c,{value:void 0}),g=[];break;case"textarea":p=Y(e,p),c=Y(e,c),g=[];break;default:typeof p.onClick!="function"&&typeof c.onClick=="function"&&(e.onclick=Ni)}Ze(s,c);var R;s=null;for(pe in p)if(!c.hasOwnProperty(pe)&&p.hasOwnProperty(pe)&&p[pe]!=null)if(pe==="style"){var W=p[pe];for(R in W)W.hasOwnProperty(R)&&(s||(s={}),s[R]="")}else pe!=="dangerouslySetInnerHTML"&&pe!=="children"&&pe!=="suppressContentEditableWarning"&&pe!=="suppressHydrationWarning"&&pe!=="autoFocus"&&(u.hasOwnProperty(pe)?g||(g=[]):(g=g||[]).push(pe,null));for(pe in c){var Z=c[pe];if(W=p?.[pe],c.hasOwnProperty(pe)&&Z!==W&&(Z!=null||W!=null))if(pe==="style")if(W){for(R in W)!W.hasOwnProperty(R)||Z&&Z.hasOwnProperty(R)||(s||(s={}),s[R]="");for(R in Z)Z.hasOwnProperty(R)&&W[R]!==Z[R]&&(s||(s={}),s[R]=Z[R])}else s||(g||(g=[]),g.push(pe,s)),s=Z;else pe==="dangerouslySetInnerHTML"?(Z=Z?Z.__html:void 0,W=W?W.__html:void 0,Z!=null&&W!==Z&&(g=g||[]).push(pe,Z)):pe==="children"?typeof Z!="string"&&typeof Z!="number"||(g=g||[]).push(pe,""+Z):pe!=="suppressContentEditableWarning"&&pe!=="suppressHydrationWarning"&&(u.hasOwnProperty(pe)?(Z!=null&&pe==="onScroll"&&lt("scroll",e),g||W===Z||(g=[])):(g=g||[]).push(pe,Z))}s&&(g=g||[]).push("style",s);var pe=g;(t.updateQueue=pe)&&(t.flags|=4)}},Xu=function(e,t,s,c){s!==c&&(t.flags|=4)};function qs(e,t){if(!ft)switch(e.tailMode){case"hidden":t=e.tail;for(var s=null;t!==null;)t.alternate!==null&&(s=t),t=t.sibling;s===null?e.tail=null:s.sibling=null;break;case"collapsed":s=e.tail;for(var c=null;s!==null;)s.alternate!==null&&(c=s),s=s.sibling;c===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:c.sibling=null}}function Ut(e){var t=e.alternate!==null&&e.alternate.child===e.child,s=0,c=0;if(t)for(var p=e.child;p!==null;)s|=p.lanes|p.childLanes,c|=p.subtreeFlags&14680064,c|=p.flags&14680064,p.return=e,p=p.sibling;else for(p=e.child;p!==null;)s|=p.lanes|p.childLanes,c|=p.subtreeFlags,c|=p.flags,p.return=e,p=p.sibling;return e.subtreeFlags|=c,e.childLanes=s,t}function Qp(e,t,s){var c=t.pendingProps;switch(va(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ut(t),null;case 1:return Kt(t.type)&&_i(),Ut(t),null;case 3:return c=t.stateNode,is(),ct(Qt),ct(Ft),Ta(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(e===null||e.child===null)&&(Oi(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,mr!==null&&(al(mr),mr=null))),Za(e,t),Ut(t),null;case 5:Ra(t);var p=Cn(Ms.current);if(s=t.type,e!==null&&t.stateNode!=null)Zu(e,t,s,c,p),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!c){if(t.stateNode===null)throw Error(n(166));return Ut(t),null}if(e=Cn(Cr.current),Oi(t)){c=t.stateNode,s=t.type;var g=t.memoizedProps;switch(c[Sr]=t,c[Ds]=g,e=(t.mode&1)!==0,s){case"dialog":lt("cancel",c),lt("close",c);break;case"iframe":case"object":case"embed":lt("load",c);break;case"video":case"audio":for(p=0;p<Os.length;p++)lt(Os[p],c);break;case"source":lt("error",c);break;case"img":case"image":case"link":lt("error",c),lt("load",c);break;case"details":lt("toggle",c);break;case"input":X(c,g),lt("invalid",c);break;case"select":c._wrapperState={wasMultiple:!!g.multiple},lt("invalid",c);break;case"textarea":E(c,g),lt("invalid",c)}Ze(s,g),p=null;for(var R in g)if(g.hasOwnProperty(R)){var W=g[R];R==="children"?typeof W=="string"?c.textContent!==W&&(g.suppressHydrationWarning!==!0&&ji(c.textContent,W,e),p=["children",W]):typeof W=="number"&&c.textContent!==""+W&&(g.suppressHydrationWarning!==!0&&ji(c.textContent,W,e),p=["children",""+W]):u.hasOwnProperty(R)&&W!=null&&R==="onScroll"&&lt("scroll",c)}switch(s){case"input":Fe(c),O(c,g,!0);break;case"textarea":Fe(c),D(c);break;case"select":case"option":break;default:typeof g.onClick=="function"&&(c.onclick=Ni)}c=p,t.updateQueue=c,c!==null&&(t.flags|=4)}else{R=p.nodeType===9?p:p.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=q(s)),e==="http://www.w3.org/1999/xhtml"?s==="script"?(e=R.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof c.is=="string"?e=R.createElement(s,{is:c.is}):(e=R.createElement(s),s==="select"&&(R=e,c.multiple?R.multiple=!0:c.size&&(R.size=c.size))):e=R.createElementNS(e,s),e[Sr]=t,e[Ds]=c,Gu(e,t,!1,!1),t.stateNode=e;e:{switch(R=Jt(s,c),s){case"dialog":lt("cancel",e),lt("close",e),p=c;break;case"iframe":case"object":case"embed":lt("load",e),p=c;break;case"video":case"audio":for(p=0;p<Os.length;p++)lt(Os[p],e);p=c;break;case"source":lt("error",e),p=c;break;case"img":case"image":case"link":lt("error",e),lt("load",e),p=c;break;case"details":lt("toggle",e),p=c;break;case"input":X(e,c),p=v(e,c),lt("invalid",e);break;case"option":p=c;break;case"select":e._wrapperState={wasMultiple:!!c.multiple},p=ue({},c,{value:void 0}),lt("invalid",e);break;case"textarea":E(e,c),p=Y(e,c),lt("invalid",e);break;default:p=c}Ze(s,p),W=p;for(g in W)if(W.hasOwnProperty(g)){var Z=W[g];g==="style"?ut(e,Z):g==="dangerouslySetInnerHTML"?(Z=Z?Z.__html:void 0,Z!=null&&$e(e,Z)):g==="children"?typeof Z=="string"?(s!=="textarea"||Z!=="")&&We(e,Z):typeof Z=="number"&&We(e,""+Z):g!=="suppressContentEditableWarning"&&g!=="suppressHydrationWarning"&&g!=="autoFocus"&&(u.hasOwnProperty(g)?Z!=null&&g==="onScroll"&&lt("scroll",e):Z!=null&&L(e,g,Z,R))}switch(s){case"input":Fe(e),O(e,c,!1);break;case"textarea":Fe(e),D(e);break;case"option":c.value!=null&&e.setAttribute("value",""+xe(c.value));break;case"select":e.multiple=!!c.multiple,g=c.value,g!=null?oe(e,!!c.multiple,g,!1):c.defaultValue!=null&&oe(e,!!c.multiple,c.defaultValue,!0);break;default:typeof p.onClick=="function"&&(e.onclick=Ni)}switch(s){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}}c&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Ut(t),null;case 6:if(e&&t.stateNode!=null)Xu(e,t,e.memoizedProps,c);else{if(typeof c!="string"&&t.stateNode===null)throw Error(n(166));if(s=Cn(Ms.current),Cn(Cr.current),Oi(t)){if(c=t.stateNode,s=t.memoizedProps,c[Sr]=t,(g=c.nodeValue!==s)&&(e=rr,e!==null))switch(e.tag){case 3:ji(c.nodeValue,s,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&ji(c.nodeValue,s,(e.mode&1)!==0)}g&&(t.flags|=4)}else c=(s.nodeType===9?s:s.ownerDocument).createTextNode(c),c[Sr]=t,t.stateNode=c}return Ut(t),null;case 13:if(ct(pt),c=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(ft&&nr!==null&&(t.mode&1)!==0&&(t.flags&128)===0)eu(),ts(),t.flags|=98560,g=!1;else if(g=Oi(t),c!==null&&c.dehydrated!==null){if(e===null){if(!g)throw Error(n(318));if(g=t.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(n(317));g[Sr]=t}else ts(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;Ut(t),g=!1}else mr!==null&&(al(mr),mr=null),g=!0;if(!g)return t.flags&65536?t:null}return(t.flags&128)!==0?(t.lanes=s,t):(c=c!==null,c!==(e!==null&&e.memoizedState!==null)&&c&&(t.child.flags|=8192,(t.mode&1)!==0&&(e===null||(pt.current&1)!==0?bt===0&&(bt=3):ul())),t.updateQueue!==null&&(t.flags|=4),Ut(t),null);case 4:return is(),Za(e,t),e===null&&Ls(t.stateNode.containerInfo),Ut(t),null;case 10:return Ca(t.type._context),Ut(t),null;case 17:return Kt(t.type)&&_i(),Ut(t),null;case 19:if(ct(pt),g=t.memoizedState,g===null)return Ut(t),null;if(c=(t.flags&128)!==0,R=g.rendering,R===null)if(c)qs(g,!1);else{if(bt!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(R=Ui(e),R!==null){for(t.flags|=128,qs(g,!1),c=R.updateQueue,c!==null&&(t.updateQueue=c,t.flags|=4),t.subtreeFlags=0,c=s,s=t.child;s!==null;)g=s,e=c,g.flags&=14680066,R=g.alternate,R===null?(g.childLanes=0,g.lanes=e,g.child=null,g.subtreeFlags=0,g.memoizedProps=null,g.memoizedState=null,g.updateQueue=null,g.dependencies=null,g.stateNode=null):(g.childLanes=R.childLanes,g.lanes=R.lanes,g.child=R.child,g.subtreeFlags=0,g.deletions=null,g.memoizedProps=R.memoizedProps,g.memoizedState=R.memoizedState,g.updateQueue=R.updateQueue,g.type=R.type,e=R.dependencies,g.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),s=s.sibling;return ot(pt,pt.current&1|2),t.child}e=e.sibling}g.tail!==null&&ht()>cs&&(t.flags|=128,c=!0,qs(g,!1),t.lanes=4194304)}else{if(!c)if(e=Ui(R),e!==null){if(t.flags|=128,c=!0,s=e.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),qs(g,!0),g.tail===null&&g.tailMode==="hidden"&&!R.alternate&&!ft)return Ut(t),null}else 2*ht()-g.renderingStartTime>cs&&s!==1073741824&&(t.flags|=128,c=!0,qs(g,!1),t.lanes=4194304);g.isBackwards?(R.sibling=t.child,t.child=R):(s=g.last,s!==null?s.sibling=R:t.child=R,g.last=R)}return g.tail!==null?(t=g.tail,g.rendering=t,g.tail=t.sibling,g.renderingStartTime=ht(),t.sibling=null,s=pt.current,ot(pt,c?s&1|2:s&1),t):(Ut(t),null);case 22:case 23:return cl(),c=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==c&&(t.flags|=8192),c&&(t.mode&1)!==0?(sr&1073741824)!==0&&(Ut(t),t.subtreeFlags&6&&(t.flags|=8192)):Ut(t),null;case 24:return null;case 25:return null}throw Error(n(156,t.tag))}function Kp(e,t){switch(va(t),t.tag){case 1:return Kt(t.type)&&_i(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return is(),ct(Qt),ct(Ft),Ta(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 5:return Ra(t),null;case 13:if(ct(pt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(n(340));ts()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return ct(pt),null;case 4:return is(),null;case 10:return Ca(t.type._context),null;case 22:case 23:return cl(),null;case 24:return null;default:return null}}var Ki=!1,zt=!1,Gp=typeof WeakSet=="function"?WeakSet:Set,Ae=null;function as(e,t){var s=e.ref;if(s!==null)if(typeof s=="function")try{s(null)}catch(c){gt(e,t,c)}else s.current=null}function Xa(e,t,s){try{s()}catch(c){gt(e,t,c)}}var Yu=!1;function Zp(e,t){if(ca=pi,e=Ac(),ta(e)){if("selectionStart"in e)var s={start:e.selectionStart,end:e.selectionEnd};else e:{s=(s=e.ownerDocument)&&s.defaultView||window;var c=s.getSelection&&s.getSelection();if(c&&c.rangeCount!==0){s=c.anchorNode;var p=c.anchorOffset,g=c.focusNode;c=c.focusOffset;try{s.nodeType,g.nodeType}catch{s=null;break e}var R=0,W=-1,Z=-1,pe=0,ke=0,Se=e,be=null;t:for(;;){for(var _e;Se!==s||p!==0&&Se.nodeType!==3||(W=R+p),Se!==g||c!==0&&Se.nodeType!==3||(Z=R+c),Se.nodeType===3&&(R+=Se.nodeValue.length),(_e=Se.firstChild)!==null;)be=Se,Se=_e;for(;;){if(Se===e)break t;if(be===s&&++pe===p&&(W=R),be===g&&++ke===c&&(Z=R),(_e=Se.nextSibling)!==null)break;Se=be,be=Se.parentNode}Se=_e}s=W===-1||Z===-1?null:{start:W,end:Z}}else s=null}s=s||{start:0,end:0}}else s=null;for(ua={focusedElem:e,selectionRange:s},pi=!1,Ae=t;Ae!==null;)if(t=Ae,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Ae=e;else for(;Ae!==null;){t=Ae;try{var Pe=t.alternate;if((t.flags&1024)!==0)switch(t.tag){case 0:case 11:case 15:break;case 1:if(Pe!==null){var Ie=Pe.memoizedProps,vt=Pe.memoizedState,de=t.stateNode,ee=de.getSnapshotBeforeUpdate(t.elementType===t.type?Ie:gr(t.type,Ie),vt);de.__reactInternalSnapshotBeforeUpdate=ee}break;case 3:var fe=t.stateNode.containerInfo;fe.nodeType===1?fe.textContent="":fe.nodeType===9&&fe.documentElement&&fe.removeChild(fe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(Ne){gt(t,t.return,Ne)}if(e=t.sibling,e!==null){e.return=t.return,Ae=e;break}Ae=t.return}return Pe=Yu,Yu=!1,Pe}function Qs(e,t,s){var c=t.updateQueue;if(c=c!==null?c.lastEffect:null,c!==null){var p=c=c.next;do{if((p.tag&e)===e){var g=p.destroy;p.destroy=void 0,g!==void 0&&Xa(t,s,g)}p=p.next}while(p!==c)}}function Gi(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var s=t=t.next;do{if((s.tag&e)===e){var c=s.create;s.destroy=c()}s=s.next}while(s!==t)}}function Ya(e){var t=e.ref;if(t!==null){var s=e.stateNode;switch(e.tag){case 5:e=s;break;default:e=s}typeof t=="function"?t(e):t.current=e}}function Ju(e){var t=e.alternate;t!==null&&(e.alternate=null,Ju(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Sr],delete t[Ds],delete t[pa],delete t[Pp],delete t[Op])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ed(e){return e.tag===5||e.tag===3||e.tag===4}function td(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||ed(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Ja(e,t,s){var c=e.tag;if(c===5||c===6)e=e.stateNode,t?s.nodeType===8?s.parentNode.insertBefore(e,t):s.insertBefore(e,t):(s.nodeType===8?(t=s.parentNode,t.insertBefore(e,s)):(t=s,t.appendChild(e)),s=s._reactRootContainer,s!=null||t.onclick!==null||(t.onclick=Ni));else if(c!==4&&(e=e.child,e!==null))for(Ja(e,t,s),e=e.sibling;e!==null;)Ja(e,t,s),e=e.sibling}function el(e,t,s){var c=e.tag;if(c===5||c===6)e=e.stateNode,t?s.insertBefore(e,t):s.appendChild(e);else if(c!==4&&(e=e.child,e!==null))for(el(e,t,s),e=e.sibling;e!==null;)el(e,t,s),e=e.sibling}var Pt=null,yr=!1;function nn(e,t,s){for(s=s.child;s!==null;)rd(e,t,s),s=s.sibling}function rd(e,t,s){if(nt&&typeof nt.onCommitFiberUnmount=="function")try{nt.onCommitFiberUnmount(Xe,s)}catch{}switch(s.tag){case 5:zt||as(s,t);case 6:var c=Pt,p=yr;Pt=null,nn(e,t,s),Pt=c,yr=p,Pt!==null&&(yr?(e=Pt,s=s.stateNode,e.nodeType===8?e.parentNode.removeChild(s):e.removeChild(s)):Pt.removeChild(s.stateNode));break;case 18:Pt!==null&&(yr?(e=Pt,s=s.stateNode,e.nodeType===8?ha(e.parentNode,s):e.nodeType===1&&ha(e,s),js(e)):ha(Pt,s.stateNode));break;case 4:c=Pt,p=yr,Pt=s.stateNode.containerInfo,yr=!0,nn(e,t,s),Pt=c,yr=p;break;case 0:case 11:case 14:case 15:if(!zt&&(c=s.updateQueue,c!==null&&(c=c.lastEffect,c!==null))){p=c=c.next;do{var g=p,R=g.destroy;g=g.tag,R!==void 0&&((g&2)!==0||(g&4)!==0)&&Xa(s,t,R),p=p.next}while(p!==c)}nn(e,t,s);break;case 1:if(!zt&&(as(s,t),c=s.stateNode,typeof c.componentWillUnmount=="function"))try{c.props=s.memoizedProps,c.state=s.memoizedState,c.componentWillUnmount()}catch(W){gt(s,t,W)}nn(e,t,s);break;case 21:nn(e,t,s);break;case 22:s.mode&1?(zt=(c=zt)||s.memoizedState!==null,nn(e,t,s),zt=c):nn(e,t,s);break;default:nn(e,t,s)}}function nd(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var s=e.stateNode;s===null&&(s=e.stateNode=new Gp),t.forEach(function(c){var p=im.bind(null,e,c);s.has(c)||(s.add(c),c.then(p,p))})}}function vr(e,t){var s=t.deletions;if(s!==null)for(var c=0;c<s.length;c++){var p=s[c];try{var g=e,R=t,W=R;e:for(;W!==null;){switch(W.tag){case 5:Pt=W.stateNode,yr=!1;break e;case 3:Pt=W.stateNode.containerInfo,yr=!0;break e;case 4:Pt=W.stateNode.containerInfo,yr=!0;break e}W=W.return}if(Pt===null)throw Error(n(160));rd(g,R,p),Pt=null,yr=!1;var Z=p.alternate;Z!==null&&(Z.return=null),p.return=null}catch(pe){gt(p,t,pe)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)sd(t,e),t=t.sibling}function sd(e,t){var s=e.alternate,c=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(vr(t,e),Nr(e),c&4){try{Qs(3,e,e.return),Gi(3,e)}catch(Ie){gt(e,e.return,Ie)}try{Qs(5,e,e.return)}catch(Ie){gt(e,e.return,Ie)}}break;case 1:vr(t,e),Nr(e),c&512&&s!==null&&as(s,s.return);break;case 5:if(vr(t,e),Nr(e),c&512&&s!==null&&as(s,s.return),e.flags&32){var p=e.stateNode;try{We(p,"")}catch(Ie){gt(e,e.return,Ie)}}if(c&4&&(p=e.stateNode,p!=null)){var g=e.memoizedProps,R=s!==null?s.memoizedProps:g,W=e.type,Z=e.updateQueue;if(e.updateQueue=null,Z!==null)try{W==="input"&&g.type==="radio"&&g.name!=null&&H(p,g),Jt(W,R);var pe=Jt(W,g);for(R=0;R<Z.length;R+=2){var ke=Z[R],Se=Z[R+1];ke==="style"?ut(p,Se):ke==="dangerouslySetInnerHTML"?$e(p,Se):ke==="children"?We(p,Se):L(p,ke,Se,pe)}switch(W){case"input":I(p,g);break;case"textarea":T(p,g);break;case"select":var be=p._wrapperState.wasMultiple;p._wrapperState.wasMultiple=!!g.multiple;var _e=g.value;_e!=null?oe(p,!!g.multiple,_e,!1):be!==!!g.multiple&&(g.defaultValue!=null?oe(p,!!g.multiple,g.defaultValue,!0):oe(p,!!g.multiple,g.multiple?[]:"",!1))}p[Ds]=g}catch(Ie){gt(e,e.return,Ie)}}break;case 6:if(vr(t,e),Nr(e),c&4){if(e.stateNode===null)throw Error(n(162));p=e.stateNode,g=e.memoizedProps;try{p.nodeValue=g}catch(Ie){gt(e,e.return,Ie)}}break;case 3:if(vr(t,e),Nr(e),c&4&&s!==null&&s.memoizedState.isDehydrated)try{js(t.containerInfo)}catch(Ie){gt(e,e.return,Ie)}break;case 4:vr(t,e),Nr(e);break;case 13:vr(t,e),Nr(e),p=e.child,p.flags&8192&&(g=p.memoizedState!==null,p.stateNode.isHidden=g,!g||p.alternate!==null&&p.alternate.memoizedState!==null||(nl=ht())),c&4&&nd(e);break;case 22:if(ke=s!==null&&s.memoizedState!==null,e.mode&1?(zt=(pe=zt)||ke,vr(t,e),zt=pe):vr(t,e),Nr(e),c&8192){if(pe=e.memoizedState!==null,(e.stateNode.isHidden=pe)&&!ke&&(e.mode&1)!==0)for(Ae=e,ke=e.child;ke!==null;){for(Se=Ae=ke;Ae!==null;){switch(be=Ae,_e=be.child,be.tag){case 0:case 11:case 14:case 15:Qs(4,be,be.return);break;case 1:as(be,be.return);var Pe=be.stateNode;if(typeof Pe.componentWillUnmount=="function"){c=be,s=be.return;try{t=c,Pe.props=t.memoizedProps,Pe.state=t.memoizedState,Pe.componentWillUnmount()}catch(Ie){gt(c,s,Ie)}}break;case 5:as(be,be.return);break;case 22:if(be.memoizedState!==null){ad(Se);continue}}_e!==null?(_e.return=be,Ae=_e):ad(Se)}ke=ke.sibling}e:for(ke=null,Se=e;;){if(Se.tag===5){if(ke===null){ke=Se;try{p=Se.stateNode,pe?(g=p.style,typeof g.setProperty=="function"?g.setProperty("display","none","important"):g.display="none"):(W=Se.stateNode,Z=Se.memoizedProps.style,R=Z!=null&&Z.hasOwnProperty("display")?Z.display:null,W.style.display=Be("display",R))}catch(Ie){gt(e,e.return,Ie)}}}else if(Se.tag===6){if(ke===null)try{Se.stateNode.nodeValue=pe?"":Se.memoizedProps}catch(Ie){gt(e,e.return,Ie)}}else if((Se.tag!==22&&Se.tag!==23||Se.memoizedState===null||Se===e)&&Se.child!==null){Se.child.return=Se,Se=Se.child;continue}if(Se===e)break e;for(;Se.sibling===null;){if(Se.return===null||Se.return===e)break e;ke===Se&&(ke=null),Se=Se.return}ke===Se&&(ke=null),Se.sibling.return=Se.return,Se=Se.sibling}}break;case 19:vr(t,e),Nr(e),c&4&&nd(e);break;case 21:break;default:vr(t,e),Nr(e)}}function Nr(e){var t=e.flags;if(t&2){try{e:{for(var s=e.return;s!==null;){if(ed(s)){var c=s;break e}s=s.return}throw Error(n(160))}switch(c.tag){case 5:var p=c.stateNode;c.flags&32&&(We(p,""),c.flags&=-33);var g=td(e);el(e,g,p);break;case 3:case 4:var R=c.stateNode.containerInfo,W=td(e);Ja(e,W,R);break;default:throw Error(n(161))}}catch(Z){gt(e,e.return,Z)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Xp(e,t,s){Ae=e,id(e)}function id(e,t,s){for(var c=(e.mode&1)!==0;Ae!==null;){var p=Ae,g=p.child;if(p.tag===22&&c){var R=p.memoizedState!==null||Ki;if(!R){var W=p.alternate,Z=W!==null&&W.memoizedState!==null||zt;W=Ki;var pe=zt;if(Ki=R,(zt=Z)&&!pe)for(Ae=p;Ae!==null;)R=Ae,Z=R.child,R.tag===22&&R.memoizedState!==null?ld(p):Z!==null?(Z.return=R,Ae=Z):ld(p);for(;g!==null;)Ae=g,id(g),g=g.sibling;Ae=p,Ki=W,zt=pe}od(e)}else(p.subtreeFlags&8772)!==0&&g!==null?(g.return=p,Ae=g):od(e)}}function od(e){for(;Ae!==null;){var t=Ae;if((t.flags&8772)!==0){var s=t.alternate;try{if((t.flags&8772)!==0)switch(t.tag){case 0:case 11:case 15:zt||Gi(5,t);break;case 1:var c=t.stateNode;if(t.flags&4&&!zt)if(s===null)c.componentDidMount();else{var p=t.elementType===t.type?s.memoizedProps:gr(t.type,s.memoizedProps);c.componentDidUpdate(p,s.memoizedState,c.__reactInternalSnapshotBeforeUpdate)}var g=t.updateQueue;g!==null&&au(t,g,c);break;case 3:var R=t.updateQueue;if(R!==null){if(s=null,t.child!==null)switch(t.child.tag){case 5:s=t.child.stateNode;break;case 1:s=t.child.stateNode}au(t,R,s)}break;case 5:var W=t.stateNode;if(s===null&&t.flags&4){s=W;var Z=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":Z.autoFocus&&s.focus();break;case"img":Z.src&&(s.src=Z.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var pe=t.alternate;if(pe!==null){var ke=pe.memoizedState;if(ke!==null){var Se=ke.dehydrated;Se!==null&&js(Se)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}zt||t.flags&512&&Ya(t)}catch(be){gt(t,t.return,be)}}if(t===e){Ae=null;break}if(s=t.sibling,s!==null){s.return=t.return,Ae=s;break}Ae=t.return}}function ad(e){for(;Ae!==null;){var t=Ae;if(t===e){Ae=null;break}var s=t.sibling;if(s!==null){s.return=t.return,Ae=s;break}Ae=t.return}}function ld(e){for(;Ae!==null;){var t=Ae;try{switch(t.tag){case 0:case 11:case 15:var s=t.return;try{Gi(4,t)}catch(Z){gt(t,s,Z)}break;case 1:var c=t.stateNode;if(typeof c.componentDidMount=="function"){var p=t.return;try{c.componentDidMount()}catch(Z){gt(t,p,Z)}}var g=t.return;try{Ya(t)}catch(Z){gt(t,g,Z)}break;case 5:var R=t.return;try{Ya(t)}catch(Z){gt(t,R,Z)}}}catch(Z){gt(t,t.return,Z)}if(t===e){Ae=null;break}var W=t.sibling;if(W!==null){W.return=t.return,Ae=W;break}Ae=t.return}}var Yp=Math.ceil,Zi=U.ReactCurrentDispatcher,tl=U.ReactCurrentOwner,dr=U.ReactCurrentBatchConfig,et=0,_t=null,xt=null,Ot=0,sr=0,ls=Yr(0),bt=0,Ks=null,Nn=0,Xi=0,rl=0,Gs=null,Zt=null,nl=0,cs=1/0,Br=null,Yi=!1,sl=null,sn=null,Ji=!1,on=null,eo=0,Zs=0,il=null,to=-1,ro=0;function Ht(){return(et&6)!==0?ht():to!==-1?to:to=ht()}function an(e){return(e.mode&1)===0?1:(et&2)!==0&&Ot!==0?Ot&-Ot:Ip.transition!==null?(ro===0&&(ro=tc()),ro):(e=rt,e!==0||(e=window.event,e=e===void 0?16:uc(e.type)),e)}function xr(e,t,s,c){if(50<Zs)throw Zs=0,il=null,Error(n(185));ws(e,s,c),((et&2)===0||e!==_t)&&(e===_t&&((et&2)===0&&(Xi|=s),bt===4&&ln(e,Ot)),Xt(e,c),s===1&&et===0&&(t.mode&1)===0&&(cs=ht()+500,Ai&&en()))}function Xt(e,t){var s=e.callbackNode;Ih(e,t);var c=Vr(e,e===_t?Ot:0);if(c===0)s!==null&&di(s),e.callbackNode=null,e.callbackPriority=0;else if(t=c&-c,e.callbackPriority!==t){if(s!=null&&di(s),t===1)e.tag===0?Lp(ud.bind(null,e)):Gc(ud.bind(null,e)),Ap(function(){(et&6)===0&&en()}),s=null;else{switch(rc(c)){case 1:s=ye;break;case 4:s=Re;break;case 16:s=Oe;break;case 536870912:s=Le;break;default:s=Oe}s=vd(s,cd.bind(null,e))}e.callbackPriority=t,e.callbackNode=s}}function cd(e,t){if(to=-1,ro=0,(et&6)!==0)throw Error(n(327));var s=e.callbackNode;if(us()&&e.callbackNode!==s)return null;var c=Vr(e,e===_t?Ot:0);if(c===0)return null;if((c&30)!==0||(c&e.expiredLanes)!==0||t)t=no(e,c);else{t=c;var p=et;et|=2;var g=fd();(_t!==e||Ot!==t)&&(Br=null,cs=ht()+500,_n(e,t));do try{tm();break}catch(W){dd(e,W)}while(!0);Sa(),Zi.current=g,et=p,xt!==null?t=0:(_t=null,Ot=0,t=bt)}if(t!==0){if(t===2&&(p=Uo(e),p!==0&&(c=p,t=ol(e,p))),t===1)throw s=Ks,_n(e,0),ln(e,c),Xt(e,ht()),s;if(t===6)ln(e,c);else{if(p=e.current.alternate,(c&30)===0&&!Jp(p)&&(t=no(e,c),t===2&&(g=Uo(e),g!==0&&(c=g,t=ol(e,g))),t===1))throw s=Ks,_n(e,0),ln(e,c),Xt(e,ht()),s;switch(e.finishedWork=p,e.finishedLanes=c,t){case 0:case 1:throw Error(n(345));case 2:Rn(e,Zt,Br);break;case 3:if(ln(e,c),(c&130023424)===c&&(t=nl+500-ht(),10<t)){if(Vr(e,0)!==0)break;if(p=e.suspendedLanes,(p&c)!==c){Ht(),e.pingedLanes|=e.suspendedLanes&p;break}e.timeoutHandle=fa(Rn.bind(null,e,Zt,Br),t);break}Rn(e,Zt,Br);break;case 4:if(ln(e,c),(c&4194240)===c)break;for(t=e.eventTimes,p=-1;0<c;){var R=31-st(c);g=1<<R,R=t[R],R>p&&(p=R),c&=~g}if(c=p,c=ht()-c,c=(120>c?120:480>c?480:1080>c?1080:1920>c?1920:3e3>c?3e3:4320>c?4320:1960*Yp(c/1960))-c,10<c){e.timeoutHandle=fa(Rn.bind(null,e,Zt,Br),c);break}Rn(e,Zt,Br);break;case 5:Rn(e,Zt,Br);break;default:throw Error(n(329))}}}return Xt(e,ht()),e.callbackNode===s?cd.bind(null,e):null}function ol(e,t){var s=Gs;return e.current.memoizedState.isDehydrated&&(_n(e,t).flags|=256),e=no(e,t),e!==2&&(t=Zt,Zt=s,t!==null&&al(t)),e}function al(e){Zt===null?Zt=e:Zt.push.apply(Zt,e)}function Jp(e){for(var t=e;;){if(t.flags&16384){var s=t.updateQueue;if(s!==null&&(s=s.stores,s!==null))for(var c=0;c<s.length;c++){var p=s[c],g=p.getSnapshot;p=p.value;try{if(!pr(g(),p))return!1}catch{return!1}}}if(s=t.child,t.subtreeFlags&16384&&s!==null)s.return=t,t=s;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function ln(e,t){for(t&=~rl,t&=~Xi,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var s=31-st(t),c=1<<s;e[s]=-1,t&=~c}}function ud(e){if((et&6)!==0)throw Error(n(327));us();var t=Vr(e,0);if((t&1)===0)return Xt(e,ht()),null;var s=no(e,t);if(e.tag!==0&&s===2){var c=Uo(e);c!==0&&(t=c,s=ol(e,c))}if(s===1)throw s=Ks,_n(e,0),ln(e,t),Xt(e,ht()),s;if(s===6)throw Error(n(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Rn(e,Zt,Br),Xt(e,ht()),null}function ll(e,t){var s=et;et|=1;try{return e(t)}finally{et=s,et===0&&(cs=ht()+500,Ai&&en())}}function En(e){on!==null&&on.tag===0&&(et&6)===0&&us();var t=et;et|=1;var s=dr.transition,c=rt;try{if(dr.transition=null,rt=1,e)return e()}finally{rt=c,dr.transition=s,et=t,(et&6)===0&&en()}}function cl(){sr=ls.current,ct(ls)}function _n(e,t){e.finishedWork=null,e.finishedLanes=0;var s=e.timeoutHandle;if(s!==-1&&(e.timeoutHandle=-1,Rp(s)),xt!==null)for(s=xt.return;s!==null;){var c=s;switch(va(c),c.tag){case 1:c=c.type.childContextTypes,c!=null&&_i();break;case 3:is(),ct(Qt),ct(Ft),Ta();break;case 5:Ra(c);break;case 4:is();break;case 13:ct(pt);break;case 19:ct(pt);break;case 10:Ca(c.type._context);break;case 22:case 23:cl()}s=s.return}if(_t=e,xt=e=cn(e.current,null),Ot=sr=t,bt=0,Ks=null,rl=Xi=Nn=0,Zt=Gs=null,Sn!==null){for(t=0;t<Sn.length;t++)if(s=Sn[t],c=s.interleaved,c!==null){s.interleaved=null;var p=c.next,g=s.pending;if(g!==null){var R=g.next;g.next=p,c.next=R}s.pending=c}Sn=null}return e}function dd(e,t){do{var s=xt;try{if(Sa(),zi.current=Vi,Mi){for(var c=mt.memoizedState;c!==null;){var p=c.queue;p!==null&&(p.pending=null),c=c.next}Mi=!1}if(jn=0,Et=wt=mt=null,$s=!1,Ws=0,tl.current=null,s===null||s.return===null){bt=1,Ks=t,xt=null;break}e:{var g=e,R=s.return,W=s,Z=t;if(t=Ot,W.flags|=32768,Z!==null&&typeof Z=="object"&&typeof Z.then=="function"){var pe=Z,ke=W,Se=ke.tag;if((ke.mode&1)===0&&(Se===0||Se===11||Se===15)){var be=ke.alternate;be?(ke.updateQueue=be.updateQueue,ke.memoizedState=be.memoizedState,ke.lanes=be.lanes):(ke.updateQueue=null,ke.memoizedState=null)}var _e=Du(R);if(_e!==null){_e.flags&=-257,Fu(_e,R,W,g,t),_e.mode&1&&Iu(g,pe,t),t=_e,Z=pe;var Pe=t.updateQueue;if(Pe===null){var Ie=new Set;Ie.add(Z),t.updateQueue=Ie}else Pe.add(Z);break e}else{if((t&1)===0){Iu(g,pe,t),ul();break e}Z=Error(n(426))}}else if(ft&&W.mode&1){var vt=Du(R);if(vt!==null){(vt.flags&65536)===0&&(vt.flags|=256),Fu(vt,R,W,g,t),ba(os(Z,W));break e}}g=Z=os(Z,W),bt!==4&&(bt=2),Gs===null?Gs=[g]:Gs.push(g),g=R;do{switch(g.tag){case 3:g.flags|=65536,t&=-t,g.lanes|=t;var de=Ou(g,Z,t);ou(g,de);break e;case 1:W=Z;var ee=g.type,fe=g.stateNode;if((g.flags&128)===0&&(typeof ee.getDerivedStateFromError=="function"||fe!==null&&typeof fe.componentDidCatch=="function"&&(sn===null||!sn.has(fe)))){g.flags|=65536,t&=-t,g.lanes|=t;var Ne=Lu(g,W,t);ou(g,Ne);break e}}g=g.return}while(g!==null)}pd(s)}catch(De){t=De,xt===s&&s!==null&&(xt=s=s.return);continue}break}while(!0)}function fd(){var e=Zi.current;return Zi.current=Vi,e===null?Vi:e}function ul(){(bt===0||bt===3||bt===2)&&(bt=4),_t===null||(Nn&268435455)===0&&(Xi&268435455)===0||ln(_t,Ot)}function no(e,t){var s=et;et|=2;var c=fd();(_t!==e||Ot!==t)&&(Br=null,_n(e,t));do try{em();break}catch(p){dd(e,p)}while(!0);if(Sa(),et=s,Zi.current=c,xt!==null)throw Error(n(261));return _t=null,Ot=0,bt}function em(){for(;xt!==null;)hd(xt)}function tm(){for(;xt!==null&&!Do();)hd(xt)}function hd(e){var t=yd(e.alternate,e,sr);e.memoizedProps=e.pendingProps,t===null?pd(e):xt=t,tl.current=null}function pd(e){var t=e;do{var s=t.alternate;if(e=t.return,(t.flags&32768)===0){if(s=Qp(s,t,sr),s!==null){xt=s;return}}else{if(s=Kp(s,t),s!==null){s.flags&=32767,xt=s;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{bt=6,xt=null;return}}if(t=t.sibling,t!==null){xt=t;return}xt=t=e}while(t!==null);bt===0&&(bt=5)}function Rn(e,t,s){var c=rt,p=dr.transition;try{dr.transition=null,rt=1,rm(e,t,s,c)}finally{dr.transition=p,rt=c}return null}function rm(e,t,s,c){do us();while(on!==null);if((et&6)!==0)throw Error(n(327));s=e.finishedWork;var p=e.finishedLanes;if(s===null)return null;if(e.finishedWork=null,e.finishedLanes=0,s===e.current)throw Error(n(177));e.callbackNode=null,e.callbackPriority=0;var g=s.lanes|s.childLanes;if(Dh(e,g),e===_t&&(xt=_t=null,Ot=0),(s.subtreeFlags&2064)===0&&(s.flags&2064)===0||Ji||(Ji=!0,vd(Oe,function(){return us(),null})),g=(s.flags&15990)!==0,(s.subtreeFlags&15990)!==0||g){g=dr.transition,dr.transition=null;var R=rt;rt=1;var W=et;et|=4,tl.current=null,Zp(e,s),sd(s,e),kp(ua),pi=!!ca,ua=ca=null,e.current=s,Xp(s),Fo(),et=W,rt=R,dr.transition=g}else e.current=s;if(Ji&&(Ji=!1,on=e,eo=p),g=e.pendingLanes,g===0&&(sn=null),Wr(s.stateNode),Xt(e,ht()),t!==null)for(c=e.onRecoverableError,s=0;s<t.length;s++)p=t[s],c(p.value,{componentStack:p.stack,digest:p.digest});if(Yi)throw Yi=!1,e=sl,sl=null,e;return(eo&1)!==0&&e.tag!==0&&us(),g=e.pendingLanes,(g&1)!==0?e===il?Zs++:(Zs=0,il=e):Zs=0,en(),null}function us(){if(on!==null){var e=rc(eo),t=dr.transition,s=rt;try{if(dr.transition=null,rt=16>e?16:e,on===null)var c=!1;else{if(e=on,on=null,eo=0,(et&6)!==0)throw Error(n(331));var p=et;for(et|=4,Ae=e.current;Ae!==null;){var g=Ae,R=g.child;if((Ae.flags&16)!==0){var W=g.deletions;if(W!==null){for(var Z=0;Z<W.length;Z++){var pe=W[Z];for(Ae=pe;Ae!==null;){var ke=Ae;switch(ke.tag){case 0:case 11:case 15:Qs(8,ke,g)}var Se=ke.child;if(Se!==null)Se.return=ke,Ae=Se;else for(;Ae!==null;){ke=Ae;var be=ke.sibling,_e=ke.return;if(Ju(ke),ke===pe){Ae=null;break}if(be!==null){be.return=_e,Ae=be;break}Ae=_e}}}var Pe=g.alternate;if(Pe!==null){var Ie=Pe.child;if(Ie!==null){Pe.child=null;do{var vt=Ie.sibling;Ie.sibling=null,Ie=vt}while(Ie!==null)}}Ae=g}}if((g.subtreeFlags&2064)!==0&&R!==null)R.return=g,Ae=R;else e:for(;Ae!==null;){if(g=Ae,(g.flags&2048)!==0)switch(g.tag){case 0:case 11:case 15:Qs(9,g,g.return)}var de=g.sibling;if(de!==null){de.return=g.return,Ae=de;break e}Ae=g.return}}var ee=e.current;for(Ae=ee;Ae!==null;){R=Ae;var fe=R.child;if((R.subtreeFlags&2064)!==0&&fe!==null)fe.return=R,Ae=fe;else e:for(R=ee;Ae!==null;){if(W=Ae,(W.flags&2048)!==0)try{switch(W.tag){case 0:case 11:case 15:Gi(9,W)}}catch(De){gt(W,W.return,De)}if(W===R){Ae=null;break e}var Ne=W.sibling;if(Ne!==null){Ne.return=W.return,Ae=Ne;break e}Ae=W.return}}if(et=p,en(),nt&&typeof nt.onPostCommitFiberRoot=="function")try{nt.onPostCommitFiberRoot(Xe,e)}catch{}c=!0}return c}finally{rt=s,dr.transition=t}}return!1}function md(e,t,s){t=os(s,t),t=Ou(e,t,1),e=rn(e,t,1),t=Ht(),e!==null&&(ws(e,1,t),Xt(e,t))}function gt(e,t,s){if(e.tag===3)md(e,e,s);else for(;t!==null;){if(t.tag===3){md(t,e,s);break}else if(t.tag===1){var c=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(sn===null||!sn.has(c))){e=os(s,e),e=Lu(t,e,1),t=rn(t,e,1),e=Ht(),t!==null&&(ws(t,1,e),Xt(t,e));break}}t=t.return}}function nm(e,t,s){var c=e.pingCache;c!==null&&c.delete(t),t=Ht(),e.pingedLanes|=e.suspendedLanes&s,_t===e&&(Ot&s)===s&&(bt===4||bt===3&&(Ot&130023424)===Ot&&500>ht()-nl?_n(e,0):rl|=s),Xt(e,t)}function gd(e,t){t===0&&((e.mode&1)===0?t=1:(t=Nt,Nt<<=1,(Nt&130023424)===0&&(Nt=4194304)));var s=Ht();e=Ir(e,t),e!==null&&(ws(e,t,s),Xt(e,s))}function sm(e){var t=e.memoizedState,s=0;t!==null&&(s=t.retryLane),gd(e,s)}function im(e,t){var s=0;switch(e.tag){case 13:var c=e.stateNode,p=e.memoizedState;p!==null&&(s=p.retryLane);break;case 19:c=e.stateNode;break;default:throw Error(n(314))}c!==null&&c.delete(t),gd(e,s)}var yd;yd=function(e,t,s){if(e!==null)if(e.memoizedProps!==t.pendingProps||Qt.current)Gt=!0;else{if((e.lanes&s)===0&&(t.flags&128)===0)return Gt=!1,qp(e,t,s);Gt=(e.flags&131072)!==0}else Gt=!1,ft&&(t.flags&1048576)!==0&&Zc(t,Pi,t.index);switch(t.lanes=0,t.tag){case 2:var c=t.type;Qi(e,t),e=t.pendingProps;var p=Yn(t,Ft.current);ss(t,s),p=La(null,t,c,e,p,s);var g=Ia();return t.flags|=1,typeof p=="object"&&p!==null&&typeof p.render=="function"&&p.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Kt(c)?(g=!0,Ri(t)):g=!1,t.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,Ea(t),p.updater=Hi,t.stateNode=p,p._reactInternals=t,Ma(t,c,e,s),t=Ha(null,t,c,!0,g,s)):(t.tag=0,ft&&g&&ya(t),Vt(null,t,p,s),t=t.child),t;case 16:c=t.elementType;e:{switch(Qi(e,t),e=t.pendingProps,p=c._init,c=p(c._payload),t.type=c,p=t.tag=am(c),e=gr(c,e),p){case 0:t=Va(null,t,c,e,s);break e;case 1:t=Wu(null,t,c,e,s);break e;case 11:t=Bu(null,t,c,e,s);break e;case 14:t=Uu(null,t,c,gr(c.type,e),s);break e}throw Error(n(306,c,""))}return t;case 0:return c=t.type,p=t.pendingProps,p=t.elementType===c?p:gr(c,p),Va(e,t,c,p,s);case 1:return c=t.type,p=t.pendingProps,p=t.elementType===c?p:gr(c,p),Wu(e,t,c,p,s);case 3:e:{if(Vu(t),e===null)throw Error(n(387));c=t.pendingProps,g=t.memoizedState,p=g.element,iu(e,t),Bi(t,c,null,s);var R=t.memoizedState;if(c=R.element,g.isDehydrated)if(g={element:c,isDehydrated:!1,cache:R.cache,pendingSuspenseBoundaries:R.pendingSuspenseBoundaries,transitions:R.transitions},t.updateQueue.baseState=g,t.memoizedState=g,t.flags&256){p=os(Error(n(423)),t),t=Hu(e,t,c,s,p);break e}else if(c!==p){p=os(Error(n(424)),t),t=Hu(e,t,c,s,p);break e}else for(nr=Xr(t.stateNode.containerInfo.firstChild),rr=t,ft=!0,mr=null,s=nu(t,null,c,s),t.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(ts(),c===p){t=Fr(e,t,s);break e}Vt(e,t,c,s)}t=t.child}return t;case 5:return lu(t),e===null&&wa(t),c=t.type,p=t.pendingProps,g=e!==null?e.memoizedProps:null,R=p.children,da(c,p)?R=null:g!==null&&da(c,g)&&(t.flags|=32),$u(e,t),Vt(e,t,R,s),t.child;case 6:return e===null&&wa(t),null;case 13:return qu(e,t,s);case 4:return _a(t,t.stateNode.containerInfo),c=t.pendingProps,e===null?t.child=rs(t,null,c,s):Vt(e,t,c,s),t.child;case 11:return c=t.type,p=t.pendingProps,p=t.elementType===c?p:gr(c,p),Bu(e,t,c,p,s);case 7:return Vt(e,t,t.pendingProps,s),t.child;case 8:return Vt(e,t,t.pendingProps.children,s),t.child;case 12:return Vt(e,t,t.pendingProps.children,s),t.child;case 10:e:{if(c=t.type._context,p=t.pendingProps,g=t.memoizedProps,R=p.value,ot(Ii,c._currentValue),c._currentValue=R,g!==null)if(pr(g.value,R)){if(g.children===p.children&&!Qt.current){t=Fr(e,t,s);break e}}else for(g=t.child,g!==null&&(g.return=t);g!==null;){var W=g.dependencies;if(W!==null){R=g.child;for(var Z=W.firstContext;Z!==null;){if(Z.context===c){if(g.tag===1){Z=Dr(-1,s&-s),Z.tag=2;var pe=g.updateQueue;if(pe!==null){pe=pe.shared;var ke=pe.pending;ke===null?Z.next=Z:(Z.next=ke.next,ke.next=Z),pe.pending=Z}}g.lanes|=s,Z=g.alternate,Z!==null&&(Z.lanes|=s),ja(g.return,s,t),W.lanes|=s;break}Z=Z.next}}else if(g.tag===10)R=g.type===t.type?null:g.child;else if(g.tag===18){if(R=g.return,R===null)throw Error(n(341));R.lanes|=s,W=R.alternate,W!==null&&(W.lanes|=s),ja(R,s,t),R=g.sibling}else R=g.child;if(R!==null)R.return=g;else for(R=g;R!==null;){if(R===t){R=null;break}if(g=R.sibling,g!==null){g.return=R.return,R=g;break}R=R.return}g=R}Vt(e,t,p.children,s),t=t.child}return t;case 9:return p=t.type,c=t.pendingProps.children,ss(t,s),p=cr(p),c=c(p),t.flags|=1,Vt(e,t,c,s),t.child;case 14:return c=t.type,p=gr(c,t.pendingProps),p=gr(c.type,p),Uu(e,t,c,p,s);case 15:return zu(e,t,t.type,t.pendingProps,s);case 17:return c=t.type,p=t.pendingProps,p=t.elementType===c?p:gr(c,p),Qi(e,t),t.tag=1,Kt(c)?(e=!0,Ri(t)):e=!1,ss(t,s),Tu(t,c,p),Ma(t,c,p,s),Ha(null,t,c,!0,e,s);case 19:return Ku(e,t,s);case 22:return Mu(e,t,s)}throw Error(n(156,t.tag))};function vd(e,t){return ui(e,t)}function om(e,t,s,c){this.tag=e,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function fr(e,t,s,c){return new om(e,t,s,c)}function dl(e){return e=e.prototype,!(!e||!e.isReactComponent)}function am(e){if(typeof e=="function")return dl(e)?1:0;if(e!=null){if(e=e.$$typeof,e===F)return 11;if(e===K)return 14}return 2}function cn(e,t){var s=e.alternate;return s===null?(s=fr(e.tag,t,e.key,e.mode),s.elementType=e.elementType,s.type=e.type,s.stateNode=e.stateNode,s.alternate=e,e.alternate=s):(s.pendingProps=t,s.type=e.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=e.flags&14680064,s.childLanes=e.childLanes,s.lanes=e.lanes,s.child=e.child,s.memoizedProps=e.memoizedProps,s.memoizedState=e.memoizedState,s.updateQueue=e.updateQueue,t=e.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},s.sibling=e.sibling,s.index=e.index,s.ref=e.ref,s}function so(e,t,s,c,p,g){var R=2;if(c=e,typeof e=="function")dl(e)&&(R=1);else if(typeof e=="string")R=5;else e:switch(e){case J:return An(s.children,p,g,t);case $:R=8,p|=8;break;case z:return e=fr(12,s,t,p|2),e.elementType=z,e.lanes=g,e;case te:return e=fr(13,s,t,p),e.elementType=te,e.lanes=g,e;case N:return e=fr(19,s,t,p),e.elementType=N,e.lanes=g,e;case ne:return io(s,p,g,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Q:R=10;break e;case ae:R=9;break e;case F:R=11;break e;case K:R=14;break e;case ge:R=16,c=null;break e}throw Error(n(130,e==null?e:typeof e,""))}return t=fr(R,s,t,p),t.elementType=e,t.type=c,t.lanes=g,t}function An(e,t,s,c){return e=fr(7,e,c,t),e.lanes=s,e}function io(e,t,s,c){return e=fr(22,e,c,t),e.elementType=ne,e.lanes=s,e.stateNode={isHidden:!1},e}function fl(e,t,s){return e=fr(6,e,null,t),e.lanes=s,e}function hl(e,t,s){return t=fr(4,e.children!==null?e.children:[],e.key,t),t.lanes=s,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function lm(e,t,s,c,p){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zo(0),this.expirationTimes=zo(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zo(0),this.identifierPrefix=c,this.onRecoverableError=p,this.mutableSourceEagerHydrationData=null}function pl(e,t,s,c,p,g,R,W,Z){return e=new lm(e,t,s,W,Z),t===1?(t=1,g===!0&&(t|=8)):t=0,g=fr(3,null,null,t),e.current=g,g.stateNode=e,g.memoizedState={element:c,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ea(g),e}function cm(e,t,s){var c=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:re,key:c==null?null:""+c,children:e,containerInfo:t,implementation:s}}function xd(e){if(!e)return Jr;e=e._reactInternals;e:{if(Ar(e)!==e||e.tag!==1)throw Error(n(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Kt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(n(171))}if(e.tag===1){var s=e.type;if(Kt(s))return Qc(e,s,t)}return t}function wd(e,t,s,c,p,g,R,W,Z){return e=pl(s,c,!0,e,p,g,R,W,Z),e.context=xd(null),s=e.current,c=Ht(),p=an(s),g=Dr(c,p),g.callback=t??null,rn(s,g,p),e.current.lanes=p,ws(e,p,c),Xt(e,c),e}function oo(e,t,s,c){var p=t.current,g=Ht(),R=an(p);return s=xd(s),t.context===null?t.context=s:t.pendingContext=s,t=Dr(g,R),t.payload={element:e},c=c===void 0?null:c,c!==null&&(t.callback=c),e=rn(p,t,R),e!==null&&(xr(e,p,R,g),Fi(e,p,R)),R}function ao(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function bd(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var s=e.retryLane;e.retryLane=s!==0&&s<t?s:t}}function ml(e,t){bd(e,t),(e=e.alternate)&&bd(e,t)}function um(){return null}var kd=typeof reportError=="function"?reportError:function(e){console.error(e)};function gl(e){this._internalRoot=e}lo.prototype.render=gl.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(n(409));oo(e,t,null,null)},lo.prototype.unmount=gl.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;En(function(){oo(null,e,null,null)}),t[Tr]=null}};function lo(e){this._internalRoot=e}lo.prototype.unstable_scheduleHydration=function(e){if(e){var t=ic();e={blockedOn:null,target:e,priority:t};for(var s=0;s<Kr.length&&t!==0&&t<Kr[s].priority;s++);Kr.splice(s,0,e),s===0&&lc(e)}};function yl(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function co(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Sd(){}function dm(e,t,s,c,p){if(p){if(typeof c=="function"){var g=c;c=function(){var pe=ao(R);g.call(pe)}}var R=wd(t,c,e,0,null,!1,!1,"",Sd);return e._reactRootContainer=R,e[Tr]=R.current,Ls(e.nodeType===8?e.parentNode:e),En(),R}for(;p=e.lastChild;)e.removeChild(p);if(typeof c=="function"){var W=c;c=function(){var pe=ao(Z);W.call(pe)}}var Z=pl(e,0,!1,null,null,!1,!1,"",Sd);return e._reactRootContainer=Z,e[Tr]=Z.current,Ls(e.nodeType===8?e.parentNode:e),En(function(){oo(t,Z,s,c)}),Z}function uo(e,t,s,c,p){var g=s._reactRootContainer;if(g){var R=g;if(typeof p=="function"){var W=p;p=function(){var Z=ao(R);W.call(Z)}}oo(t,R,e,p)}else R=dm(s,t,e,p,c);return ao(R)}nc=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var s=Tt(t.pendingLanes);s!==0&&(Mo(t,s|1),Xt(t,ht()),(et&6)===0&&(cs=ht()+500,en()))}break;case 13:En(function(){var c=Ir(e,1);if(c!==null){var p=Ht();xr(c,e,1,p)}}),ml(e,1)}},$o=function(e){if(e.tag===13){var t=Ir(e,134217728);if(t!==null){var s=Ht();xr(t,e,134217728,s)}ml(e,134217728)}},sc=function(e){if(e.tag===13){var t=an(e),s=Ir(e,t);if(s!==null){var c=Ht();xr(s,e,t,c)}ml(e,t)}},ic=function(){return rt},oc=function(e,t){var s=rt;try{return rt=e,t()}finally{rt=s}},Rr=function(e,t,s){switch(t){case"input":if(I(e,s),t=s.name,s.type==="radio"&&t!=null){for(s=e;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<s.length;t++){var c=s[t];if(c!==e&&c.form===e.form){var p=Ei(c);if(!p)throw Error(n(90));He(c),I(c,p)}}}break;case"textarea":T(e,s);break;case"select":t=s.value,t!=null&&oe(e,!!s.multiple,t,!1)}},zr=ll,At=En;var fm={usingClientEntryPoint:!1,Events:[Fs,Zn,Ei,mn,zn,ll]},Xs={findFiberByHostInstance:xn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},hm={bundleType:Xs.bundleType,version:Xs.version,rendererPackageName:Xs.rendererPackageName,rendererConfig:Xs.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:U.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=xs(e),e===null?null:e.stateNode},findFiberByHostInstance:Xs.findFiberByHostInstance||um,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var fo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!fo.isDisabled&&fo.supportsFiber)try{Xe=fo.inject(hm),nt=fo}catch{}}return Yt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=fm,Yt.createPortal=function(e,t){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!yl(t))throw Error(n(200));return cm(e,t,null,s)},Yt.createRoot=function(e,t){if(!yl(e))throw Error(n(299));var s=!1,c="",p=kd;return t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(c=t.identifierPrefix),t.onRecoverableError!==void 0&&(p=t.onRecoverableError)),t=pl(e,1,!1,null,null,s,!1,c,p),e[Tr]=t.current,Ls(e.nodeType===8?e.parentNode:e),new gl(t)},Yt.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(n(188)):(e=Object.keys(e).join(","),Error(n(268,e)));return e=xs(t),e=e===null?null:e.stateNode,e},Yt.flushSync=function(e){return En(e)},Yt.hydrate=function(e,t,s){if(!co(t))throw Error(n(200));return uo(null,e,t,!0,s)},Yt.hydrateRoot=function(e,t,s){if(!yl(e))throw Error(n(405));var c=s!=null&&s.hydratedSources||null,p=!1,g="",R=kd;if(s!=null&&(s.unstable_strictMode===!0&&(p=!0),s.identifierPrefix!==void 0&&(g=s.identifierPrefix),s.onRecoverableError!==void 0&&(R=s.onRecoverableError)),t=wd(t,null,e,1,s??null,p,!1,g,R),e[Tr]=t.current,Ls(e),c)for(e=0;e<c.length;e++)s=c[e],p=s._getVersion,p=p(s._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[s,p]:t.mutableSourceEagerHydrationData.push(s,p);return new lo(t)},Yt.render=function(e,t,s){if(!co(t))throw Error(n(200));return uo(null,e,t,!1,s)},Yt.unmountComponentAtNode=function(e){if(!co(e))throw Error(n(40));return e._reactRootContainer?(En(function(){uo(null,null,e,!1,function(){e._reactRootContainer=null,e[Tr]=null})}),!0):!1},Yt.unstable_batchedUpdates=ll,Yt.unstable_renderSubtreeIntoContainer=function(e,t,s,c){if(!co(s))throw Error(n(200));if(e==null||e._reactInternals===void 0)throw Error(n(38));return uo(e,t,s,!1,c)},Yt.version="18.3.1-next-f1338f8080-20240426",Yt}var Td;function bf(){if(Td)return wl.exports;Td=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(i){console.error(i)}}return r(),wl.exports=km(),wl.exports}var Pd;function Sm(){if(Pd)return po;Pd=1;var r=bf();return po.createRoot=r.createRoot,po.hydrateRoot=r.hydrateRoot,po}var Cm=Sm();const jm=$l(Cm),Nm="modulepreload",Em=function(r){return"/JamesEnglish1028-My-Ebook-Reader/"+r},Od={},kf=function(i,n,o){let u=Promise.resolve();if(n&&n.length>0){let h=function(y){return Promise.all(y.map(k=>Promise.resolve(k).then(w=>({status:"fulfilled",value:w}),w=>({status:"rejected",reason:w}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),f=d?.nonce||d?.getAttribute("nonce");u=h(n.map(y=>{if(y=Em(y),y in Od)return;Od[y]=!0;const k=y.endsWith(".css"),w=k?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${y}"]${w}`))return;const x=document.createElement("link");if(x.rel=k?"stylesheet":Nm,k||(x.as="script"),x.crossOrigin="",x.href=y,f&&x.setAttribute("nonce",f),document.head.appendChild(x),k)return new Promise((b,C)=>{x.addEventListener("load",b),x.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${y}`)))})}))}function l(d){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=d,window.dispatchEvent(f),!f.defaultPrevented)throw d}return u.then(d=>{for(const f of d||[])f.status==="rejected"&&l(f.reason);return i().catch(l)})};var ms=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(r){return this.listeners.add(r),this.onSubscribe(),()=>{this.listeners.delete(r),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},_m={setTimeout:(r,i)=>setTimeout(r,i),clearTimeout:r=>clearTimeout(r),setInterval:(r,i)=>setInterval(r,i),clearInterval:r=>clearInterval(r)},Rm=class{#e=_m;#t=!1;setTimeoutProvider(r){this.#e=r}setTimeout(r,i){return this.#e.setTimeout(r,i)}clearTimeout(r){this.#e.clearTimeout(r)}setInterval(r,i){return this.#e.setInterval(r,i)}clearInterval(r){this.#e.clearInterval(r)}},On=new Rm;function Am(r){setTimeout(r,0)}var In=typeof window>"u"||"Deno"in globalThis;function qt(){}function Tm(r,i){return typeof r=="function"?r(i):r}function Tl(r){return typeof r=="number"&&r>=0&&r!==1/0}function Sf(r,i){return Math.max(r+(i||0)-Date.now(),0)}function pn(r,i){return typeof r=="function"?r(i):r}function hr(r,i){return typeof r=="function"?r(i):r}function Ld(r,i){const{type:n="all",exact:o,fetchStatus:u,predicate:l,queryKey:d,stale:f}=r;if(d){if(o){if(i.queryHash!==Vl(d,i.options))return!1}else if(!ni(i.queryKey,d))return!1}if(n!=="all"){const h=i.isActive();if(n==="active"&&!h||n==="inactive"&&h)return!1}return!(typeof f=="boolean"&&i.isStale()!==f||u&&u!==i.state.fetchStatus||l&&!l(i))}function Id(r,i){const{exact:n,status:o,predicate:u,mutationKey:l}=r;if(l){if(!i.options.mutationKey)return!1;if(n){if(Dn(i.options.mutationKey)!==Dn(l))return!1}else if(!ni(i.options.mutationKey,l))return!1}return!(o&&i.state.status!==o||u&&!u(i))}function Vl(r,i){return(i?.queryKeyHashFn||Dn)(r)}function Dn(r){return JSON.stringify(r,(i,n)=>Pl(n)?Object.keys(n).sort().reduce((o,u)=>(o[u]=n[u],o),{}):n)}function ni(r,i){return r===i?!0:typeof r!=typeof i?!1:r&&i&&typeof r=="object"&&typeof i=="object"?Object.keys(i).every(n=>ni(r[n],i[n])):!1}var Pm=Object.prototype.hasOwnProperty;function Cf(r,i){if(r===i)return r;const n=Dd(r)&&Dd(i);if(!n&&!(Pl(r)&&Pl(i)))return i;const u=(n?r:Object.keys(r)).length,l=n?i:Object.keys(i),d=l.length,f=n?new Array(d):{};let h=0;for(let y=0;y<d;y++){const k=n?y:l[y],w=r[k],x=i[k];if(w===x){f[k]=w,(n?y<u:Pm.call(r,k))&&h++;continue}if(w===null||x===null||typeof w!="object"||typeof x!="object"){f[k]=x;continue}const b=Cf(w,x);f[k]=b,b===w&&h++}return u===d&&h===u?r:f}function bo(r,i){if(!i||Object.keys(r).length!==Object.keys(i).length)return!1;for(const n in r)if(r[n]!==i[n])return!1;return!0}function Dd(r){return Array.isArray(r)&&r.length===Object.keys(r).length}function Pl(r){if(!Fd(r))return!1;const i=r.constructor;if(i===void 0)return!0;const n=i.prototype;return!(!Fd(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(r)!==Object.prototype)}function Fd(r){return Object.prototype.toString.call(r)==="[object Object]"}function Om(r){return new Promise(i=>{On.setTimeout(i,r)})}function Ol(r,i,n){return typeof n.structuralSharing=="function"?n.structuralSharing(r,i):n.structuralSharing!==!1?Cf(r,i):i}function Lm(r,i,n=0){const o=[...r,i];return n&&o.length>n?o.slice(1):o}function Im(r,i,n=0){const o=[i,...r];return n&&o.length>n?o.slice(0,-1):o}var Hl=Symbol();function jf(r,i){return!r.queryFn&&i?.initialPromise?()=>i.initialPromise:!r.queryFn||r.queryFn===Hl?()=>Promise.reject(new Error(`Missing queryFn: '${r.queryHash}'`)):r.queryFn}function Nf(r,i){return typeof r=="function"?r(...i):!!r}var Dm=class extends ms{#e;#t;#r;constructor(){super(),this.#r=r=>{if(!In&&window.addEventListener){const i=()=>r();return window.addEventListener("visibilitychange",i,!1),()=>{window.removeEventListener("visibilitychange",i)}}}}onSubscribe(){this.#t||this.setEventListener(this.#r)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(r){this.#r=r,this.#t?.(),this.#t=r(i=>{typeof i=="boolean"?this.setFocused(i):this.onFocus()})}setFocused(r){this.#e!==r&&(this.#e=r,this.onFocus())}onFocus(){const r=this.isFocused();this.listeners.forEach(i=>{i(r)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},ql=new Dm;function Ll(){let r,i;const n=new Promise((u,l)=>{r=u,i=l});n.status="pending",n.catch(()=>{});function o(u){Object.assign(n,u),delete n.resolve,delete n.reject}return n.resolve=u=>{o({status:"fulfilled",value:u}),r(u)},n.reject=u=>{o({status:"rejected",reason:u}),i(u)},n}var Fm=Am;function Bm(){let r=[],i=0,n=f=>{f()},o=f=>{f()},u=Fm;const l=f=>{i?r.push(f):u(()=>{n(f)})},d=()=>{const f=r;r=[],f.length&&u(()=>{o(()=>{f.forEach(h=>{n(h)})})})};return{batch:f=>{let h;i++;try{h=f()}finally{i--,i||d()}return h},batchCalls:f=>(...h)=>{l(()=>{f(...h)})},schedule:l,setNotifyFunction:f=>{n=f},setBatchNotifyFunction:f=>{o=f},setScheduler:f=>{u=f}}}var kt=Bm(),Um=class extends ms{#e=!0;#t;#r;constructor(){super(),this.#r=r=>{if(!In&&window.addEventListener){const i=()=>r(!0),n=()=>r(!1);return window.addEventListener("online",i,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",i),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#r)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(r){this.#r=r,this.#t?.(),this.#t=r(this.setOnline.bind(this))}setOnline(r){this.#e!==r&&(this.#e=r,this.listeners.forEach(n=>{n(r)}))}isOnline(){return this.#e}},ko=new Um;function zm(r){return Math.min(1e3*2**r,3e4)}function Ef(r){return(r??"online")==="online"?ko.isOnline():!0}var Il=class extends Error{constructor(r){super("CancelledError"),this.revert=r?.revert,this.silent=r?.silent}};function _f(r){let i=!1,n=0,o;const u=Ll(),l=()=>u.status!=="pending",d=m=>{if(!l()){const S=new Il(m);x(S),r.onCancel?.(S)}},f=()=>{i=!0},h=()=>{i=!1},y=()=>ql.isFocused()&&(r.networkMode==="always"||ko.isOnline())&&r.canRun(),k=()=>Ef(r.networkMode)&&r.canRun(),w=m=>{l()||(o?.(),u.resolve(m))},x=m=>{l()||(o?.(),u.reject(m))},b=()=>new Promise(m=>{o=S=>{(l()||y())&&m(S)},r.onPause?.()}).then(()=>{o=void 0,l()||r.onContinue?.()}),C=()=>{if(l())return;let m;const S=n===0?r.initialPromise:void 0;try{m=S??r.fn()}catch(j){m=Promise.reject(j)}Promise.resolve(m).then(w).catch(j=>{if(l())return;const _=r.retry??(In?0:3),L=r.retryDelay??zm,U=typeof L=="function"?L(n,j):L,M=_===!0||typeof _=="number"&&n<_||typeof _=="function"&&_(n,j);if(i||!M){x(j);return}n++,r.onFail?.(n,j),Om(U).then(()=>y()?void 0:b()).then(()=>{i?x(j):C()})})};return{promise:u,status:()=>u.status,cancel:d,continue:()=>(o?.(),u),cancelRetry:f,continueRetry:h,canStart:k,start:()=>(k()?C():b().then(C),u)}}var Rf=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Tl(this.gcTime)&&(this.#e=On.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(r){this.gcTime=Math.max(this.gcTime||0,r??(In?1/0:300*1e3))}clearGcTimeout(){this.#e&&(On.clearTimeout(this.#e),this.#e=void 0)}},Mm=class extends Rf{#e;#t;#r;#s;#n;#o;#a;constructor(r){super(),this.#a=!1,this.#o=r.defaultOptions,this.setOptions(r.options),this.observers=[],this.#s=r.client,this.#r=this.#s.getQueryCache(),this.queryKey=r.queryKey,this.queryHash=r.queryHash,this.#e=Bd(this.options),this.state=r.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#n?.promise}setOptions(r){if(this.options={...this.#o,...r},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const i=Bd(this.options);i.data!==void 0&&(this.setData(i.data,{updatedAt:i.dataUpdatedAt,manual:!0}),this.#e=i)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#r.remove(this)}setData(r,i){const n=Ol(this.state.data,r,this.options);return this.#i({data:n,type:"success",dataUpdatedAt:i?.updatedAt,manual:i?.manual}),n}setState(r,i){this.#i({type:"setState",state:r,setStateOptions:i})}cancel(r){const i=this.#n?.promise;return this.#n?.cancel(r),i?i.then(qt).catch(qt):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(r=>hr(r.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Hl||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(r=>pn(r.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(r=>r.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(r=0){return this.state.data===void 0?!0:r==="static"?!1:this.state.isInvalidated?!0:!Sf(this.state.dataUpdatedAt,r)}onFocus(){this.observers.find(i=>i.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#n?.continue()}onOnline(){this.observers.find(i=>i.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#n?.continue()}addObserver(r){this.observers.includes(r)||(this.observers.push(r),this.clearGcTimeout(),this.#r.notify({type:"observerAdded",query:this,observer:r}))}removeObserver(r){this.observers.includes(r)&&(this.observers=this.observers.filter(i=>i!==r),this.observers.length||(this.#n&&(this.#a?this.#n.cancel({revert:!0}):this.#n.cancelRetry()),this.scheduleGc()),this.#r.notify({type:"observerRemoved",query:this,observer:r}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#i({type:"invalidate"})}async fetch(r,i){if(this.state.fetchStatus!=="idle"&&this.#n?.status()!=="rejected"){if(this.state.data!==void 0&&i?.cancelRefetch)this.cancel({silent:!0});else if(this.#n)return this.#n.continueRetry(),this.#n.promise}if(r&&this.setOptions(r),!this.options.queryFn){const f=this.observers.find(h=>h.options.queryFn);f&&this.setOptions(f.options)}const n=new AbortController,o=f=>{Object.defineProperty(f,"signal",{enumerable:!0,get:()=>(this.#a=!0,n.signal)})},u=()=>{const f=jf(this.options,i),y=(()=>{const k={client:this.#s,queryKey:this.queryKey,meta:this.meta};return o(k),k})();return this.#a=!1,this.options.persister?this.options.persister(f,y,this):f(y)},d=(()=>{const f={fetchOptions:i,options:this.options,queryKey:this.queryKey,client:this.#s,state:this.state,fetchFn:u};return o(f),f})();this.options.behavior?.onFetch(d,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==d.fetchOptions?.meta)&&this.#i({type:"fetch",meta:d.fetchOptions?.meta}),this.#n=_f({initialPromise:i?.initialPromise,fn:d.fetchFn,onCancel:f=>{f instanceof Il&&f.revert&&this.setState({...this.#t,fetchStatus:"idle"}),n.abort()},onFail:(f,h)=>{this.#i({type:"failed",failureCount:f,error:h})},onPause:()=>{this.#i({type:"pause"})},onContinue:()=>{this.#i({type:"continue"})},retry:d.options.retry,retryDelay:d.options.retryDelay,networkMode:d.options.networkMode,canRun:()=>!0});try{const f=await this.#n.start();if(f===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(f),this.#r.config.onSuccess?.(f,this),this.#r.config.onSettled?.(f,this.state.error,this),f}catch(f){if(f instanceof Il){if(f.silent)return this.#n.promise;if(f.revert){if(this.state.data===void 0)throw f;return this.state.data}}throw this.#i({type:"error",error:f}),this.#r.config.onError?.(f,this),this.#r.config.onSettled?.(this.state.data,f,this),f}finally{this.scheduleGc()}}#i(r){const i=n=>{switch(r.type){case"failed":return{...n,fetchFailureCount:r.failureCount,fetchFailureReason:r.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,...Af(n.data,this.options),fetchMeta:r.meta??null};case"success":const o={...n,data:r.data,dataUpdateCount:n.dataUpdateCount+1,dataUpdatedAt:r.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!r.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=r.manual?o:void 0,o;case"error":const u=r.error;return{...n,error:u,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:u,fetchStatus:"idle",status:"error"};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...r.state}}};this.state=i(this.state),kt.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate()}),this.#r.notify({query:this,type:"updated",action:r})})}};function Af(r,i){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Ef(i.networkMode)?"fetching":"paused",...r===void 0&&{error:null,status:"pending"}}}function Bd(r){const i=typeof r.initialData=="function"?r.initialData():r.initialData,n=i!==void 0,o=n?typeof r.initialDataUpdatedAt=="function"?r.initialDataUpdatedAt():r.initialDataUpdatedAt:0;return{data:i,dataUpdateCount:0,dataUpdatedAt:n?o??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var $m=class extends ms{constructor(r,i){super(),this.options=i,this.#e=r,this.#i=null,this.#a=Ll(),this.bindMethods(),this.setOptions(i)}#e;#t=void 0;#r=void 0;#s=void 0;#n;#o;#a;#i;#m;#f;#h;#c;#u;#l;#p=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),Ud(this.#t,this.options)?this.#d():this.updateResult(),this.#x())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Dl(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Dl(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#w(),this.#b(),this.#t.removeObserver(this)}setOptions(r){const i=this.options,n=this.#t;if(this.options=this.#e.defaultQueryOptions(r),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof hr(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#k(),this.#t.setOptions(this.options),i._defaulted&&!bo(this.options,i)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const o=this.hasListeners();o&&zd(this.#t,n,this.options,i)&&this.#d(),this.updateResult(),o&&(this.#t!==n||hr(this.options.enabled,this.#t)!==hr(i.enabled,this.#t)||pn(this.options.staleTime,this.#t)!==pn(i.staleTime,this.#t))&&this.#g();const u=this.#y();o&&(this.#t!==n||hr(this.options.enabled,this.#t)!==hr(i.enabled,this.#t)||u!==this.#l)&&this.#v(u)}getOptimisticResult(r){const i=this.#e.getQueryCache().build(this.#e,r),n=this.createResult(i,r);return Vm(this,n)&&(this.#s=n,this.#o=this.options,this.#n=this.#t.state),n}getCurrentResult(){return this.#s}trackResult(r,i){return new Proxy(r,{get:(n,o)=>(this.trackProp(o),i?.(o),o==="promise"&&!this.options.experimental_prefetchInRender&&this.#a.status==="pending"&&this.#a.reject(new Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(n,o))})}trackProp(r){this.#p.add(r)}getCurrentQuery(){return this.#t}refetch({...r}={}){return this.fetch({...r})}fetchOptimistic(r){const i=this.#e.defaultQueryOptions(r),n=this.#e.getQueryCache().build(this.#e,i);return n.fetch().then(()=>this.createResult(n,i))}fetch(r){return this.#d({...r,cancelRefetch:r.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#s))}#d(r){this.#k();let i=this.#t.fetch(this.options,r);return r?.throwOnError||(i=i.catch(qt)),i}#g(){this.#w();const r=pn(this.options.staleTime,this.#t);if(In||this.#s.isStale||!Tl(r))return;const n=Sf(this.#s.dataUpdatedAt,r)+1;this.#c=On.setTimeout(()=>{this.#s.isStale||this.updateResult()},n)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#v(r){this.#b(),this.#l=r,!(In||hr(this.options.enabled,this.#t)===!1||!Tl(this.#l)||this.#l===0)&&(this.#u=On.setInterval(()=>{(this.options.refetchIntervalInBackground||ql.isFocused())&&this.#d()},this.#l))}#x(){this.#g(),this.#v(this.#y())}#w(){this.#c&&(On.clearTimeout(this.#c),this.#c=void 0)}#b(){this.#u&&(On.clearInterval(this.#u),this.#u=void 0)}createResult(r,i){const n=this.#t,o=this.options,u=this.#s,l=this.#n,d=this.#o,h=r!==n?r.state:this.#r,{state:y}=r;let k={...y},w=!1,x;if(i._optimisticResults){const $=this.hasListeners(),z=!$&&Ud(r,i),Q=$&&zd(r,n,i,o);(z||Q)&&(k={...k,...Af(y.data,r.options)}),i._optimisticResults==="isRestoring"&&(k.fetchStatus="idle")}let{error:b,errorUpdatedAt:C,status:m}=k;x=k.data;let S=!1;if(i.placeholderData!==void 0&&x===void 0&&m==="pending"){let $;u?.isPlaceholderData&&i.placeholderData===d?.placeholderData?($=u.data,S=!0):$=typeof i.placeholderData=="function"?i.placeholderData(this.#h?.state.data,this.#h):i.placeholderData,$!==void 0&&(m="success",x=Ol(u?.data,$,i),w=!0)}if(i.select&&x!==void 0&&!S)if(u&&x===l?.data&&i.select===this.#m)x=this.#f;else try{this.#m=i.select,x=i.select(x),x=Ol(u?.data,x,i),this.#f=x,this.#i=null}catch($){this.#i=$}this.#i&&(b=this.#i,x=this.#f,C=Date.now(),m="error");const j=k.fetchStatus==="fetching",_=m==="pending",L=m==="error",U=_&&j,M=x!==void 0,J={status:m,fetchStatus:k.fetchStatus,isPending:_,isSuccess:m==="success",isError:L,isInitialLoading:U,isLoading:U,data:x,dataUpdatedAt:k.dataUpdatedAt,error:b,errorUpdatedAt:C,failureCount:k.fetchFailureCount,failureReason:k.fetchFailureReason,errorUpdateCount:k.errorUpdateCount,isFetched:k.dataUpdateCount>0||k.errorUpdateCount>0,isFetchedAfterMount:k.dataUpdateCount>h.dataUpdateCount||k.errorUpdateCount>h.errorUpdateCount,isFetching:j,isRefetching:j&&!_,isLoadingError:L&&!M,isPaused:k.fetchStatus==="paused",isPlaceholderData:w,isRefetchError:L&&M,isStale:Ql(r,i),refetch:this.refetch,promise:this.#a,isEnabled:hr(i.enabled,r)!==!1};if(this.options.experimental_prefetchInRender){const $=ae=>{J.status==="error"?ae.reject(J.error):J.data!==void 0&&ae.resolve(J.data)},z=()=>{const ae=this.#a=J.promise=Ll();$(ae)},Q=this.#a;switch(Q.status){case"pending":r.queryHash===n.queryHash&&$(Q);break;case"fulfilled":(J.status==="error"||J.data!==Q.value)&&z();break;case"rejected":(J.status!=="error"||J.error!==Q.reason)&&z();break}}return J}updateResult(){const r=this.#s,i=this.createResult(this.#t,this.options);if(this.#n=this.#t.state,this.#o=this.options,this.#n.data!==void 0&&(this.#h=this.#t),bo(i,r))return;this.#s=i;const n=()=>{if(!r)return!0;const{notifyOnChangeProps:o}=this.options,u=typeof o=="function"?o():o;if(u==="all"||!u&&!this.#p.size)return!0;const l=new Set(u??this.#p);return this.options.throwOnError&&l.add("error"),Object.keys(this.#s).some(d=>{const f=d;return this.#s[f]!==r[f]&&l.has(f)})};this.#S({listeners:n()})}#k(){const r=this.#e.getQueryCache().build(this.#e,this.options);if(r===this.#t)return;const i=this.#t;this.#t=r,this.#r=r.state,this.hasListeners()&&(i?.removeObserver(this),r.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#x()}#S(r){kt.batch(()=>{r.listeners&&this.listeners.forEach(i=>{i(this.#s)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function Wm(r,i){return hr(i.enabled,r)!==!1&&r.state.data===void 0&&!(r.state.status==="error"&&i.retryOnMount===!1)}function Ud(r,i){return Wm(r,i)||r.state.data!==void 0&&Dl(r,i,i.refetchOnMount)}function Dl(r,i,n){if(hr(i.enabled,r)!==!1&&pn(i.staleTime,r)!=="static"){const o=typeof n=="function"?n(r):n;return o==="always"||o!==!1&&Ql(r,i)}return!1}function zd(r,i,n,o){return(r!==i||hr(o.enabled,r)===!1)&&(!n.suspense||r.state.status!=="error")&&Ql(r,n)}function Ql(r,i){return hr(i.enabled,r)!==!1&&r.isStaleByTime(pn(i.staleTime,r))}function Vm(r,i){return!bo(r.getCurrentResult(),i)}function Md(r){return{onFetch:(i,n)=>{const o=i.options,u=i.fetchOptions?.meta?.fetchMore?.direction,l=i.state.data?.pages||[],d=i.state.data?.pageParams||[];let f={pages:[],pageParams:[]},h=0;const y=async()=>{let k=!1;const w=C=>{Object.defineProperty(C,"signal",{enumerable:!0,get:()=>(i.signal.aborted?k=!0:i.signal.addEventListener("abort",()=>{k=!0}),i.signal)})},x=jf(i.options,i.fetchOptions),b=async(C,m,S)=>{if(k)return Promise.reject();if(m==null&&C.pages.length)return Promise.resolve(C);const _=(()=>{const re={client:i.client,queryKey:i.queryKey,pageParam:m,direction:S?"backward":"forward",meta:i.options.meta};return w(re),re})(),L=await x(_),{maxPages:U}=i.options,M=S?Im:Lm;return{pages:M(C.pages,L,U),pageParams:M(C.pageParams,m,U)}};if(u&&l.length){const C=u==="backward",m=C?Hm:$d,S={pages:l,pageParams:d},j=m(o,S);f=await b(S,j,C)}else{const C=r??l.length;do{const m=h===0?d[0]??o.initialPageParam:$d(o,f);if(h>0&&m==null)break;f=await b(f,m),h++}while(h<C)}return f};i.options.persister?i.fetchFn=()=>i.options.persister?.(y,{client:i.client,queryKey:i.queryKey,meta:i.options.meta,signal:i.signal},n):i.fetchFn=y}}}function $d(r,{pages:i,pageParams:n}){const o=i.length-1;return i.length>0?r.getNextPageParam(i[o],i,n[o],n):void 0}function Hm(r,{pages:i,pageParams:n}){return i.length>0?r.getPreviousPageParam?.(i[0],i,n[0],n):void 0}var qm=class extends Rf{#e;#t;#r;#s;constructor(r){super(),this.#e=r.client,this.mutationId=r.mutationId,this.#r=r.mutationCache,this.#t=[],this.state=r.state||Tf(),this.setOptions(r.options),this.scheduleGc()}setOptions(r){this.options=r,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(r){this.#t.includes(r)||(this.#t.push(r),this.clearGcTimeout(),this.#r.notify({type:"observerAdded",mutation:this,observer:r}))}removeObserver(r){this.#t=this.#t.filter(i=>i!==r),this.scheduleGc(),this.#r.notify({type:"observerRemoved",mutation:this,observer:r})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#r.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(r){const i=()=>{this.#n({type:"continue"})},n={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#s=_f({fn:()=>this.options.mutationFn?this.options.mutationFn(r,n):Promise.reject(new Error("No mutationFn found")),onFail:(l,d)=>{this.#n({type:"failed",failureCount:l,error:d})},onPause:()=>{this.#n({type:"pause"})},onContinue:i,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#r.canRun(this)});const o=this.state.status==="pending",u=!this.#s.canStart();try{if(o)i();else{this.#n({type:"pending",variables:r,isPaused:u}),await this.#r.config.onMutate?.(r,this,n);const d=await this.options.onMutate?.(r,n);d!==this.state.context&&this.#n({type:"pending",context:d,variables:r,isPaused:u})}const l=await this.#s.start();return await this.#r.config.onSuccess?.(l,r,this.state.context,this,n),await this.options.onSuccess?.(l,r,this.state.context,n),await this.#r.config.onSettled?.(l,null,this.state.variables,this.state.context,this,n),await this.options.onSettled?.(l,null,r,this.state.context,n),this.#n({type:"success",data:l}),l}catch(l){try{throw await this.#r.config.onError?.(l,r,this.state.context,this,n),await this.options.onError?.(l,r,this.state.context,n),await this.#r.config.onSettled?.(void 0,l,this.state.variables,this.state.context,this,n),await this.options.onSettled?.(void 0,l,r,this.state.context,n),l}finally{this.#n({type:"error",error:l})}}finally{this.#r.runNext(this)}}#n(r){const i=n=>{switch(r.type){case"failed":return{...n,failureCount:r.failureCount,failureReason:r.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:r.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:r.isPaused,status:"pending",variables:r.variables,submittedAt:Date.now()};case"success":return{...n,data:r.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:r.error,failureCount:n.failureCount+1,failureReason:r.error,isPaused:!1,status:"error"}}};this.state=i(this.state),kt.batch(()=>{this.#t.forEach(n=>{n.onMutationUpdate(r)}),this.#r.notify({mutation:this,type:"updated",action:r})})}};function Tf(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Qm=class extends ms{constructor(r={}){super(),this.config=r,this.#e=new Set,this.#t=new Map,this.#r=0}#e;#t;#r;build(r,i,n){const o=new qm({client:r,mutationCache:this,mutationId:++this.#r,options:r.defaultMutationOptions(i),state:n});return this.add(o),o}add(r){this.#e.add(r);const i=mo(r);if(typeof i=="string"){const n=this.#t.get(i);n?n.push(r):this.#t.set(i,[r])}this.notify({type:"added",mutation:r})}remove(r){if(this.#e.delete(r)){const i=mo(r);if(typeof i=="string"){const n=this.#t.get(i);if(n)if(n.length>1){const o=n.indexOf(r);o!==-1&&n.splice(o,1)}else n[0]===r&&this.#t.delete(i)}}this.notify({type:"removed",mutation:r})}canRun(r){const i=mo(r);if(typeof i=="string"){const o=this.#t.get(i)?.find(u=>u.state.status==="pending");return!o||o===r}else return!0}runNext(r){const i=mo(r);return typeof i=="string"?this.#t.get(i)?.find(o=>o!==r&&o.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){kt.batch(()=>{this.#e.forEach(r=>{this.notify({type:"removed",mutation:r})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(r){const i={exact:!0,...r};return this.getAll().find(n=>Id(i,n))}findAll(r={}){return this.getAll().filter(i=>Id(r,i))}notify(r){kt.batch(()=>{this.listeners.forEach(i=>{i(r)})})}resumePausedMutations(){const r=this.getAll().filter(i=>i.state.isPaused);return kt.batch(()=>Promise.all(r.map(i=>i.continue().catch(qt))))}};function mo(r){return r.options.scope?.id}var Km=class extends ms{#e;#t=void 0;#r;#s;constructor(i,n){super(),this.#e=i,this.setOptions(n),this.bindMethods(),this.#n()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(i){const n=this.options;this.options=this.#e.defaultMutationOptions(i),bo(this.options,n)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#r,observer:this}),n?.mutationKey&&this.options.mutationKey&&Dn(n.mutationKey)!==Dn(this.options.mutationKey)?this.reset():this.#r?.state.status==="pending"&&this.#r.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#r?.removeObserver(this)}onMutationUpdate(i){this.#n(),this.#o(i)}getCurrentResult(){return this.#t}reset(){this.#r?.removeObserver(this),this.#r=void 0,this.#n(),this.#o()}mutate(i,n){return this.#s=n,this.#r?.removeObserver(this),this.#r=this.#e.getMutationCache().build(this.#e,this.options),this.#r.addObserver(this),this.#r.execute(i)}#n(){const i=this.#r?.state??Tf();this.#t={...i,isPending:i.status==="pending",isSuccess:i.status==="success",isError:i.status==="error",isIdle:i.status==="idle",mutate:this.mutate,reset:this.reset}}#o(i){kt.batch(()=>{if(this.#s&&this.hasListeners()){const n=this.#t.variables,o=this.#t.context,u={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};i?.type==="success"?(this.#s.onSuccess?.(i.data,n,o,u),this.#s.onSettled?.(i.data,null,n,o,u)):i?.type==="error"&&(this.#s.onError?.(i.error,n,o,u),this.#s.onSettled?.(void 0,i.error,n,o,u))}this.listeners.forEach(n=>{n(this.#t)})})}},Gm=class extends ms{constructor(r={}){super(),this.config=r,this.#e=new Map}#e;build(r,i,n){const o=i.queryKey,u=i.queryHash??Vl(o,i);let l=this.get(u);return l||(l=new Mm({client:r,queryKey:o,queryHash:u,options:r.defaultQueryOptions(i),state:n,defaultOptions:r.getQueryDefaults(o)}),this.add(l)),l}add(r){this.#e.has(r.queryHash)||(this.#e.set(r.queryHash,r),this.notify({type:"added",query:r}))}remove(r){const i=this.#e.get(r.queryHash);i&&(r.destroy(),i===r&&this.#e.delete(r.queryHash),this.notify({type:"removed",query:r}))}clear(){kt.batch(()=>{this.getAll().forEach(r=>{this.remove(r)})})}get(r){return this.#e.get(r)}getAll(){return[...this.#e.values()]}find(r){const i={exact:!0,...r};return this.getAll().find(n=>Ld(i,n))}findAll(r={}){const i=this.getAll();return Object.keys(r).length>0?i.filter(n=>Ld(r,n)):i}notify(r){kt.batch(()=>{this.listeners.forEach(i=>{i(r)})})}onFocus(){kt.batch(()=>{this.getAll().forEach(r=>{r.onFocus()})})}onOnline(){kt.batch(()=>{this.getAll().forEach(r=>{r.onOnline()})})}},Zm=class{#e;#t;#r;#s;#n;#o;#a;#i;constructor(r={}){this.#e=r.queryCache||new Gm,this.#t=r.mutationCache||new Qm,this.#r=r.defaultOptions||{},this.#s=new Map,this.#n=new Map,this.#o=0}mount(){this.#o++,this.#o===1&&(this.#a=ql.subscribe(async r=>{r&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#i=ko.subscribe(async r=>{r&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#o--,this.#o===0&&(this.#a?.(),this.#a=void 0,this.#i?.(),this.#i=void 0)}isFetching(r){return this.#e.findAll({...r,fetchStatus:"fetching"}).length}isMutating(r){return this.#t.findAll({...r,status:"pending"}).length}getQueryData(r){const i=this.defaultQueryOptions({queryKey:r});return this.#e.get(i.queryHash)?.state.data}ensureQueryData(r){const i=this.defaultQueryOptions(r),n=this.#e.build(this,i),o=n.state.data;return o===void 0?this.fetchQuery(r):(r.revalidateIfStale&&n.isStaleByTime(pn(i.staleTime,n))&&this.prefetchQuery(i),Promise.resolve(o))}getQueriesData(r){return this.#e.findAll(r).map(({queryKey:i,state:n})=>{const o=n.data;return[i,o]})}setQueryData(r,i,n){const o=this.defaultQueryOptions({queryKey:r}),l=this.#e.get(o.queryHash)?.state.data,d=Tm(i,l);if(d!==void 0)return this.#e.build(this,o).setData(d,{...n,manual:!0})}setQueriesData(r,i,n){return kt.batch(()=>this.#e.findAll(r).map(({queryKey:o})=>[o,this.setQueryData(o,i,n)]))}getQueryState(r){const i=this.defaultQueryOptions({queryKey:r});return this.#e.get(i.queryHash)?.state}removeQueries(r){const i=this.#e;kt.batch(()=>{i.findAll(r).forEach(n=>{i.remove(n)})})}resetQueries(r,i){const n=this.#e;return kt.batch(()=>(n.findAll(r).forEach(o=>{o.reset()}),this.refetchQueries({type:"active",...r},i)))}cancelQueries(r,i={}){const n={revert:!0,...i},o=kt.batch(()=>this.#e.findAll(r).map(u=>u.cancel(n)));return Promise.all(o).then(qt).catch(qt)}invalidateQueries(r,i={}){return kt.batch(()=>(this.#e.findAll(r).forEach(n=>{n.invalidate()}),r?.refetchType==="none"?Promise.resolve():this.refetchQueries({...r,type:r?.refetchType??r?.type??"active"},i)))}refetchQueries(r,i={}){const n={...i,cancelRefetch:i.cancelRefetch??!0},o=kt.batch(()=>this.#e.findAll(r).filter(u=>!u.isDisabled()&&!u.isStatic()).map(u=>{let l=u.fetch(void 0,n);return n.throwOnError||(l=l.catch(qt)),u.state.fetchStatus==="paused"?Promise.resolve():l}));return Promise.all(o).then(qt)}fetchQuery(r){const i=this.defaultQueryOptions(r);i.retry===void 0&&(i.retry=!1);const n=this.#e.build(this,i);return n.isStaleByTime(pn(i.staleTime,n))?n.fetch(i):Promise.resolve(n.state.data)}prefetchQuery(r){return this.fetchQuery(r).then(qt).catch(qt)}fetchInfiniteQuery(r){return r.behavior=Md(r.pages),this.fetchQuery(r)}prefetchInfiniteQuery(r){return this.fetchInfiniteQuery(r).then(qt).catch(qt)}ensureInfiniteQueryData(r){return r.behavior=Md(r.pages),this.ensureQueryData(r)}resumePausedMutations(){return ko.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#r}setDefaultOptions(r){this.#r=r}setQueryDefaults(r,i){this.#s.set(Dn(r),{queryKey:r,defaultOptions:i})}getQueryDefaults(r){const i=[...this.#s.values()],n={};return i.forEach(o=>{ni(r,o.queryKey)&&Object.assign(n,o.defaultOptions)}),n}setMutationDefaults(r,i){this.#n.set(Dn(r),{mutationKey:r,defaultOptions:i})}getMutationDefaults(r){const i=[...this.#n.values()],n={};return i.forEach(o=>{ni(r,o.mutationKey)&&Object.assign(n,o.defaultOptions)}),n}defaultQueryOptions(r){if(r._defaulted)return r;const i={...this.#r.queries,...this.getQueryDefaults(r.queryKey),...r,_defaulted:!0};return i.queryHash||(i.queryHash=Vl(i.queryKey,i)),i.refetchOnReconnect===void 0&&(i.refetchOnReconnect=i.networkMode!=="always"),i.throwOnError===void 0&&(i.throwOnError=!!i.suspense),!i.networkMode&&i.persister&&(i.networkMode="offlineFirst"),i.queryFn===Hl&&(i.enabled=!1),i}defaultMutationOptions(r){return r?._defaulted?r:{...this.#r.mutations,...r?.mutationKey&&this.getMutationDefaults(r.mutationKey),...r,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},Pf=P.createContext(void 0),Eo=r=>{const i=P.useContext(Pf);if(!i)throw new Error("No QueryClient set, use QueryClientProvider to set one");return i},Xm=({client:r,children:i})=>(P.useEffect(()=>(r.mount(),()=>{r.unmount()}),[r]),a.jsx(Pf.Provider,{value:r,children:i})),Of=P.createContext(!1),Ym=()=>P.useContext(Of);Of.Provider;function Lf(){let r=!1;return{clearReset:()=>{r=!1},reset:()=>{r=!0},isReset:()=>r}}var If=P.createContext(Lf()),Jm=()=>P.useContext(If),eg=({children:r})=>{const[i]=P.useState(()=>Lf());return a.jsx(If.Provider,{value:i,children:typeof r=="function"?r(i):r})},tg=(r,i)=>{(r.suspense||r.throwOnError||r.experimental_prefetchInRender)&&(i.isReset()||(r.retryOnMount=!1))},rg=r=>{P.useEffect(()=>{r.clearReset()},[r])},ng=({result:r,errorResetBoundary:i,throwOnError:n,query:o,suspense:u})=>r.isError&&!i.isReset()&&!r.isFetching&&o&&(u&&r.data===void 0||Nf(n,[r.error,o])),sg=r=>{if(r.suspense){const n=u=>u==="static"?u:Math.max(u??1e3,1e3),o=r.staleTime;r.staleTime=typeof o=="function"?(...u)=>n(o(...u)):n(o),typeof r.gcTime=="number"&&(r.gcTime=Math.max(r.gcTime,1e3))}},ig=(r,i)=>r.isLoading&&r.isFetching&&!i,og=(r,i)=>r?.suspense&&i.isPending,Wd=(r,i,n)=>i.fetchOptimistic(r).catch(()=>{n.clearReset()});function ag(r,i,n){const o=Ym(),u=Jm(),l=Eo(),d=l.defaultQueryOptions(r);l.getDefaultOptions().queries?._experimental_beforeQuery?.(d),d._optimisticResults=o?"isRestoring":"optimistic",sg(d),tg(d,u),rg(u);const f=!l.getQueryCache().get(d.queryHash),[h]=P.useState(()=>new i(l,d)),y=h.getOptimisticResult(d),k=!o&&r.subscribed!==!1;if(P.useSyncExternalStore(P.useCallback(w=>{const x=k?h.subscribe(kt.batchCalls(w)):qt;return h.updateResult(),x},[h,k]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),P.useEffect(()=>{h.setOptions(d)},[d,h]),og(d,y))throw Wd(d,h,u);if(ng({result:y,errorResetBoundary:u,throwOnError:d.throwOnError,query:l.getQueryCache().get(d.queryHash),suspense:d.suspense}))throw y.error;return l.getDefaultOptions().queries?._experimental_afterQuery?.(d,y),d.experimental_prefetchInRender&&!In&&ig(y,o)&&(f?Wd(d,h,u):l.getQueryCache().get(d.queryHash)?.promise)?.catch(qt).finally(()=>{h.updateResult()}),d.notifyOnChangeProps?y:h.trackResult(y)}function Df(r,i){return ag(r,$m)}function lg(r,i){const n=Eo(),[o]=P.useState(()=>new Km(n,r));P.useEffect(()=>{o.setOptions(r)},[o,r]);const u=P.useSyncExternalStore(P.useCallback(d=>o.subscribe(kt.batchCalls(d)),[o]),()=>o.getCurrentResult(),()=>o.getCurrentResult()),l=P.useCallback((d,f)=>{o.mutate(d,f).catch(qt)},[o]);if(u.error&&Nf(o.options.throwOnError,[u.error]))throw u.error;return{...u,mutate:l,mutateAsync:u.mutate}}var cg=function(){return null};bf();/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function si(){return si=Object.assign?Object.assign.bind():function(r){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])}return r},si.apply(this,arguments)}var hn;(function(r){r.Pop="POP",r.Push="PUSH",r.Replace="REPLACE"})(hn||(hn={}));const Vd="popstate";function ug(r){r===void 0&&(r={});function i(u,l){let{pathname:d="/",search:f="",hash:h=""}=Bn(u.location.hash.substr(1));return!d.startsWith("/")&&!d.startsWith(".")&&(d="/"+d),Fl("",{pathname:d,search:f,hash:h},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function n(u,l){let d=u.document.querySelector("base"),f="";if(d&&d.getAttribute("href")){let h=u.location.href,y=h.indexOf("#");f=y===-1?h:h.slice(0,y)}return f+"#"+(typeof l=="string"?l:Ff(l))}function o(u,l){Kl(u.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(l)+")")}return fg(i,n,o,r)}function St(r,i){if(r===!1||r===null||typeof r>"u")throw new Error(i)}function Kl(r,i){if(!r){typeof console<"u"&&console.warn(i);try{throw new Error(i)}catch{}}}function dg(){return Math.random().toString(36).substr(2,8)}function Hd(r,i){return{usr:r.state,key:r.key,idx:i}}function Fl(r,i,n,o){return n===void 0&&(n=null),si({pathname:typeof r=="string"?r:r.pathname,search:"",hash:""},typeof i=="string"?Bn(i):i,{state:n,key:i&&i.key||o||dg()})}function Ff(r){let{pathname:i="/",search:n="",hash:o=""}=r;return n&&n!=="?"&&(i+=n.charAt(0)==="?"?n:"?"+n),o&&o!=="#"&&(i+=o.charAt(0)==="#"?o:"#"+o),i}function Bn(r){let i={};if(r){let n=r.indexOf("#");n>=0&&(i.hash=r.substr(n),r=r.substr(0,n));let o=r.indexOf("?");o>=0&&(i.search=r.substr(o),r=r.substr(0,o)),r&&(i.pathname=r)}return i}function fg(r,i,n,o){o===void 0&&(o={});let{window:u=document.defaultView,v5Compat:l=!1}=o,d=u.history,f=hn.Pop,h=null,y=k();y==null&&(y=0,d.replaceState(si({},d.state,{idx:y}),""));function k(){return(d.state||{idx:null}).idx}function w(){f=hn.Pop;let S=k(),j=S==null?null:S-y;y=S,h&&h({action:f,location:m.location,delta:j})}function x(S,j){f=hn.Push;let _=Fl(m.location,S,j);n&&n(_,S),y=k()+1;let L=Hd(_,y),U=m.createHref(_);try{d.pushState(L,"",U)}catch(M){if(M instanceof DOMException&&M.name==="DataCloneError")throw M;u.location.assign(U)}l&&h&&h({action:f,location:m.location,delta:1})}function b(S,j){f=hn.Replace;let _=Fl(m.location,S,j);n&&n(_,S),y=k();let L=Hd(_,y),U=m.createHref(_);d.replaceState(L,"",U),l&&h&&h({action:f,location:m.location,delta:0})}function C(S){let j=u.location.origin!=="null"?u.location.origin:u.location.href,_=typeof S=="string"?S:Ff(S);return _=_.replace(/ $/,"%20"),St(j,"No window.location.(origin|href) available to create URL for href: "+_),new URL(_,j)}let m={get action(){return f},get location(){return r(u,d)},listen(S){if(h)throw new Error("A history only accepts one active listener");return u.addEventListener(Vd,w),h=S,()=>{u.removeEventListener(Vd,w),h=null}},createHref(S){return i(u,S)},createURL:C,encodeLocation(S){let j=C(S);return{pathname:j.pathname,search:j.search,hash:j.hash}},push:x,replace:b,go(S){return d.go(S)}};return m}var qd;(function(r){r.data="data",r.deferred="deferred",r.redirect="redirect",r.error="error"})(qd||(qd={}));function hg(r,i,n){return n===void 0&&(n="/"),pg(r,i,n)}function pg(r,i,n,o){let u=typeof i=="string"?Bn(i):i,l=zf(u.pathname||"/",n);if(l==null)return null;let d=Bf(r);mg(d);let f=null;for(let h=0;f==null&&h<d.length;++h){let y=Eg(l);f=Cg(d[h],y)}return f}function Bf(r,i,n,o){i===void 0&&(i=[]),n===void 0&&(n=[]),o===void 0&&(o="");let u=(l,d,f)=>{let h={relativePath:f===void 0?l.path||"":f,caseSensitive:l.caseSensitive===!0,childrenIndex:d,route:l};h.relativePath.startsWith("/")&&(St(h.relativePath.startsWith(o),'Absolute route path "'+h.relativePath+'" nested under path '+('"'+o+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),h.relativePath=h.relativePath.slice(o.length));let y=Ln([o,h.relativePath]),k=n.concat(h);l.children&&l.children.length>0&&(St(l.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+y+'".')),Bf(l.children,i,k,y)),!(l.path==null&&!l.index)&&i.push({path:y,score:kg(y,l.index),routesMeta:k})};return r.forEach((l,d)=>{var f;if(l.path===""||!((f=l.path)!=null&&f.includes("?")))u(l,d);else for(let h of Uf(l.path))u(l,d,h)}),i}function Uf(r){let i=r.split("/");if(i.length===0)return[];let[n,...o]=i,u=n.endsWith("?"),l=n.replace(/\?$/,"");if(o.length===0)return u?[l,""]:[l];let d=Uf(o.join("/")),f=[];return f.push(...d.map(h=>h===""?l:[l,h].join("/"))),u&&f.push(...d),f.map(h=>r.startsWith("/")&&h===""?"/":h)}function mg(r){r.sort((i,n)=>i.score!==n.score?n.score-i.score:Sg(i.routesMeta.map(o=>o.childrenIndex),n.routesMeta.map(o=>o.childrenIndex)))}const gg=/^:[\w-]+$/,yg=3,vg=2,xg=1,wg=10,bg=-2,Qd=r=>r==="*";function kg(r,i){let n=r.split("/"),o=n.length;return n.some(Qd)&&(o+=bg),i&&(o+=vg),n.filter(u=>!Qd(u)).reduce((u,l)=>u+(gg.test(l)?yg:l===""?xg:wg),o)}function Sg(r,i){return r.length===i.length&&r.slice(0,-1).every((o,u)=>o===i[u])?r[r.length-1]-i[i.length-1]:0}function Cg(r,i,n){let{routesMeta:o}=r,u={},l="/",d=[];for(let f=0;f<o.length;++f){let h=o[f],y=f===o.length-1,k=l==="/"?i:i.slice(l.length)||"/",w=jg({path:h.relativePath,caseSensitive:h.caseSensitive,end:y},k),x=h.route;if(!w)return null;Object.assign(u,w.params),d.push({params:u,pathname:Ln([l,w.pathname]),pathnameBase:Og(Ln([l,w.pathnameBase])),route:x}),w.pathnameBase!=="/"&&(l=Ln([l,w.pathnameBase]))}return d}function jg(r,i){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[n,o]=Ng(r.path,r.caseSensitive,r.end),u=i.match(n);if(!u)return null;let l=u[0],d=l.replace(/(.)\/+$/,"$1"),f=u.slice(1);return{params:o.reduce((y,k,w)=>{let{paramName:x,isOptional:b}=k;if(x==="*"){let m=f[w]||"";d=l.slice(0,l.length-m.length).replace(/(.)\/+$/,"$1")}const C=f[w];return b&&!C?y[x]=void 0:y[x]=(C||"").replace(/%2F/g,"/"),y},{}),pathname:l,pathnameBase:d,pattern:r}}function Ng(r,i,n){i===void 0&&(i=!1),n===void 0&&(n=!0),Kl(r==="*"||!r.endsWith("*")||r.endsWith("/*"),'Route path "'+r+'" will be treated as if it were '+('"'+r.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+r.replace(/\*$/,"/*")+'".'));let o=[],u="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(d,f,h)=>(o.push({paramName:f,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(o.push({paramName:"*"}),u+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?u+="\\/*$":r!==""&&r!=="/"&&(u+="(?:(?=\\/|$))"),[new RegExp(u,i?void 0:"i"),o]}function Eg(r){try{return r.split("/").map(i=>decodeURIComponent(i).replace(/\//g,"%2F")).join("/")}catch(i){return Kl(!1,'The URL path "'+r+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+i+").")),r}}function zf(r,i){if(i==="/")return r;if(!r.toLowerCase().startsWith(i.toLowerCase()))return null;let n=i.endsWith("/")?i.length-1:i.length,o=r.charAt(n);return o&&o!=="/"?null:r.slice(n)||"/"}function _g(r,i){i===void 0&&(i="/");let{pathname:n,search:o="",hash:u=""}=typeof r=="string"?Bn(r):r;return{pathname:n?n.startsWith("/")?n:Rg(n,i):i,search:Lg(o),hash:Ig(u)}}function Rg(r,i){let n=i.replace(/\/+$/,"").split("/");return r.split("/").forEach(u=>{u===".."?n.length>1&&n.pop():u!=="."&&n.push(u)}),n.length>1?n.join("/"):"/"}function Sl(r,i,n,o){return"Cannot include a '"+r+"' character in a manually specified "+("`to."+i+"` field ["+JSON.stringify(o)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Ag(r){return r.filter((i,n)=>n===0||i.route.path&&i.route.path.length>0)}function Tg(r,i){let n=Ag(r);return i?n.map((o,u)=>u===n.length-1?o.pathname:o.pathnameBase):n.map(o=>o.pathnameBase)}function Pg(r,i,n,o){o===void 0&&(o=!1);let u;typeof r=="string"?u=Bn(r):(u=si({},r),St(!u.pathname||!u.pathname.includes("?"),Sl("?","pathname","search",u)),St(!u.pathname||!u.pathname.includes("#"),Sl("#","pathname","hash",u)),St(!u.search||!u.search.includes("#"),Sl("#","search","hash",u)));let l=r===""||u.pathname==="",d=l?"/":u.pathname,f;if(d==null)f=n;else{let w=i.length-1;if(!o&&d.startsWith("..")){let x=d.split("/");for(;x[0]==="..";)x.shift(),w-=1;u.pathname=x.join("/")}f=w>=0?i[w]:"/"}let h=_g(u,f),y=d&&d!=="/"&&d.endsWith("/"),k=(l||d===".")&&n.endsWith("/");return!h.pathname.endsWith("/")&&(y||k)&&(h.pathname+="/"),h}const Ln=r=>r.join("/").replace(/\/\/+/g,"/"),Og=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),Lg=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,Ig=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function Dg(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}const Mf=["post","put","patch","delete"];new Set(Mf);const Fg=["get",...Mf];new Set(Fg);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ii(){return ii=Object.assign?Object.assign.bind():function(r){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])}return r},ii.apply(this,arguments)}const Gl=P.createContext(null),Bg=P.createContext(null),_o=P.createContext(null),Ro=P.createContext(null),Un=P.createContext({outlet:null,matches:[],isDataRoute:!1}),$f=P.createContext(null);function Ao(){return P.useContext(Ro)!=null}function Zl(){return Ao()||St(!1),P.useContext(Ro).location}function Wf(r){P.useContext(_o).static||P.useLayoutEffect(r)}function Vf(){let{isDataRoute:r}=P.useContext(Un);return r?Xg():Ug()}function Ug(){Ao()||St(!1);let r=P.useContext(Gl),{basename:i,future:n,navigator:o}=P.useContext(_o),{matches:u}=P.useContext(Un),{pathname:l}=Zl(),d=JSON.stringify(Tg(u,n.v7_relativeSplatPath)),f=P.useRef(!1);return Wf(()=>{f.current=!0}),P.useCallback(function(y,k){if(k===void 0&&(k={}),!f.current)return;if(typeof y=="number"){o.go(y);return}let w=Pg(y,JSON.parse(d),l,k.relative==="path");r==null&&i!=="/"&&(w.pathname=w.pathname==="/"?i:Ln([i,w.pathname])),(k.replace?o.replace:o.push)(w,k.state,k)},[i,o,d,l,r])}function _v(){let{matches:r}=P.useContext(Un),i=r[r.length-1];return i?i.params:{}}function zg(r,i){return Mg(r,i)}function Mg(r,i,n,o){Ao()||St(!1);let{navigator:u}=P.useContext(_o),{matches:l}=P.useContext(Un),d=l[l.length-1],f=d?d.params:{};d&&d.pathname;let h=d?d.pathnameBase:"/";d&&d.route;let y=Zl(),k;if(i){var w;let S=typeof i=="string"?Bn(i):i;h==="/"||(w=S.pathname)!=null&&w.startsWith(h)||St(!1),k=S}else k=y;let x=k.pathname||"/",b=x;if(h!=="/"){let S=h.replace(/^\//,"").split("/");b="/"+x.replace(/^\//,"").split("/").slice(S.length).join("/")}let C=hg(r,{pathname:b}),m=qg(C&&C.map(S=>Object.assign({},S,{params:Object.assign({},f,S.params),pathname:Ln([h,u.encodeLocation?u.encodeLocation(S.pathname).pathname:S.pathname]),pathnameBase:S.pathnameBase==="/"?h:Ln([h,u.encodeLocation?u.encodeLocation(S.pathnameBase).pathname:S.pathnameBase])})),l,n,o);return i&&m?P.createElement(Ro.Provider,{value:{location:ii({pathname:"/",search:"",hash:"",state:null,key:"default"},k),navigationType:hn.Pop}},m):m}function $g(){let r=Zg(),i=Dg(r)?r.status+" "+r.statusText:r instanceof Error?r.message:JSON.stringify(r),n=r instanceof Error?r.stack:null,u={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return P.createElement(P.Fragment,null,P.createElement("h2",null,"Unexpected Application Error!"),P.createElement("h3",{style:{fontStyle:"italic"}},i),n?P.createElement("pre",{style:u},n):null,null)}const Wg=P.createElement($g,null);class Vg extends P.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,n){return n.location!==i.location||n.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:n.error,location:n.location,revalidation:i.revalidation||n.revalidation}}componentDidCatch(i,n){console.error("React Router caught the following error during render",i,n)}render(){return this.state.error!==void 0?P.createElement(Un.Provider,{value:this.props.routeContext},P.createElement($f.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Hg(r){let{routeContext:i,match:n,children:o}=r,u=P.useContext(Gl);return u&&u.static&&u.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(u.staticContext._deepestRenderedBoundaryId=n.route.id),P.createElement(Un.Provider,{value:i},o)}function qg(r,i,n,o){var u;if(i===void 0&&(i=[]),n===void 0&&(n=null),o===void 0&&(o=null),r==null){var l;if(!n)return null;if(n.errors)r=n.matches;else if((l=o)!=null&&l.v7_partialHydration&&i.length===0&&!n.initialized&&n.matches.length>0)r=n.matches;else return null}let d=r,f=(u=n)==null?void 0:u.errors;if(f!=null){let k=d.findIndex(w=>w.route.id&&f?.[w.route.id]!==void 0);k>=0||St(!1),d=d.slice(0,Math.min(d.length,k+1))}let h=!1,y=-1;if(n&&o&&o.v7_partialHydration)for(let k=0;k<d.length;k++){let w=d[k];if((w.route.HydrateFallback||w.route.hydrateFallbackElement)&&(y=k),w.route.id){let{loaderData:x,errors:b}=n,C=w.route.loader&&x[w.route.id]===void 0&&(!b||b[w.route.id]===void 0);if(w.route.lazy||C){h=!0,y>=0?d=d.slice(0,y+1):d=[d[0]];break}}}return d.reduceRight((k,w,x)=>{let b,C=!1,m=null,S=null;n&&(b=f&&w.route.id?f[w.route.id]:void 0,m=w.route.errorElement||Wg,h&&(y<0&&x===0?(Yg("route-fallback"),C=!0,S=null):y===x&&(C=!0,S=w.route.hydrateFallbackElement||null)));let j=i.concat(d.slice(0,x+1)),_=()=>{let L;return b?L=m:C?L=S:w.route.Component?L=P.createElement(w.route.Component,null):w.route.element?L=w.route.element:L=k,P.createElement(Hg,{match:w,routeContext:{outlet:k,matches:j,isDataRoute:n!=null},children:L})};return n&&(w.route.ErrorBoundary||w.route.errorElement||x===0)?P.createElement(Vg,{location:n.location,revalidation:n.revalidation,component:m,error:b,children:_(),routeContext:{outlet:null,matches:j,isDataRoute:!0}}):_()},null)}var Hf=(function(r){return r.UseBlocker="useBlocker",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r})(Hf||{}),qf=(function(r){return r.UseBlocker="useBlocker",r.UseLoaderData="useLoaderData",r.UseActionData="useActionData",r.UseRouteError="useRouteError",r.UseNavigation="useNavigation",r.UseRouteLoaderData="useRouteLoaderData",r.UseMatches="useMatches",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r.UseRouteId="useRouteId",r})(qf||{});function Qg(r){let i=P.useContext(Gl);return i||St(!1),i}function Kg(r){let i=P.useContext(Bg);return i||St(!1),i}function Gg(r){let i=P.useContext(Un);return i||St(!1),i}function Qf(r){let i=Gg(),n=i.matches[i.matches.length-1];return n.route.id||St(!1),n.route.id}function Zg(){var r;let i=P.useContext($f),n=Kg(),o=Qf();return i!==void 0?i:(r=n.errors)==null?void 0:r[o]}function Xg(){let{router:r}=Qg(Hf.UseNavigateStable),i=Qf(qf.UseNavigateStable),n=P.useRef(!1);return Wf(()=>{n.current=!0}),P.useCallback(function(u,l){l===void 0&&(l={}),n.current&&(typeof u=="number"?r.navigate(u):r.navigate(u,ii({fromRouteId:i},l)))},[r,i])}const Kd={};function Yg(r,i,n){Kd[r]||(Kd[r]=!0)}function Jg(r,i){r?.v7_startTransition,r?.v7_relativeSplatPath}function wo(r){St(!1)}function e0(r){let{basename:i="/",children:n=null,location:o,navigationType:u=hn.Pop,navigator:l,static:d=!1,future:f}=r;Ao()&&St(!1);let h=i.replace(/^\/*/,"/"),y=P.useMemo(()=>({basename:h,navigator:l,static:d,future:ii({v7_relativeSplatPath:!1},f)}),[h,f,l,d]);typeof o=="string"&&(o=Bn(o));let{pathname:k="/",search:w="",hash:x="",state:b=null,key:C="default"}=o,m=P.useMemo(()=>{let S=zf(k,h);return S==null?null:{location:{pathname:S,search:w,hash:x,state:b,key:C},navigationType:u}},[h,k,w,x,b,C,u]);return m==null?null:P.createElement(_o.Provider,{value:y},P.createElement(Ro.Provider,{children:n,value:m}))}function t0(r){let{children:i,location:n}=r;return zg(Bl(i),n)}new Promise(()=>{});function Bl(r,i){i===void 0&&(i=[]);let n=[];return P.Children.forEach(r,(o,u)=>{if(!P.isValidElement(o))return;let l=[...i,u];if(o.type===P.Fragment){n.push.apply(n,Bl(o.props.children,l));return}o.type!==wo&&St(!1),!o.props.index||!o.props.children||St(!1);let d={id:o.props.id||l.join("-"),caseSensitive:o.props.caseSensitive,element:o.props.element,Component:o.props.Component,index:o.props.index,path:o.props.path,loader:o.props.loader,action:o.props.action,errorElement:o.props.errorElement,ErrorBoundary:o.props.ErrorBoundary,hasErrorBoundary:o.props.ErrorBoundary!=null||o.props.errorElement!=null,shouldRevalidate:o.props.shouldRevalidate,handle:o.props.handle,lazy:o.props.lazy};o.props.children&&(d.children=Bl(o.props.children,l)),n.push(d)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const r0="6";try{window.__reactRouterVersion=r0}catch{}const n0="startTransition",Gd=xm[n0];function s0(r){let{basename:i,children:n,future:o,window:u}=r,l=P.useRef();l.current==null&&(l.current=ug({window:u,v5Compat:!0}));let d=l.current,[f,h]=P.useState({action:d.action,location:d.location}),{v7_startTransition:y}=o||{},k=P.useCallback(w=>{y&&Gd?Gd(()=>h(w)):h(w)},[h,y]);return P.useLayoutEffect(()=>d.listen(k),[d,k]),P.useEffect(()=>Jg(o),[o]),P.createElement(e0,{basename:i,children:n,location:f.location,navigationType:f.action,navigator:d,future:o})}var Zd;(function(r){r.UseScrollRestoration="useScrollRestoration",r.UseSubmit="useSubmit",r.UseSubmitFetcher="useSubmitFetcher",r.UseFetcher="useFetcher",r.useViewTransitionState="useViewTransitionState"})(Zd||(Zd={}));var Xd;(function(r){r.UseFetcher="useFetcher",r.UseFetchers="useFetchers",r.UseScrollRestoration="useScrollRestoration"})(Xd||(Xd={}));const Kf=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),Gf=({className:r})=>a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),To=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),Zf=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),ir=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),i0=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25H12"})}),Xf=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:r,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})}),o0=({className:r,filled:i})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:i?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.5 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0111.186 0z"})}),oi=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),Yf=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),a0=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:r,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.26 10.147a60.436 60.436 0 00-.491 6.347A48.627 48.627 0 0112 20.904a48.627 48.627 0 018.232-4.41 60.46 60.46 0 00-.491-6.347m-15.482 0a50.57 50.57 0 00-2.658-.813A59.905 59.905 0 0112 3.493a59.902 59.902 0 0110.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0l-.07.07m15.482 0l.07.07m0 0l-1.018.51a51.011 51.011 0 01-4.456 2.054A51.011 51.011 0 0112 15.342a51.011 51.011 0 01-4.456-2.054l-1.018-.51m0 0l-1.018.51a51.011 51.011 0 01-4.456 2.054A51.011 51.011 0 0112 15.342a51.011 51.011 0 01-4.456-2.054l-1.018-.51"})}),Jf=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:r,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 13.5V3.75m0 9.75a1.5 1.5 0 010 3m0-3a1.5 1.5 0 000 3m0 3.75V16.5m12-3V3.75m0 9.75a1.5 1.5 0 010 3m0-3a1.5 1.5 0 000 3m0 3.75V16.5m-6-9V3.75m0 3.75a1.5 1.5 0 010 3m0-3a1.5 1.5 0 000 3m0 9.75V10.5"})}),l0=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:r,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"})}),eh=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:r,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.971l-11.54 6.347a1.125 1.125 0 01-1.667-.985V5.653z"})}),c0=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:r,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 5.25v13.5m-6-13.5v13.5"})}),u0=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:r,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.114 5.636a9 9 0 010 12.728M16.463 8.288a5.25 5.25 0 010 7.424M6.75 8.25l4.72-4.72a.75.75 0 011.28.53v15.88a.75.75 0 01-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.01 9.01 0 012.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75z"})}),th=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:r,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"})}),rh=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),d0=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14"})}),f0=({className:r})=>a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:[a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 01-.354-17.995M12 21a9 9 0 009-9M12 21a9 9 0 00-9-9M12 3c-4.418 0-8 2.015-8 4.5S7.582 12 12 12s8-2.015 8-4.5S16.418 3 12 3z"}),a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 01-9 9"})]}),h0=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})}),Ul=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),p0=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.536L16.732 3.732z"})}),m0=({className:r})=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),g0=({onBack:r})=>a.jsxs("div",{className:"container mx-auto p-4 md:p-8 text-white min-h-screen",children:[a.jsx("header",{className:"mb-8",children:a.jsxs("button",{onClick:r,className:"inline-flex items-center gap-2 text-slate-300 hover:text-sky-400 transition-colors",children:[a.jsx(To,{className:"w-5 h-5"}),a.jsx("span",{children:"Back to Library"})]})}),a.jsxs("main",{className:"max-w-4xl mx-auto space-y-8",children:[a.jsxs("section",{className:"bg-slate-800/80 rounded-xl shadow-lg p-6 border border-slate-700",children:[a.jsx("h1",{className:"text-3xl font-bold text-sky-300 mb-2",children:"About MeBooks"}),a.jsxs("p",{className:"text-lg text-slate-300 mb-4",children:[a.jsx("span",{className:"font-semibold text-sky-200",children:"MeBooks"})," is a modern, browser-based ebook reader inspired by the user experience of Readium's Thorium, but built entirely with web technologies. EPUB books are rendered using ",a.jsx("span",{className:"font-semibold",children:"epub.js"}),", and PDF books are rendered using an embedded distribution of ",a.jsx("span",{className:"font-semibold",children:"pdf.js"})," via ",a.jsx("span",{className:"font-semibold",children:"react-pdf"})," and ",a.jsx("span",{className:"font-semibold",children:"pdfjs-dist"}),". Import EPUB and PDF books into your local library, or browse and download from online OPDS catalogs. Built with accessibility, privacy, and customization in mind."]})]}),a.jsxs("section",{className:"grid md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-slate-800/80 rounded-xl shadow p-6 border border-slate-700 flex flex-col gap-2",children:[a.jsxs("h2",{className:"text-xl font-semibold text-sky-300 flex items-center gap-2 mb-2",children:["Accessibility & A11Y",a.jsx("span",{className:"bg-sky-900 text-sky-200 text-xs font-bold px-2 py-1 rounded ml-2",children:"WCAG 2.1 AA"})]}),a.jsxs("ul",{className:"list-disc list-inside space-y-1 text-slate-200",children:[a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Keyboard Navigation:"})," Logical tab order, visible focus, and full keyboard support."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Screen Reader Support:"})," ARIA labels, live regions, and dynamic announcements."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"High Contrast & Color Blind Friendly:"})," Tested palette and contrast ratios."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Skip Links & Landmarks:"})," Quick navigation for assistive tech users."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Accessible Modals & Dialogs:"})," Focus management, ARIA roles, and announcements."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Global Keyboard Shortcuts:"})," Discoverable, accessible shortcuts for power users."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Adjustable Font Size & Family:"})," Reader settings for easy text customization."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Responsive Design:"})," Works on all devices and screen sizes."]})]}),a.jsx("div",{className:"mt-3",children:a.jsx("a",{href:"/JamesEnglish1028-My-Ebook-Reader/VPAT.html",target:"_blank",rel:"noopener noreferrer",className:"block bg-sky-900/80 border border-sky-700 rounded px-4 py-2 text-sky-300 font-semibold text-center hover:bg-sky-800 transition",children:"Accessibility VPAT (Voluntary Product Accessibility Template)"})})]}),a.jsxs("div",{className:"bg-slate-800/80 rounded-xl shadow p-6 border border-slate-700 flex flex-col gap-2",children:[a.jsx("h2",{className:"text-xl font-semibold text-sky-300 mb-2",children:"Library Management"}),a.jsxs("ul",{className:"list-disc list-inside space-y-1 text-slate-200",children:[a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Local-First Storage:"})," Your books and reading data never leave your computer. Book files are stored in IndexedDB, settings and annotations in LocalStorage."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"EPUB & PDF Import:"})," Build your personal library with ",a.jsx("code",{children:".epub"})," and ",a.jsx("code",{children:".pdf"})," files."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Book Details:"})," View publication info, subjects, and provider IDs."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Library Organization:"})," Sort by title, author, publication date, or date added."]})]})]})]}),a.jsxs("section",{className:"grid md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-slate-800/80 rounded-xl shadow p-6 border border-slate-700 flex flex-col gap-2",children:[a.jsx("h2",{className:"text-xl font-semibold text-sky-300 mb-2",children:"Online Catalogs (OPDS)"}),a.jsxs("ul",{className:"list-disc list-inside space-y-1 text-slate-200",children:[a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Browse Remote Libraries:"})," Add and manage unlimited public OPDS catalogs."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"OPDS v1 & v2 Support:"})," Compatible with XML (Atom) and JSON feeds."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"One-Click Import:"})," Download books directly from catalogs to your library."]})]})]}),a.jsxs("div",{className:"bg-slate-800/80 rounded-xl shadow p-6 border border-slate-700 flex flex-col gap-2",children:[a.jsx("h2",{className:"text-xl font-semibold text-sky-300 mb-2",children:"Advanced Reader Experience"}),a.jsxs("ul",{className:"list-disc list-inside space-y-1 text-slate-200",children:[a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Browser-Based:"})," No installation needed—runs entirely in your browser."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Multi-Format Support:"})," Read EPUB files with ",a.jsx("span",{className:"font-semibold",children:"epub.js"})," and PDF files with an embedded ",a.jsx("span",{className:"font-semibold",children:"pdf.js"})," engine (",a.jsx("span",{className:"font-semibold",children:"react-pdf"})," + ",a.jsx("span",{className:"font-semibold",children:"pdfjs-dist"}),")."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Advanced Navigation:"})," Both readers support table of contents navigation, page jumping, and keyboard shortcuts for moving between chapters or pages."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Full-Text Search:"})," EPUB and PDF readers both support searching the entire book text, with results highlighted and easy navigation between matches."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Customizable Reader (EPUB):"})," Adjust font, theme, and reading mode (paginated or scrolled)."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Rich Tools (EPUB):"})," Bookmarks with notes, academic citation generation, and full-text search."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Citation Export (EPUB):"})," Export citations in ",a.jsx("code",{children:".ris"})," format for Zotero/EndNote."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Read Aloud (EPUB):"})," Text-to-speech with synchronized highlighting."]})]})]})]}),a.jsxs("section",{className:"bg-slate-800/80 rounded-xl shadow-lg p-6 border border-slate-700",children:[a.jsx("h2",{className:"text-xl font-semibold text-sky-300 mb-2",children:"Technology Stack"}),a.jsxs("ul",{className:"list-disc list-inside space-y-1 text-slate-200",children:[a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"React:"})," Component-based UI library."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"TypeScript:"})," Static typing for maintainable code."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"TailwindCSS:"})," Utility-first CSS for rapid styling."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"epub.js:"})," EPUB parsing and rendering."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"pdf.js:"})," PDF rendering (via ",a.jsx("span",{className:"font-semibold",children:"react-pdf"})," and ",a.jsx("span",{className:"font-semibold",children:"pdfjs-dist"}),")."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"JSZip:"})," EPUB unzipping (via ",a.jsx("code",{children:"epub.js"}),")."]})]}),a.jsx("p",{className:"mt-2 text-slate-400",children:"All external dependencies are loaded from a CDN for simplicity."})]}),a.jsxs("section",{className:"bg-slate-800/80 rounded-xl shadow-lg p-6 border border-slate-700 mt-8",children:[a.jsx("h2",{className:"text-xl font-semibold text-sky-300 mb-2",children:"For Developers"}),a.jsxs("ul",{className:"list-disc list-inside space-y-1 text-slate-200",children:[a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Vite:"})," Lightning-fast build tool and dev server for modern web apps."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"React Router:"})," Declarative routing for SPA navigation."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"React-PDF:"})," PDF rendering in React using pdf.js."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"TanStack Query:"})," Powerful data fetching and caching (if used)."]}),a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:"Other modern libraries:"})," Includes utility packages and accessibility helpers as needed."]})]}),a.jsxs("p",{className:"mt-2 text-slate-400",children:["See the ",a.jsx("code",{children:"package.json"})," for a full list of dependencies and scripts."]})]})]})]}),Yd={CATALOGS:"ebook-catalogs",REGISTRIES:"ebook-reader-registries"},fn={GLOBAL_SETTINGS:"ebook-reader-settings-global",BOOKMARKS_PREFIX:"ebook-reader-bookmarks",CITATIONS_PREFIX:"ebook-reader-citations",POSITION_PREFIX:"ebook-reader-pos",SPOKEN_POSITION_PREFIX:"ebook-reader-spoken-pos",PDF_VIEW_STATE_PREFIX:"ebook-reader-pdf-view-state",EPUB_VIEW_STATE_PREFIX:"ebook-reader-epub-view-state"},y0={ETAG_CACHE_PREFIX:"mebooks.opds.etag"},yt={bookmarks:r=>`${fn.BOOKMARKS_PREFIX}-${String(r)}`,citations:r=>`${fn.CITATIONS_PREFIX}-${String(r)}`,position:r=>`${fn.POSITION_PREFIX}-${String(r)}`,spokenPosition:r=>`${fn.SPOKEN_POSITION_PREFIX}-${String(r)}`,pdfViewState:r=>`${fn.PDF_VIEW_STATE_PREFIX}-${String(r)}`,epubViewState:r=>`${fn.EPUB_VIEW_STATE_PREFIX}-${String(r)}`,etag:r=>`${y0.ETAG_CACHE_PREFIX}-${r}`},nh="EbookReaderDB",Ge="books",sh=3,Mt={TITLE:"title",ISBN:"isbn",PROVIDER_ID:"providerId"},v0={BASE_URL:"/JamesEnglish1028-My-Ebook-Reader/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_OWN_PROXY_URL:"https://mebooks-proxy-worker.jce1028.workers.dev/"};class x0{isDebugMode(){if(typeof window<"u"&&window.__MEBOOKS_DEBUG__)return!0;try{const i=v0;return i?.DEV||i?.VITE_DEBUG_LOGGING==="true"}catch{return!1}}shouldLog(i){return i==="error"||i==="warn"?!0:this.isDebugMode()}debug(i,...n){this.shouldLog("debug")&&console.debug(`[mebooks:debug] ${i}`,...n)}info(i,...n){this.shouldLog("info")&&console.info(`[mebooks:info] ${i}`,...n)}warn(i,...n){this.shouldLog("warn")&&console.warn(`[mebooks:warn] ${i}`,...n)}error(i,...n){this.shouldLog("error")&&console.error(`[mebooks:error] ${i}`,...n)}log(i,...n){this.isDebugMode()&&console.log(`[mebooks] ${i}`,...n)}}const ce=new x0,it={dbInstance:null},Ur=()=>new Promise((r,i)=>{if(it.dbInstance){r(it.dbInstance);return}if(typeof indexedDB>"u"){const o=new Error("IndexedDB is not available in this environment.");ce.error("IndexedDB unavailable:",o),i(o);return}const n=indexedDB.open(nh,sh);n.onerror=()=>{ce.error("IndexedDB error:",n.error),i(n.error)},n.onsuccess=()=>{it.dbInstance=n.result,r(it.dbInstance)},n.onupgradeneeded=o=>{const u=o.target.result;let l;if(!u.objectStoreNames.contains(Ge))l=u.createObjectStore(Ge,{keyPath:"id",autoIncrement:!0}),l.createIndex(Mt.TITLE,Mt.TITLE,{unique:!1});else{const d=o.target.transaction;if(d)l=d.objectStore(Ge);else return}o.oldVersion<2&&(l.indexNames.contains(Mt.ISBN)||l.createIndex(Mt.ISBN,Mt.ISBN,{unique:!1})),o.oldVersion<3&&(l.indexNames.contains(Mt.PROVIDER_ID)||l.createIndex(Mt.PROVIDER_ID,Mt.PROVIDER_ID,{unique:!1}))}}),w0=async r=>{let i;try{i=await Ur()}catch(n){return Promise.reject(n)}return new Promise((n,o)=>{const d=i.transaction(Ge,"readwrite").objectStore(Ge).put(r);d.onsuccess=()=>{n(d.result)},d.onerror=()=>{ce.error("Error saving book:",d.error),o("Error saving book")}})},b0=async()=>{const r=await Ur();return new Promise((i,n)=>{const l=r.transaction(Ge,"readonly").objectStore(Ge).openCursor(),d=[];l.onsuccess=f=>{const h=f.target.result;h?(d.push({...h.value}),h.continue()):(console.log("[db.getBooksMetadata] Loaded metadata:",d),i(d))},l.onerror=()=>{ce.error("Error getting books:",l.error),n("Error getting books")}})},k0=async()=>{const r=await Ur();return new Promise((i,n)=>{const l=r.transaction(Ge,"readonly").objectStore(Ge).getAll();l.onsuccess=()=>{console.log("[db.getAllBooks] Loaded books:",l.result),i(l.result)},l.onerror=()=>{ce.error("Error getting all books:",l.error),n("Error getting all books")}})},S0=async r=>{const i=await Ur();return new Promise((n,o)=>{const d=i.transaction(Ge,"readonly").objectStore(Ge).get(r);d.onsuccess=()=>{n(d.result)},d.onerror=()=>{ce.error("Error getting book:",d.error),o("Error getting book")}})},C0=async r=>{const i=await Ur();return new Promise((n,o)=>{const d=i.transaction(Ge,"readonly").objectStore(Ge).get(r);d.onsuccess=()=>{const f=d.result;n(f?{...f,id:f.id}:null)},d.onerror=()=>{ce.error("Error getting book metadata:",d.error),o("Error getting book metadata")}})},j0=async r=>{if(!r)return null;const i=await Ur(),n=u=>new Promise((l,d)=>{try{const h=i.transaction(Ge,"readonly").objectStore(Ge);if(!h.indexNames.contains(u)){l(null);return}const k=h.index(u).get(r);k.onsuccess=()=>{l(k.result||null)},k.onerror=()=>{ce.error(`Error finding book by ${u}:`,k.error),d(`Error finding book by ${u}`)}}catch(f){ce.error(`Error initiating search on index ${u}:`,f),l(null)}}),o=await n("providerId");return o||n("isbn")},N0=async r=>{const i=await Ur();return new Promise((n,o)=>{const d=i.transaction(Ge,"readwrite").objectStore(Ge).delete(r);d.onsuccess=()=>{n()},d.onerror=()=>{ce.error("Error deleting book:",d.error),o("Error deleting book")}})},E0=async()=>{const r=await Ur();return new Promise((i,n)=>{const l=r.transaction(Ge,"readwrite").objectStore(Ge).clear();l.onsuccess=()=>{i()},l.onerror=()=>{ce.error("Error clearing books:",l.error),n("Error clearing books")}})};it.init=Ur;it.saveBook=w0;it.getBooksMetadata=b0;it.getAllBooks=k0;it.getBook=S0;it.getBookMetadata=C0;it.findBookByIdentifier=j0;it.deleteBook=N0;it.clearAllBooks=E0;const Xl={BASE_URL:"/JamesEnglish1028-My-Ebook-Reader/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_OWN_PROXY_URL:"https://mebooks-proxy-worker.jce1028.workers.dev/"},Jd=(r,i,n,o,u,l)=>{const d=i.split(" ");let f="",h=o;for(let y=0;y<d.length;y++){const k=f+d[y]+" ";r.measureText(k).width>u&&y>0?(r.fillText(f,n,h),f=d[y]+" ",h+=l):f=k}return r.fillText(f,n,h),h+l},_0=(r,i)=>new Promise(n=>{const l=document.createElement("canvas");l.width=400,l.height=600;const d=l.getContext("2d");if(!d)return n("");const f=d.createLinearGradient(0,0,400,600);f.addColorStop(0,"#1e3a8a"),f.addColorStop(1,"#4c1d95"),d.fillStyle=f,d.fillRect(0,0,400,600);const h=70,y=35,k=400-h-20,w=20;d.fillStyle="#dc2626",d.fillRect(k,w,h,y),d.font="bold 20px sans-serif",d.fillStyle="white",d.textAlign="center",d.textBaseline="middle",d.fillText("PDF",k+h/2,w+y/2),d.textAlign="left",d.textBaseline="top",d.fillStyle="white",d.font="bold 42px sans-serif";const x=Jd(d,r,30,100,340,50);d.strokeStyle="rgba(255, 255, 255, 0.3)",d.lineWidth=1,d.beginPath(),d.moveTo(30,x+10),d.lineTo(370,x+10),d.stroke(),d.font="24px sans-serif",d.fillStyle="rgba(255, 255, 255, 0.8)",Jd(d,i,30,x+30,340,30),n(l.toDataURL("image/jpeg",.9))}),R0="https://corsproxy.io/?",ef=typeof import.meta<"u"&&Xl?"https://mebooks-proxy-worker.jce1028.workers.dev/":"",A0=typeof import.meta<"u"&&Xl&&!1,$t=r=>{try{if(new URL(r),ef){let i=ef.trim();i=i.replace(/\/+$/,""),i.endsWith("/proxy")||(i=`${i}/proxy`);const n=i.includes("?")?"&":"?";return`${i}${n}url=${encodeURIComponent(r)}`}return`${R0}${encodeURIComponent(r)}`}catch{return console.error("Invalid URL passed to proxiedUrl:",r),""}},wr=async(r,i=!1)=>{try{new URL(r)}catch{return console.error("Invalid URL for maybeProxyForCors:",r),""}if(i)return console.log("[maybeProxyForCors] Skipping HEAD probe for open-access content, using proxy for CORS"),$t(r);try{let n=await fetch(r,{method:"HEAD",mode:"cors",redirect:"manual",credentials:"include"});if(n&&n.status===405)try{n=await fetch(r,{method:"GET",mode:"cors",redirect:"manual",credentials:"include"})}catch{}if(!n)return $t(r);if(n.status>=300&&n.status<400)return console.log("[maybeProxyForCors] HEAD probe redirect",{url:r,status:n.status}),$t(r);if(n.status>=200&&n.status<300){const o=n.headers.get("access-control-allow-origin");try{const u=typeof window<"u"&&window.location&&window.location.origin?window.location.origin:"";if(console.log("[maybeProxyForCors] HEAD probe",{url:r,status:n.status,allow:o,origin:u}),o==="*"||o&&u&&o===u)return console.log("[maybeProxyForCors] using direct URL",{url:r}),r}catch(u){console.log("[maybeProxyForCors] error determining origin, falling back to proxy",{url:r,err:u})}}return $t(r)}catch{return $t(r)}},tf=async r=>{try{const i=$t(r),n=await fetch(i);if(!n.ok)return console.error(`Failed to fetch cover image from ${r}, status: ${n.status}`),null;const o=await n.blob();return new Promise((u,l)=>{const d=new FileReader;d.onloadend=()=>{typeof d.result=="string"&&d.result.startsWith("data:")?u(d.result):(console.error(`Failed to convert resource from ${r} to base64 DataURL.`),u(null))},d.onerror=()=>{console.error(`Error reading blob from ${r} as DataURL.`),l(null)},d.readAsDataURL(o)})}catch(i){return console.error("Error fetching or converting image to base64:",i),null}},rf=(r,i)=>{try{const n={event:r,payload:i||{},ts:Date.now()};try{window.dispatchEvent(new CustomEvent("analytics",{detail:n}))}catch{}Er()&&console.info("trackEvent:",r,i||{})}catch(n){Er()&&console.warn("trackEvent failed",n)}},Er=()=>{try{if(typeof window<"u"&&window.__MEBOOKS_DEBUG__)return!0}catch{}try{typeof import.meta<"u"}catch{}return!1};function ih(r){let n="";for(let o=0;o<r.length;o+=32768){const u=r.subarray(o,o+32768);n+=String.fromCharCode.apply(null,Array.prototype.slice.call(u))}return n}const Tn=new WeakMap;async function oh(r){try{const i=Tn.get(r);if(i)return i}catch{}try{if(r&&typeof r.arrayBuffer=="function")try{const i=await r.arrayBuffer(),n=new Uint8Array(i);try{Tn.set(r,n)}catch{}return n}catch{}if(r&&typeof r.clone=="function"){const i=r.clone();try{const n=await i.arrayBuffer(),o=new Uint8Array(n);try{Tn.set(r,o)}catch{}return o}catch(n){const o=i.body&&i.body.getReader?i.body.getReader():null;if(!o)throw n;const u=[];let l=0;for(;;){const{done:h,value:y}=await o.read();if(h)break;if(y){const k=y instanceof Uint8Array?y:new Uint8Array(y);u.push(k),l+=k.length}}const d=new Uint8Array(l);let f=0;for(const h of u)d.set(h,f),f+=h.length;try{Tn.set(r,d)}catch{}return d}}if(r&&typeof r.text=="function"){const i=await r.text();let n;typeof TextEncoder<"u"?n=new TextEncoder().encode(i):typeof Buffer<"u"?n=new Uint8Array(Buffer.from(i,"utf-8")):n=new Uint8Array;try{Tn.set(r,n)}catch{}return n}if(r&&r.body){if(r.body instanceof Uint8Array){try{Tn.set(r,r.body)}catch{}return r.body}if(typeof Buffer<"u"&&Buffer.isBuffer(r.body)){const i=new Uint8Array(r.body);try{Tn.set(r,i)}catch{}return i}}return new Uint8Array}catch(i){throw i}}async function hs(r){try{const i=await oh(r);try{return new TextDecoder("utf-8",{fatal:!1}).decode(i)}catch{try{return new TextDecoder("iso-8859-1",{fatal:!1}).decode(i)}catch{return ih(i)}}}catch(i){console.warn("safeReadText: fallback decode failed",i);try{if(r&&typeof r.text=="function")return await r.text()}catch{}return""}}async function Cl(r,i=512){try{const n=await oh(r),o=n.subarray(0,Math.min(n.length,i)),u=ih(o);return btoa(u)}catch(n){return console.warn("captureFirstBytes failed",n),""}}const So=r=>{if(!r)return;const i=r.split(";")[0].trim().toLowerCase();if(i.includes("epub")||i==="application/epub+zip")return"EPUB";if(i.includes("pdf")||i==="application/pdf")return"PDF";if(i.includes("audiobook")||i==="http://bib.schema.org/audiobook")return"AUDIOBOOK"},dn=(r,i)=>{const o=new DOMParser().parseFromString(r,"application/xml"),u=o.querySelector("parsererror");if(u)throw console.error("XML Parsing Error:",u.textContent),new Error("Failed to parse catalog feed. The URL may not point to a valid OPDS feed, or the response was not valid XML.");const l=o.documentElement?.nodeName;if(!l||l.toLowerCase()!=="feed"&&!l.endsWith(":feed"))throw new Error("Invalid Atom/OPDS feed. The XML document is missing the root <feed> element.");const d=Array.from(o.querySelectorAll("entry")),f=[],h=[],y={};if(Array.from(o.querySelectorAll("feed > link")).forEach(w=>{const x=w.getAttribute("rel")||"",b=String(x).toLowerCase(),C=w.getAttribute("href");if(C){const m=new URL(C,i).href;b.includes("next")&&(y.next=m),(b.includes("prev")||b.includes("previous"))&&(y.prev=m),b.includes("first")&&(y.first=m),b.includes("last")&&(y.last=m)}}),d.forEach(w=>{const x=w.querySelector("title")?.textContent?.trim()||"Untitled",b=Array.from(w.querySelectorAll("link")),C=w.getAttribute("schema:additionalType"),m=C==="http://bib.schema.org/Audiobook"||C==="http://schema.org/Audiobook",S=b.find(U=>{const M=U.getAttribute("rel")||"";return M.includes("/open-access")||M==="http://opds-spec.org/acquisition/open-access"}),j=S||b.find(U=>{const M=U.getAttribute("rel")||"",re=U.getAttribute("type")||"";return M.includes("opds-spec.org/acquisition")&&(re.includes("epub+zip")||re.includes("pdf"))})||b.find(U=>(U.getAttribute("rel")||"").includes("opds-spec.org/acquisition")),_=!!S,L=w.querySelector('link[rel="subsection"], link[rel="http://opds-spec.org/subsection"]');if(j){const U=w.querySelector("author > name")?.textContent?.trim()||"Unknown Author",M=w.querySelector("summary")?.textContent?.trim()||w.querySelector("content")?.textContent?.trim()||null,J=w.querySelector('link[rel="http://opds-spec.org/image"]')?.getAttribute("href"),$=J?new URL(J,i).href:null,z=j?.getAttribute("href"),Q=j?.getAttribute("type")||"";let ae=So(Q);if(m)ae="AUDIOBOOK";else if(!ae){const A=me=>{if(me)for(const he of Array.from(me.children))if((he.localName||he.nodeName||"").toLowerCase()==="indirectacquisition"){const we=he.getAttribute("type");if(we)return we;const Ee=A(he);if(Ee)return Ee}else{const we=A(he);if(we)return we}},B=A(j);B&&(ae=So(B))}const F=(w.querySelector("publisher")?.textContent||w.querySelector("dc\\:publisher")?.textContent)?.trim();let te;try{const A=w.getElementsByTagName("bibframe:distribution");if(A.length>0){const B=A[0].getAttribute("bibframe:ProviderName")?.trim();te=B&&B.length>0?B:void 0}}catch{try{const B=w.getElementsByTagName("distribution");if(B.length>0){const me=B[0].getAttribute("ProviderName")?.trim();te=me&&me.length>0?me:void 0}}catch(B){console.warn("Could not parse distributor information:",B)}}const N=(w.querySelector("issued")?.textContent||w.querySelector("dc\\:issued")?.textContent||w.querySelector("published")?.textContent)?.trim(),ge=Array.from(w.querySelectorAll("identifier, dc\\:identifier"))[0]?.textContent?.trim()||void 0,ne=Array.from(w.querySelectorAll("category")).map(A=>{const B=A.getAttribute("scheme")||"http://palace.io/subjects",me=A.getAttribute("term")?.trim(),he=A.getAttribute("label")?.trim();return me?{scheme:B,term:me,label:he||me}:null}).filter(A=>A!==null),le=ne.map(A=>A.label),ue=Array.from(w.querySelectorAll('link[rel="collection"]')).map(A=>{const B=A.getAttribute("href"),me=A.getAttribute("title");return B&&me?{title:me.trim(),href:new URL(B,i).href}:null}).filter(A=>A!==null);if(z){const A=new URL(z,i).href;let B=Q;m&&(B="http://bib.schema.org/Audiobook"),f.push({title:x,author:U,coverImage:$,downloadUrl:A,summary:M,publisher:F||void 0,publicationDate:N||void 0,providerId:ge,distributor:te,subjects:le.length>0?le:void 0,categories:ne.length>0?ne:void 0,format:ae,acquisitionMediaType:B||void 0,collections:ue.length>0?ue:void 0,isOpenAccess:_||void 0})}}else if(L){const U=L.getAttribute("href");U&&h.push({title:x,url:new URL(U,i).href,rel:"subsection"})}}),f.length>0&&h.length===0){const w=new Map;f.forEach(x=>{x.collections&&x.collections.forEach(b=>{w.has(b.title)||w.set(b.title,b.href)})}),w.forEach((x,b)=>{h.push({title:b,url:x,rel:"collection"})})}if(l&&(l.toLowerCase()==="feed"||l.endsWith(":feed"))&&d.length===0){const w=o.documentElement,x=!!(w&&w.getElementsByTagName("title")&&w.getElementsByTagName("title").length>0),b=!!(w&&w.getElementsByTagName("link")&&w.getElementsByTagName("link").length>0);if(!x&&!b)throw new Error("The feed contains no entries.");return{books:[],navLinks:[],pagination:y}}if(l&&(l.toLowerCase()==="feed"||l.endsWith(":feed"))&&d.length>0&&f.length===0&&h.length===0)throw new Error("This appears to be a valid Atom feed, but it contains no recognizable OPDS book entries or navigation links. Please ensure the URL points to an OPDS catalog.");return{books:f,navLinks:h,pagination:y}},go=(r,i)=>{if(!r||typeof r!="object")throw new Error("Invalid catalog format. The response was not a valid JSON object.");if(!r.metadata)throw new Error("OPDS2 feed missing metadata");const n=[],o=[],u={};r.links&&Array.isArray(r.links)&&r.links.forEach(d=>{if(d.href&&d.rel){const f=new URL(d.href,i).href;d.rel==="next"&&(u.next=f),d.rel==="previous"&&(u.prev=f),d.rel==="first"&&(u.first=f),d.rel==="last"&&(u.last=f)}}),r.publications&&Array.isArray(r.publications)&&r.publications.forEach(d=>{const f=d.metadata||{},h=f.title?.trim()||"Untitled",y=f.description?.trim()||null;let k="Unknown Author";if(f.author)if(Array.isArray(f.author)&&f.author.length>0){const _=f.author[0];typeof _=="string"?k=_.trim():_?.name&&(k=_.name.trim())}else typeof f.author=="string"?k=f.author.trim():f.author?.name&&(k=f.author.name.trim());const w=d.links?.filter(_=>_.rel?.includes("opds-spec.org/acquisition"))||[],x=w.filter(_=>_.rel?.includes("/open-access")||_.rel==="http://opds-spec.org/acquisition/open-access");let b=x.find(_=>_.type?.includes("epub"));b||(b=x[0]||w[0]);const C=x.length>0,m=[],S=new Set;for(const _ of x.length>0?x:w){const L=So(_.type);L&&!S.has(L)&&(S.add(L),m.push({format:L,downloadUrl:new URL(_.href,i).href,mediaType:_.type,isOpenAccess:x.includes(_)}))}const j=d.images?.[0];if(b?.href){const _=new URL(b.href,i).href,L=j?.href?new URL(j.href,i).href:null,U=b?.type||"",M=So(U);let re;f.publisher&&(typeof f.publisher=="string"?re=f.publisher.trim():f.publisher?.name&&(re=f.publisher.name.trim()));const J=f.published?.trim();let $;if(typeof f.identifier=="string")$=f.identifier.trim();else if(Array.isArray(f.identifier)&&f.identifier.length>0){const ae=f.identifier.find(F=>typeof F=="string");ae&&($=ae.trim())}let z=[];Array.isArray(f.subject)&&(z=f.subject.map(ae=>typeof ae=="string"?ae.trim():ae?.name?ae.name.trim():null).filter(ae=>!!ae&&typeof ae=="string"));let Q;if(f.belongsTo){const ae=f.belongsTo;ae.name&&(Q={name:ae.name.trim(),position:typeof ae.position=="number"?ae.position:void 0})}n.push({title:h,author:k,coverImage:L,downloadUrl:_,summary:y,publisher:re,publicationDate:J,providerId:$,subjects:z.length>0?z:void 0,series:Q,format:M,acquisitionMediaType:U||void 0,isOpenAccess:C?!0:void 0,alternativeFormats:m.length>0?m:void 0})}});let l=!1;return r.catalogs&&Array.isArray(r.catalogs)&&r.catalogs.length>0&&(r.catalogs.forEach(d=>{const f=d.metadata?.title,h=d.links?.find(y=>y.rel==="http://opds-spec.org/catalog"&&y.href);if(f&&h){const y=new URL(h.href,i).href;o.push({title:f,url:y,rel:"subsection",isCatalog:!0})}}),o.length>0&&(l=!0)),!l&&r.navigation&&Array.isArray(r.navigation)&&r.navigation.forEach(d=>{if(d.href&&d.title){const f=new URL(d.href,i).href,h=d.rel||(d.type&&typeof d.type=="string"&&d.type.includes("application/opds+json")?"subsection":""),y=!!(d.type&&typeof d.type=="string"&&d.type.includes("application/opds+json"))||!!d.isCatalog;o.push({title:d.title,url:f,rel:h,isCatalog:y})}}),{books:n,navLinks:o,pagination:u}},T0=async(r,i,n="auto")=>{try{const o=(()=>{try{return new URL(r).hostname.toLowerCase()}catch{return""}})(),u=o.endsWith("palace.io")||o.endsWith("palaceproject.io")||o.endsWith("thepalaceproject.org")||o==="palace.io"||o.endsWith(".palace.io")||o.endsWith(".thepalaceproject.org");ce.debug("fetchCatalogContent host classification",{hostname:o,isPalaceHost:u,forcedVersion:n});let l;u?l=$t(r):l=await wr(r);const d=u||n==="1"?"application/atom+xml;profile=opds-catalog, application/xml, text/xml, */*":"application/opds+json, application/atom+xml;profile=opds-catalog;q=0.9, application/json;q=0.8, application/xml;q=0.7, */*;q=0.5";ce.debug("fetchCatalogContent fetch details",{fetchUrl:l,acceptHeader:d});const f=l===r,h=await fetch(l,{method:"GET",mode:"cors",credentials:f?"include":"omit",headers:{Accept:d}});try{console.debug("[mebooks] initial response - status:",h.status,"content-type:",h.headers.get("Content-Type"))}catch{}const y=h.status>=300&&h.status<400,k=!!h.headers.get("Access-Control-Allow-Origin");if((y||f&&!k)&&$t){const b=$t(r),C=await fetch(b,{method:"GET",headers:{Accept:d}});if(C){const m=C.headers.get("Content-Type")||"",S=await hs(C);if(C.status===403)try{const j=m.includes("application/json")?JSON.parse(S):null;if(j&&j.error&&typeof j.error=="string"&&j.error.toLowerCase().includes("host"))throw new Error(`Proxy denied access to host for ${r}. The proxy's HOST_ALLOWLIST may need to include the upstream host.`)}catch{throw new Error(`Proxy returned 403 for ${r}. The proxy may be blocking this host.`)}if(m.includes("text/html")&&S.trim().toLowerCase().startsWith("<!doctype html>"))throw new Error("The CORS proxy returned an HTML page instead of the catalog feed. This might indicate the proxy service is down or blocking the request. Please try another catalog or check back later.");if(console.debug("[mebooks] proxied response - forcedVersion:",n,"contentType:",m,"url:",r),n==="1"&&S.trim().startsWith("<"))return console.debug("[mebooks] Forcing OPDS1 (XML) parse for proxied response"),dn(S,i);if(n!=="1"&&(m.includes("application/opds+json")||m.includes("application/json")))try{const j=JSON.parse(S);return go(j,i)}catch{if(S&&S.trim().startsWith("<"))try{return console.debug("[mebooks] proxied response body appears to be XML despite JSON Content-Type; attempting XML parse"),dn(S,i)}catch{}const _=await Cl(C).catch(()=>"");throw console.warn("[mebooks] Failed to JSON.parse proxied response; first bytes (base64):",_),new Error(`Failed to parse proxied JSON response for ${r}. First bytes (base64): ${_}`)}else{if(m.includes("application/atom+xml")||m.includes("application/xml")||m.includes("text/xml"))return dn(S,i);if((n!=="1"||u)&&S.trim().startsWith("{"))try{const j=JSON.parse(S);return go(j,i)}catch{const _=await Cl(C).catch(()=>"");throw console.warn("Failed to auto-parse proxied JSON; first bytes (base64):",_),new Error(`Failed to parse proxied JSON response for ${r}. First bytes (base64): ${_}`)}if(S.trim().startsWith("<"))return dn(S,i);throw new Error(`Unsupported or ambiguous catalog format. Content-Type: "${m}".`)}}}if(!h.ok){const b=`${h.status}${h.statusText?` ${h.statusText}`:""}`;let C=`The catalog server responded with an error (${b}). Please check the catalog URL.`;throw(h.status===401||h.status===403)&&(C=`Could not access catalog (${b}). This catalog requires authentication (a login or password), which is not supported by this application.`),h.status===429&&(C=`Could not access catalog (${b}). The request was rate-limited by the server or the proxy. Please wait a moment and try again.`),new Error(C)}const w=h.headers.get("Content-Type")||"",x=await hs(h);if(h.status===403&&w.includes("application/json"))try{const b=JSON.parse(x);if(b&&b.error&&typeof b.error=="string")throw new Error(`Proxy error: ${b.error}`)}catch{throw new Error(`Proxy returned 403 for ${r}`)}if(w.includes("text/html")&&x.trim().toLowerCase().startsWith("<!doctype html>"))throw new Error("The CORS proxy returned an HTML page instead of the catalog feed. This might indicate the proxy service is down or blocking the request. Please try another catalog or check back later.");if(console.debug("[mebooks] direct response - forcedVersion:",n,"contentType:",w,"url:",r),n==="1"&&x.trim().startsWith("<"))return console.debug("[mebooks] Forcing OPDS1 (XML) parse for direct response"),dn(x,i);if(console.log("[mebooks] About to check JSON condition - forcedVersion:",n,"contentType includes opds+json:",w.includes("application/opds+json"),"contentType includes json:",w.includes("application/json")),n!=="1"&&(w.includes("application/opds+json")||w.includes("application/json"))){console.log("[mebooks] ENTERED JSON condition block! About to parse JSON...");try{console.log("[mebooks] About to call JSON.parse on response, length:",x.length);const b=JSON.parse(x);return console.log("[mebooks] JSON.parse succeeded! About to call parseOpds2Json..."),ce.info("[mebooks] Delegating to parseOpds2Json for",i),go(b,i)}catch{if(x&&x.trim().startsWith("<"))try{return console.debug("[mebooks] direct response body appears to be XML despite JSON Content-Type; attempting XML parse"),dn(x,i)}catch{}const C=await Cl(h).catch(()=>"");throw console.warn("[mebooks] Failed to JSON.parse response; first bytes (base64):",C),new Error(`Failed to parse JSON response for ${r}. First bytes (base64): ${C}`)}}else{if(w.includes("application/atom+xml")||w.includes("application/xml")||w.includes("text/xml"))return dn(x,i);if(n!=="1"&&x.trim().startsWith("{"))try{const b=JSON.parse(x);return go(b,i)}catch{}if(x.trim().startsWith("<"))return dn(x,i);throw new Error(`Unsupported or ambiguous catalog format. Content-Type: "${w}".`)}}catch(o){console.error("Error fetching or parsing catalog content:",o);let u;return o instanceof TypeError?o.message.includes("exceeds response Body")?u="A network error occurred while downloading the catalog. The response was incomplete, which can be caused by an unstable connection or a proxy issue. Please try again.":o.message==="Failed to fetch"?u="Network Error: Failed to fetch the content. This could be due to your internet connection, the remote catalog being offline, or the public CORS proxy being temporarily unavailable.":u=`A network error occurred: ${o.message}`:o instanceof SyntaxError?u="Failed to parse the catalog feed. The response was not valid JSON or XML.":o instanceof Error?u=o.message:u="An unknown error occurred while loading the catalog.",{books:[],navLinks:[],pagination:{},error:u}}},ti=async(r,i,n=5)=>{let o=0;const u=["application/adobe+epub","application/pdf+lcp","application/vnd.readium.license.status.v1.0+json"],l=r;let d;try{const y=(()=>{try{return new URL(r).hostname.toLowerCase()}catch{return""}})();y.endsWith("palace.io")||y.endsWith("palaceproject.io")||y.endsWith("thepalaceproject.org")||y==="palace.io"||y.endsWith(".palace.io")||y.endsWith(".thepalaceproject.org")?d=$t(r):d=await wr(r)}catch{d=await wr(r)}try{if(typeof d=="string"&&d.includes("corsproxy.io")&&i){const k=new Error("Acquisition would use a public CORS proxy which may strip Authorization or block POST requests. Configure an owned proxy (VITE_OWN_PROXY_URL) to perform authenticated borrows.");throw k.proxyUsed=!0,k}}catch(y){throw y}const f=(y=!1)=>{const k={Accept:"application/atom+xml, application/xml, text/xml, */*"};return y&&i&&(k.Authorization=`Basic ${btoa(`${i.username}:${i.password}`)}`),k},h=!!i;for(;o<n&&d;){o++;let y=null;try{const w=typeof d=="string"&&d===l;h?(y=await fetch(d,{method:"GET",headers:f(!0),credentials:w?"include":"omit"}),y.status===405&&(y=await fetch(d,{method:"POST",headers:f(!0),credentials:w?"include":"omit"}))):(y=await fetch(d,{method:"POST",headers:f(!1),credentials:w?"include":"omit"}),y.status===405&&(y=await fetch(d,{method:"GET",headers:f(!1),credentials:w?"include":"omit"})))}catch(w){throw w}if(!y)return null;if(y.status>=300&&y.status<400){const w=y.headers&&typeof y.headers.get=="function"?y.headers.get("Location")||y.headers.get("location"):null;if(w)return new URL(w,l).href}if(typeof y.ok=="boolean"?y.ok:y.status>=200&&y.status<300){const w=await hs(y).catch(()=>"");try{if(w.trim().startsWith("<")){const C=new DOMParser().parseFromString(w,"application/xml"),m=Array.from(C.querySelectorAll("link")),S=["application/adobe+epub","application/pdf+lcp","application/vnd.readium.license.status.v1.0+json"],j=m.find(_=>{const L=(_.getAttribute("rel")||"").toLowerCase(),U=(_.getAttribute("type")||"").toLowerCase();return _.getAttribute("href")&&(L.includes("acquisition")||L.includes("borrow")||L.includes("loan")||L.includes("http://opds-spec.org/acquisition"))?(U&&(U.includes("epub")||U.includes("pdf")||S.some(re=>U.includes(re))),!0):!1});if(j){const _=j.getAttribute("href");return new URL(_,l).href}}}catch{}const x=y.headers&&typeof y.headers.get=="function"&&y.headers.get("Content-Type")||"";if(x.includes("application/epub")||x.includes("application/pdf")||x.includes("application/octet-stream"))return l;try{const b=w||await hs(y).catch(()=>"");if(typeof d=="string"&&(d.includes("corsproxy.io")||d.includes("/proxy?url="))&&(x.includes("text/html")||b&&b.trim().startsWith("<"))){const m=new Error("Acquisition failed via public CORS proxy. The proxy may block POST requests or strip Authorization headers. Configure an owned proxy (VITE_OWN_PROXY_URL) to preserve credentials and HTTP methods.");throw m.status=y.status,m.proxyUsed=!0,m}}catch{}}try{const w=typeof d=="string"&&d===l,x=y.status===401||y.status===403,b=y.headers&&typeof y.headers.get=="function"&&!!y.headers.get("Access-Control-Allow-Origin");if(w&&x&&!b){const C=$t(l),m=C&&C.includes("corsproxy.io");if(!C){const U=new Error("Acquisition failed and no proxy is available. Configure an owned proxy via VITE_OWN_PROXY_URL to allow authenticated downloads from the browser.");throw U.proxyUsed=!0,U}if(m){const U=new Error("Acquisition would require using a public CORS proxy which may strip Authorization or block POSTs. Configure an owned proxy (VITE_OWN_PROXY_URL).");throw U.proxyUsed=!0,U}const S=(U=!1)=>{const M={Accept:"application/atom+xml, application/xml, text/xml, */*"};return U&&i&&(M.Authorization=`Basic ${btoa(`${i.username}:${i.password}`)}`),M};let j=null;try{h?(j=await fetch(C,{method:"GET",headers:S(!0)}),j&&j.status===405&&(j=await fetch(C,{method:"POST",headers:S(!0)}))):(j=await fetch(C,{method:"POST",headers:S(!1)}),j&&j.status===405&&(j=await fetch(C,{method:"GET",headers:S(!1)})))}catch{const M=new Error("Failed to contact owned proxy for authenticated acquisition. Check your proxy configuration.");throw M.proxyUsed=!0,M}if(!j){const U=new Error("Proxy retry failed.");throw U.proxyUsed=!0,U}if(j.status>=300&&j.status<400){const U=j.headers&&typeof j.headers.get=="function"?j.headers.get("Location")||j.headers.get("location"):null;if(U)return new URL(U,l).href}if(typeof j.ok=="boolean"?j.ok:j.status>=200&&j.status<300){const U=await hs(j).catch(()=>"");try{if(U.trim().startsWith("<")){const J=new DOMParser().parseFromString(U,"application/xml"),z=Array.from(J.querySelectorAll("link")).find(Q=>{const ae=(Q.getAttribute("rel")||"").toLowerCase(),F=(Q.getAttribute("type")||"").toLowerCase();return Q.getAttribute("href")&&(ae.includes("acquisition")||ae.includes("borrow")||ae.includes("loan")||ae.includes("http://opds-spec.org/acquisition"))?(F&&(F.includes("epub")||F.includes("pdf")||u.some(N=>F.includes(N))),!0):!1});if(z){const Q=z.getAttribute("href");return new URL(Q,l).href}}}catch{}const M=j.headers&&typeof j.headers.get=="function"&&j.headers.get("Content-Type")||"";if(M.includes("application/epub")||M.includes("application/pdf")||M.includes("application/octet-stream"))return l}const L=new Error("Authenticated acquisition failed even after retrying via owned proxy.");throw L.proxyUsed=!0,L}}catch(w){throw w}if(y.status===401||y.status===403){const w=await hs(y).catch(()=>"");let x=null;try{((y.headers.get("Content-Type")||"").includes("application/vnd.opds.authentication.v1.0+json")||w.trim().startsWith("{"))&&(x=JSON.parse(w))}catch{x=null}const b=new Error(`Acquisition requires authentication: ${y.status} ${y.statusText}`);b.status=y.status,x&&(b.authDocument=x);try{typeof d=="string"&&(d.includes("corsproxy.io")||d.includes("/proxy?url="))&&(b.proxyUsed=!0)}catch{}throw b}break}return null},ah=(r,i)=>i==="all"?r:r.filter(n=>{if(n.categories&&n.categories.length>0){const o=n.categories.filter(u=>u.scheme.includes("audience")||u.scheme.includes("target-age"));if(o.length>0)return o.some(l=>{const d=l.label.toLowerCase(),f=l.term.toLowerCase();switch(i){case"adult":return d.includes("adult")&&!d.includes("young")||f.includes("adult")&&!f.includes("young")||d.includes("18+")||f.includes("18+");case"young-adult":return d.includes("young adult")||d.includes("teen")||f.includes("young-adult")||f.includes("teen")||d.includes("ya")||f.includes("ya");case"children":return d.includes("children")||d.includes("child")||d.includes("juvenile")||d.includes("kids")||f.includes("children")||f.includes("child")||f.includes("juvenile")||f.includes("kids");default:return!1}})}return n.subjects&&n.subjects.length>0&&n.subjects.some(u=>{const l=u.toLowerCase();switch(i){case"adult":return l.includes("adult")&&!l.includes("young");case"young-adult":return l.includes("young adult")||l.includes("teen")||l.includes("ya");case"children":return l.includes("children")||l.includes("child")||l.includes("juvenile")||l.includes("kids");default:return!1}})?!0:i==="adult"}),P0=r=>{const i=new Set(["all"]);return r.forEach(n=>{n.categories&&n.categories.length>0&&n.categories.forEach(o=>{if(o.scheme.includes("audience")||o.scheme.includes("target-age")){const u=o.label.toLowerCase(),l=o.term.toLowerCase();(u.includes("adult")&&!u.includes("young")||l.includes("adult")&&!l.includes("young")||u.includes("18+")||l.includes("18+"))&&i.add("adult"),(u.includes("young adult")||u.includes("teen")||l.includes("young-adult")||l.includes("teen")||u.includes("ya")||l.includes("ya"))&&i.add("young-adult"),(u.includes("children")||u.includes("child")||u.includes("juvenile")||u.includes("kids")||l.includes("children")||l.includes("child")||l.includes("juvenile")||l.includes("kids"))&&i.add("children")}}),n.subjects&&n.subjects.length>0&&n.subjects.forEach(o=>{const u=o.toLowerCase();u.includes("adult")&&!u.includes("young")&&i.add("adult"),(u.includes("young adult")||u.includes("teen")||u.includes("ya"))&&i.add("young-adult"),(u.includes("children")||u.includes("child")||u.includes("juvenile")||u.includes("kids"))&&i.add("children")})}),Array.from(i)},lh=(r,i)=>i==="all"?r:r.filter(n=>{if(n.categories&&n.categories.length>0){const o=n.categories.filter(u=>u.scheme.includes("fiction")||u.scheme.includes("genre")||u.scheme.includes("bisac"));if(o.length>0){const u=o.some(l=>{const d=l.label.toLowerCase(),f=l.term.toLowerCase();if(d.includes("fiction")||f.includes("fiction"))return!d.includes("non-fiction")&&!f.includes("non-fiction");if(d.includes("non-fiction")||f.includes("non-fiction")||d.includes("nonfiction")||f.includes("nonfiction"))return!1;const h=["romance","mystery","thriller","fantasy","science fiction","horror","adventure","literary","drama","suspense"],y=["biography","history","science","philosophy","religion","self-help","health","business","politics","economics"],k=h.some(x=>d.includes(x)||f.includes(x));return y.some(x=>d.includes(x)||f.includes(x))?!1:k?!0:null});if(u!==null)return i==="fiction"?u:!u}}if(n.subjects&&n.subjects.length>0){const o=n.subjects.some(u=>{const l=u.toLowerCase();if(l.includes("fiction")&&!l.includes("non-fiction"))return!0;if(l.includes("non-fiction")||l.includes("nonfiction"))return!1;const d=["romance","mystery","thriller","fantasy","science fiction","horror","adventure","literary","drama","suspense"];return["biography","history","science","philosophy","religion","self-help","health","business","politics","economics"].some(k=>l.includes(k))?!1:d.some(k=>l.includes(k))?!0:null});if(o!==null)return i==="fiction"?o:!o}return!0}),O0=r=>{const i=new Set(["all"]);let n=!1,o=!1;return r.forEach(u=>{u.categories&&u.categories.length>0&&u.categories.forEach(l=>{if(l.scheme.includes("fiction")||l.scheme.includes("genre")||l.scheme.includes("bisac")){const d=l.label.toLowerCase(),f=l.term.toLowerCase();(d.includes("fiction")&&!d.includes("non-fiction")||f.includes("fiction")&&!f.includes("non-fiction"))&&(n=!0),(d.includes("non-fiction")||f.includes("non-fiction")||d.includes("nonfiction")||f.includes("nonfiction"))&&(o=!0);const h=["romance","mystery","thriller","fantasy","science fiction","horror","adventure","literary","drama","suspense"],y=["biography","history","science","philosophy","religion","self-help","health","business","politics","economics"],k=h.some(x=>d.includes(x)||f.includes(x)),w=y.some(x=>d.includes(x)||f.includes(x));k&&(n=!0),w&&(o=!0)}}),u.subjects&&u.subjects.length>0&&u.subjects.forEach(l=>{const d=l.toLowerCase();d.includes("fiction")&&!d.includes("non-fiction")&&(n=!0),(d.includes("non-fiction")||d.includes("nonfiction"))&&(o=!0);const f=["romance","mystery","thriller","fantasy","science fiction","horror","adventure","literary","drama","suspense"],h=["biography","history","science","philosophy","religion","self-help","health","business","politics","economics"],y=f.some(w=>d.includes(w)),k=h.some(w=>d.includes(w));y&&(n=!0),k&&(o=!0)})}),n&&i.add("fiction"),o&&i.add("non-fiction"),Array.from(i)},ch=(r,i)=>i==="all"?r:r.filter(n=>{const o=(n.mediaType||n.acquisitionMediaType)?.toLowerCase(),u=n.format?.toUpperCase();return i==="ebook"?o?.includes("bib.schema.org/book")||o?.includes("schema.org/ebook")||o?.includes("ebook")||u==="EPUB"||u==="PDF"||!o&&u!=="AUDIOBOOK":i==="audiobook"?o?.includes("bib.schema.org/audiobook")||o?.includes("audiobook")||u==="AUDIOBOOK":!1}),L0=r=>{const i=new Set(["all"]);return r.forEach(o=>{const u=o.mediaType||o.acquisitionMediaType,l=u?.toLowerCase(),d=o.format?.toUpperCase();(l?.includes("bib.schema.org/audiobook")||l?.includes("audiobook")||u==="http://bib.schema.org/Audiobook"||d==="AUDIOBOOK")&&i.add("audiobook"),(l?.includes("bib.schema.org/book")||l?.includes("schema.org/ebook")||l?.includes("ebook")||u==="http://bib.schema.org/Book"||u==="http://schema.org/EBook"||d==="EPUB"||d==="PDF"||!u&&d!=="AUDIOBOOK")&&i.add("ebook")}),Array.from(i)},I0=(r,i,n=[])=>i==="all"||n.find(u=>(u.rel==="collection"||u.rel==="subsection")&&u.title===i)?r:r.filter(u=>u.collections?.some(l=>l.title===i)),D0=(r,i=[])=>{const n=new Set;return r.forEach(o=>{o.collections&&o.collections.length>0&&o.collections.forEach(u=>{(u.href.includes("/groups/")||u.title.toLowerCase()==="fiction"||u.title.toLowerCase()==="nonfiction"||u.title.toLowerCase().includes("young adult")||u.title.toLowerCase().includes("children"))&&n.add(u.title)})}),i.forEach(o=>{(o.rel==="collection"||o.rel==="subsection")&&(o.url.includes("/groups/")||o.title.toLowerCase()==="fiction"||o.title.toLowerCase()==="nonfiction"||o.title.toLowerCase().includes("young adult")||o.title.toLowerCase().includes("children"))&&n.add(o.title)}),Array.from(n).sort()},F0=(r,i=[])=>{const n=new Set;return r.forEach(o=>{o.collections&&o.collections.length>0&&o.collections.forEach(u=>{u.href.includes("/groups/")||u.title.toLowerCase()==="fiction"||u.title.toLowerCase()==="nonfiction"||u.title.toLowerCase().includes("young adult")||u.title.toLowerCase().includes("children")||n.add(u.title)})}),i.forEach(o=>{(o.rel==="collection"||o.rel==="subsection")&&(o.url.includes("/groups/")||o.title.toLowerCase()==="fiction"||o.title.toLowerCase()==="nonfiction"||o.title.toLowerCase().includes("young adult")||o.title.toLowerCase().includes("children")||n.add(o.title))}),Array.from(n).sort()},B0=(r,i,n,o,u="all",l="all",d="all",f="all")=>{let h=r;d!=="all"&&(h=ch(h,d)),l!=="all"&&(h=lh(h,l)),u!=="all"&&(h=ah(h,u)),f!=="all"&&(h=I0(h,f,i));const y=new Map,k=new Set,w=[],x=!f||f==="all";h.forEach(m=>{let S=!1;m.categories&&m.categories.length>0?m.categories.forEach(j=>{const _=`${j.scheme}|${j.label}`;y.has(_)||y.set(_,{category:j,books:[]}),y.get(_).books.push(m),S=!0}):o==="subject"&&m.subjects&&m.subjects.length>0&&m.subjects.forEach(j=>{const _={scheme:"http://palace.io/subjects",term:j.toLowerCase().replace(/\s+/g,"-"),label:j},L=`${_.scheme}|${_.label}`;y.has(L)||y.set(L,{category:_,books:[]}),y.get(L).books.push(m),S=!0}),x&&m.collections&&m.collections.length>0&&m.collections.forEach(j=>{k.add(JSON.stringify(j))}),S||w.push(m)}),x&&r.forEach(m=>{m.collections&&m.collections.length>0&&m.collections.forEach(S=>{k.add(JSON.stringify(S))})});const b=Array.from(y.values()).map(m=>{let S=m.books;return m.category.scheme==="http://opds-spec.org/series"&&(S=[...m.books].sort((j,_)=>{const L=j.series?.position||0,U=_.series?.position||0;return L-U})),{...m,books:S}}),C=Array.from(k).map(m=>JSON.parse(m));return{books:h,navLinks:i,pagination:n,categoryLanes:b,collectionLinks:C,uncategorizedBooks:w}},U0="MeBooksCredentialsDB",_r="credentials",z0=1;function Po(){return new Promise((r,i)=>{const n=indexedDB.open(U0,z0);n.onupgradeneeded=()=>{const o=n.result;o.objectStoreNames.contains(_r)||o.createObjectStore(_r,{keyPath:"host"})},n.onsuccess=()=>r(n.result),n.onerror=()=>i(n.error)})}async function uh(r,i,n){try{const u=(await Po()).transaction(_r,"readwrite");return u.objectStore(_r).put({host:r,username:i,password:n}),new Promise((d,f)=>{u.oncomplete=()=>d(),u.onerror=()=>f(u.error)})}catch(o){ce.warn("saveCredential failed",o)}}async function dh(){try{const o=(await Po()).transaction(_r,"readonly").objectStore(_r).getAll();return new Promise((u,l)=>{o.onsuccess=()=>u(o.result),o.onerror=()=>l(o.error)})}catch(r){return ce.warn("getAllCredentials failed",r),[]}}async function M0(r){try{const u=(await Po()).transaction(_r,"readonly").objectStore(_r).get(r);return new Promise((l,d)=>{u.onsuccess=()=>l(u.result),u.onerror=()=>d(u.error)})}catch(i){ce.warn("findCredential failed",i);return}}async function $0(r){try{const n=(await Po()).transaction(_r,"readwrite");return n.objectStore(_r).delete(r),new Promise((u,l)=>{n.oncomplete=()=>u(),n.onerror=()=>l(n.error)})}catch(i){ce.warn("deleteCredential failed",i)}}async function W0(r="mebooks.opds.credentials"){try{const i=localStorage.getItem(r);if(!i)return;let n=null;try{n=JSON.parse(i)}catch{n=null}if(!Array.isArray(n))return;const o=await dh(),u=new Set(o.map(l=>l.host));for(const l of n)!l||!l.host||u.has(l.host)||await uh(l.host,l.username,l.password);try{localStorage.removeItem(r)}catch{}}catch(i){ce.warn("migrateFromLocalStorage failed",i)}}const Yl={saveCredential:uh,getAllCredentials:dh,findCredential:M0,deleteCredential:$0,migrateFromLocalStorage:W0};function V0(r){let n="";for(let o=0;o<r.length;o+=32768){const u=r.subarray(o,o+32768);n+=String.fromCharCode.apply(null,Array.prototype.slice.call(u))}return n}const Pn=new WeakMap;async function H0(r){try{const i=Pn.get(r);if(i)return i}catch{}try{if(r&&typeof r.clone=="function"){const i=r.clone();try{const n=await i.arrayBuffer(),o=new Uint8Array(n);try{Pn.set(r,o)}catch{}return o}catch(n){const o=i.body&&i.body.getReader?i.body.getReader():null;if(!o)throw n;const u=[];let l=0;for(;;){const{done:h,value:y}=await o.read();if(h)break;if(y){const k=y instanceof Uint8Array?y:new Uint8Array(y);u.push(k),l+=k.length}}const d=new Uint8Array(l);let f=0;for(const h of u)d.set(h,f),f+=h.length;try{Pn.set(r,d)}catch{}return d}}if(r&&typeof r.arrayBuffer=="function"){const i=await r.arrayBuffer(),n=new Uint8Array(i);try{Pn.set(r,n)}catch{}return n}if(r&&typeof r.text=="function"){const i=await r.text();let n;typeof TextEncoder<"u"?n=new TextEncoder().encode(i):typeof Buffer<"u"?n=new Uint8Array(Buffer.from(i,"utf-8")):n=new Uint8Array;try{Pn.set(r,n)}catch{}return n}if(r&&r.body){if(r.body instanceof Uint8Array){try{Pn.set(r,r.body)}catch{}return r.body}if(typeof Buffer<"u"&&Buffer.isBuffer(r.body)){const i=new Uint8Array(r.body);try{Pn.set(r,i)}catch{}return i}}return new Uint8Array}catch(i){throw i}}async function q0(r){try{const i=await H0(r);try{return new TextDecoder("utf-8",{fatal:!1}).decode(i)}catch{try{return new TextDecoder("iso-8859-1",{fatal:!1}).decode(i)}catch{return V0(i)}}}catch(i){ce.warn("safeReadText: fallback decode failed",i);try{if(r&&typeof r.text=="function")return await r.text()}catch{}return""}}function Q0(r){try{return new URL(r).host}catch{return r}}let nf=!1;async function K0(){if(!nf){nf=!0;try{await Yl.migrateFromLocalStorage()}catch{}}}function fh(r,i,n){try{Yl.saveCredential(r,i,n)}catch(o){ce.warn("saveOpdsCredential failed",o)}}async function zl(r){try{await K0();const i=Q0(r);return await Yl.findCredential(i)}catch{return}}const G0=async(r,i,n=5)=>{let o=0;const u=r,l=await wr(r);try{if(typeof l=="string"&&l.includes("corsproxy.io")&&i){const y=new Error("Acquisition would use a public CORS proxy which may strip Authorization or block POST requests. Configure an owned proxy (VITE_OWN_PROXY_URL) to perform authenticated borrows.");throw y.proxyUsed=!0,y}}catch(h){throw h}try{if(typeof l=="string"&&l.includes("corsproxy.io")&&i){const y=new Error("Acquisition would use a public CORS proxy which may strip Authorization or block POST requests. Configure an owned proxy (VITE_OWN_PROXY_URL) to perform authenticated borrows.");throw y.proxyUsed=!0,y}}catch(h){throw h}try{if(typeof l=="string"&&l.includes("corsproxy.io")&&i){const y=new Error("Acquisition would use a public CORS proxy which may strip Authorization or block POST requests. Configure an owned proxy (VITE_OWN_PROXY_URL) to perform authenticated borrows.");throw y.proxyUsed=!0,y}}catch(h){throw h}const d=(h=!1)=>{const y={Accept:"application/json, text/json, */*"};return h&&i&&(y.Authorization=`Basic ${btoa(`${i.username}:${i.password}`)}`),y},f=!!i;for(;o<n&&l;){o++;let h=null;try{f?(h=await fetch(l,{method:"GET",headers:d(!0)}),h.status===405&&(h=await fetch(l,{method:"POST",headers:d(!0)}))):(h=await fetch(l,{method:"POST",headers:d(!1)}),h.status===405&&(h=await fetch(l,{method:"GET",headers:d(!1)})))}catch(w){throw w}if(!h)return null;if(h.status>=300&&h.status<400){const w=h.headers&&typeof h.headers.get=="function"?h.headers.get("Location")||h.headers.get("location"):null;if(w)return new URL(w,u).href}const y=typeof h.ok=="boolean"?h.ok:h.status>=200&&h.status<300,k=h.headers&&typeof h.headers.get=="function"&&h.headers.get("Content-Type")||"";if(y){if(k.includes("application/json")||k.includes("text/json")||k.includes("application/opds+json")){const x=await h.json().catch(()=>null),b=x?.url||x?.location||x?.href||x?.contentLocation;if(typeof b=="string"&&b.length>0)return new URL(b,u).href;if(Array.isArray(x?.links)){const C=x.links.find(m=>m?.href&&(m.rel==="content"||m.rel==="self"||String(m.rel).includes("acquisition")));if(C?.href)return new URL(C.href,l).href}}const w=h.headers.get("Location")||h.headers.get("location");if(w)return new URL(w,u).href;if(k.includes("application/epub")||k.includes("application/pdf")||k.includes("application/octet-stream"))return u}if(h.status===401||h.status===403){const w=await q0(h).catch(()=>"");let x=null;try{(h.headers.get&&(h.headers.get("Content-Type")||"").includes("application/vnd.opds.authentication.v1.0+json")||w.trim().startsWith("{"))&&(x=JSON.parse(w))}catch{x=null}const b=new Error(`Acquisition requires authentication: ${h.status} ${h.statusText}`);b.status=h.status,x&&(b.authDocument=x);try{typeof l=="string"&&(l.includes("corsproxy.io")||l.includes("/proxy?url="))&&(b.proxyUsed=!0)}catch{}throw b}break}return null},sf="93993206222-19e48jq3thrh262a7kbq239j9212kdea.apps.googleusercontent.com",of="https://www.googleapis.com/auth/drive.file",hh="Custom Ebook Reader Library",ph="books",Ml="library.json";let Z0=!1,af=!1,jl=null;const lf=(r,i)=>new Promise(n=>{const o=setInterval(()=>{window[r]&&(i?window[r][i]&&(clearInterval(o),n(window[r])):(clearInterval(o),n(window[r])))},100)}),X0=r=>new Promise(async(i,n)=>{try{if(await Promise.all([lf("gapi","client"),lf("google","accounts")]),af){i(jl);return}jl=window.google.accounts.oauth2.initTokenClient({client_id:sf,scope:of,callback:r}),af=!0,window.gapi.load("client",async()=>{await window.gapi.client.init({clientId:sf,scope:of,discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]}),Z0=!0,i(jl)})}catch(o){ce.error("Error during Google Client initialization:",o),n(o)}}),Y0=r=>{window.google.accounts.oauth2.revoke(r,()=>{ce.info("Access token revoked.")})},Co=async(r,i)=>{const n=`mimeType='application/vnd.google-apps.folder' and name='${r}' and trashed=false`+(i?` and '${i}' in parents`:""),o=await window.gapi.client.drive.files.list({q:n});if(o.result.files&&o.result.files.length>0)return o.result.files[0].id;{const u={name:r,mimeType:"application/vnd.google-apps.folder",...i&&{parents:[i]}};return(await window.gapi.client.drive.files.create({resource:u,fields:"id"})).result.id}},cf=async(r,i,n,o)=>{const u={name:i,parents:[r]},l=new FormData;l.append("metadata",new Blob([JSON.stringify(u)],{type:"application/json"})),l.append("file",new Blob([n],{type:o}));const f=await(await fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",headers:new Headers({Authorization:`Bearer ${window.gapi.client.getToken().access_token}`}),body:l})).json();if(f.error)throw new Error(f.error.message);return f.id},J0=async(r,i,n)=>{const u=await(await fetch(`https://www.googleapis.com/upload/drive/v3/files/${r}?uploadType=media`,{method:"PATCH",headers:new Headers({Authorization:`Bearer ${window.gapi.client.getToken().access_token}`,"Content-Type":n}),body:i})).json();if(u.error)throw new Error(u.error.message);return u},ey=async(r,i,n)=>{const o=await Co(hh);localStorage.setItem("ebook-reader-drive-folder-id",o),n(`Uploading ${i.length} book files...`);const u=await Co(ph,o),l=i.map(async(y,k)=>{n(`Uploading book ${k+1}/${i.length}: ${y.title}`);const w=(y.format||"epub").toLowerCase(),x=w==="pdf"?"application/pdf":"application/epub+zip",b=`${y.id}.${w}`;await cf(u,b,y.epubData,x)});await Promise.all(l),n("Uploading library metadata...");const d=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),f=`'${o}' in parents and name='${Ml}' and trashed=false`,h=await window.gapi.client.drive.files.list({q:f});if(h.result.files&&h.result.files.length>0){const y=h.result.files[0].id;await J0(y,d,"application/json")}else await cf(o,Ml,d,"application/json");n("Upload complete!")},ty=async r=>{r("Finding app folder in Drive...");const i=await Co(hh);r("Downloading library metadata...");const n=`'${i}' in parents and name='${Ml}' and trashed=false`,o=await window.gapi.client.drive.files.list({q:n});if(!o.result.files||o.result.files.length===0)return null;const u=o.result.files[0].id,l=await window.gapi.client.drive.files.get({fileId:u,alt:"media"}),d=JSON.parse(l.body);r("Finding books subfolder...");const f=await Co(ph,i),h=[];for(let y=0;y<d.library.length;y++){const k=d.library[y];if(!k.id){console.warn(`Book metadata for "${k.title}" is missing an ID, skipping download.`);continue}r(`Downloading book ${y+1}/${d.library.length}: ${k.title}`);const w=(k.format||"epub").toLowerCase(),x=`${k.id}.${w}`,b=`'${f}' in parents and name='${x}' and trashed=false`,C=await window.gapi.client.drive.files.list({q:b});if(C.result.files&&C.result.files.length>0){const m=C.result.files[0].id,S=window.gapi.client.getToken().access_token,j=await fetch(`https://www.googleapis.com/drive/v3/files/${m}?alt=media`,{headers:{Authorization:`Bearer ${S}`}});if(!j.ok){console.warn(`Failed to download book file for "${k.title}" (ID: ${k.id}). Status: ${j.statusText}`);continue}const _=await j.arrayBuffer(),L={...k,epubData:_};h.push(L)}else console.warn(`Book file for "${k.title}" (ID: ${k.id}, filename: ${x}) not found in Drive.`)}return r("Download complete!"),{payload:d,booksWithData:h}},ai=(r,i)=>{if(!r)return i;try{return JSON.parse(r)}catch(n){return console.warn("Failed to parse JSON from storage, using fallback",n),i}},uf={fontSize:100,theme:"light",flow:"paginated",fontFamily:"Original",citationFormat:"apa",readAloud:{voiceURI:null,rate:.9,pitch:1,volume:1}},df=()=>{const r=localStorage.getItem(fn.GLOBAL_SETTINGS),i=ai(r,{});return{...uf,...i,readAloud:{...uf.readAloud,...i.readAloud||{}}}},ff=r=>{localStorage.setItem(fn.GLOBAL_SETTINGS,JSON.stringify(r))},Rv=r=>{const i=localStorage.getItem(yt.bookmarks(r));return ai(i,[])},Av=(r,i)=>{localStorage.setItem(yt.bookmarks(r),JSON.stringify(i))},Tv=r=>{const i=localStorage.getItem(yt.citations(r));return ai(i,[])},Pv=(r,i)=>{localStorage.setItem(yt.citations(r),JSON.stringify(i))},Ov=r=>localStorage.getItem(yt.position(r)),Lv=(r,i)=>{localStorage.setItem(yt.position(r),i)},ry=async(r,i)=>{if(!i||!r)return[];const n=r.spine.spineItems.map(u=>u.load(r.load.bind(r)).then(()=>{const l=u.find(i.trim());return u.unload(),Promise.resolve(l)}).catch(()=>(u.unload(),Promise.resolve([])))),o=await Promise.all(n);return[].concat(...o)},ny=async r=>{try{if(r.navigation&&Array.isArray(r.navigation.landmarks)&&r.navigation.landmarks.length>0){const i=r.navigation.landmarks.find(n=>(n.type||"").toString().toLowerCase().includes("bodymatter"));if(i&&i.href)return i.href}}catch(i){console.warn("Error reading navigation landmarks when finding first chapter",i)}try{if(r.packaging&&Array.isArray(r.packaging.guide)&&r.packaging.guide.length>0){const i=r.packaging.guide.find(n=>(n.type||"").toString().toLowerCase().includes("text"));if(i&&i.href)return i.href}}catch(i){console.warn("Error reading packaging guide when finding first chapter",i)}if(r.spine&&Array.isArray(r.spine.items)){for(const i of r.spine.items)try{if(r.spine.get){const n=await r.spine.get(i.href);if(!n)continue;const u=(await n.load())?.body;let l=!1;if(u&&(u.textContent||"").trim().length>300&&(l=!0),n.unload(),l)return i.href}else return i.href}catch(n){console.warn(`Could not parse section ${i.href} when searching for first chapter. Skipping.`,n)}return r.spine.items.length>0?r.spine.items[0].href:void 0}},hf=r=>{const i=[];try{if(r&&r.spine&&Array.isArray(r.spine.items))for(let n=0;n<r.spine.items.length;n++){const o=r.spine.items[n],u=o.href||o.idref||`item-${n}`,l=o.id||(o.href?o.href.split("#")[0].split("/").pop():`Section ${n+1}`)||`Section ${n+1}`;i.push({id:`${n}`,href:u,label:l})}}catch(n){console.warn("Failed to build fallback TOC from spine",n)}return i},Iv=r=>{try{const i=localStorage.getItem(yt.pdfViewState(r));return ai(i,{zoomPercent:100,fitMode:"page"})}catch(i){return console.warn("Failed to read pdf view state",i),{zoomPercent:100,fitMode:"page"}}},Dv=(r,i)=>{try{localStorage.setItem(yt.pdfViewState(r),JSON.stringify(i))}catch(n){console.warn("Failed to save pdf view state",n)}},sy=r=>{try{const i=localStorage.getItem(yt.epubViewState(r));return ai(i,{})}catch(i){return console.warn("Failed to read epub view state",i),{}}},iy=(r,i)=>{try{localStorage.setItem(yt.epubViewState(r),JSON.stringify(i))}catch(n){console.warn("Failed to save epub view state",n)}};function jo(r,i){const[n,o]=P.useState(()=>{try{const l=localStorage.getItem(r);return l?JSON.parse(l):i}catch(l){return ce.error(`Error reading localStorage key "${r}":`,l),i}});P.useEffect(()=>{try{localStorage.setItem(r,JSON.stringify(n))}catch(l){ce.error(`Error writing to localStorage key "${r}":`,l)}},[r,n]);const u=P.useCallback(()=>{try{localStorage.removeItem(r),o(i)}catch(l){ce.error(`Error removing localStorage key "${r}":`,l)}},[r,i]);return[n,o,u]}function oy(){const[r,i]=jo(Yd.CATALOGS,[]),[n,o]=jo(Yd.REGISTRIES,[]);P.useEffect(()=>{if(r.some(w=>!w.opdsVersion)){const w=r.map(x=>x.opdsVersion?x:{...x,opdsVersion:"auto"});i(w)}},[r,i]);const u=P.useCallback((k,w,x="auto")=>{const b={id:new Date().toISOString(),name:k,url:w,opdsVersion:x};return i(C=>[...C,b]),b},[i]),l=P.useCallback(k=>{i(w=>w.filter(x=>x.id!==k))},[i]),d=P.useCallback((k,w)=>{i(x=>x.map(b=>b.id===k?{...b,...w}:b))},[i]),f=P.useCallback((k,w)=>{const x={id:new Date().toISOString(),name:k,url:w};return o(b=>[...b,x]),x},[o]),h=P.useCallback(k=>{o(w=>w.filter(x=>x.id!==k))},[o]),y=P.useCallback((k,w)=>{o(x=>x.map(b=>b.id===k?{...b,...w}:b))},[o]);return{catalogs:r,registries:n,addCatalog:u,deleteCatalog:l,updateCatalog:d,addRegistry:f,deleteRegistry:h,updateRegistry:y}}function ay(r,i){return P.useMemo(()=>{const n=[...r],[o,u]=i.split("-");return n.sort((l,d)=>{let f,h;switch(o){case"title":f=l.title.toLowerCase(),h=d.title.toLowerCase();break;case"author":f=l.author.toLowerCase(),h=d.author.toLowerCase();break;case"pubdate":f=l.publicationDate?new Date(l.publicationDate).getTime():0,h=d.publicationDate?new Date(d.publicationDate).getTime():0,isNaN(f)&&(f=0),isNaN(h)&&(h=0);break;case"added":default:f=l.id,h=d.id;break}return f<h?u==="asc"?-1:1:f>h?u==="asc"?1:-1:0}),n},[r,i])}const ly=[{key:"added-desc",label:"Recently Added"},{key:"title-asc",label:"Title (A-Z)"},{key:"title-desc",label:"Title (Z-A)"},{key:"author-asc",label:"Author (A-Z)"},{key:"author-desc",label:"Author (Z-A)"},{key:"pubdate-desc",label:"Publication Date (Newest)"},{key:"pubdate-asc",label:"Publication Date (Oldest)"}];class cy{constructor(){this.dbInstance=null}async init(){return this.dbInstance?this.dbInstance:new Promise((i,n)=>{const o=indexedDB.open(nh,sh);o.onerror=()=>{ce.error("IndexedDB error:",o.error),n(new Error("Failed to open IndexedDB"))},o.onsuccess=()=>{this.dbInstance=o.result,i(this.dbInstance)},o.onupgradeneeded=u=>{const l=u.target.result;let d;if(!l.objectStoreNames.contains(Ge))d=l.createObjectStore(Ge,{keyPath:"id",autoIncrement:!0}),d.createIndex(Mt.TITLE,Mt.TITLE,{unique:!1});else{const f=u.target.transaction;if(f)d=f.objectStore(Ge);else return}u.oldVersion<2&&(d.indexNames.contains(Mt.ISBN)||d.createIndex(Mt.ISBN,Mt.ISBN,{unique:!1})),u.oldVersion<3&&(d.indexNames.contains(Mt.PROVIDER_ID)||d.createIndex(Mt.PROVIDER_ID,Mt.PROVIDER_ID,{unique:!1}))}})}async save(i){try{const n=await this.init(),o=await new Promise((u,l)=>{const h=n.transaction(Ge,"readwrite").objectStore(Ge).put(i);h.onsuccess=()=>{u(h.result)},h.onerror=()=>{ce.error("Error saving book:",h.error),l(new Error("Failed to save book"))}});return ce.info(`Book saved successfully with ID: ${o}`),{success:!0,data:o}}catch(n){const o=n instanceof Error?n.message:"Unknown error saving book";return ce.error("BookRepository.save error:",o),{success:!1,error:o}}}async findById(i){try{const n=await this.init();return{success:!0,data:await new Promise((u,l)=>{const h=n.transaction(Ge,"readonly").objectStore(Ge).get(i);h.onsuccess=()=>{u(h.result)},h.onerror=()=>{ce.error("Error getting book:",h.error),l(new Error("Failed to get book"))}})||null}}catch(n){const o=n instanceof Error?n.message:"Unknown error finding book";return ce.error("BookRepository.findById error:",o),{success:!1,error:o}}}async findMetadataById(i){try{const n=await this.findById(i);if(!n.success)return{success:!1,error:"Failed to find book metadata"};if(!n.data)return{success:!0,data:null};const o=n.data;return{success:!0,data:{id:o.id,title:o.title,author:o.author,coverImage:o.coverImage,publisher:o.publisher,publicationDate:o.publicationDate,isbn:o.isbn,providerId:o.providerId,providerName:o.providerName,distributor:o.distributor,description:o.description,subjects:o.subjects,format:o.format,language:o.language,rights:o.rights,identifiers:o.identifiers,opfRaw:o.opfRaw,accessModes:o.accessModes,accessModesSufficient:o.accessModesSufficient,accessibilityFeatures:o.accessibilityFeatures,hazards:o.hazards,accessibilitySummary:o.accessibilitySummary,certificationConformsTo:o.certificationConformsTo,certification:o.certification,accessibilityFeedback:o.accessibilityFeedback}}}catch(n){const o=n instanceof Error?n.message:"Unknown error finding metadata";return ce.error("BookRepository.findMetadataById error:",o),{success:!1,error:o}}}async findAll(){try{const i=await this.init();return{success:!0,data:await new Promise((o,u)=>{const f=i.transaction(Ge,"readonly").objectStore(Ge).getAll();f.onsuccess=()=>{o(f.result)},f.onerror=()=>{ce.error("Error getting all books:",f.error),u(new Error("Failed to get all books"))}})}}catch(i){const n=i instanceof Error?i.message:"Unknown error finding all books";return ce.error("BookRepository.findAll error:",n),{success:!1,error:n}}}async findAllMetadata(){try{const i=await this.init(),n=await new Promise((o,u)=>{const f=i.transaction(Ge,"readonly").objectStore(Ge).openCursor(),h=[];f.onsuccess=y=>{const k=y.target.result;k?(h.push({...k.value}),k.continue()):(console.log("[BookRepository.findAllMetadata] Loaded metadata:",h),o(h))},f.onerror=()=>{ce.error("Error getting books metadata:",f.error),u(new Error("Failed to get books metadata"))}});return console.log("[BookRepository.findAllMetadata] Returning books:",n),{success:!0,data:n}}catch(i){const n=i instanceof Error?i.message:"Unknown error finding all metadata";return ce.error("BookRepository.findAllMetadata error:",n),{success:!1,error:n}}}async findByIdentifier(i){if(!i)return{success:!0,data:null};try{const n=await this.init(),o=async d=>new Promise((f,h)=>{try{const k=n.transaction(Ge,"readonly").objectStore(Ge);if(!k.indexNames.contains(d)){f(null);return}const x=k.index(d).get(i);x.onsuccess=()=>{f(x.result||null)},x.onerror=()=>{ce.error(`Error finding book by ${d}:`,x.error),h(new Error(`Failed to find book by ${d}`))}}catch(y){ce.error(`Error initiating search on index ${d}:`,y),f(null)}}),u=await o("providerId");return u?{success:!0,data:u}:{success:!0,data:await o("isbn")}}catch(n){const o=n instanceof Error?n.message:"Unknown error finding by identifier";return ce.error("BookRepository.findByIdentifier error:",o),{success:!1,error:o}}}async delete(i){try{const n=await this.init();return await new Promise((o,u)=>{const f=n.transaction(Ge,"readwrite").objectStore(Ge).delete(i);f.onsuccess=()=>{o()},f.onerror=()=>{ce.error("Error deleting book:",f.error),u(new Error("Failed to delete book"))}}),ce.info(`Book deleted successfully: ${i}`),{success:!0,data:void 0}}catch(n){const o=n instanceof Error?n.message:"Unknown error deleting book";return ce.error("BookRepository.delete error:",o),{success:!1,error:o}}}async deleteAll(){try{const i=await this.init();return await new Promise((n,o)=>{const d=i.transaction(Ge,"readwrite").objectStore(Ge).clear();d.onsuccess=()=>{n()},d.onerror=()=>{ce.error("Error clearing all books:",d.error),o(new Error("Failed to clear all books"))}}),ce.warn("All books cleared from library"),{success:!0,data:void 0}}catch(i){const n=i instanceof Error?i.message:"Unknown error clearing all books";return ce.error("BookRepository.deleteAll error:",n),{success:!1,error:n}}}async update(i,n){try{const o=await this.findById(i);if(!o.success)return{success:!1,error:"Failed to find book for update"};if(!o.data)return{success:!1,error:"Book not found"};const u={...o.data,...n,id:i};return(await this.save(u)).success?{success:!0,data:void 0}:{success:!1,error:"Failed to save updated book"}}catch(o){const u=o instanceof Error?o.message:"Unknown error updating book";return ce.error("BookRepository.update error:",u),{success:!1,error:u}}}async exists(i){const n=await this.findByIdentifier(i);return n.success?{success:!0,data:n.data!==null}:{success:!1,error:"Failed to check if book exists"}}async count(){try{const i=await this.init();return{success:!0,data:await new Promise((o,u)=>{const f=i.transaction(Ge,"readonly").objectStore(Ge).count();f.onsuccess=()=>{o(f.result)},f.onerror=()=>{ce.error("Error counting books:",f.error),u(new Error("Failed to count books"))}})}}catch(i){const n=i instanceof Error?i.message:"Unknown error counting books";return ce.error("BookRepository.count error:",n),{success:!1,error:n}}}}const No=new cy,Jl={all:["books"],detail:r=>["books",r],metadata:r=>["books",r,"metadata"]};function uy(){return Df({queryKey:Jl.all,queryFn:async()=>{const r=await No.findAllMetadata();if(r.success)return r.data;{const i=r.error;throw ce.error("Failed to fetch books from repository:",i),new Error(i)}}})}function dy(){const r=Eo();return lg({mutationFn:async i=>{const n=await No.delete(i);if(!n.success){const o=n.error;throw ce.error(`Failed to delete book ${i}:`,o),new Error(o)}},onSuccess:()=>{r.invalidateQueries({queryKey:Jl.all})}})}const fy={all:["catalogs"],content:(r,i,n)=>["catalogs","content",r,i,n]};function hy(r,i,n="auto",o=!0){return Df({queryKey:fy.content(r||"",i,n),queryFn:async()=>{if(!r)return{books:[],navLinks:[],pagination:{},error:"No URL provided"};ce.debug(`[useCatalogContent] Fetching: ${r}`);const u=(()=>{try{return new URL(r).hostname.toLowerCase()}catch{return""}})(),d=u.endsWith("palace.io")||u.endsWith("palaceproject.io")||u==="palace.io"||u.endsWith(".palace.io")?"1":n,f=await T0(r,i,d),h=f.navLinks.length>0&&f.books.length===0;let y=f.navLinks;if(h&&f.pagination){const k=Object.values(f.pagination).filter(w=>!!w);y=f.navLinks.filter(w=>!k.includes(w.url))}return{books:f.books,navLinks:y,pagination:f.pagination,error:f.error}},enabled:o&&!!r,staleTime:120*1e3})}function py(r={}){const{enableArrowKeys:i=!1,enableActivation:n=!1,enableEscape:o=!1,onArrowKey:u,onActivate:l,onEscape:d,preventDefault:f=!0,stopPropagation:h=!1}=r,y=P.useRef(u),k=P.useRef(l),w=P.useRef(d);P.useEffect(()=>{y.current=u,k.current=l,w.current=d},[u,l,d]);const x=P.useCallback(b=>{if(i&&y.current){let C=null;switch(b.key){case"ArrowUp":C="up";break;case"ArrowDown":C="down";break;case"ArrowLeft":C="left";break;case"ArrowRight":C="right";break}if(C){f&&b.preventDefault(),h&&b.stopPropagation(),y.current(C,b);return}}if(n&&k.current&&(b.key==="Enter"||b.key===" ")){f&&b.preventDefault(),h&&b.stopPropagation(),k.current(b);return}if(o&&w.current&&b.key==="Escape"){f&&b.preventDefault(),h&&b.stopPropagation(),w.current(b);return}},[i,n,o,f,h]);P.useEffect(()=>(window.addEventListener("keydown",x),()=>{window.removeEventListener("keydown",x)}),[x])}function br(r){const{isActive:i,initialFocusRef:n,returnFocusRef:o,onEscape:u}=r,l=P.useRef(null),d=P.useRef(null),f=P.useCallback(y=>{const k=["a[href]","button:not([disabled])","textarea:not([disabled])","input:not([disabled])","select:not([disabled])",'[tabindex]:not([tabindex="-1"])',"[contenteditable]"].join(",");return Array.from(y.querySelectorAll(k)).filter(x=>x.offsetParent!==null&&getComputedStyle(x).visibility!=="hidden")},[]),h=P.useCallback(y=>{if(l.current){if(y.key==="Escape"&&u){y.preventDefault(),u();return}if(y.key==="Tab"){const k=f(l.current);if(k.length===0){y.preventDefault();return}const w=k[0],x=k[k.length-1];if(y.shiftKey&&document.activeElement===w){y.preventDefault(),x.focus();return}if(!y.shiftKey&&document.activeElement===x){y.preventDefault(),w.focus();return}}}},[f,u]);return P.useEffect(()=>{if(!i||!l.current)return;d.current=document.activeElement;const y=f(l.current);n?.current?n.current.focus():y.length>0&&y[0].focus();const k=l.current;return k&&k.addEventListener("keydown",h),()=>{k&&k.removeEventListener("keydown",h),o?.current?o.current.focus():d.current&&d.current.focus()}},[i,n,o,f,h]),l}function my(r){const{shortcuts:i,enabled:n=!0,preventInInputs:o=!0}=r,u=P.useRef(i);P.useEffect(()=>{u.current=i},[i]);const l=P.useCallback(d=>{if(!n)return;if(o){const h=d.target,y=h.tagName.toLowerCase();if(y==="input"||y==="textarea"||h.isContentEditable)return}const f=u.current.find(h=>{if(h.enabled===!1||!(d.key===h.key))return!1;const k=h.ctrl?d.ctrlKey||d.metaKey:!d.ctrlKey&&!d.metaKey,w=h.shift?d.shiftKey:!d.shiftKey,x=h.alt?d.altKey:!d.altKey;return k&&w&&x});f&&(f.preventDefault&&d.preventDefault(),f.action(d))},[n,o]);P.useEffect(()=>{if(n)return window.addEventListener("keydown",l),()=>{window.removeEventListener("keydown",l)}},[n,l])}function gy(r){const i=typeof navigator<"u"&&navigator.platform.toUpperCase().includes("MAC"),n=[];r.ctrl&&n.push(i?"⌘":"Ctrl"),r.shift&&n.push(i?"⇧":"Shift"),r.alt&&n.push(i?"⌥":"Alt");let o=r.key;return o===" "?o="Space":o==="ArrowLeft"?o="←":o==="ArrowRight"?o="→":o==="ArrowUp"?o="↑":o==="ArrowDown"?o="↓":o==="Escape"&&(o="Esc"),n.push(o),n.join(i?"":"+")}const mh=({isOpen:r,onClose:i,onReplace:n,onAddAnyway:o,bookTitle:u})=>{const l=br({isActive:r,onEscape:i});return r?a.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:i,"aria-modal":"true",role:"dialog",children:a.jsxs("div",{ref:l,className:"bg-slate-800 rounded-lg shadow-xl w-full max-w-md p-6 text-white",onClick:d=>d.stopPropagation(),children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h2",{className:"text-xl font-bold text-yellow-300",children:"Duplicate Book Found"}),a.jsx("button",{onClick:i,className:"p-2 rounded-full hover:bg-slate-700 transition-colors","aria-label":"Close",children:a.jsx(ir,{className:"w-6 h-6"})})]}),a.jsxs("p",{className:"text-slate-300 mb-6 text-sm",children:['The book "',a.jsx("strong",{className:"font-semibold text-slate-100",children:u}),'" is already in your library. What would you like to do?']}),a.jsxs("div",{className:"flex flex-col gap-3",children:[a.jsx("button",{onClick:n,className:"w-full py-2.5 px-4 rounded-md bg-sky-500 hover:bg-sky-600 transition-colors font-bold",children:"Replace Existing"}),a.jsx("button",{onClick:o,className:"w-full py-2.5 px-4 rounded-md bg-slate-600 hover:bg-slate-500 transition-colors font-semibold",children:"Add as New Copy"}),a.jsx("button",{onClick:i,className:"w-full py-2 px-4 text-sm text-slate-400 hover:text-white transition-colors",children:"Cancel Import"})]})]})}):null},gh=({isOpen:r,host:i,authDocument:n,onClose:o,onSubmit:u,onOpenAuthLink:l,onRetry:d,probeUrl:f})=>{const[h,y]=P.useState(""),[k,w]=P.useState(""),[x,b]=P.useState(!1);P.useEffect(()=>{if(!r){y(""),w(""),b(!1);return}const $=n?.username_hint||n?.username||n?.suggested_username||"",z=n?.password_hint||"";$&&y(String($)),z&&w("")},[r]);const[C,m]=P.useState(!1),[S,j]=P.useState(!1),_=P.useRef(null);P.useEffect(()=>()=>{if(_.current){try{window.clearInterval(_.current)}catch{}_.current=null}},[]);const L=br({isActive:r,onEscape:o});if(!r)return null;const U=n?.realm||n?.title||null,M=n?.description||n?.instructions||null,re=n?.logo||n?.image||null,J=Array.isArray(n?.links)?n.links:[];return a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900 bg-opacity-75 p-4",children:a.jsxs("div",{ref:L,className:"bg-slate-800 p-6 rounded-lg max-w-md w-full text-white",children:[a.jsxs("div",{className:"flex items-start gap-4 mb-2",children:[re&&a.jsx("img",{src:re,alt:"provider logo",className:"w-12 h-12 object-contain"}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold",children:U?`Login to ${U}`:"Authentication required"}),a.jsxs("p",{className:"text-sm text-slate-300",children:["This catalog at ",a.jsx("span",{className:"font-mono",children:i})," requires credentials to access the requested content."]})]}),C&&a.jsx("div",{className:"mb-3 text-sm text-slate-300",children:"Waiting for provider sign-in to complete... This may take a minute."}),S&&a.jsxs("div",{className:"mb-3 text-sm text-emerald-300 flex items-center justify-between",children:[a.jsx("span",{children:"Direct access appears to be available. You can retry the acquisition now."}),a.jsx("div",{className:"ml-4",children:a.jsx("button",{onClick:()=>{if(_.current){try{window.clearInterval(_.current)}catch{}_.current=null}m(!1),typeof d=="function"&&d()},className:"px-3 py-1 rounded bg-emerald-600 hover:bg-emerald-500 text-white",children:"Retry now"})})]})]}),M&&a.jsx("p",{className:"text-sm text-slate-300 mb-4",children:M}),J.length>0&&a.jsxs("div",{className:"mb-4 text-sm text-slate-300",children:[a.jsx("div",{className:"font-semibold mb-1",children:"Authentication Links"}),a.jsx("ul",{className:"list-disc list-inside",children:J.map(($,z)=>a.jsxs("li",{children:[a.jsx("a",{className:"text-sky-400",href:$.href,target:"_blank",rel:"noreferrer",children:$.title||$.href})," ",$.rel?a.jsxs("span",{className:"text-xs text-slate-400",children:["(",$.rel,")"]}):null]},z))})]}),J.length>0&&a.jsx("div",{className:"mb-4 flex gap-2",children:J.map(($,z)=>($.rel||"").toString().includes("authenticate")?a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("button",{type:"button",onClick:async()=>{let ae=null;try{ae=window.open($.href,"_blank","noopener")}catch{ae=null}typeof l=="function"&&l($.href);try{if(!ae||typeof window>"u"||typeof wr!="function")return;m(!0),j(!1);let F=0;const te=30,N=f||$.href;_.current=window.setInterval(async()=>{F+=1;try{await wr(N)===N&&(j(!0),m(!1),_.current&&(window.clearInterval(_.current),_.current=null))}catch{}F>=te&&(m(!1),_.current&&(window.clearInterval(_.current),_.current=null))},2e3)}catch{}},className:"px-3 py-2 rounded bg-emerald-600 hover:bg-emerald-500 text-white",children:"Open sign-in page"})},z):null)}),a.jsx("label",{htmlFor:"opds-username",className:"block text-sm text-slate-300 mb-1",children:"Username"}),a.jsx("input",{id:"opds-username","aria-label":"username",placeholder:n?.username_placeholder||"Username",value:h,onChange:$=>y($.target.value),className:"w-full mb-3 p-2 rounded bg-slate-900 border border-slate-700 text-white"}),a.jsx("label",{htmlFor:"opds-password",className:"block text-sm text-slate-300 mb-1",children:"Password"}),a.jsx("input",{id:"opds-password","aria-label":"password",placeholder:n?.password_placeholder||"Password",type:"password",value:k,onChange:$=>w($.target.value),className:"w-full mb-3 p-2 rounded bg-slate-900 border border-slate-700 text-white"}),n?.username_hint&&a.jsxs("div",{className:"text-xs text-slate-400 mb-2",children:["Hint: ",n.username_hint]}),n?.password_hint&&a.jsxs("div",{className:"text-xs text-slate-400 mb-2",children:["Password: ",n.password_hint]}),a.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx("input",{id:"saveCred",type:"checkbox",checked:x,onChange:$=>b($.target.checked)}),a.jsx("label",{htmlFor:"saveCred",className:"text-sm text-slate-300",children:"Save credential for this host"})]}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx("button",{onClick:o,className:"px-4 py-2 rounded bg-slate-700 hover:bg-slate-600",children:"Cancel"}),typeof d=="function"&&a.jsx("button",{onClick:()=>d(),className:"px-4 py-2 rounded bg-yellow-600 hover:bg-yellow-500",children:"Retry"}),a.jsx("button",{onClick:()=>u(h,k,x),className:"px-4 py-2 rounded bg-sky-500 hover:bg-sky-600",children:"Continue"})]})]})})},Fn=({text:r,size:i="medium"})=>{const n=i==="small"?"h-5 w-5 border-2":"h-12 w-12 border-b-2",o=i==="small"?"text-sm":"text-base";return a.jsxs("div",{className:"flex flex-col items-center justify-center space-y-2",role:"status","aria-live":"polite","aria-busy":"true",children:[a.jsx("div",{className:`animate-spin rounded-full border-sky-400 ${n}`,"aria-hidden":"true"}),r&&a.jsx("p",{className:`text-sky-300 ${o}`,children:r}),!r&&a.jsx("span",{className:"sr-only",children:"Loading..."})]})},yh=P.createContext(void 0),yy=({children:r})=>{const[i,n]=P.useState([]),o=P.useRef({}),u=P.useCallback(d=>{if(n(f=>f.filter(h=>h.id!==d)),o.current[d]){try{window.clearTimeout(o.current[d])}catch{}delete o.current[d]}},[]),l=P.useCallback((d,f=4e3,h,y)=>{const k=`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;n(x=>[...x,{id:k,message:d,actionLabel:h,action:y}]);const w=window.setTimeout(()=>u(k),f);return o.current[k]=w,k},[u]);return P.useEffect(()=>()=>{Object.values(o.current).forEach(d=>{try{window.clearTimeout(d)}catch{}}),o.current={}},[]),a.jsx(yh.Provider,{value:{toasts:i,pushToast:l,removeToast:u},children:r})},ec=()=>{const r=P.useContext(yh);return r||{toasts:[],pushToast:(i,n,o,u)=>{try{return`${Date.now().toString(36)}-noop`}catch{return"noop"}},removeToast:i=>{}}},vy=r=>r.replace(/<script[^>]*>.*?<\/script>/gi,"").replace(/<iframe[^>]*>.*?<\/iframe>/gi,"").replace(/<object[^>]*>.*?<\/object>/gi,"").replace(/<embed[^>]*>/gi,"").replace(/on\w+\s*=\s*["'][^"']*["']/gi,"").replace(/javascript:/gi,"").replace(/data:/gi,"").replace(/<([^>]+)\s+style\s*=\s*["'][^"']*["']/gi,"<$1").trim(),Js=r=>"id"in r&&typeof r.id=="number",xy=r=>{const i=new Date(r);if(isNaN(i.getTime()))return r;const n=r.trim();return/^\d{4}$/.test(n)?i.getUTCFullYear().toString():/^\d{4}-\d{2}$/.test(n)?i.toLocaleDateString("en-US",{year:"numeric",month:"long",timeZone:"UTC"}):i.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",timeZone:"UTC"})},wy=({book:r,source:i,catalogName:n,onBack:o,onReadBook:u,onImportFromCatalog:l,importStatus:d,setImportStatus:f})=>{const h=ps.useRef(null),[y,k]=P.useState(!1),[w,x]=P.useState(null),[b,C]=P.useState(null),[m,S]=P.useState(!1),[j,_]=P.useState(null),[L,U]=P.useState(void 0),[M,re]=P.useState(null),J=ec(),$=Js(r)?r:null,z=Js(r)?null:r,Q="description"in r?r.description:z?.summary,ae=Q?vy(Q):"",F=ae&&ae.length>400,te=r.coverImage?r.coverImage:null,N=r.providerId||r.isbn,K=Js(r)?r.providerName:r.distributor,ge="format"in r&&r.format||(Js(r)?"EPUB":void 0),ne=()=>{if($?.id&&h.current){const se=h.current.getBoundingClientRect(),we={rect:{x:se.x,y:se.y,width:se.width,height:se.height,top:se.top,right:se.right,bottom:se.bottom,left:se.left},coverImage:$.coverImage};u($.id,we,$.format||"EPUB")}},le=async()=>{if(z){const se=z.acquisitionMediaType||"";if(se?["application/adobe+epub","application/pdf+lcp","application/vnd.readium.license.status.v1.0+json"].some(je=>se.includes(je)):!1){f({isLoading:!0,message:"Resolving acquisition...",error:null}),re(z);try{const je=await zl(z.downloadUrl);let Te=null;if(je)try{Te=await ti(z.downloadUrl,{username:je.username,password:je.password});try{J.pushToast("Using saved credentials",3e3)}catch{}}catch{Te=null}if(Te||(Te=await ti(z.downloadUrl,null)),Te){const Fe={...z,downloadUrl:Te},He=await l(Fe,n);!He.success&&He.bookRecord&&He.existingBook&&(x(He.bookRecord),C(He.existingBook))}else f({isLoading:!1,message:"",error:"Could not resolve acquisition link."})}catch(je){if(je&&je.authDocument)_(z.providerName||new URL(z.downloadUrl).host),U(je.authDocument),S(!0);else if(f({isLoading:!1,message:"",error:je?.message||"Failed to resolve acquisition."}),je&&je.proxyUsed)try{J.pushToast("Borrow failed through public CORS proxy. Configure VITE_OWN_PROXY_URL to use an owned proxy that preserves Authorization.",8e3)}catch{}}re(null);return}const xe=await l(z,n);!xe.success&&xe.bookRecord&&xe.existingBook&&(x(xe.bookRecord),C(xe.existingBook))}},ie=async(se,we,Ee)=>{if(S(!1),!!M){f({isLoading:!0,message:"Retrying acquisition with credentials...",error:null});try{const xe={username:se,password:we};Ee&&j&&fh(j,se,we);const je=await ti(M.downloadUrl,xe);if(je){const Te={...M,downloadUrl:je},Fe=await l(Te,n);!Fe.success&&Fe.bookRecord&&Fe.existingBook&&(x(Fe.bookRecord),C(Fe.existingBook))}else f({isLoading:!1,message:"",error:"Could not resolve acquisition link with provided credentials."})}catch(xe){if(f({isLoading:!1,message:"",error:xe?.message||"Failed to resolve acquisition with credentials."}),xe&&xe.proxyUsed)try{J.pushToast("Borrow failed through public CORS proxy. Configure VITE_OWN_PROXY_URL to use an owned proxy that preserves Authorization.",8e3)}catch{}}}},ue=se=>{try{window.open(se,"_blank","noopener")}catch{}},A=async()=>{if(M){f({isLoading:!0,message:"Retrying acquisition...",error:null});try{const se=await ti(M.downloadUrl,null);if(se){const we={...M,downloadUrl:se},Ee=await l(we,n);!Ee.success&&Ee.bookRecord&&Ee.existingBook&&(x(Ee.bookRecord),C(Ee.existingBook))}else f({isLoading:!1,message:"",error:"Could not resolve acquisition link."})}catch(se){if(se&&se.authDocument)U(se.authDocument),S(!0);else if(f({isLoading:!1,message:"",error:se?.message||"Failed to resolve acquisition."}),se&&se.proxyUsed)try{J.pushToast("Borrow failed through public CORS proxy. Configure VITE_OWN_PROXY_URL to use an owned proxy that preserves Authorization.",8e3)}catch{}}}},B=P.useCallback(async()=>{if(!w||!b)return;f({isLoading:!0,message:"Replacing book...",error:null});const se={...w,id:b.id};x(null),C(null);try{const we=await No.save(se);we.success?(f({isLoading:!1,message:"Import successful!",error:null}),setTimeout(()=>{f({isLoading:!1,message:"",error:null}),o()},2e3)):(console.error("Error replacing book:",we.error),f({isLoading:!1,message:"",error:"Failed to replace the book in the library."}))}catch(we){console.error("Error replacing book:",we),f({isLoading:!1,message:"",error:"Failed to replace the book in the library."})}},[w,b,o,f]),me=P.useCallback(async()=>{if(!w)return;f({isLoading:!0,message:"Saving new copy...",error:null});const se={...w};x(null),C(null);try{const we=await No.save(se);we.success?(f({isLoading:!1,message:"Import successful!",error:null}),setTimeout(()=>{f({isLoading:!1,message:"",error:null}),o()},2e3)):(console.error("Error adding duplicate book:",we.error),f({isLoading:!1,message:"",error:"Failed to add the new copy to the library."}))}catch(we){console.error("Error adding duplicate book:",we),f({isLoading:!1,message:"",error:"Failed to add the new copy to the library."})}},[w,o,f]),he=()=>{x(null),C(null),f({isLoading:!1,message:"",error:null})};return a.jsxs("div",{className:"container mx-auto p-4 md:p-8 text-white min-h-screen",children:[a.jsx("header",{className:"mb-8",children:a.jsxs("button",{onClick:o,className:"inline-flex items-center gap-2 text-slate-300 hover:text-sky-400 transition-colors",children:[a.jsx(To,{className:"w-5 h-5"}),a.jsxs("span",{children:["Return to ",i==="library"?"My Library":"Catalog"]})]})}),a.jsxs("main",{className:"grid md:grid-cols-12 gap-8 md:gap-12",children:[a.jsxs("aside",{ref:h,className:"md:col-span-4 lg:col-span-3",children:[te?a.jsx("img",{src:te,alt:r.title,className:"w-full h-auto object-cover rounded-lg shadow-2xl aspect-[2/3]",onError:se=>{const we=se.currentTarget;we.onerror=null,typeof r.coverImage=="string"&&(we.src=$t(r.coverImage))}}):a.jsx("div",{className:"w-full flex items-center justify-center p-4 text-center text-slate-400 bg-slate-800 rounded-lg aspect-[2/3] shadow-2xl",children:a.jsx("span",{className:"font-semibold",children:r.title})}),a.jsx("div",{className:"mt-6",children:i==="library"?a.jsxs("button",{onClick:ne,className:"w-full py-3 px-6 rounded-lg bg-sky-500 hover:bg-sky-600 transition-colors font-bold inline-flex items-center justify-center text-lg",children:[a.jsx(th,{className:"w-6 h-6 mr-2"}),"Read Book"]}):(()=>{const se=z&&z.acquisitionMediaType||void 0,Ee=se?["application/adobe+epub","application/pdf+lcp","application/vnd.readium.license.status.v1.0+json"].some(He=>se.includes(He)):!1,xe=!!ge&&ge!=="EPUB"&&ge!=="PDF",je=d.isLoading||xe,Te=z?.alternativeFormats;return Te&&Te.length>1&&!Ee?a.jsxs("div",{className:"space-y-2",children:[a.jsx("p",{className:"text-sm text-slate-400 mb-2",children:"Choose format:"}),Te.map((He,Me)=>{const v=d.isLoading;return a.jsxs("button",{onClick:()=>{const X={...z,downloadUrl:He.downloadUrl,format:He.format,acquisitionMediaType:He.mediaType,isOpenAccess:He.isOpenAccess};l(X,n)},disabled:v,className:"w-full py-3 px-6 rounded-lg bg-sky-500 hover:bg-sky-600 transition-colors font-bold inline-flex items-center justify-center text-lg disabled:opacity-50 disabled:cursor-not-allowed",children:[a.jsx(Ul,{className:"w-6 h-6 mr-2"}),He.format," Format"]},Me)})]}):a.jsxs("button",{onClick:le,disabled:je,className:"w-full py-3 px-6 rounded-lg bg-sky-500 hover:bg-sky-600 transition-colors font-bold inline-flex items-center justify-center text-lg disabled:opacity-50 disabled:cursor-not-allowed",children:[a.jsx(Ul,{className:"w-6 h-6 mr-2"}),Ee?"Read in Palace App":xe?`Cannot Import ${ge}`:"Add to Bookshelf"]})})()})]}),a.jsxs("article",{className:"md:col-span-8 lg:col-span-9",children:[a.jsx("h1",{className:"text-4xl lg:text-5xl font-bold tracking-tight text-white",children:r.title}),a.jsx("h2",{className:"text-xl lg:text-2xl text-slate-300 mt-2",children:r.author}),a.jsxs("div",{className:"mt-8 border-t border-slate-700 pt-8 space-y-8",children:[ae&&a.jsxs("section",{children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-200 mb-3",children:"Description"}),a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:`prose prose-invert max-w-none text-slate-300 prose-p:mb-4 overflow-hidden transition-all duration-500 ease-in-out ${F&&!y?"max-h-40":"max-h-[1000px]"}`,children:a.jsx("div",{dangerouslySetInnerHTML:{__html:ae}})}),F&&!y&&a.jsx("div",{className:"absolute bottom-0 left-0 w-full h-16 bg-gradient-to-t from-slate-900 to-transparent pointer-events-none"})]}),F&&a.jsx("button",{onClick:()=>k(!y),className:"text-sky-400 hover:text-sky-300 font-semibold text-sm mt-2",children:y?"Show Less":"Read More"})]}),(r.publisher||r.publicationDate||N||K||ge)&&a.jsxs("section",{children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-200 mb-3",children:"Publication Details"}),a.jsx("div",{className:"bg-slate-800/50 rounded-lg border border-slate-700",children:a.jsxs("dl",{className:"divide-y divide-slate-700",children:[r.publisher&&a.jsxs("div",{className:"px-4 py-3 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[a.jsx("dt",{className:"text-sm font-medium text-slate-400",children:"Publisher"}),a.jsx("dd",{className:"mt-1 text-sm text-slate-200 sm:mt-0 sm:col-span-2",children:r.publisher})]}),r.publicationDate&&a.jsxs("div",{className:"px-4 py-3 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[a.jsx("dt",{className:"text-sm font-medium text-slate-400",children:"Published"}),a.jsx("dd",{className:"mt-1 text-sm text-slate-200 sm:mt-0 sm:col-span-2",children:xy(r.publicationDate)})]}),K&&!N&&a.jsxs("div",{className:"px-4 py-3 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[a.jsx("dt",{className:"text-sm font-medium text-slate-400",children:"Distributor"}),a.jsx("dd",{className:"mt-1 text-sm text-slate-200 sm:mt-0 sm:col-span-2",children:K})]}),N&&a.jsxs("div",{className:"px-4 py-3 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[a.jsx("dt",{className:"text-sm font-medium text-slate-400",children:"Provider ID"}),a.jsxs("dd",{className:"mt-1 text-sm text-slate-200 sm:mt-0 sm:col-span-2",children:[N,K&&a.jsxs("span",{className:"block text-xs text-slate-400",children:["from ",K]})]})]}),(ge||z?.alternativeFormats&&z.alternativeFormats.length>0)&&a.jsxs("div",{className:"px-4 py-3 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[a.jsx("dt",{className:"text-sm font-medium text-slate-400",children:z?.alternativeFormats&&z.alternativeFormats.length>1?"Available Formats":"Format"}),a.jsx("dd",{className:"mt-1 text-sm text-slate-200 sm:mt-0 sm:col-span-2",children:a.jsx("div",{className:"flex flex-wrap gap-2",children:z?.alternativeFormats&&z.alternativeFormats.length>1?z.alternativeFormats.map((se,we)=>a.jsx("span",{className:`text-white text-xs font-medium px-2 py-1 rounded-md ${se.format.toUpperCase()==="PDF"?"bg-red-600":se.format.toUpperCase()==="AUDIOBOOK"?"bg-purple-600":"bg-sky-500"}`,children:se.format},we)):ge?a.jsx("span",{className:"bg-slate-700 text-slate-300 text-xs font-medium px-2 py-1 rounded-md",children:ge}):null})})]})]})})]}),r.subjects&&r.subjects.length>0&&a.jsxs("section",{children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-200 mb-3",children:"Subjects"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:r.subjects.map((se,we)=>a.jsx("span",{className:"bg-slate-700 text-slate-300 text-sm font-medium px-3 py-1.5 rounded-full",children:se},we))})]}),Js(r)&&(r.accessibilityFeedback||r.accessModes||r.accessibilityFeatures||r.hazards||r.accessibilitySummary||r.language||r.rights)&&a.jsxs("section",{children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-200 mb-3",children:"Accessibility & Metadata"}),a.jsxs("div",{className:"bg-slate-800/50 rounded-lg border border-slate-700 p-4 space-y-2",children:[r.accessibilityFeedback&&a.jsxs("div",{children:[a.jsx("span",{className:"block text-sky-400 font-semibold mb-1",children:"Accessibility Summary"}),a.jsx("span",{className:"text-slate-200 text-sm",children:r.accessibilityFeedback})]}),r.accessModes&&r.accessModes.length>0&&a.jsxs("div",{children:[a.jsx("span",{className:"block text-sky-400 font-semibold mb-1",children:"Access Modes"}),a.jsx("span",{className:"text-slate-200 text-sm",children:r.accessModes.join(", ")})]}),r.accessibilityFeatures&&r.accessibilityFeatures.length>0&&a.jsxs("div",{children:[a.jsx("span",{className:"block text-sky-400 font-semibold mb-1",children:"Accessibility Features"}),a.jsx("span",{className:"text-slate-200 text-sm",children:r.accessibilityFeatures.join(", ")})]}),r.hazards&&r.hazards.length>0&&a.jsxs("div",{children:[a.jsx("span",{className:"block text-sky-400 font-semibold mb-1",children:"Accessibility Hazards"}),a.jsx("span",{className:"text-slate-200 text-sm",children:r.hazards.join(", ")})]}),r.accessibilitySummary&&a.jsxs("div",{children:[a.jsx("span",{className:"block text-sky-400 font-semibold mb-1",children:"Accessibility Notes"}),a.jsx("span",{className:"text-slate-200 text-sm",children:r.accessibilitySummary})]}),r.language&&a.jsxs("div",{children:[a.jsx("span",{className:"block text-sky-400 font-semibold mb-1",children:"Language"}),a.jsx("span",{className:"text-slate-200 text-sm",children:r.language})]}),r.rights&&a.jsxs("div",{children:[a.jsx("span",{className:"block text-sky-400 font-semibold mb-1",children:"Rights"}),a.jsx("span",{className:"text-slate-200 text-sm",children:r.rights})]})]})]})]})]})]}),(d.isLoading||d.error||d.message==="Import successful!")&&a.jsx("div",{className:"fixed inset-0 bg-slate-900 bg-opacity-75 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-slate-800 p-8 rounded-lg shadow-xl text-center max-w-sm w-full",children:[d.isLoading&&!d.error&&a.jsx(Fn,{text:d.message}),d.message==="Import successful!"&&!d.isLoading&&a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsx("h3",{className:"text-xl font-bold text-green-400 mb-4",children:"Success"}),a.jsx("p",{className:"text-slate-300 mb-6",children:"Book added to your library!"})]}),d.error&&a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsx("h3",{className:"text-xl font-bold text-red-400 mb-4",children:"Import Failed"}),a.jsx("p",{className:"text-slate-300 mb-6",children:d.error}),a.jsx("button",{onClick:()=>f({isLoading:!1,message:"",error:null}),className:"bg-sky-500 hover:bg-sky-600 text-white font-bold py-2 px-6 rounded-lg transition-colors",children:"Close"})]})]})}),a.jsx(mh,{isOpen:!!w,onClose:he,onReplace:B,onAddAnyway:me,bookTitle:w?.title||""}),a.jsx(gh,{isOpen:m,host:j,authDocument:L,onClose:()=>S(!1),onSubmit:ie,onOpenAuthLink:ue,onRetry:A,probeUrl:M?.downloadUrl})]})};class by{safeParse(i,n){if(!i)return n;try{return JSON.parse(i)}catch(o){return ce.warn("Failed to parse bookmark JSON, using fallback",o),n}}findByBookId(i){try{ce.info("Finding bookmarks for book",{bookId:i});const n=yt.bookmarks(i),o=localStorage.getItem(n),u=this.safeParse(o,[]);return ce.info("Found bookmarks",{bookId:i,count:u.length}),{success:!0,data:u}}catch(n){const o=n instanceof Error?n.message:"Unknown error finding bookmarks";return ce.error("Error finding bookmarks:",o),{success:!1,error:o}}}findById(i,n){try{const o=this.findByBookId(i);return o.success?{success:!0,data:o.data.find(l=>l.id===n)||null}:{success:!1,error:"Failed to find bookmarks"}}catch(o){const u=o instanceof Error?o.message:"Unknown error finding bookmark";return ce.error("Error finding bookmark by ID:",u),{success:!1,error:u}}}add(i,n){try{ce.info("Adding bookmark",{bookId:i,cfi:n.cfi});const o=this.findByBookId(i);if(!o.success)return{success:!1,error:"Failed to retrieve bookmarks"};const u={id:new Date().toISOString(),cfi:n.cfi,label:n.label||"Bookmark",chapter:n.chapter,description:n.description,createdAt:Date.now()},l=[...o.data,u];return this.saveAll(i,l).success?(ce.info("Bookmark added",{bookId:i,bookmarkId:u.id}),{success:!0,data:u}):{success:!1,error:"Failed to save bookmark"}}catch(o){const u=o instanceof Error?o.message:"Unknown error adding bookmark";return ce.error("Error adding bookmark:",u),{success:!1,error:u}}}update(i,n,o){try{ce.info("Updating bookmark",{bookId:i,bookmarkId:n});const u=this.findByBookId(i);if(!u.success)return{success:!1,error:"Failed to retrieve bookmarks"};const l=u.data,d=l.findIndex(y=>y.id===n);if(d===-1)return{success:!1,error:"Bookmark not found"};const f={...l[d],...o};return l[d]=f,this.saveAll(i,l).success?(ce.info("Bookmark updated",{bookId:i,bookmarkId:n}),{success:!0,data:f}):{success:!1,error:"Failed to save updated bookmark"}}catch(u){const l=u instanceof Error?u.message:"Unknown error updating bookmark";return ce.error("Error updating bookmark:",l),{success:!1,error:l}}}delete(i,n){try{ce.info("Deleting bookmark",{bookId:i,bookmarkId:n});const o=this.findByBookId(i);if(!o.success)return{success:!1,error:"Failed to retrieve bookmarks"};const u=o.data.filter(d=>d.id!==n);return u.length===o.data.length?{success:!1,error:"Bookmark not found"}:this.saveAll(i,u).success?(ce.info("Bookmark deleted",{bookId:i,bookmarkId:n}),{success:!0,data:void 0}):{success:!1,error:"Failed to save after deletion"}}catch(o){const u=o instanceof Error?o.message:"Unknown error deleting bookmark";return ce.error("Error deleting bookmark:",u),{success:!1,error:u}}}deleteAll(i){try{ce.warn("Deleting all bookmarks for book",{bookId:i});const n=yt.bookmarks(i);return localStorage.removeItem(n),ce.info("All bookmarks deleted",{bookId:i}),{success:!0,data:void 0}}catch(n){const o=n instanceof Error?n.message:"Unknown error deleting all bookmarks";return ce.error("Error deleting all bookmarks:",o),{success:!1,error:o}}}count(i){try{const n=this.findByBookId(i);return n.success?{success:!0,data:n.data.length}:{success:!1,error:"Failed to count bookmarks"}}catch(n){const o=n instanceof Error?n.message:"Unknown error counting bookmarks";return ce.error("Error counting bookmarks:",o),{success:!1,error:o}}}existsAtCfi(i,n){try{const o=this.findByBookId(i);return o.success?{success:!0,data:o.data.some(l=>l.cfi===n)}:{success:!1,error:"Failed to check bookmark existence"}}catch(o){const u=o instanceof Error?o.message:"Unknown error checking bookmark existence";return ce.error("Error checking bookmark existence:",u),{success:!1,error:u}}}findByChapter(i,n){try{ce.info("Finding bookmarks by chapter",{bookId:i,chapter:n});const o=this.findByBookId(i);if(!o.success)return{success:!1,error:"Failed to find bookmarks by chapter"};const u=o.data.filter(l=>l.chapter===n);return ce.info("Found bookmarks by chapter",{bookId:i,chapter:n,count:u.length}),{success:!0,data:u}}catch(o){const u=o instanceof Error?o.message:"Unknown error finding bookmarks by chapter";return ce.error("Error finding bookmarks by chapter:",u),{success:!1,error:u}}}findSortedByDate(i){try{const n=this.findByBookId(i);return n.success?{success:!0,data:[...n.data].sort((u,l)=>l.createdAt-u.createdAt)}:{success:!1,error:"Failed to sort bookmarks"}}catch(n){const o=n instanceof Error?n.message:"Unknown error sorting bookmarks";return ce.error("Error sorting bookmarks:",o),{success:!1,error:o}}}saveAll(i,n){try{const o=yt.bookmarks(i);return localStorage.setItem(o,JSON.stringify(n)),{success:!0,data:void 0}}catch(o){const u=o instanceof Error?o.message:"Unknown error saving bookmarks";return ce.error("Error saving bookmarks:",u),{success:!1,error:u}}}exportBookmarks(i){try{const n=this.findByBookId(i);if(!n.success)return{success:!1,error:"Failed to export bookmarks"};const o=JSON.stringify(n.data,null,2);return ce.info("Bookmarks exported",{bookId:i,count:n.data.length}),{success:!0,data:o}}catch(n){const o=n instanceof Error?n.message:"Unknown error exporting bookmarks";return ce.error("Error exporting bookmarks:",o),{success:!1,error:o}}}importBookmarks(i,n,o=!1){try{ce.info("Importing bookmarks",{bookId:i,merge:o});const u=this.safeParse(n,[]);if(!Array.isArray(u))return{success:!1,error:"Invalid bookmark data format"};let l=u;if(o){const f=this.findByBookId(i);if(!f.success)return{success:!1,error:"Failed to merge bookmarks"};const h=new Set(f.data.map(k=>k.id)),y=u.filter(k=>!h.has(k.id));l=[...f.data,...y]}return this.saveAll(i,l).success?(ce.info("Bookmarks imported",{bookId:i,count:u.length,totalCount:l.length}),{success:!0,data:u.length}):{success:!1,error:"Failed to save imported bookmarks"}}catch(u){const l=u instanceof Error?u.message:"Unknown error importing bookmarks";return ce.error("Error importing bookmarks:",l),{success:!1,error:l}}}}const yo=new by;class ky{safeParse(i,n){if(!i)return n;try{return JSON.parse(i)}catch(o){return ce.warn("Failed to parse citation JSON, using fallback",o),n}}findByBookId(i){try{ce.info("Finding citations for book",{bookId:i});const n=yt.citations(i),o=localStorage.getItem(n),u=this.safeParse(o,[]);return ce.info("Found citations",{bookId:i,count:u.length}),{success:!0,data:u}}catch(n){const o=n instanceof Error?n.message:"Unknown error finding citations";return ce.error("Error finding citations:",o),{success:!1,error:o}}}findById(i,n){try{const o=this.findByBookId(i);return o.success?{success:!0,data:o.data.find(l=>l.id===n)||null}:{success:!1,error:"Failed to find citations"}}catch(o){const u=o instanceof Error?o.message:"Unknown error finding citation";return ce.error("Error finding citation by ID:",u),{success:!1,error:u}}}add(i,n){try{ce.info("Adding citation",{bookId:i,cfi:n.cfi});const o=this.findByBookId(i);if(!o.success)return{success:!1,error:"Failed to retrieve citations"};const u={id:new Date().toISOString(),cfi:n.cfi,note:n.note,createdAt:Date.now(),pageNumber:n.pageNumber,chapter:n.chapter},l=[...o.data,u];return this.saveAll(i,l).success?(ce.info("Citation added",{bookId:i,citationId:u.id}),{success:!0,data:u}):{success:!1,error:"Failed to save citation"}}catch(o){const u=o instanceof Error?o.message:"Unknown error adding citation";return ce.error("Error adding citation:",u),{success:!1,error:u}}}update(i,n,o){try{ce.info("Updating citation",{bookId:i,citationId:n});const u=this.findByBookId(i);if(!u.success)return{success:!1,error:"Failed to retrieve citations"};const l=u.data,d=l.findIndex(y=>y.id===n);if(d===-1)return{success:!1,error:"Citation not found"};const f={...l[d],...o};return l[d]=f,this.saveAll(i,l).success?(ce.info("Citation updated",{bookId:i,citationId:n}),{success:!0,data:f}):{success:!1,error:"Failed to save updated citation"}}catch(u){const l=u instanceof Error?u.message:"Unknown error updating citation";return ce.error("Error updating citation:",l),{success:!1,error:l}}}delete(i,n){try{ce.info("Deleting citation",{bookId:i,citationId:n});const o=this.findByBookId(i);if(!o.success)return{success:!1,error:"Failed to retrieve citations"};const u=o.data.filter(d=>d.id!==n);return u.length===o.data.length?{success:!1,error:"Citation not found"}:this.saveAll(i,u).success?(ce.info("Citation deleted",{bookId:i,citationId:n}),{success:!0,data:void 0}):{success:!1,error:"Failed to save after deletion"}}catch(o){const u=o instanceof Error?o.message:"Unknown error deleting citation";return ce.error("Error deleting citation:",u),{success:!1,error:u}}}deleteAll(i){try{ce.warn("Deleting all citations for book",{bookId:i});const n=yt.citations(i);return localStorage.removeItem(n),ce.info("All citations deleted",{bookId:i}),{success:!0,data:void 0}}catch(n){const o=n instanceof Error?n.message:"Unknown error deleting all citations";return ce.error("Error deleting all citations:",o),{success:!1,error:o}}}count(i){try{const n=this.findByBookId(i);return n.success?{success:!0,data:n.data.length}:{success:!1,error:"Failed to count citations"}}catch(n){const o=n instanceof Error?n.message:"Unknown error counting citations";return ce.error("Error counting citations:",o),{success:!1,error:o}}}findByChapter(i,n){try{ce.info("Finding citations by chapter",{bookId:i,chapter:n});const o=this.findByBookId(i);if(!o.success)return{success:!1,error:"Failed to find citations by chapter"};const u=o.data.filter(l=>l.chapter===n);return ce.info("Found citations by chapter",{bookId:i,chapter:n,count:u.length}),{success:!0,data:u}}catch(o){const u=o instanceof Error?o.message:"Unknown error finding citations by chapter";return ce.error("Error finding citations by chapter:",u),{success:!1,error:u}}}findSortedByDate(i){try{const n=this.findByBookId(i);return n.success?{success:!0,data:[...n.data].sort((u,l)=>l.createdAt-u.createdAt)}:{success:!1,error:"Failed to sort citations"}}catch(n){const o=n instanceof Error?n.message:"Unknown error sorting citations";return ce.error("Error sorting citations:",o),{success:!1,error:o}}}saveAll(i,n){try{const o=yt.citations(i);return localStorage.setItem(o,JSON.stringify(n)),{success:!0,data:void 0}}catch(o){const u=o instanceof Error?o.message:"Unknown error saving citations";return ce.error("Error saving citations:",u),{success:!1,error:u}}}getPublicationYear(i){if(!i)return"n.d.";const n=i.match(/\d{4}/);return n?n[0]:"n.d."}formatAuthorName(i,n){const o=i.split(" ").filter(d=>d.trim());if(o.length<2)return i;const u=o.pop(),l=o;if(n==="apa"){const d=l.map(f=>f[0]?`${f[0]}.`:"").join(" ");return`${u}, ${d}`}return`${u}, ${l.join(" ")}`}generateCitation(i,n){try{const o=i.author||"Unknown Author",u=i.title||"Untitled Book",l=i.publisher||"[Publisher not available]",d=this.getPublicationYear(i.publicationDate),f=this.formatAuthorName(o,n);switch(n){case"apa":return{pre:`${f} (${d}). `,title:u,post:`. ${l}.`,isItalic:!0};case"mla":return{pre:`${f}. `,title:u,post:`. ${l}, ${d==="n.d."?"[Date not available]":d}.`,isItalic:!0};case"chicago":return{pre:`${f}. `,title:u,post:`. ${l}, ${d==="n.d."?"[Date not available]":d}.`,isItalic:!1};default:return{pre:`${o}. `,title:u,post:".",isItalic:!1}}}catch(o){return ce.error("Error generating citation:",o),{pre:"",title:i.title||"Untitled Book",post:"",isItalic:!1}}}formatCitation(i,n){const o=this.generateCitation(i,n),u=`${o.pre}${o.title}${o.post}`;return{format:n,text:u}}formatAllStyles(i){return["apa","mla","chicago"].map(o=>this.formatCitation(i,o))}exportToRIS(i,n){try{ce.info("Exporting citations to RIS",{bookId:i.id,count:n.length});const o=[],u=this.getPublicationYear(i.publicationDate);n.forEach(d=>{const f=[];if(f.push("TY  - CHAP"),i.author){const y=this.formatAuthorName(i.author,"apa");f.push(`AU  - ${y}`)}i.title&&f.push(`T2  - ${i.title}`),i.publisher&&f.push(`PB  - ${i.publisher}`),u!=="n.d."&&f.push(`PY  - ${u}`),i.isbn&&f.push(`SN  - ${i.isbn}`),d.chapter&&f.push(`TI  - ${d.chapter}`),d.pageNumber&&f.push(`SP  - ${d.pageNumber}`);const h=(d.note||"").replace(/(\r\n|\n|\r)/gm," ");h&&f.push(`N1  - ${h}`),f.push("ER  - "),o.push(f.join(`\r
`))});const l=o.join(`\r
\r
`)+`\r
`;return ce.info("RIS export successful",{recordCount:o.length}),{success:!0,data:l}}catch(o){const u=o instanceof Error?o.message:"Unknown error exporting to RIS";return ce.error("Error exporting to RIS:",u),{success:!1,error:u}}}exportCitations(i){try{const n=this.findByBookId(i);if(!n.success)return{success:!1,error:"Failed to export citations"};const o=JSON.stringify(n.data,null,2);return ce.info("Citations exported",{bookId:i,count:n.data.length}),{success:!0,data:o}}catch(n){const o=n instanceof Error?n.message:"Unknown error exporting citations";return ce.error("Error exporting citations:",o),{success:!1,error:o}}}importCitations(i,n,o=!1){try{ce.info("Importing citations",{bookId:i,merge:o});const u=this.safeParse(n,[]);if(!Array.isArray(u))return{success:!1,error:"Invalid citation data format"};let l=u;if(o){const f=this.findByBookId(i);if(!f.success)return{success:!1,error:"Failed to merge citations"};const h=new Set(f.data.map(k=>k.id)),y=u.filter(k=>!h.has(k.id));l=[...f.data,...y]}return this.saveAll(i,l).success?(ce.info("Citations imported",{bookId:i,count:u.length,totalCount:l.length}),{success:!0,data:u.length}):{success:!1,error:"Failed to save imported citations"}}catch(u){const l=u instanceof Error?u.message:"Unknown error importing citations";return ce.error("Error importing citations:",l),{success:!1,error:l}}}}const Nl=new ky;class Sy{getPosition(i){try{ce.info("Getting position for book",{bookId:i});const n=yt.position(i),o=localStorage.getItem(n);return o?ce.info("Found position",{bookId:i,cfi:o.substring(0,50)+"..."}):ce.info("No position found",{bookId:i}),{success:!0,data:o}}catch(n){const o=n instanceof Error?n.message:"Unknown error getting position";return ce.error("Error getting position:",o),{success:!1,error:o}}}savePosition(i,n){try{ce.info("Saving position for book",{bookId:i,cfi:n.substring(0,50)+"..."});const o=yt.position(i);return localStorage.setItem(o,n),ce.info("Position saved",{bookId:i}),{success:!0,data:void 0}}catch(o){const u=o instanceof Error?o.message:"Unknown error saving position";return ce.error("Error saving position:",u),{success:!1,error:u}}}clearPosition(i){try{ce.info("Clearing position for book",{bookId:i});const n=yt.position(i);return localStorage.removeItem(n),ce.info("Position cleared",{bookId:i}),{success:!0,data:void 0}}catch(n){const o=n instanceof Error?n.message:"Unknown error clearing position";return ce.error("Error clearing position:",o),{success:!1,error:o}}}hasPosition(i){try{const n=this.getPosition(i);return n.success?{success:!0,data:n.data!==null}:{success:!1,error:"Failed to check position"}}catch(n){const o=n instanceof Error?n.message:"Unknown error checking position";return ce.error("Error checking position:",o),{success:!1,error:o}}}getReadingPosition(i){try{const n=this.getPosition(i);return n.success?n.data?{success:!0,data:{bookId:i,cfi:n.data,updatedAt:Date.now()}}:{success:!0,data:null}:{success:!1,error:"Failed to get reading position"}}catch(n){const o=n instanceof Error?n.message:"Unknown error getting reading position";return ce.error("Error getting reading position:",o),{success:!1,error:o}}}getSpeechPosition(i){try{ce.info("Getting speech position for book",{bookId:i});const n=yt.spokenPosition(i),o=localStorage.getItem(n);return o?ce.info("Found speech position",{bookId:i,cfi:o.substring(0,50)+"..."}):ce.info("No speech position found",{bookId:i}),{success:!0,data:o}}catch(n){const o=n instanceof Error?n.message:"Unknown error getting speech position";return ce.error("Error getting speech position:",o),{success:!1,error:o}}}saveSpeechPosition(i,n){try{ce.info("Saving speech position for book",{bookId:i,cfi:n.substring(0,50)+"..."});const o=yt.spokenPosition(i);return localStorage.setItem(o,n),ce.info("Speech position saved",{bookId:i}),{success:!0,data:void 0}}catch(o){const u=o instanceof Error?o.message:"Unknown error saving speech position";return ce.error("Error saving speech position:",u),{success:!1,error:u}}}clearSpeechPosition(i){try{ce.info("Clearing speech position for book",{bookId:i});const n=yt.spokenPosition(i);return localStorage.removeItem(n),ce.info("Speech position cleared",{bookId:i}),{success:!0,data:void 0}}catch(n){const o=n instanceof Error?n.message:"Unknown error clearing speech position";return ce.error("Error clearing speech position:",o),{success:!1,error:o}}}clearAllPositions(i){try{ce.info("Clearing all positions for book",{bookId:i});const n=this.clearPosition(i),o=this.clearSpeechPosition(i);return!n.success||!o.success?{success:!1,error:"Failed to clear all positions"}:(ce.info("All positions cleared",{bookId:i}),{success:!0,data:void 0})}catch(n){const o=n instanceof Error?n.message:"Unknown error clearing all positions";return ce.error("Error clearing all positions:",o),{success:!1,error:o}}}calculateProgress(i,n){if(n===0)return 0;const o=i/n*100;return Math.round(Math.max(0,Math.min(100,o)))}createLocationInfo(i,n,o){const u=o!==void 0?o:this.calculateProgress(i,n);return{currentPage:i,totalPages:n,progress:u}}formatLocationInfo(i){return`Page ${i.currentPage} of ${i.totalPages} (${i.progress}%)`}formatPageLabel(i){return`Page ${i.currentPage}`}formatPageWithProgress(i){return`Page ${i.currentPage} (${i.progress}%)`}getAllBooksWithPositions(){try{ce.info("Getting all books with positions");const i=[],n="reader_position_";for(let o=0;o<localStorage.length;o++){const u=localStorage.key(o);if(u&&u.startsWith(n)){const l=u.substring(n.length),d=parseInt(l,10);isNaN(d)||i.push(d)}}return ce.info("Found books with positions",{count:i.length}),{success:!0,data:i}}catch(i){const n=i instanceof Error?i.message:"Unknown error getting books with positions";return ce.error("Error getting books with positions:",n),{success:!1,error:n}}}exportAllPositions(){try{ce.info("Exporting all positions");const i=this.getAllBooksWithPositions();if(!i.success)return{success:!1,error:"Failed to export positions"};const n={};for(const u of i.data){const l=this.getPosition(u),d=this.getSpeechPosition(u);l.success&&d.success&&(n[u]={position:l.data,speechPosition:d.data})}const o=JSON.stringify(n,null,2);return ce.info("Positions exported",{bookCount:Object.keys(n).length}),{success:!0,data:o}}catch(i){const n=i instanceof Error?i.message:"Unknown error exporting positions";return ce.error("Error exporting positions:",n),{success:!1,error:n}}}importPositions(i,n=!1){try{ce.info("Importing positions",{merge:n});const o=JSON.parse(i);if(typeof o!="object"||o===null)return{success:!1,error:"Invalid positions data format"};if(!n){const l=this.getAllBooksWithPositions();if(l.success)for(const d of l.data)this.clearAllPositions(d)}let u=0;for(const[l,d]of Object.entries(o)){const f=parseInt(l,10);isNaN(f)||(d.position&&(this.savePosition(f,d.position),u++),d.speechPosition&&this.saveSpeechPosition(f,d.speechPosition))}return ce.info("Positions imported",{count:u}),{success:!0,data:u}}catch(o){const u=o instanceof Error?o.message:"Unknown error importing positions";return ce.error("Error importing positions:",u),{success:!1,error:u}}}clearAllBooksPositions(){try{ce.warn("Clearing all positions for all books");const i=this.getAllBooksWithPositions();if(!i.success)return{success:!1,error:"Failed to clear all positions"};let n=0;for(const o of i.data)this.clearAllPositions(o).success&&n++;return ce.info("All positions cleared",{count:n}),{success:!0,data:n}}catch(i){const n=i instanceof Error?i.message:"Unknown error clearing all positions";return ce.error("Error clearing all positions:",n),{success:!1,error:n}}}}const ei=new Sy,Cy=({isOpen:r,onClose:i,onSave:n})=>{const[o,u]=P.useState(""),l=200,d=P.useRef(null),f=br({isActive:r,initialFocusRef:d,onEscape:i});if(P.useEffect(()=>{r&&u("")},[r]),!r)return null;const h=()=>{n(o)},y=l-o.length;return a.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:i,"aria-modal":"true",role:"dialog",children:a.jsxs("div",{ref:f,className:"bg-slate-800 rounded-lg shadow-xl w-full max-w-md p-6 text-white",onClick:k=>k.stopPropagation(),children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h2",{className:"text-xl font-bold text-sky-300",children:"Add Bookmark"}),a.jsx("button",{onClick:i,className:"p-2 rounded-full hover:bg-slate-700 transition-colors","aria-label":"Close",children:a.jsx(ir,{className:"w-6 h-6"})})]}),a.jsx("p",{className:"text-slate-300 mb-4 text-sm",children:"A bookmark for the current location will be created. You can add an optional note below."}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"bookmark-note",className:"block text-sm font-medium text-slate-400 mb-2",children:"Note (optional)"}),a.jsx("textarea",{ref:d,id:"bookmark-note",rows:4,value:o,onChange:k=>{k.target.value.length<=l&&u(k.target.value)},className:"w-full bg-slate-700 rounded-md p-2 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500",placeholder:"Add a brief note..."}),a.jsxs("p",{className:`text-xs mt-1 text-right ${y<20?"text-red-400":"text-slate-500"}`,children:[y," characters remaining"]})]}),a.jsxs("div",{className:"flex justify-end gap-4 mt-6",children:[a.jsx("button",{onClick:i,className:"py-2 px-4 rounded-md bg-slate-600 hover:bg-slate-500 transition-colors font-semibold",children:"Cancel"}),a.jsx("button",{onClick:h,className:"py-2 px-6 rounded-md bg-sky-500 hover:bg-sky-600 transition-colors font-bold",children:"Save Bookmark"})]})]})})},jy=({isOpen:r,onClose:i,onSave:n})=>{const[o,u]=P.useState(""),l=50,d=P.useRef(null),f=br({isActive:r,initialFocusRef:d,onEscape:i});if(P.useEffect(()=>{r&&u("")},[r]),!r)return null;const h=()=>{n(o)},y=l-o.length;return a.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:i,"aria-modal":"true",role:"dialog",children:a.jsxs("div",{ref:f,className:"bg-slate-800 rounded-lg shadow-xl w-full max-w-md p-6 text-white",onClick:k=>k.stopPropagation(),children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h2",{className:"text-xl font-bold text-sky-300",children:"Create Citation"}),a.jsx("button",{onClick:i,className:"p-2 rounded-full hover:bg-slate-700 transition-colors","aria-label":"Close",children:a.jsx(ir,{className:"w-6 h-6"})})]}),a.jsx("p",{className:"text-slate-300 mb-4 text-sm",children:"A citation for the current location will be created. You can add an optional note below."}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"citation-note",className:"block text-sm font-medium text-slate-400 mb-2",children:"Note (optional)"}),a.jsx("textarea",{ref:d,id:"citation-note",rows:3,value:o,onChange:k=>{k.target.value.length<=l&&u(k.target.value)},className:"w-full bg-slate-700 rounded-md p-2 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500",placeholder:"Add a brief note..."}),a.jsxs("p",{className:`text-xs mt-1 text-right ${y<10?"text-red-400":"text-slate-500"}`,children:[y," characters remaining"]})]}),a.jsxs("div",{className:"flex justify-end gap-4 mt-6",children:[a.jsx("button",{onClick:i,className:"py-2 px-4 rounded-md bg-slate-600 hover:bg-slate-500 transition-colors font-semibold",children:"Discard"}),a.jsx("button",{onClick:h,className:"py-2 px-6 rounded-md bg-sky-500 hover:bg-sky-600 transition-colors font-bold",children:"Save Citation"})]})]})})},Ny=({excerpt:r,query:i})=>{if(!i)return a.jsx("span",{children:r});const n=i.toLowerCase(),o=r.replace(/\s+/g," ").trim(),l=o.toLowerCase().indexOf(n);if(l===-1){const b=r.split(new RegExp(`(${i})`,"gi"));return a.jsx("span",{className:"text-sm text-slate-300 group-hover:text-slate-100 transition-colors",children:b.map((C,m)=>C.toLowerCase()===n?a.jsx("strong",{className:"text-sky-300 bg-sky-800/50 font-normal rounded",children:C},m):a.jsx("span",{children:C},m))})}let d=o.lastIndexOf(".",l);d=Math.max(d,o.lastIndexOf("!",l)),d=Math.max(d,o.lastIndexOf("?",l));let f=o.indexOf(".",l+i.length);f===-1&&(f=1/0);let h=o.indexOf("!",l+i.length);h!==-1&&(f=Math.min(f,h)),h=o.indexOf("?",l+i.length),h!==-1&&(f=Math.min(f,h)),f===1/0?f=o.length:f++,d===-1?d=0:d++;const y=o.substring(d,f).trim(),k=d>0,w=f<o.length,x=y.split(new RegExp(`(${i})`,"gi"));return a.jsxs("span",{className:"text-sm text-slate-300 group-hover:text-slate-100 transition-colors",children:[k&&"...",x.map((b,C)=>b.toLowerCase()===n?a.jsx("strong",{className:"text-sky-300 bg-sky-800/50 font-normal rounded",children:b},C):a.jsx("span",{children:b},C)),w&&"..."]})},Ey=({isOpen:r,onClose:i,onQueryChange:n,onNavigate:o,results:u,isLoading:l,searchQuery:d})=>r?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 bg-black/60 z-30",onClick:i,"aria-hidden":"true"}),a.jsxs("div",{className:`fixed top-0 left-0 h-full w-80 bg-slate-800 shadow-2xl z-40 transform transition-transform duration-300 ease-in-out flex flex-col ${r?"translate-x-0":"-translate-x-full"}`,role:"dialog","aria-modal":"true","aria-labelledby":"search-heading",children:[a.jsxs("div",{className:"p-4 border-b border-slate-700 flex justify-between items-center flex-shrink-0",children:[a.jsx("h3",{id:"search-heading",className:"text-xl font-semibold text-white",children:"Search"}),a.jsx("button",{onClick:i,className:"p-2 rounded-full hover:bg-slate-700","aria-label":"Close search",children:a.jsx(ir,{className:"w-6 h-6"})})]}),a.jsx("div",{className:"p-4 border-b border-slate-700 flex-shrink-0",children:a.jsxs("div",{className:"relative",children:[a.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:a.jsx(Yf,{className:"w-5 h-5 text-slate-400"})}),a.jsx("input",{type:"search",placeholder:"Search in book...",value:d,onChange:f=>n(f.target.value),className:"w-full bg-slate-700 text-white rounded-md pl-10 pr-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":"Search input",autoFocus:!0})]})}),a.jsx("div",{className:"overflow-y-auto flex-grow",children:l?a.jsx("div",{className:"flex justify-center items-center h-full",children:a.jsx(Fn,{text:"Searching..."})}):d&&u.length>0?a.jsxs(a.Fragment,{children:[a.jsxs("p",{className:"text-xs text-slate-400 px-4 pt-4 pb-2",children:[u.length," result",u.length!==1&&"s",' found for "',d,'"']}),a.jsx("ul",{className:"divide-y divide-slate-700",children:u.map((f,h)=>a.jsx("li",{className:"group",children:a.jsx("button",{onClick:()=>o(f.cfi),className:"w-full text-left p-4 hover:bg-sky-500/10 transition-colors",children:a.jsx(Ny,{excerpt:f.excerpt.trim(),query:d})})},h))})]}):d&&u.length===0?a.jsxs("p",{className:"p-8 text-slate-400 text-center",children:['No results found for "',d,'".']}):a.jsx("p",{className:"p-8 text-slate-400 text-center",children:"Enter a term above to search the book."})})]})]}):null,_y=({isOpen:r,onClose:i,settings:n,onSettingsChange:o})=>{const[u,l]=P.useState("display"),[d,f]=P.useState([]);if(P.useEffect(()=>{if(r){const w=()=>{const x=window.speechSynthesis.getVoices();x.length>0&&f(x)};return w(),window.speechSynthesis.onvoiceschanged=w,()=>{window.speechSynthesis.onvoiceschanged=null}}},[r]),!r)return null;const h=w=>{o({readAloud:{...n.readAloud,...w}})},y=w=>{window.speechSynthesis.cancel();const x=new SpeechSynthesisUtterance("Hello, this is a preview of my voice.");x.voice=w,x.rate=n.readAloud.rate,x.pitch=n.readAloud.pitch,window.speechSynthesis.speak(x)},k=()=>{const w=d.find(x=>x.voiceURI===n.readAloud.voiceURI);return a.jsxs("div",{className:"space-y-8",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Voice"}),a.jsxs("div",{className:"p-3 bg-slate-900/50 rounded-md mb-4",children:[a.jsx("p",{className:"text-xs text-slate-400 text-center",children:"Current Voice"}),a.jsx("p",{className:"font-semibold text-sky-300 truncate text-center",title:w?w.name:"System Default",children:w?w.name:"System Default"})]}),a.jsx("p",{className:"text-xs text-slate-400 mb-2",children:"Select a new voice from the list below:"}),a.jsx("div",{className:"max-h-48 overflow-y-auto rounded-md border border-slate-600 bg-slate-700/50",children:a.jsx("ul",{className:"divide-y divide-slate-600",children:d.length>0?d.map(x=>a.jsxs("li",{className:`flex items-center justify-between p-2 text-sm transition-colors ${n.readAloud.voiceURI===x.voiceURI?"bg-sky-500/20 text-sky-300":"hover:bg-slate-700"}`,children:[a.jsxs("button",{onClick:()=>h({voiceURI:x.voiceURI}),className:"flex-grow text-left pr-2",children:[a.jsx("span",{className:"font-medium",children:x.name}),a.jsx("span",{className:"text-xs text-slate-400 block",children:x.lang})]}),a.jsx("button",{onClick:()=>y(x),className:"p-2 rounded-full hover:bg-slate-600 flex-shrink-0","aria-label":`Preview voice ${x.name}`,children:a.jsx(eh,{className:"w-4 h-4"})})]},x.voiceURI)):a.jsx("li",{className:"p-4 text-center text-slate-400",children:"Loading voices..."})})})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"read-speed",className:"block text-sm font-medium text-slate-300 mb-2",children:"Speed"}),a.jsx("input",{id:"read-speed",type:"range",min:"0.5",max:"2",step:"0.1",value:n.readAloud.rate,onChange:x=>h({rate:parseFloat(x.target.value)}),className:"w-full h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer"}),a.jsxs("div",{className:"text-center text-slate-400 text-sm mt-1",children:[n.readAloud.rate.toFixed(1),"x"]})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"read-pitch",className:"block text-sm font-medium text-slate-300 mb-2",children:"Pitch"}),a.jsx("input",{id:"read-pitch",type:"range",min:"0",max:"2",step:"0.1",value:n.readAloud.pitch,onChange:x=>h({pitch:parseFloat(x.target.value)}),className:"w-full h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer"}),a.jsx("div",{className:"text-center text-slate-400 text-sm mt-1",children:n.readAloud.pitch.toFixed(1)})]})]})};return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 bg-black/60 z-30",onClick:i}),a.jsxs("div",{className:`fixed top-0 right-0 h-full w-80 bg-slate-800 shadow-2xl z-40 transform transition-transform duration-300 ease-in-out flex flex-col ${r?"translate-x-0":"translate-x-full"}`,role:"dialog","aria-modal":"true","aria-labelledby":"settings-panel-title",children:[a.jsxs("div",{className:"p-4 border-b border-slate-700 flex justify-between items-center flex-shrink-0",children:[a.jsx("h3",{id:"settings-panel-title",className:"text-xl font-semibold text-white",children:"Settings"}),a.jsx("button",{onClick:i,"aria-label":"Close settings",className:"p-2 rounded-full hover:bg-slate-700",children:a.jsx(ir,{className:"w-6 h-6"})})]}),a.jsx("div",{className:"border-b border-slate-700 px-2 flex-shrink-0",children:a.jsxs("nav",{className:"flex -mb-px",children:[a.jsxs("button",{onClick:()=>l("display"),className:`flex-1 flex items-center justify-center gap-2 py-3 px-4 text-sm font-medium border-b-2 transition-colors duration-200 ${u==="display"?"border-sky-400 text-sky-300":"border-transparent text-slate-400 hover:text-white hover:border-slate-500"}`,children:[a.jsx(th,{className:"w-5 h-5"}),"Display"]}),a.jsxs("button",{onClick:()=>l("readAloud"),className:`flex-1 flex items-center justify-center gap-2 py-3 px-4 text-sm font-medium border-b-2 transition-colors duration-200 ${u==="readAloud"?"border-sky-400 text-sky-300":"border-transparent text-slate-400 hover:text-white hover:border-slate-500"}`,children:[a.jsx(u0,{className:"w-5 h-5"}),"Read Aloud"]})]})}),a.jsxs("div",{className:"p-6 text-white overflow-y-auto flex-grow",children:[u==="display"&&a.jsxs("div",{className:"space-y-8",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"font-size",className:"block text-sm font-medium text-slate-300 mb-2",children:"Font Size"}),a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("span",{className:"text-lg",children:"A"}),a.jsx("input",{id:"font-size",type:"range",min:"80",max:"200",step:"1",value:n.fontSize,onChange:w=>o({fontSize:parseInt(w.target.value,10)}),className:"w-full h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer"}),a.jsx("span",{className:"text-3xl",children:"A"})]}),a.jsxs("div",{className:"text-center text-slate-400 text-sm mt-1",children:[n.fontSize,"%"]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Theme"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("button",{onClick:()=>o({theme:"light"}),className:`p-4 rounded-lg border-2 transition-colors ${n.theme==="light"?"border-sky-500 bg-sky-500/20":"border-slate-600 hover:border-slate-500"}`,children:[a.jsx("div",{className:"w-full h-12 bg-white rounded"}),a.jsx("p",{className:"mt-2 text-center text-sm font-medium",children:"Light"})]}),a.jsxs("button",{onClick:()=>o({theme:"dark"}),className:`p-4 rounded-lg border-2 transition-colors ${n.theme==="dark"?"border-sky-500 bg-sky-500/20":"border-slate-600 hover:border-slate-500"}`,children:[a.jsx("div",{className:"w-full h-12 bg-gray-900 rounded"}),a.jsx("p",{className:"mt-2 text-center text-sm font-medium",children:"Dark"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Font Family"}),a.jsx("div",{className:"grid grid-cols-3 gap-2",children:["Original","Serif","Sans-Serif"].map(w=>a.jsx("button",{onClick:()=>o({fontFamily:w}),className:`py-2 px-1 rounded-lg border-2 transition-colors text-center text-sm truncate ${n.fontFamily===w?"border-sky-500 bg-sky-500/20":"border-slate-600 hover:border-slate-500"}`,children:a.jsx("span",{className:w==="Serif"?"font-serif-custom":w==="Sans-Serif"?"font-sans-custom":"font-original",children:w})},w))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Reading Mode"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("button",{onClick:()=>o({flow:"paginated"}),className:`p-4 rounded-lg border-2 transition-colors text-center ${n.flow==="paginated"?"border-sky-500 bg-sky-500/20":"border-slate-600 hover:border-slate-500"}`,children:[a.jsx("span",{className:"block text-sm font-medium",children:"Paginated"}),a.jsx("span",{className:"block text-xs text-slate-400 mt-1",children:"Turn pages like a real book."})]}),a.jsxs("button",{onClick:()=>o({flow:"scrolled"}),className:`p-4 rounded-lg border-2 transition-colors text-center ${n.flow==="scrolled"?"border-sky-500 bg-sky-500/20":"border-slate-600 hover:border-slate-500"}`,children:[a.jsx("span",{className:"block text-sm font-medium",children:"Scrolled"}),a.jsx("span",{className:"block text-xs text-slate-400 mt-1",children:"Scroll like a webpage."})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Citation Format"}),a.jsx("div",{className:"grid grid-cols-3 gap-2",children:["APA","MLA","Chicago"].map(w=>a.jsx("button",{onClick:()=>o({citationFormat:w.toLowerCase()}),className:`py-2 px-1 rounded-lg border-2 transition-colors text-center text-sm truncate ${n.citationFormat===w.toLowerCase()?"border-sky-500 bg-sky-500/20":"border-slate-600 hover:border-slate-500"}`,children:w},w))})]})]}),u==="readAloud"&&a.jsx(k,{})]})]})]})},El=({children:r,label:i,placement:n="top"})=>{const[o,u]=P.useState(!1),l=P.useRef(null);return a.jsxs("div",{ref:l,className:"relative inline-flex",onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),onFocus:()=>u(!0),onBlur:()=>u(!1),children:[r,a.jsx("div",{role:"tooltip","aria-hidden":!o,className:`pointer-events-none z-50 absolute whitespace-nowrap bg-slate-800 text-white text-xs rounded px-2 py-1 transition-all duration-200 transform ${o?"opacity-100 scale-100":"opacity-0 scale-95"}`+(n==="top"?" -bottom-9 left-1/2 -translate-x-1/2":""),children:i})]})},vh=({isOpen:r,onClose:i,onZoomIn:n,onZoomOut:o,onToggleFit:u,activeReader:l=null})=>{const d=P.useRef(null),f=br({isActive:r,initialFocusRef:d,onEscape:i});if(!r)return null;const h=[{key:"?",description:"Show/hide keyboard shortcuts",category:"global",action:()=>{}},{key:"Escape",description:"Close active modal or return to library",category:"global",action:()=>{}}],y=l?[{key:"ArrowLeft",description:"Previous page",category:"reader",action:()=>{}},{key:"ArrowRight",description:"Next page",category:"reader",action:()=>{}},{key:" ",description:"Next page",category:"reader",action:()=>{}},{key:"+",description:`Zoom in ${l==="epub"?"(increase font size)":""}`,category:"reader",action:()=>{}},{key:"-",description:`Zoom out ${l==="epub"?"(decrease font size)":""}`,category:"reader",action:()=>{}},{key:"f",description:"Toggle fit width / fit page",category:"reader",action:()=>{}},{key:"c",description:"Open/close contents & bookmarks",category:"reader",action:()=>{}},{key:"b",description:"Add a quick bookmark for current page",category:"reader",action:()=>{}}]:[],k=w=>a.jsxs("li",{className:"flex items-start gap-2",children:[a.jsx("kbd",{className:"px-2 py-1 bg-slate-700 rounded text-xs font-mono min-w-[3rem] text-center",children:gy(w)}),a.jsx("span",{className:"flex-1",children:w.description})]},`${w.key}-${w.description}`);return a.jsxs("div",{className:"fixed inset-0 z-40 flex items-center justify-center",role:"presentation",children:[a.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:i}),a.jsxs("div",{ref:f,role:"dialog","aria-modal":"true","aria-labelledby":"shortcut-help-title",className:"relative bg-slate-800 text-white rounded-lg shadow-lg max-w-2xl w-full mx-4 p-6 max-h-[90vh] overflow-y-auto",onClick:w=>w.stopPropagation(),children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{id:"shortcut-help-title",className:"text-xl font-bold",children:"Keyboard Shortcuts"}),a.jsx("button",{ref:d,onClick:i,className:"p-2 rounded hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":"Close help",children:"✕"})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("h4",{className:"text-sm font-semibold text-slate-400 uppercase tracking-wide mb-3",children:"Global"}),a.jsx("ul",{className:"space-y-2 text-sm",children:h.map(k)})]}),l&&a.jsxs("div",{className:"mb-6",children:[a.jsxs("h4",{className:"text-sm font-semibold text-slate-400 uppercase tracking-wide mb-3",children:["Reader (",l==="epub"?"EPUB":"PDF",")"]}),a.jsx("ul",{className:"space-y-2 text-sm",children:y.map(k)})]}),l&&n&&o&&u&&a.jsxs("div",{className:"mt-6 pt-4 border-t border-slate-700",children:[a.jsx("h4",{className:"text-sm font-semibold text-slate-400 uppercase tracking-wide mb-3",children:"Quick Actions"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(El,{label:"Zoom out (-)",children:a.jsx("button",{onClick:o,className:"p-3 rounded-full bg-slate-700 hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":"Zoom out",children:a.jsx(d0,{className:"w-5 h-5 text-slate-50"})})}),a.jsx(El,{label:"Zoom in (+)",children:a.jsx("button",{onClick:n,className:"p-3 rounded-full bg-slate-700 hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":"Zoom in",children:a.jsx(rh,{className:"w-5 h-5 text-slate-50"})})}),a.jsx(El,{label:"Toggle fit (F)",children:a.jsx("button",{onClick:u,className:"p-3 rounded-full bg-slate-700 hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":"Toggle fit mode",children:a.jsx(Jf,{className:"w-5 h-5 text-slate-50"})})})]})]}),a.jsxs("div",{className:"mt-6 pt-4 border-t border-slate-700 text-xs text-slate-400",children:[a.jsx("p",{children:"💡 Tip: Keyboard shortcuts are disabled when typing in text fields."}),a.jsxs("p",{className:"mt-1",children:["Press ",a.jsx("kbd",{className:"px-1 py-0.5 bg-slate-700 rounded text-xs",children:"?"})," anytime to view this help."]})]})]})]})},xh=r=>{if(!r)return"n.d.";const i=new Date(r).getFullYear();if(!isNaN(i))return i.toString();const n=r.match(/^\d{4}/);return n?n[0]:"n.d."},wh=(r,i)=>{const n=r.split(" ").filter(l=>l.trim());if(n.length<2)return r;const o=n.pop(),u=n;if(i==="apa"){const l=u.map(d=>d[0]?`${d[0]}.`:"").join(" ");return`${o}, ${l}`}return`${o}, ${u.join(" ")}`},Ry=(r,i)=>{const n=r.author||"Unknown Author",o=r.title||"Untitled Book",u=r.publisher||"[Publisher not available]",l=xh(r.publicationDate),d=wh(n,i);switch(i){case"apa":return{pre:`${d} (${l}). `,title:o,post:`. ${u}.`,isItalic:!0};case"mla":return{pre:`${d}. `,title:o,post:`. ${u}, ${l==="n.d."?"[Date not available]":l}.`,isItalic:!0};case"chicago":return{pre:`${d}. `,title:o,post:`. ${u}, ${l==="n.d."?"[Date not available]":l}.`,isItalic:!1};default:return{pre:`${n}. `,title:o,post:".",isItalic:!1}}},Ay=(r,i)=>{const n=[],o=xh(r.publicationDate);return i.forEach(u=>{const l=[];l.push("TY  - CHAP"),r.author&&l.push(`AU  - ${wh(r.author,"ris")}`),r.title&&l.push(`T2  - ${r.title}`),r.publisher&&l.push(`PB  - ${r.publisher}`),o!=="n.d."&&l.push(`PY  - ${o}`),r.isbn&&l.push(`SN  - ${r.isbn}`),u.chapter&&l.push(`TI  - ${u.chapter}`),u.pageNumber&&l.push(`SP  - ${u.pageNumber}`);const d=(u.note||"").replace(/(\r\n|\n|\r)/gm," ");d&&l.push(`N1  - ${d}`),l.push("ER  - "),n.push(l.join(`\r
`))}),n.join(`\r
\r
`)+`\r
`},bh=({item:r,onNavigate:i,level:n})=>{const[o,u]=P.useState(!1),l=!!(r.subitems&&r.subitems.length>0),f=n===0?"font-semibold text-slate-200":"font-normal text-slate-300";return a.jsxs("li",{children:[a.jsxs("div",{className:"flex items-center justify-between w-full py-2 pr-3 hover:bg-sky-500/10","data-level":n,children:[a.jsx("button",{onClick:()=>{r.href&&i(r.href)},className:`flex-1 text-left ${f} group-hover:text-sky-300 transition-colors focus:outline-none`,"aria-label":`Go to ${r.label}`,children:r.label.trim()}),l&&a.jsx("button",{onClick:()=>u(!o),"aria-label":o?`Collapse ${r.label}`:`Expand ${r.label}`,className:"p-1 ml-2 rounded hover:bg-slate-700",children:a.jsx(Xf,{className:`w-4 h-4 text-slate-500 transition-transform duration-200 flex-shrink-0 ${o?"rotate-90":""}`})})]}),l&&a.jsx("div",{className:`transition-all duration-300 ease-in-out overflow-hidden ${o?"max-h-[1000px]":"max-h-0"}`,children:a.jsx("ul",{className:"pt-1",children:r.subitems.map(y=>a.jsx(bh,{item:y,onNavigate:i,level:n+1},y.id))})})]})},Ty=({isOpen:r,onClose:i,toc:n,onTocNavigate:o,bookmarks:u,onBookmarkNavigate:l,onDeleteBookmark:d,citations:f,onCitationNavigate:h,onDeleteCitation:y,settings:k,bookData:w})=>{const[x,b]=P.useState("toc"),C=()=>{if(!w||f.length===0)return;const m=Ay(w,f),S=new Blob([m],{type:"application/x-research-info-systems;charset=utf-8"}),_=`${(w.title||"book").replace(/[^a-z0-9]/gi,"_").toLowerCase()}_citations.ris`,L=document.createElement("a");L.href=URL.createObjectURL(S),L.download=_,document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(L.href)};return r?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 bg-black/60 z-30",onClick:i,"aria-hidden":"true"}),a.jsxs("div",{className:`fixed top-0 left-0 h-full w-80 bg-slate-800 shadow-2xl z-40 transform transition-transform duration-300 ease-in-out flex flex-col ${r?"translate-x-0":"-translate-x-full"}`,role:"dialog","aria-modal":"true","aria-labelledby":"nav-heading",children:[a.jsxs("div",{className:"p-4 border-b border-slate-700 flex justify-between items-center flex-shrink-0",children:[a.jsx("h3",{id:"nav-heading",className:"text-xl font-semibold text-white",children:"Navigation"}),a.jsx("button",{onClick:i,className:"p-2 rounded-full hover:bg-slate-700","aria-label":"Close navigation panel",children:a.jsx(ir,{className:"w-6 h-6"})})]}),a.jsx("div",{className:"border-b border-slate-700 px-2 flex-shrink-0",children:a.jsxs("nav",{className:"flex -mb-px",children:[a.jsx("button",{onClick:()=>b("toc"),className:`py-3 px-4 text-sm font-medium border-b-2 transition-colors duration-200 ${x==="toc"?"border-sky-400 text-sky-300":"border-transparent text-slate-400 hover:text-white hover:border-slate-500"}`,"aria-current":x==="toc"?"page":void 0,children:"Contents"}),a.jsx("button",{onClick:()=>b("bookmarks"),className:`py-3 px-4 text-sm font-medium border-b-2 transition-colors duration-200 ${x==="bookmarks"?"border-sky-400 text-sky-300":"border-transparent text-slate-400 hover:text-white hover:border-slate-500"}`,"aria-current":x==="bookmarks"?"page":void 0,children:"Bookmarks"}),a.jsx("button",{onClick:()=>b("citations"),className:`py-3 px-4 text-sm font-medium border-b-2 transition-colors duration-200 ${x==="citations"?"border-sky-400 text-sky-300":"border-transparent text-slate-400 hover:text-white hover:border-slate-500"}`,"aria-current":x==="citations"?"page":void 0,children:"Citations"})]})}),a.jsxs("div",{className:"overflow-y-auto flex-grow",children:[x==="toc"&&a.jsx("div",{className:"p-4",children:n.length>0?a.jsx("ul",{className:"space-y-1",children:n.map(m=>a.jsx(bh,{item:m,onNavigate:o,level:0},m.id))}):a.jsx("p",{className:"p-4 text-slate-400 text-center",children:"No table of contents available."})}),x==="bookmarks"&&a.jsx("div",{children:u.length>0?a.jsx("ul",{className:"divide-y divide-slate-700",children:u.sort((m,S)=>m.createdAt-S.createdAt).map(m=>a.jsxs("li",{className:"p-4 flex items-center justify-between group",children:[a.jsxs("button",{onClick:()=>l(m.cfi),className:"flex-grow text-left pr-4",children:[m.chapter&&a.jsx("span",{className:"block text-xs font-semibold text-sky-400 uppercase tracking-wider mb-1",children:m.chapter}),a.jsx("span",{className:"block text-sm font-semibold text-slate-200 group-hover:text-sky-300 transition-colors",children:m.label}),m.description&&a.jsx("blockquote",{className:"mt-2 pl-3 border-l-2 border-slate-600",children:a.jsx("p",{className:"text-sm text-slate-300 italic",children:m.description})}),a.jsx("span",{className:"block text-xs text-slate-400 mt-2",children:new Date(m.createdAt).toLocaleString()})]}),a.jsx("button",{onClick:()=>d(m.id),className:"p-2 rounded-full hover:bg-red-500/20 text-slate-500 hover:text-red-400 transition-colors flex-shrink-0","aria-label":`Delete bookmark: ${m.label}`,children:a.jsx(oi,{className:"w-5 h-5"})})]},m.id))}):a.jsx("p",{className:"p-8 text-slate-400 text-center",children:"You haven't added any bookmarks yet."})}),x==="citations"&&a.jsxs("div",{children:[w&&f.length>0&&a.jsx("div",{className:"p-4 border-b border-slate-700",children:a.jsxs("button",{onClick:C,className:"w-full flex items-center justify-center gap-2 py-2 px-4 rounded-md bg-sky-500 hover:bg-sky-600 transition-colors font-semibold text-white text-sm",children:[a.jsx(l0,{className:"w-5 h-5"}),a.jsx("span",{children:"Export Citations (.ris)"})]})}),f.length>0&&w?a.jsx("ul",{className:"divide-y divide-slate-700",children:f.sort((m,S)=>m.createdAt-S.createdAt).map(m=>{const S=Ry(w,k.citationFormat);return a.jsxs("li",{className:"p-4 flex items-center justify-between group",children:[a.jsxs("button",{onClick:()=>h(m.cfi),className:"flex-grow text-left pr-4",children:[m.chapter&&a.jsx("span",{className:"block text-xs font-semibold text-sky-400 uppercase tracking-wider mb-1",children:m.chapter}),a.jsxs("p",{className:"text-sm text-slate-200 group-hover:text-sky-300 transition-colors",children:[S.pre,a.jsx("span",{className:`${S.isItalic?"italic":"not-italic"} text-slate-300 group-hover:text-sky-400`,children:S.title}),S.post]}),m.note&&a.jsx("blockquote",{className:"mt-2 pl-3 border-l-2 border-slate-600",children:a.jsxs("p",{className:"text-sm text-slate-300 italic",children:['"',m.note,'"']})}),a.jsxs("div",{className:"flex justify-between items-center text-xs text-slate-400 mt-2",children:[a.jsx("span",{children:new Date(m.createdAt).toLocaleString()}),m.pageNumber&&a.jsxs("span",{className:"font-semibold bg-slate-700 px-1.5 py-0.5 rounded",children:["p. ",m.pageNumber]})]})]}),a.jsx("button",{onClick:()=>y(m.id),className:"p-2 rounded-full hover:bg-red-500/20 text-slate-500 hover:text-red-400 transition-colors flex-shrink-0","aria-label":"Delete citation",children:a.jsx(oi,{className:"w-5 h-5"})})]},m.id)})}):a.jsx("p",{className:"p-8 text-slate-400 text-center",children:"You haven't created any citations yet."})]})]})]})]}):null},Py=({value:r,isOpen:i})=>a.jsx("div",{className:"fixed left-1/2 transform -translate-x-1/2 top-6 z-50 pointer-events-none",children:a.jsx("div",{"aria-hidden":!i,"aria-live":"polite",className:`mx-auto transition-all ${i?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-95 -translate-y-2"} duration-300`,children:a.jsx("div",{className:"bg-sky-600 text-white px-5 py-2 rounded-full shadow-2xl text-sm sm:text-base font-semibold ring-1 ring-sky-700",children:r})})}),Oy=({bookId:r,onClose:i,animationData:n})=>{const[o,u]=P.useState(null),[l,d]=P.useState(null),[f,h]=P.useState(!0),[y,k]=P.useState(!1),[w,x]=P.useState(!1),[b,C]=P.useState(!1),[m,S]=P.useState(!1),[j,_]=P.useState(!1),[L,U]=P.useState([]),[M,re]=P.useState([]),[J,$]=P.useState([]),[z,Q]=P.useState([]),[ae,F]=P.useState(!1),[te,N]=P.useState(""),[K,ge]=P.useState({currentPage:0,totalPages:0,progress:0}),[ne,le]=P.useState(!0),[ie,ue]=P.useState(null),[A,B]=P.useState(""),[me,he]=P.useState(null),[se,we]=P.useState(n?"start":"finished"),[Ee,xe]=P.useState(!1),[je,Te]=P.useState(!1);P.useEffect(()=>{if(!je)return;const ye=window.setTimeout(()=>Te(!1),8e3);return()=>clearTimeout(ye)},[je]);const[Fe,He]=P.useState("stopped"),[Me,v]=P.useState(!1),[X,H]=P.useState(!1),I=P.useRef(null);P.useEffect(()=>{if(X)return I.current&&clearTimeout(I.current),I.current=window.setTimeout(()=>H(!1),1200),()=>{I.current&&(clearTimeout(I.current),I.current=null)}},[X]);const[O,V]=P.useState(df),G=P.useRef(null),oe=P.useRef(null),Y=P.useRef(null),E=P.useRef(null),T=P.useRef(O);T.current=O;const D=P.useRef(Fe);D.current=Fe;const q=P.useRef(null),ve=P.useRef(null),Ce=P.useRef(null),$e=P.useRef(null),We=P.useRef(null),Qe=P.useRef(null),Je=P.useRef(null),Be=P.useRef(null),ut=P.useRef(!1),Lt=P.useRef(null),Ze=P.useRef(null),Jt=P.useRef(null),It=P.useRef(null),kr=P.useRef(""),Rr=P.useRef(null),Dt=P.useRef(!1),Ct=P.useMemo(()=>y||w||b,[y,w,b]),Wt=P.useCallback(()=>{Je.current&&clearTimeout(Je.current)},[]),mn=P.useCallback(()=>{Wt(),Ct||(Je.current=window.setTimeout(()=>{le(!1)},3e3))},[Ct,Wt]);P.useEffect(()=>{if(se!=="start")return;const ye=setTimeout(()=>we("expanding"),50);return()=>clearTimeout(ye)},[se]),P.useEffect(()=>{const ye=oe.current;!ye||!n||(se==="start"?(ye.style.position="absolute",ye.style.top=`${n.rect.top}px`,ye.style.left=`${n.rect.left}px`,ye.style.width=`${n.rect.width}px`,ye.style.height=`${n.rect.height}px`,ye.style.transition="all 0.6s cubic-bezier(0.4, 0, 0.2, 1)"):se==="expanding"&&(ye.style.position="absolute",ye.style.top="50%",ye.style.left="50%",ye.style.transform="translate(-50%, -50%)",ye.style.width="auto",ye.style.height="80vh",ye.style.transition="all 0.6s cubic-bezier(0.4, 0, 0.2, 1)"))},[se,n]),P.useEffect(()=>{(async()=>{const Re=await it.getBook(r);Re?u(Re):(console.error("Book not found"),i())})()},[r,i]),P.useEffect(()=>{const ye=()=>{if(df().readAloud.voiceURI)return;const Oe=window.speechSynthesis.getVoices();if(Oe.length===0)return;const qe=Oe.find(Le=>Le.default)||Oe.find(Le=>Le.lang==="en-US"&&/google/i.test(Le.name))||Oe.find(Le=>Le.lang==="en-US"&&/microsoft/i.test(Le.name))||Oe.find(Le=>Le.lang==="en-US"&&Le.localService)||Oe.find(Le=>Le.lang==="en-US")||null;qe&&V(Le=>{const Xe={...Le.readAloud,voiceURI:qe.voiceURI},nt={...Le,readAloud:Xe};return ff(nt),nt})};return window.speechSynthesis.getVoices().length>0?ye():window.speechSynthesis.onvoiceschanged=ye,()=>{window.speechSynthesis.onvoiceschanged=null}},[]);const zn=P.useCallback(()=>{Jt.current&&ei.saveSpeechPosition(r,Jt.current)},[r]),zr=P.useCallback(()=>{Lt.current&&E.current&&(E.current.annotations.remove(Lt.current,"highlight"),Lt.current=null)},[]),At=P.useCallback(()=>{D.current!=="stopped"&&zn(),He("stopped"),window.speechSynthesis.cancel(),Dt.current=!1,zr(),Ze.current=null,Jt.current=null,kr.current=""},[zr,zn]),gn=P.useCallback(()=>{const ye=E.current;if(!ye)return;D.current!=="stopped"&&(window.speechSynthesis.cancel(),zr());const Re=ye.getContents();if(!Re||Re.length===0)return;const Oe=Re[0].document?.body;if(!Oe)return;const qe=Oe.textContent||"",Le=qe.replace(/\s+/g," ").trim();if(!Le){T.current.flow==="paginated"&&D.current==="playing"&&(Dt.current=!0,ye.next());return}let Xe=Le,nt=0;const Wr=It.current;if(Wr)try{const Ye=Re[0].range(Wr);if(Ye){const Nt=Ye.toString().replace(/\s+/g," ").trim(),Tt=Le.indexOf(Nt);Tt!==-1&&(nt=Tt,Xe=Le.substring(nt))}}catch(Ye){console.error("Could not find start CFI for speech, starting from beginning.",Ye)}finally{It.current=null}Rr.current={rawText:qe,normalizedText:Le,startIndexInNormalized:nt};const st=new SpeechSynthesisUtterance(Xe);Ze.current=st;const at=window.speechSynthesis.getVoices(),jt=T.current,dt=at.find(Ye=>Ye.voiceURI===jt.readAloud.voiceURI);st.voice=dt||null,st.rate=jt.readAloud.rate,st.pitch=jt.readAloud.pitch,st.volume=jt.readAloud.volume,st.onboundary=Ye=>{if(Ye.name!=="word"||!E.current||!Oe||!Rr.current)return;const{rawText:Nt,normalizedText:Tt,startIndexInNormalized:Vr}=Rr.current;Ye.charIndex+Vr},st.onend=()=>{if(zr(),D.current!=="playing"){if(D.current==="paused")return;He("stopped");return}T.current.flow==="paginated"?(Dt.current=!0,E.current?.next()):He("stopped")},st.onerror=Ye=>{console.error("SpeechSynthesisUtterance error",Ye),At()},window.speechSynthesis.speak(st),He("playing")},[At,zr]);P.useEffect(()=>{if(se!=="finished"||!o||!G.current)return;let ye=!0;return(async()=>{try{h(!0);const Oe=window.ePub,qe=Oe(o.epubData);Y.current=qe,G.current&&(G.current.innerHTML="",G.current.style.opacity="0");const Le=qe.renderTo(G.current,{width:"100%",height:"100%",flow:O.flow==="scrolled"?"scrolled-doc":"paginated",manager:"default",spread:"auto"});if(!ye)return;d(Le),E.current=Le;const Xe=await qe.loaded.navigation;if(!ye)return;try{if(Xe&&Xe.toc&&Array.isArray(Xe.toc)&&Xe.toc.length>0)Er()&&console.debug("ReaderView: using navigation.toc with",Xe.toc.length,"entries"),U(Xe.toc),Te(!1);else{Er()&&console.debug("ReaderView: navigation.toc missing or empty, building fallback TOC from spine");const dt=hf(qe),Ye=dt.map(Nt=>({id:Nt.id,href:Nt.href,label:Nt.label,subitems:[]}));U(Ye),Te(!0);try{rf("toc_fallback",{bookId:r,fallbackCount:dt&&dt.length||0})}catch{}}}catch(dt){Er()&&console.warn("Error processing navigation TOC, using fallback",dt);const Ye=hf(qe),Nt=Ye.map(Tt=>({id:Tt.id,href:Tt.href,label:Tt.label,subitems:[]}));U(Nt),Te(!0);try{rf("toc_fallback",{bookId:r,fallbackCount:Ye&&Ye.length||0,error:String(dt)})}catch{}}if(q.current=Xe||null,xe(!0),Le.on("relocated",dt=>{if(!ye)return;const Ye=dt.start.cfi;if(ue(Ye),Ye&&(Ce.current=Ye,$e.current&&clearTimeout($e.current),$e.current=window.setTimeout(()=>{ei.savePosition(r,Ye)},1e3)),ut.current&&Y.current?.locations){const Nt=Y.current.locations,Tt=Nt.locationFromCfi(dt.start.cfi);if(Tt>-1){const Vr=Nt.percentageFromCfi(dt.start.cfi);ge({currentPage:Tt+1,totalPages:Nt.length(),progress:Math.round((Vr||0)*100)})}}Dt.current&&(Dt.current=!1,gn())}),await qe.ready,!ye||(ut.current=!1,await qe.locations.generate(1600),!ye))return;ut.current=!0,qe.locations&&ge(dt=>({...dt,totalPages:qe.locations.length(),currentPage:1}));const nt=yo.findByBookId(r);nt.success&&re(nt.data);const Wr=Nl.findByBookId(r);Wr.success&&$(Wr.data);const st=ei.getSpeechPosition(r);It.current=st.success?st.data:null;const at=ei.getPosition(r),jt=(at.success?at.data:null)||await ny(qe);if(!ye)return;if(Le)try{await Le.display(jt||void 0)}catch(dt){console.warn(`rendition.display failed for ${jt}. Attempting spine fallback.`,dt);try{const Ye=qe?.spine?.items&&qe.spine.items.length>0?qe.spine.items[0].href:void 0;Ye?await Le.display(Ye):await Le.display()}catch(Ye){console.error("Failed to display book using spine fallback or default",Ye)}}if(!ye)return;h(!1),G.current&&(G.current.style.transition="opacity 0.3s ease-in",G.current.style.opacity="1");try{if(r){const dt=sy(r);dt&&dt.fontSize&&typeof dt.fontSize=="number"&&V(Ye=>({...Ye,fontSize:dt.fontSize}))}}catch{}}catch(Oe){ye&&console.error("Error initializing EPUB:",Oe)}})(),()=>{ye=!1,At(),$e.current&&clearTimeout($e.current),Ce.current&&ei.savePosition(r,Ce.current),ut.current=!1,xe(!1),q.current=null,Y.current&&(Y.current.destroy(),Y.current=null),E.current=null,d(null)}},[r,o,O.flow,se,gn,At]),P.useEffect(()=>{if(l){if(!l.themesRegistered){const ye={body:{color:"#000",background:"#fff"}},Re={body:{color:"#fff",background:"#1f2937"}};l.themes.register("light",ye),l.themes.register("dark",Re),l.themesRegistered=!0}l.themes.select(O.theme),l.themes.fontSize(`${O.fontSize}%`),O.fontFamily==="Original"?l.themes.font("inherit"):O.fontFamily==="Serif"?l.themes.font('Georgia, "Times New Roman", serif'):O.fontFamily==="Sans-Serif"&&l.themes.font('"Helvetica Neue", Helvetica, Arial, sans-serif')}ff(O)},[l,O]),P.useEffect(()=>{if(r)try{iy(r,{fontSize:O.fontSize})}catch(ye){console.warn("Failed to save epub view state",ye)}},[O.fontSize,r]);const gs=()=>{V(ye=>{const Re=Math.min(300,Math.round(ye.fontSize*1.15));return{...ye,fontSize:Re}}),H(!0)},Mr=()=>{V(ye=>{const Re=Math.max(50,Math.round(ye.fontSize/1.15));return{...ye,fontSize:Re}}),H(!0)},Mn=()=>{V(ye=>({...ye,flow:ye.flow==="paginated"?"scrolled":"paginated"}))};P.useEffect(()=>()=>{window.speechSynthesis.cancel()},[]),P.useEffect(()=>{if(l)return Be.current&&(clearTimeout(Be.current),Be.current=null),Be.current=window.setTimeout(()=>{try{E.current&&typeof E.current.resize=="function"&&E.current.resize()}catch(ye){console.warn("Safe resize failed, rendition may no longer be available.",ye)}},50),()=>{Be.current&&(clearTimeout(Be.current),Be.current=null)}},[ne,l]),P.useEffect(()=>(ne&&!Ct?mn():Wt(),Ct&&!ne&&le(!0),Wt),[ne,Ct,mn,Wt]),P.useEffect(()=>{if(ie&&Ee&&q.current){const Re=q.current.get(ie);Re&&typeof Re.then=="function"&&Re.then(Oe=>{Oe&&Oe.label&&B(Oe.label.trim())})}},[ie,Ee]);const er=P.useCallback(()=>{l?.next(),le(!0),At()},[l,At]),$r=P.useCallback(()=>{l?.prev(),le(!0),At()},[l,At]);P.useEffect(()=>{const ye=Re=>{const Oe=document.activeElement&&document.activeElement.tagName;if(!(Oe==="INPUT"||Oe==="TEXTAREA")){if(Re.key==="ArrowLeft")$r();else if(Re.key==="ArrowRight")er();else if(Re.key===" ")Re.preventDefault(),er();else if(Re.key.toLowerCase()==="c")x(qe=>!qe);else if(Re.key==="?")v(qe=>!qe);else if(Re.key==="+"||Re.key==="="&&Re.shiftKey)gs();else if(Re.key==="-"||Re.key==="_")Mr();else if(Re.key.toLowerCase()==="f")Mn();else if(Re.key.toLowerCase()==="b"){if(!Ce.current)return;new Date().toISOString(),Ce.current,`${K.currentPage}`;const qe=yo.add(r,{cfi:Ce.current,label:`Page ${K.currentPage}`,chapter:A});if(qe.success){const Le=[...M,qe.data];re(Le)}}}};return window.addEventListener("keydown",ye),()=>window.removeEventListener("keydown",ye)},[$r,er,M,r,K.currentPage,A]),P.useEffect(()=>{if(!l)return;const ye=Re=>{if(y||w||b||!G.current)return;const Oe=G.current.getBoundingClientRect(),qe=Re.clientX-Oe.left,Le=Oe.width,Xe=Le*.3;O.flow==="paginated"?qe<Xe?$r():qe>Le-Xe?er():le(nt=>!nt):le(nt=>!nt)};return l.on("click",ye),()=>{l.off("click",ye)}},[l,O.flow,y,w,b,$r,er]);const yn=ye=>{V(Re=>{const Oe={...Re,...ye};return ye.readAloud&&(Oe.readAloud={...Re.readAloud,...ye.readAloud}),Oe})},or=P.useCallback(async ye=>{if(!E.current){Er()&&console.warn("safeDisplay: rendition not ready");return}try{await E.current.display(ye||void 0)}catch(Re){Er()&&console.warn("safeDisplay: rendition.display failed for",ye,Re);try{const Oe=Y.current,qe=new Set,Le=async at=>{if(!at||qe.has(at))return!1;qe.add(at);try{return Er()&&console.debug("safeDisplay: trying candidate",at),await E.current.display(at),!0}catch(jt){return Er()&&console.debug("safeDisplay: candidate failed",at,jt),!1}};if(!ye){const at=Oe?.spine?.items&&Oe.spine.items.length>0?Oe.spine.items[0].href:void 0;if(at&&await Le(at))return;await Le(void 0);return}const Xe=ye;if(await Le(Xe))return;const nt=Xe.split("#")[0];if(nt!==Xe&&await Le(nt))return;if(!/[\/.]/.test(Xe)&&Oe?.spine?.items){for(const at of Oe.spine.items)if(at.id===Xe||at.idref===Xe||at.href&&at.href.split("#")[0].endsWith(Xe)){const jt=at.href;if(jt&&await Le(jt))return}}if(Oe?.spine?.items){const at=nt.split("/").pop();if(at){for(const jt of Oe.spine.items)if(jt.href&&jt.href.split("#")[0].endsWith(at)&&await Le(jt.href))return}}const st=Oe?.spine?.items&&Oe.spine.items.length>0?Oe.spine.items[0].href:void 0;if(st&&await Le(st))return;await Le(void 0)}catch(Oe){console.error("safeDisplay: rendition.display fallback failed",Oe)}}},[]),$n=ye=>{At(),or(ye),x(!1)},ys=ye=>{At(),or(ye),x(!1)},Oo=ye=>{At(),or(ye),x(!1)},Lo=P.useCallback(async ye=>{if(!Ce.current)return;const Re=Ce.current;let Oe=A;if(q.current)try{const Le=q.current.get(Re);if(Le&&typeof Le.then=="function"){const Xe=await Le;Xe?.label&&(Oe=Xe.label.trim())}}catch(Le){console.warn("Could not fetch chapter for bookmark, using last known chapter.",Le)}new Date().toISOString(),`${K.currentPage}${K.progress}`;const qe=yo.add(r,{cfi:Ce.current,label:`Page ${K.currentPage} (${K.progress}%)`,chapter:Oe,description:ye||void 0});if(qe.success){const Le=[...M,qe.data];re(Le)}_(!1)},[r,M,K.currentPage,K.progress,A]),vs=P.useCallback(ye=>{if(yo.delete(r,ye).success){const Oe=M.filter(qe=>qe.id!==ye);re(Oe)}},[r,M]),Ar=P.useCallback(async ye=>{if(!Ce.current)return;const Re=Ce.current;let Oe=A;if(q.current)try{const Le=q.current.get(Re);if(Le&&typeof Le.then=="function"){const Xe=await Le;Xe?.label&&(Oe=Xe.label.trim())}}catch(Le){console.warn("Could not fetch chapter for citation, using last known chapter.",Le)}const qe=Nl.add(r,{cfi:Re,note:ye,pageNumber:K.currentPage>0?K.currentPage:void 0,chapter:Oe});if(qe.success){const Le=[...J,qe.data];$(Le)}S(!1)},[r,J,K.currentPage,A]),li=P.useCallback(ye=>{if(Nl.delete(r,ye).success){const Oe=J.filter(qe=>qe.id!==ye);$(Oe)}},[r,J]),vn=P.useMemo(()=>M.some(ye=>ye.cfi===ie),[M,ie]),Io=P.useCallback(()=>{if(vn){const ye=M.find(Re=>Re.cfi===ie);ye&&vs(ye.id)}else _(!0)},[vn,vs,M,ie]),xs=P.useCallback(async ye=>{if(!ye||!Y.current){Q([]),F(!1);return}me&&l&&(l.annotations.remove(me,"highlight"),he(null));try{F(!0);const Re=await ry(Y.current,ye);Q(Re)}catch(Re){console.error("Search failed:",Re),Q([])}finally{F(!1)}},[l,me]),ci=P.useCallback(ye=>{if(N(ye),Qe.current&&clearTimeout(Qe.current),!ye.trim()){Q([]),F(!1);return}Qe.current=window.setTimeout(()=>{xs(ye)},500)},[xs]),ui=P.useCallback(ye=>{l&&(me&&l.annotations.remove(me,"highlight"),At(),C(!1),or(ye).then(()=>{try{l.annotations.add("highlight",ye,{},void 0,"hl",{fill:"yellow","fill-opacity":"0.3"}),he(ye)}catch(Re){console.warn("Failed to add highlight after navigation",Re)}}))},[l,me,At]),di=()=>{C(!1),me&&l&&(l.annotations.remove(me,"highlight"),he(null))},Do=ye=>{if(l&&Y.current?.locations&&ut.current){le(!0),At();const Re=parseInt(ye.target.value,10);ge(Oe=>({...Oe,progress:Re})),ve.current&&clearTimeout(ve.current),ve.current=window.setTimeout(()=>{const Oe=Y.current.locations.cfiFromPercentage(Re/100);or(Oe)},150)}},Fo=ye=>{O.flow==="paginated"&&(We.current=ye.touches[0].clientX)},ht=ye=>{if(O.flow!=="paginated"||We.current===null)return;const Re=ye.changedTouches[0].clientX-We.current;Re>50?$r():Re<-50&&er(),We.current=null},Bo=()=>{D.current==="playing"?(He("paused"),window.speechSynthesis.pause(),zn(),Dt.current=!1):D.current==="paused"?(He("playing"),window.speechSynthesis.resume()):gn()};return a.jsxs(a.Fragment,{children:[n&&se!=="finished"&&a.jsx("div",{className:`fixed inset-0 bg-slate-900 z-50 flex justify-center items-center transition-opacity duration-300 ${se==="fading"?"opacity-0":"opacity-100"}`,onTransitionEnd:()=>{se==="fading"&&we("finished")},children:n.coverImage&&a.jsx("img",{ref:oe,src:n.coverImage,alt:"Expanding book cover",className:"object-contain rounded-lg shadow-2xl transition-all duration-700 ease-[cubic-bezier(0.4,0,0.2,1)]",onTransitionEnd:()=>{se==="expanding"&&setTimeout(()=>we("fading"),200)}})}),a.jsxs("div",{className:`fixed inset-0 bg-slate-900 flex flex-col select-none transition-opacity duration-500 ${se==="fading"||se==="finished"?"opacity-100":"opacity-0"}`,children:[a.jsxs("header",{className:`flex flex-wrap sm:flex-nowrap items-center justify-between sm:justify-start sm:gap-4 p-2 bg-slate-800 shadow-md z-20 text-white flex-shrink-0 transition-transform duration-300 ease-in-out ${ne?"translate-y-0":"-translate-y-full"}`,onMouseEnter:Wt,onMouseLeave:mn,children:[je&&a.jsx("div",{className:"absolute left-1/2 transform -translate-x-1/2 top-full mt-2 z-40",children:a.jsxs("div",{className:"bg-amber-600 text-black px-4 py-2 rounded shadow-md flex items-center gap-4",children:[a.jsx("span",{className:"text-sm",children:"This book's navigation was incomplete; a fallback contents list was used."}),a.jsx("button",{onClick:()=>{const ye=Y.current?.spine?.items&&Y.current.spine.items.length>0?Y.current.spine.items[0].href:void 0;ye&&or(ye),Te(!1)},className:"bg-black/10 hover:bg-black/20 px-3 py-1 rounded text-sm font-semibold",children:"Open first content"}),a.jsx("button",{onClick:()=>Te(!1),className:"px-2 py-1 text-sm underline",children:"Dismiss"})]})}),a.jsxs("div",{className:"flex items-center gap-2 sm:order-1",children:[a.jsx("button",{onClick:i,className:"p-2 rounded-full hover:bg-slate-700 transition-colors","aria-label":"Close Reader",children:a.jsx(ir,{className:"w-6 h-6"})}),a.jsxs("button",{onClick:()=>x(!0),className:"p-2 rounded-full hover:bg-slate-700 transition-colors relative","aria-label":"Contents and Bookmarks",children:[a.jsx(i0,{className:"w-6 h-6"}),(M.length>0||J.length>0)&&a.jsx("span",{className:"absolute top-1 right-1 block h-2 w-2 rounded-full bg-sky-400 ring-2 ring-slate-800"})]})]}),a.jsxs("div",{className:"flex justify-end items-center gap-2 sm:order-3",children:[a.jsx("button",{onClick:Bo,className:"p-2 rounded-full hover:bg-slate-700 transition-colors focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":Fe==="playing"?"Pause Read Aloud":"Start Read Aloud",children:Fe==="playing"?a.jsx(c0,{className:"w-6 h-6 text-sky-400"}):a.jsx(eh,{className:"w-6 h-6"})}),a.jsx("button",{onClick:()=>C(!0),className:"p-2 rounded-full hover:bg-slate-700 transition-colors focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":"Search in book",children:a.jsx(Yf,{className:"w-6 h-6"})}),a.jsx("button",{onClick:()=>S(!0),className:"p-2 rounded-full hover:bg-slate-700 transition-colors focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":"Create citation for this page",children:a.jsx(a0,{className:"w-6 h-6"})}),a.jsx("button",{onClick:Io,className:"p-2 rounded-full hover:bg-slate-700 transition-colors focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":vn?"Remove bookmark from this page":"Add bookmark to this page",children:a.jsx(o0,{className:"w-6 h-6",filled:vn})}),a.jsx("button",{onClick:()=>v(!0),className:"p-2 rounded-full hover:bg-slate-700 transition-colors focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":"Keyboard help",children:"?"}),a.jsx("button",{onClick:()=>k(!0),className:"p-2 rounded-full hover:bg-slate-700 transition-colors focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":"Settings",children:a.jsx(Gf,{className:"w-6 h-6"})})]}),a.jsxs("div",{className:"text-center truncate px-2 w-full pt-2 sm:order-2 sm:w-auto sm:flex-grow sm:min-w-0 sm:pt-0",children:[a.jsx("h2",{className:"text-lg font-bold",children:o?.title||"Loading..."}),a.jsx("p",{className:"text-sm text-slate-400",children:o?.author})]})]}),a.jsxs("div",{className:"flex-grow relative min-h-0",onTouchStart:Fo,onTouchEnd:ht,children:[f&&a.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900 z-30",children:a.jsx(Fn,{text:"Loading Book..."})}),a.jsx("div",{ref:G,id:"viewer",className:"w-full h-full p-4 md:p-8 bg-slate-900/20"})]}),a.jsxs("footer",{className:`flex items-center gap-4 p-4 bg-slate-800 z-20 text-white flex-shrink-0 transition-transform duration-300 ease-in-out ${ne?"translate-y-0":"translate-y-full"}`,onMouseEnter:Wt,onMouseLeave:mn,children:[O.flow==="paginated"?a.jsx("button",{onClick:$r,className:"p-2 rounded-full hover:bg-slate-700 transition-colors flex-shrink-0","aria-label":"Previous Page",children:a.jsx(To,{className:"w-6 h-6"})}):a.jsx("div",{className:"w-10 h-10 flex-shrink-0"}),a.jsxs("div",{className:"flex-grow flex flex-col justify-center",children:[a.jsx("input",{type:"range",min:"0",max:"100",value:K.progress||0,onChange:Do,className:"w-full h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Book progress",disabled:!ut.current||K.totalPages===0}),a.jsx("div",{className:"text-center text-sm text-slate-300 mt-2","aria-live":"polite",children:K.totalPages>0&&ut.current?a.jsxs("span",{children:["Page ",K.currentPage," of ",K.totalPages," • ",K.progress,"%"]}):a.jsx("span",{className:"text-slate-400",children:"Calculating progress..."})})]}),a.jsxs("div",{className:"w-28 flex flex-col items-center text-sm",children:[a.jsx("label",{className:"text-slate-300 text-xs",children:"Go to"}),a.jsx("input",{type:"number",min:1,max:K.totalPages||9999,value:K.currentPage||"",onChange:ye=>{const Re=parseInt(ye.target.value||"1",10);if(isNaN(Re)||!Y.current?.locations)return;const Oe=Y.current.locations.cfiFromLocation(Re-1);Oe&&or(Oe)},className:"w-full text-center rounded-md bg-slate-700 px-2 py-1 focus:outline-none focus:ring-2 focus:ring-sky-500","aria-label":"Jump to page"})]}),O.flow==="paginated"?a.jsx("button",{onClick:er,className:"p-2 rounded-full hover:bg-slate-700 transition-colors flex-shrink-0","aria-label":"Next Page",children:a.jsx(Zf,{className:"w-6 h-6"})}):a.jsx("div",{className:"w-10 h-10 flex-shrink-0"})]}),a.jsx(Ty,{isOpen:w,onClose:()=>x(!1),toc:L,onTocNavigate:$n,bookmarks:M,onBookmarkNavigate:ys,onDeleteBookmark:vs,citations:J,onCitationNavigate:Oo,onDeleteCitation:li,settings:O,bookData:o}),a.jsx(Ey,{isOpen:b,onClose:di,onQueryChange:ci,onNavigate:ui,results:z,isLoading:ae,searchQuery:te}),a.jsx(_y,{isOpen:y,onClose:()=>k(!1),settings:O,onSettingsChange:yn}),a.jsx(jy,{isOpen:m,onClose:()=>S(!1),onSave:Ar}),a.jsx(Cy,{isOpen:j,onClose:()=>_(!1),onSave:Lo}),a.jsx(vh,{isOpen:Me,onClose:()=>v(!1),onZoomIn:gs,onZoomOut:Mr,onToggleFit:Mn,activeReader:"epub"}),a.jsx(Py,{value:`${O.fontSize}%`,isOpen:X})]})]})},Ly=({isOpen:r,title:i="Confirm",message:n,confirmLabel:o="Confirm",cancelLabel:u="Cancel",onClose:l,onConfirm:d,variant:f="default"})=>{const h=P.useRef(null),y=br({isActive:r,onEscape:l,initialFocusRef:h});return r?a.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:l,role:"dialog","aria-modal":"true",children:a.jsxs("div",{ref:y,className:"bg-slate-800 rounded-lg shadow-xl w-full max-w-md p-6 text-white",onClick:k=>k.stopPropagation(),children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h2",{className:`text-xl font-bold ${f==="danger"?"text-red-300":"text-sky-300"}`,children:i}),a.jsx("button",{onClick:l,className:"p-2 rounded-full hover:bg-slate-700 transition-colors","aria-label":"Close",children:a.jsx(ir,{className:"w-6 h-6"})})]}),a.jsx("p",{className:"text-slate-300 mb-6 text-sm",children:n}),a.jsxs("div",{className:"flex justify-end gap-4",children:[a.jsx("button",{ref:h,onClick:l,className:"py-2 px-4 rounded-md bg-slate-600 hover:bg-slate-500 transition-colors font-semibold",tabIndex:0,children:u}),a.jsx("button",{onClick:d,className:`py-2 px-6 rounded-md transition-colors font-bold ${f==="danger"?"bg-red-600 hover:bg-red-700":"bg-sky-500 hover:bg-sky-600"}`,tabIndex:0,children:o})]})]})}):null},Iy=({isOpen:r,onClose:i,onConfirm:n,bookTitle:o})=>{const u=br({isActive:r,onEscape:i});return r?a.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:i,"aria-modal":"true",role:"dialog",children:a.jsxs("div",{ref:u,className:"bg-slate-800 rounded-lg shadow-xl w-full max-w-md p-6 text-white",onClick:l=>l.stopPropagation(),children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsxs("h2",{className:"text-xl font-bold text-red-400 flex items-center gap-2",children:[a.jsx(oi,{className:"w-6 h-6"}),"Confirm Deletion"]}),a.jsx("button",{onClick:i,className:"p-2 rounded-full hover:bg-slate-700 transition-colors","aria-label":"Close",children:a.jsx(ir,{className:"w-6 h-6"})})]}),a.jsxs("p",{className:"text-slate-300 mb-6 text-sm",children:['Are you sure you want to permanently delete "',a.jsx("strong",{className:"font-semibold text-slate-100",children:o}),'"? This action cannot be undone.']}),a.jsxs("div",{className:"flex justify-end gap-4",children:[a.jsx("button",{onClick:i,className:"py-2 px-4 rounded-md bg-slate-600 hover:bg-slate-500 transition-colors font-semibold",children:"Cancel"}),a.jsx("button",{onClick:n,className:"py-2 px-6 rounded-md bg-red-600 hover:bg-red-700 transition-colors font-bold",children:"Delete"})]})]})}):null},kh=P.createContext(null),Dy=({children:r})=>{const[i,n]=P.useState(!1),[o,u]=P.useState({message:""}),l=P.useRef(()=>{});P.useRef(null);const d=ec(),f=k=>(u({...typeof k=="string"?{message:k}:k}),n(!0),new Promise(x=>{l.current=x})),h=()=>{n(!1),l.current(!1)},y=()=>{if(n(!1),l.current(!0),o&&typeof o.undoCallback=="function")try{const k=o.undoCallback(),w=o.undoDurationMs??6e3;d.pushToast("Action performed",w,"Undo",async()=>{try{k&&typeof k.then=="function"?await k:await o.undoCallback()}catch(x){console.error("Undo action failed",x)}}),k&&typeof k.then=="function"&&k.catch(()=>{})}catch(k){console.warn("undoCallback failed",k)}};return a.jsxs(kh.Provider,{value:f,children:[r,a.jsx(Ly,{isOpen:i,title:o.title||"Confirm",message:o.message,confirmLabel:o.confirmLabel||"Confirm",cancelLabel:o.cancelLabel||"Cancel",variant:o.variant||"default",onClose:h,onConfirm:y})]})},Sh=()=>{const r=P.useContext(kh);if(!r)throw new Error("useConfirm must be used within a ConfirmProvider");return r},Fy=({isOpen:r,onClose:i})=>{const[n,o]=P.useState(null),u=Sh(),l=br({isActive:r,onEscape:i});P.useEffect(()=>{r&&it.getBooksMetadata().then(f=>{o(f.length)}).catch(()=>{o(0)})},[r]);const d=()=>{(async()=>{const f={books:[],localStorageEntries:{}};try{f.books=await it.getAllBooks(),Object.keys(localStorage).filter(y=>y.startsWith("ebook-reader-")).forEach(y=>{f.localStorageEntries[y]=localStorage.getItem(y)})}catch(y){console.warn("Failed to snapshot library before clear",y)}await u({message:`DANGER: This will permanently delete your entire local library, including all books, bookmarks, and citations.

You will have a short window to undo this action.`,title:"Dangerous Operation",confirmLabel:"Yes, delete",variant:"danger",undoCallback:async()=>{try{if(f.books&&f.books.length>0)for(const y of f.books)await it.saveBook(y);Object.entries(f.localStorageEntries||{}).forEach(([y,k])=>{k===null?localStorage.removeItem(y):localStorage.setItem(y,k)}),setTimeout(()=>window.location.reload(),200)}catch(y){console.error("Failed to restore library on undo",y)}},undoDurationMs:8e3})&&(Object.keys(localStorage).filter(y=>y.startsWith("ebook-reader-")).forEach(y=>localStorage.removeItem(y)),it.clearAllBooks().then(()=>{window.location.reload()}))})()};return r?a.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:i,"aria-modal":"true",role:"dialog",children:a.jsxs("div",{ref:l,className:"bg-slate-800 rounded-lg shadow-xl w-full max-w-lg p-6 text-white",onClick:f=>f.stopPropagation(),children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h2",{className:"text-xl font-bold text-sky-300",children:"Local Storage Management"}),a.jsx("button",{onClick:i,className:"p-2 rounded-full hover:bg-slate-700 transition-colors","aria-label":"Close",children:a.jsx(ir,{className:"w-6 h-6"})})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg",children:[a.jsx("h3",{className:"text-lg font-semibold mb-2 text-slate-200",children:"Library Statistics"}),a.jsx("p",{className:"text-sm text-slate-400",children:"Your library is stored locally in your browser's IndexedDB."}),a.jsxs("div",{className:"mt-4",children:[a.jsx("span",{className:"font-semibold text-slate-300",children:"Books in Library: "}),a.jsx("span",{className:"font-bold text-sky-300 text-lg",children:n===null?"Loading...":n})]})]}),a.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg border border-red-500/30",children:[a.jsx("h3",{className:"text-lg font-semibold mb-2 text-red-400",children:"Danger Zone"}),a.jsx("p",{className:"text-sm text-slate-400 mb-4",children:"This will permanently delete all books and associated data (bookmarks, citations, reading progress) from your browser. This action cannot be undone."}),a.jsxs("button",{onClick:d,className:"w-full flex items-center justify-center gap-2 py-2 px-4 rounded-md bg-red-600 hover:bg-red-700 transition-colors font-semibold text-white text-sm",children:[a.jsx(oi,{className:"w-5 h-5"}),a.jsx("span",{children:"Clear Entire Local Library"})]})]})]})]})}):null},By=({isOpen:r,onClose:i,catalogs:n,onAddCatalog:o,onDeleteCatalog:u,onUpdateCatalog:l,registries:d,onAddRegistry:f,onDeleteRegistry:h,onUpdateRegistry:y})=>{const[k,w]=P.useState(""),[x,b]=P.useState(""),[C,m]=P.useState("auto"),[S,j]=P.useState(""),[_,L]=P.useState(null),[U,M]=P.useState(""),[re,J]=P.useState("catalogs"),$=br({isActive:r,onEscape:i});if(!r)return null;const z=K=>{if(K.preventDefault(),!k.trim()||!x.trim()){j("Name and URL cannot be empty.");return}try{new URL(x)}catch{j("Please enter a valid URL.");return}j(""),re==="catalogs"?o(k,x,C):f(k,x),w(""),b("")},Q=K=>{L(K.id),M(K.name)},ae=()=>{L(null),M("")},F=()=>{!_||!U.trim()||(re==="catalogs"?l(_,U.trim()):y(_,U.trim()),ae())},te=re==="catalogs"?n:d,N=re==="catalogs"?u:h;return a.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:i,"aria-modal":"true",role:"dialog",children:a.jsxs("div",{ref:$,className:"bg-slate-800 rounded-lg shadow-xl w-full max-w-lg p-6 text-white",onClick:K=>K.stopPropagation(),children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h2",{className:"text-xl font-bold text-sky-300",children:"Manage Sources"}),a.jsx("button",{onClick:i,className:"p-2 rounded-full hover:bg-slate-700 transition-colors","aria-label":"Close",children:a.jsx(ir,{className:"w-6 h-6"})})]}),a.jsx("div",{className:"border-b border-slate-700 mb-6",children:a.jsxs("nav",{className:"flex -mb-px gap-4",children:[a.jsx("button",{onClick:()=>J("catalogs"),className:`py-3 px-2 text-sm font-medium border-b-2 transition-colors duration-200 ${re==="catalogs"?"border-sky-400 text-sky-300":"border-transparent text-slate-400 hover:text-white hover:border-slate-500"}`,children:"Catalogs"}),a.jsx("button",{onClick:()=>J("registries"),className:`py-3 px-2 text-sm font-medium border-b-2 transition-colors duration-200 ${re==="registries"?"border-sky-400 text-sky-300":"border-transparent text-slate-400 hover:text-white hover:border-slate-500"}`,children:"Registries"})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[a.jsx(rh,{className:"w-5 h-5"}),"Add New ",re==="catalogs"?"Catalog":"Registry"]}),a.jsxs("form",{onSubmit:z,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"item-name",className:"block text-sm font-medium text-slate-400 mb-1",children:"Name"}),a.jsx("input",{id:"item-name",type:"text",value:k,onChange:K=>w(K.target.value),placeholder:re==="catalogs"?"e.g., Project Gutenberg":"e.g., OPDS Registry",className:"w-full bg-slate-700 rounded-md p-2 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"item-url",className:"block text-sm font-medium text-slate-400 mb-1",children:"URL"}),a.jsx("input",{id:"item-url",type:"url",value:x,onChange:K=>b(K.target.value),placeholder:"https://.../catalog.xml",className:"w-full bg-slate-700 rounded-md p-2 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"opds-version",className:"block text-sm font-medium text-slate-400 mb-1",children:"OPDS Version"}),a.jsxs("select",{id:"opds-version",value:C,onChange:K=>m(K.target.value),className:"w-full bg-slate-700 rounded-md p-2 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500",children:[a.jsx("option",{value:"auto",children:"Auto-detect (recommended)"}),a.jsx("option",{value:"1",children:"OPDS 1 (Atom/XML)"}),a.jsx("option",{value:"2",children:"OPDS 2 (JSON)"})]})]}),S&&a.jsx("p",{className:"text-sm text-red-400",children:S}),a.jsxs("button",{type:"submit",className:"w-full py-2 px-4 rounded-md bg-sky-500 hover:bg-sky-600 transition-colors font-bold text-sm",children:["Add ",re==="catalogs"?"Catalog":"Registry"]})]})]}),a.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg",children:[a.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[a.jsx(f0,{className:"w-5 h-5"})," Saved ",re==="catalogs"?"Catalogs":"Registries"]}),te.length>0?a.jsx("ul",{className:"space-y-2 max-h-60 overflow-y-auto pr-2",children:te.map(K=>a.jsx("li",{className:"bg-slate-700/50 p-2 rounded-md flex items-center justify-between gap-2",children:_===K.id?a.jsxs(a.Fragment,{children:[a.jsx("label",{htmlFor:`edit-name-${K.id}`,className:"sr-only",children:"Edit name"}),a.jsx("input",{id:`edit-name-${K.id}`,type:"text",value:U,onChange:ge=>M(ge.target.value),className:"w-full bg-slate-600 rounded-md p-1 text-sm focus:outline-none focus:ring-1 focus:ring-sky-500",autoFocus:!0,onKeyDown:ge=>{ge.key==="Enter"&&F(),ge.key==="Escape"&&ae()}}),a.jsxs("div",{className:"flex items-center flex-shrink-0",children:[a.jsx("button",{onClick:F,className:"p-2 rounded-full hover:bg-green-500/20 text-green-400 transition-colors","aria-label":`Save changes for ${K.name}`,children:a.jsx(m0,{className:"w-4 h-4"})}),a.jsx("button",{onClick:ae,className:"p-2 rounded-full hover:bg-red-500/20 text-slate-500 hover:text-red-400 transition-colors","aria-label":"Cancel editing",children:a.jsx(ir,{className:"w-4 h-4"})})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"truncate",children:[a.jsx("p",{className:"font-semibold text-slate-200 truncate",children:K.name}),a.jsx("p",{className:"text-xs text-slate-400 truncate",children:K.url})]}),a.jsxs("div",{className:"flex items-center flex-shrink-0",children:[a.jsx("button",{onClick:()=>Q(K),className:"p-2 rounded-full hover:bg-sky-500/20 text-slate-500 hover:text-sky-400 transition-colors","aria-label":`Edit ${K.name}`,children:a.jsx(p0,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>N(K.id),className:"p-2 rounded-full hover:bg-red-500/20 text-slate-500 hover:text-red-400 transition-colors","aria-label":`Delete ${K.name}`,children:a.jsx(oi,{className:"w-4 h-4"})})]})]})},K.id))}):a.jsxs("p",{className:"text-sm text-slate-400 text-center py-8",children:["No ",re==="catalogs"?"catalogs":"registries"," added yet."]})]})]})]})})},Uy=({isOpen:r,onClose:i})=>{const[n,o]=P.useState(""),[u,l]=P.useState(""),[d,f]=P.useState(!0),[h,y]=P.useState(null),[k,w]=P.useState(!1),x=br({isActive:r,onEscape:i});if(!Er())return null;const b=async(C=!1)=>{w(!0),y(null);try{let m=n;C?m=$t(n):m=await wr(n);const S={};u&&(S.Authorization=u);let j=null;try{j=await fetch(m,{method:"HEAD",mode:"cors",redirect:"manual",credentials:d?"include":"omit",headers:S}),j&&j.status===405&&(j=await fetch(m,{method:"GET",mode:"cors",redirect:"manual",credentials:d?"include":"omit",headers:S}))}catch(re){y({error:String(re),target:m,requestHeaders:S,documentCookie:typeof document<"u"?document.cookie:""}),w(!1);return}const _=j.headers.get("access-control-allow-origin"),L=j.headers.get("access-control-allow-credentials"),U=j.headers.get("access-control-allow-headers"),M=j.headers.get("access-control-expose-headers");y({ok:j.ok,status:j.status,statusText:j.statusText,url:j.url||m,accessControlAllowOrigin:_,accessControlAllowCredentials:L,accessControlAllowHeaders:U,accessControlExposeHeaders:M,requestHeaders:S,proxied:m!==n,proxiedUrl:m!==n?m:null,documentCookie:typeof document<"u"?document.cookie:""})}catch(m){y({error:String(m)})}w(!1)};return r?a.jsx("div",{className:"fixed inset-0 z-50 flex items-start justify-center p-6",children:a.jsxs("div",{ref:x,className:"w-full max-w-2xl bg-white rounded shadow-lg overflow-auto",style:{maxHeight:"80vh"},children:[a.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[a.jsx("strong",{children:"Network Debug"}),a.jsxs("div",{children:[a.jsx("button",{className:"mr-2 px-3 py-1 bg-gray-200 rounded",onClick:()=>{o(""),y(null)},children:"Clear"}),a.jsx("button",{className:"px-3 py-1 bg-red-500 text-white rounded",onClick:i,children:"Close"})]})]}),a.jsxs("div",{className:"p-4",children:[a.jsxs("div",{className:"mb-2",children:[a.jsx("label",{className:"block text-sm font-medium",children:"Target URL"}),a.jsx("input",{className:"w-full p-2 border rounded",value:n,onChange:C=>o(C.target.value),placeholder:"https://example.org/opds/borrow/123"})]}),a.jsxs("div",{className:"mb-2",children:[a.jsx("label",{className:"block text-sm font-medium",children:"Authorization header (optional)"}),a.jsx("input",{className:"w-full p-2 border rounded",value:u,onChange:C=>l(C.target.value),placeholder:"Basic base64(...)"}),a.jsx("div",{className:"text-xs text-gray-600",children:"You can paste an Authorization header value to simulate client-sent auth. Note: browsers may preflight requests when custom headers are present."})]}),a.jsx("div",{className:"mb-4 flex items-center gap-3",children:a.jsxs("label",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",checked:d,onChange:C=>f(C.target.checked)})," Include credentials (cookies)"]})}),a.jsxs("div",{className:"mb-4 flex gap-2",children:[a.jsx("button",{className:"px-3 py-2 bg-blue-600 text-white rounded",onClick:()=>b(!1),disabled:k||!n,children:"Probe (auto)"}),a.jsx("button",{className:"px-3 py-2 bg-indigo-600 text-white rounded",onClick:()=>b(!0),disabled:k||!n,children:"Force Proxy"})]}),a.jsxs("div",{className:"text-sm",children:[k&&a.jsx("div",{children:"Running probe..."}),h&&a.jsxs("div",{className:"mt-3",children:[a.jsxs("div",{children:[a.jsx("strong",{children:"Target used:"})," ",h.url||h.target]}),a.jsxs("div",{children:[a.jsx("strong",{children:"Proxied:"})," ",String(h.proxied)]}),h.proxiedUrl&&a.jsxs("div",{children:[a.jsx("strong",{children:"Proxied URL:"})," ",h.proxiedUrl]}),a.jsxs("div",{children:[a.jsx("strong",{children:"Response:"})," ",h.status," ",h.statusText]}),a.jsxs("div",{children:[a.jsx("strong",{children:"Access-Control-Allow-Origin:"})," ",String(h.accessControlAllowOrigin)]}),a.jsxs("div",{children:[a.jsx("strong",{children:"Access-Control-Allow-Credentials:"})," ",String(h.accessControlAllowCredentials)]}),a.jsxs("div",{children:[a.jsx("strong",{children:"Access-Control-Allow-Headers:"})," ",String(h.accessControlAllowHeaders)]}),a.jsxs("div",{children:[a.jsx("strong",{children:"Access-Control-Expose-Headers:"})," ",String(h.accessControlExposeHeaders)]}),a.jsxs("div",{className:"mt-2",children:[a.jsx("strong",{children:"Request headers sent (client-side):"}),a.jsx("pre",{className:"p-2 bg-gray-100 rounded text-xs overflow-auto",children:JSON.stringify(h.requestHeaders,null,2)})]}),a.jsxs("div",{className:"mt-2",children:[a.jsx("strong",{children:"document.cookie (current origin):"}),a.jsx("pre",{className:"p-2 bg-gray-100 rounded text-xs overflow-auto",children:h.documentCookie||"<none>"})]}),a.jsx("div",{className:"mt-2 text-xs text-gray-600",children:"Limitations: The browser will not expose cross-origin cookies or Set-Cookie headers to JavaScript. A missing Access-Control-Allow-Origin or Access-Control-Allow-Credentials header will still prevent the browser from exposing the response body to the app."})]})]})]})]})}):null},Ch=P.createContext(null),zy=({children:r})=>{const[i,n]=P.useState(null),[o,u]=P.useState(null),[l,d]=P.useState(!1),f=!!i,h=P.useCallback(()=>{const x=localStorage.getItem("g_access_token");x&&Y0(x),n(null),localStorage.removeItem("g_access_token"),localStorage.removeItem("ebook-reader-drive-folder-id"),localStorage.removeItem("ebook-reader-drive-file-id"),localStorage.removeItem("ebook-reader-last-sync"),window.gapi?.client&&window.gapi.client.setToken(null)},[]),y=P.useCallback(async x=>{try{const b=await fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${x}`}});if(!b.ok)throw new Error(`Failed to fetch user profile, status: ${b.status}`);const C=await b.json();window.gapi?.client?window.gapi.client.setToken({access_token:x}):console.warn("gapi.client not ready when fetching profile."),n({name:C.name,email:C.email,picture:C.picture})}catch(b){console.error("Token validation/profile fetch failed:",b),h()}},[h]),k=P.useCallback(async x=>{x.access_token&&(localStorage.setItem("g_access_token",x.access_token),await y(x.access_token))},[y]);P.useEffect(()=>{(async()=>{try{const b=await X0(k);u(b),d(!0)}catch(b){console.error("Error initializing Google Client:",b),d(!0)}})()},[k]),P.useEffect(()=>{if(l){const x=localStorage.getItem("g_access_token");x&&y(x)}},[l,y]);const w=P.useCallback(()=>{o&&o.requestAccessToken({prompt:""})},[o]);return a.jsx(Ch.Provider,{value:{user:i,isLoggedIn:f,tokenClient:o,signIn:w,signOut:h,isInitialized:l},children:r})},jh=()=>{const r=P.useContext(Ch);if(!r)throw new Error("useAuth must be used within an AuthProvider");return r},My=({className:r})=>a.jsxs("svg",{className:r,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),a.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),a.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),a.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),$y=({isOpen:r,onClose:i,onUploadToDrive:n,onDownloadFromDrive:o,syncStatus:u,setSyncStatus:l})=>{const{user:d,isLoggedIn:f,signIn:h,signOut:y,isInitialized:k}=jh(),w=()=>{u.state!=="syncing"&&(l({state:"idle",message:""}),i())},x=br({isActive:r,onEscape:w});if(!r)return null;const b=localStorage.getItem("ebook-reader-last-sync"),C=b?new Date(b).toLocaleString():"Never",m=u.state==="syncing";return a.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:w,"aria-modal":"true",role:"dialog",children:a.jsxs("div",{ref:x,className:"bg-slate-800 rounded-lg shadow-xl w-full max-w-lg p-6 text-white",onClick:S=>S.stopPropagation(),children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h2",{className:"text-xl font-bold text-sky-300",children:"Cloud Sync"}),a.jsx("button",{onClick:w,className:"p-2 rounded-full hover:bg-slate-700 transition-colors","aria-label":"Close",disabled:m,children:a.jsx(ir,{className:"w-6 h-6"})})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4 text-slate-200",children:"Account & Sync"}),f&&d?a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("img",{src:d.picture,alt:"User",className:"w-12 h-12 rounded-full"}),a.jsxs("div",{className:"flex-grow",children:[a.jsx("p",{className:"font-semibold",children:d.name}),a.jsx("p",{className:"text-sm text-slate-400",children:d.email})]}),a.jsx("button",{onClick:y,className:"py-2 px-4 rounded-md bg-slate-600 hover:bg-slate-500 transition-colors font-semibold text-sm",children:"Sign Out"})]}):a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-slate-400 mb-3",children:"Sign in with your Google account to back up and sync your library across devices using Google Drive."}),a.jsxs("button",{onClick:h,disabled:!k,className:"w-full flex items-center justify-center gap-3 py-2.5 px-4 rounded-md bg-white text-slate-700 hover:bg-slate-200 transition-colors font-semibold disabled:opacity-70 disabled:cursor-not-allowed",children:[a.jsx(My,{className:"w-5 h-5"}),k?"Sign in with Google":"Initializing..."]})]})]}),f&&a.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg",children:[a.jsx("h3",{className:"text-lg font-semibold mb-2 text-slate-200",children:"Google Drive Sync"}),a.jsxs("p",{className:"text-xs text-slate-500 mb-4",children:["Last synced: ",C]}),u.state!=="idle"?a.jsxs("div",{className:"p-4 rounded-md bg-slate-700/50 text-center",children:[m&&a.jsx(Fn,{text:u.message}),u.state==="success"&&a.jsx("p",{className:"text-green-400",children:u.message}),u.state==="error"&&a.jsx("p",{className:"text-red-400",children:u.message})]}):a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsxs("button",{onClick:n,className:"flex flex-col items-center justify-center gap-2 p-4 rounded-md bg-slate-700 hover:bg-slate-600 transition-colors disabled:opacity-50",disabled:m,children:[a.jsx(Kf,{className:"w-6 h-6 text-sky-400"}),a.jsx("span",{className:"font-semibold",children:"Upload to Drive"}),a.jsx("span",{className:"text-xs text-slate-400 text-center",children:"Save your local library to the cloud. This will overwrite any existing data in Drive."})]}),a.jsxs("button",{onClick:o,className:"flex flex-col items-center justify-center gap-2 p-4 rounded-md bg-slate-700 hover:bg-slate-600 transition-colors disabled:opacity-50",disabled:m,children:[a.jsx(Ul,{className:"w-6 h-6 text-sky-400"}),a.jsx("span",{className:"font-semibold",children:"Download from Drive"}),a.jsx("span",{className:"text-xs text-slate-400 text-center",children:"Replace your local library with the one from Drive. Local changes will be lost."})]})]})]})]})]})})},Wy=({categoryLane:r,onBookClick:i})=>{const n=P.useRef(null),o=()=>{n.current&&n.current.scrollBy({left:-300,behavior:"smooth"})},u=()=>{n.current&&n.current.scrollBy({left:300,behavior:"smooth"})};return r.books.length===0?null:a.jsxs("div",{className:"mb-10",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6 px-4",children:[a.jsx("div",{className:"flex items-center gap-4",children:a.jsxs("div",{className:"flex flex-col",children:[a.jsx("h3",{className:"text-2xl font-bold text-white leading-tight tracking-tight",children:r.category.label}),r.category.scheme&&a.jsx("span",{className:"text-xs text-slate-400 uppercase tracking-wider font-medium mt-0.5",children:r.category.scheme.includes("Simplified")?"Simplified":r.category.scheme.includes("fiction")?"Fiction":"Category"})]})}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("div",{className:"bg-slate-700/80 text-slate-300 text-sm font-medium px-3 py-1.5 rounded-full border border-slate-600/50",children:[r.books.length," book",r.books.length!==1?"s":""]})})]}),a.jsxs("div",{className:"relative group",children:[a.jsx("button",{onClick:o,className:"absolute left-2 top-1/2 -translate-y-1/2 z-10 bg-gradient-to-r from-slate-900/90 to-slate-800/80 hover:from-slate-800/95 hover:to-slate-700/85 text-white p-3 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-all duration-300 border border-slate-600/50 backdrop-blur-sm","aria-label":"Scroll left",children:a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),a.jsx("button",{onClick:u,className:"absolute right-2 top-1/2 -translate-y-1/2 z-10 bg-gradient-to-r from-slate-900/90 to-slate-800/80 hover:from-slate-800/95 hover:to-slate-700/85 text-white p-3 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-all duration-300 border border-slate-600/50 backdrop-blur-sm","aria-label":"Scroll right",children:a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),a.jsx("div",{ref:n,className:"flex gap-5 overflow-x-auto px-6 py-3 scrollContainer scroll-smooth",children:r.books.map((l,d)=>a.jsxs("div",{onClick:()=>i(l),className:"cursor-pointer group/book relative flex-shrink-0 w-40",children:[a.jsx("div",{className:"aspect-[2/3] bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl overflow-hidden shadow-xl transform group-hover/book:scale-105 transition-all duration-300 border border-slate-700/50 group-hover/book:border-sky-500/50",children:l.coverImage?a.jsx("img",{src:l.coverImage,alt:l.title,className:"w-full h-full object-cover",loading:"lazy",onError:f=>{const h=f.currentTarget;h.onerror=null,h.src=$t(l.coverImage)}}):a.jsx("div",{className:"w-full h-full flex items-center justify-center p-4 text-center text-slate-400",children:a.jsx("span",{className:"text-sm font-semibold leading-tight",children:l.title})})}),a.jsxs("div",{className:"mt-3 space-y-1.5",children:[a.jsx("h4",{className:"text-sm font-semibold text-white truncate group-hover/book:text-sky-400 transition-colors duration-200 leading-tight",children:l.title}),l.author&&a.jsx("p",{className:"text-xs text-slate-400 truncate leading-relaxed",children:l.author}),a.jsx("div",{className:"flex gap-1 flex-wrap mt-1",children:l.alternativeFormats&&l.alternativeFormats.length>0?l.alternativeFormats.map((f,h)=>a.jsx("span",{className:`inline-block text-white text-[10px] font-bold px-2 py-0.5 rounded ${f.format.toUpperCase()==="PDF"?"bg-red-600":f.format.toUpperCase()==="AUDIOBOOK"?"bg-purple-600":"bg-sky-500"}`,title:`Format: ${f.format}, MediaType: ${f.mediaType}`,children:f.format},`${l.title}-${f.format}-${h}`)):l.format&&a.jsx("span",{className:`inline-block text-white text-[10px] font-bold px-2 py-0.5 rounded ${l.format.toUpperCase()==="PDF"?"bg-red-600":l.format.toUpperCase()==="AUDIOBOOK"?"bg-purple-600":"bg-sky-500"}`,children:l.format})})]})]},`${l.downloadUrl}-${d}`))})]})]})},Vy=({books:r,onBookClick:i})=>{const n=P.useRef(null),o=()=>{n.current&&n.current.scrollBy({left:-300,behavior:"smooth"})},u=()=>{n.current&&n.current.scrollBy({left:300,behavior:"smooth"})};return r.length===0?null:a.jsxs("div",{className:"mb-8",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4 px-4",children:[a.jsx("h3",{className:"text-xl font-semibold text-white",children:"Other Books"}),a.jsxs("div",{className:"text-sm text-slate-400",children:[r.length," book",r.length!==1?"s":""]})]}),a.jsxs("div",{className:"relative group",children:[a.jsx("button",{onClick:o,className:"absolute left-0 top-1/2 -translate-y-1/2 z-10 bg-black/60 hover:bg-black/80 text-white p-2 rounded-r-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200","aria-label":"Scroll left",children:"←"}),a.jsx("button",{onClick:u,className:"absolute right-0 top-1/2 -translate-y-1/2 z-10 bg-black/60 hover:bg-black/80 text-white p-2 rounded-l-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200","aria-label":"Scroll right",children:"→"}),a.jsx("div",{ref:n,className:"flex gap-4 overflow-x-auto px-4 py-2 scrollContainer",children:r.map((l,d)=>a.jsxs("div",{onClick:()=>i(l),className:"cursor-pointer group/book relative flex-shrink-0 w-36",children:[a.jsx("div",{className:"aspect-[2/3] bg-slate-800 rounded-lg overflow-hidden shadow-lg transform group-hover/book:scale-105 transition-transform duration-300",children:l.coverImage?a.jsx("img",{src:l.coverImage,alt:l.title,className:"w-full h-full object-cover",loading:"lazy",onError:f=>{const h=f.currentTarget;h.onerror=null,h.src=$t(l.coverImage)}}):a.jsx("div",{className:"w-full h-full flex items-center justify-center p-3 text-center text-slate-400",children:a.jsx("span",{className:"text-xs font-semibold leading-tight",children:l.title})})}),a.jsxs("div",{className:"mt-2 space-y-1",children:[a.jsx("h4",{className:"text-sm font-semibold text-white truncate group-hover/book:text-sky-400 transition-colors duration-200",children:l.title}),l.author&&a.jsx("p",{className:"text-xs text-slate-400 truncate",children:l.author}),a.jsx("div",{className:"flex gap-1 flex-wrap",children:l.alternativeFormats&&l.alternativeFormats.length>0?l.alternativeFormats.map((f,h)=>a.jsx("span",{className:`inline-block text-white text-[10px] font-bold px-2 py-0.5 rounded ${f.format.toUpperCase()==="PDF"?"bg-red-600":f.format.toUpperCase()==="AUDIOBOOK"?"bg-purple-600":"bg-sky-500"}`,title:`Format: ${f.format}, MediaType: ${f.mediaType}`,children:f.format},`${l.title}-${f.format}-${h}`)):l.format?a.jsx("span",{className:`inline-block text-white text-[10px] font-bold px-2 py-0.5 rounded ${l.format.toUpperCase()==="PDF"?"bg-red-600":l.format.toUpperCase()==="AUDIOBOOK"?"bg-purple-600":"bg-sky-500"}`,children:l.format}):null})]})]},`${l.downloadUrl}-${d}`))})]})]})};class ri extends P.Component{constructor(){super(...arguments),this.state={hasError:!1,error:null},this.handleReset=()=>{this.props.onReset(),this.setState({hasError:!1,error:null})}}static getDerivedStateFromError(i){return{hasError:!0,error:i}}componentDidCatch(i,n){console.error("ErrorBoundary caught an error:",i,n)}render(){return this.state.hasError?a.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen p-4 text-center text-white bg-slate-900",role:"alert",children:a.jsxs("div",{className:"bg-slate-800 p-8 rounded-lg shadow-xl max-w-lg w-full",children:[a.jsx("svg",{className:"w-16 h-16 mx-auto text-red-400 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),a.jsx("h1",{className:"text-2xl font-bold text-red-300",children:"Something went wrong."}),a.jsx("p",{className:"mt-2 text-slate-300",children:this.props.fallbackMessage||"An unexpected error occurred. Please try again."}),this.state.error&&a.jsxs("details",{className:"mt-4 text-left bg-slate-900/50 p-3 rounded-md text-sm",children:[a.jsx("summary",{className:"cursor-pointer text-slate-400 hover:text-white",children:"Error Details"}),a.jsx("pre",{className:"mt-2 text-slate-400 whitespace-pre-wrap break-all",children:a.jsx("code",{children:this.state.error.message})})]}),a.jsx("button",{onClick:this.handleReset,className:"mt-6 py-2 px-6 rounded-md bg-sky-500 hover:bg-sky-600 transition-colors font-bold",children:"Try Again"})]})}):this.props.children}}const pf=({message:r,politeness:i="polite",clearAfter:n=5e3,onClear:o})=>{const[u,l]=P.useState(null);return P.useEffect(()=>{if(r){if(l(r),n>0){const d=setTimeout(()=>{l(null),o&&o()},n);return()=>clearTimeout(d)}}else l(null)},[r,n,o]),u?a.jsx("div",{role:"status","aria-live":i,"aria-atomic":"true",className:"sr-only",children:u}):null},Hy="/JamesEnglish1028-My-Ebook-Reader/assets/MeBooks_lockup_stacked_dark-Bjs16_ps.svg",qy="/JamesEnglish1028-My-Ebook-Reader/assets/MeBooks_transparent_white_removed-8vWVlR8U.png",Qy=({isVisible:r})=>a.jsx("div",{className:`fixed inset-0 bg-slate-900 flex flex-col items-center justify-center z-50 transition-opacity duration-700 ease-in-out ${r?"opacity-100":"opacity-0 pointer-events-none"}`,children:a.jsx("div",{className:"animate-pulse",children:a.jsx("img",{src:Hy,alt:"MeBooks",className:"w-64"})})}),Ky=({isCloudSyncModalOpen:r,onCloseCloudSyncModal:i,onUploadToDrive:n,onDownloadFromDrive:o,syncStatus:u,setSyncStatus:l,isLocalStorageModalOpen:d,onCloseLocalStorageModal:f,credentialPrompt:h,onCloseCredentialPrompt:y,onCredentialSubmit:k,onOpenAuthLink:w,onRetryAfterProviderLogin:x,showNetworkDebug:b,onCloseNetworkDebug:C,onOpenNetworkDebug:m,isShortcutHelpOpen:S,onCloseShortcutHelp:j})=>a.jsxs(a.Fragment,{children:[a.jsx($y,{isOpen:r,onClose:i,onUploadToDrive:n,onDownloadFromDrive:o,syncStatus:u,setSyncStatus:l}),a.jsx(Fy,{isOpen:d,onClose:f}),a.jsx(gh,{isOpen:h.isOpen,host:h.host,authDocument:h.authDocument,onClose:y,onSubmit:k,onOpenAuthLink:w,onRetry:x,probeUrl:h.pendingHref}),a.jsx(Uy,{isOpen:b,onClose:C}),a.jsx(vh,{isOpen:S,onClose:j,activeReader:null}),typeof window<"u"&&window.__MEBOOKS_DEBUG__&&a.jsx("div",{className:"fixed right-3 bottom-3 z-[60]",children:a.jsx("button",{onClick:m,className:"px-3 py-2 bg-yellow-400 rounded shadow",children:"Network Debug"})})]}),Gy=({availableAudiences:r,availableFictionModes:i,availableMediaModes:n,audienceMode:o,fictionMode:u,mediaMode:l,onAudienceChange:d,onFictionChange:f,onMediaChange:h})=>{const y=[{key:"all",label:"All Ages",available:!0},{key:"adult",label:"Adult",available:r.includes("adult")},{key:"young-adult",label:"Young Adult",available:r.includes("young-adult")},{key:"children",label:"Children",available:r.includes("children")}],k=[{key:"all",label:"All Types",available:!0},{key:"fiction",label:"Fiction",available:i.includes("fiction")},{key:"non-fiction",label:"Non-Fiction",available:i.includes("non-fiction")}],w=[{key:"all",label:"All Media",available:!0},{key:"ebook",label:"E-Books",available:n.includes("ebook")},{key:"audiobook",label:"Audiobooks",available:n.includes("audiobook")}],x=r.length>1,b=i.length>1,C=n.length>1;return x||b||C?a.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4 mb-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Filter By"}),(x||b||C)&&a.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[x&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-sm text-slate-400",children:"Audience:"}),a.jsx("div",{className:"flex gap-1",children:y.filter(S=>S.available).map(S=>a.jsx("button",{onClick:()=>d(S.key),className:`px-3 py-1 text-sm rounded-md transition-colors ${o===S.key?"bg-blue-600 text-white font-medium":"bg-slate-700 hover:bg-slate-600 text-slate-300"}`,children:S.label.replace("All Ages","All")},S.key))})]}),b&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-sm text-slate-400",children:"Type:"}),a.jsx("div",{className:"flex gap-1",children:k.filter(S=>S.available).map(S=>a.jsx("button",{onClick:()=>f(S.key),className:`px-3 py-1 text-sm rounded-md transition-colors ${u===S.key?"bg-purple-600 text-white font-medium":"bg-slate-700 hover:bg-slate-600 text-slate-300"}`,children:S.label.replace("All Types","All")},S.key))})]}),C&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-sm text-slate-400",children:"Format:"}),a.jsx("div",{className:"flex gap-1",children:w.filter(S=>S.available).map(S=>a.jsx("button",{onClick:()=>h(S.key),className:`px-3 py-1 text-sm rounded-md transition-colors ${l===S.key?"bg-indigo-600 text-white font-medium":"bg-slate-700 hover:bg-slate-600 text-slate-300"}`,children:S.label.replace("All Media","All")},S.key))})]})]})]}):null},Zy=({navPath:r,pagination:i,onBreadcrumbClick:n,onPaginationClick:o,isLoading:u=!1})=>{const l=r.length>0,d=i&&(i.prev||i.next)&&!u;return a.jsxs(a.Fragment,{children:[l&&a.jsx("nav",{"aria-label":"breadcrumb",className:"flex items-center text-sm text-slate-400 mb-4 flex-wrap",children:r.map((f,h)=>a.jsxs(ps.Fragment,{children:[a.jsx("button",{onClick:()=>n(h),className:`hover:text-sky-400 transition-colors ${h===r.length-1?"font-semibold text-white":""}`,"aria-current":h===r.length-1?"page":void 0,children:f.name}),h<r.length-1&&a.jsx(Xf,{className:"w-4 h-4 mx-1 flex-shrink-0"})]},h))}),d&&a.jsxs("div",{className:"flex justify-between items-center mt-8",children:[a.jsxs("button",{onClick:()=>i.prev&&o(i.prev),disabled:!i.prev,className:"bg-slate-700 hover:bg-slate-600 text-white font-bold py-2 px-4 rounded-lg inline-flex items-center transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Previous page",children:[a.jsx(To,{className:"w-5 h-5 mr-2"}),a.jsx("span",{children:"Previous"})]}),a.jsxs("button",{onClick:()=>i.next&&o(i.next),disabled:!i.next,className:"bg-slate-700 hover:bg-slate-600 text-white font-bold py-2 px-4 rounded-lg inline-flex items-center transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Next page",children:[a.jsx("span",{children:"Next"}),a.jsx(Zf,{className:"w-5 h-5 ml-2"})]})]})]})},Xy=({collections:r,categories:i,activeCollection:n,navPathLength:o,onCollectionChange:u,onCategoryNavigate:l,catalogNavLinks:d,activeOpdsSource:f,isLoading:h=!1})=>{const[y,k]=P.useState(!0),[w,x]=P.useState(!0);if(i.length===0&&r.length===0&&!h)return null;const b=C=>{d.find(S=>(S.rel==="collection"||S.rel==="subsection")&&S.title===C&&S.url.includes("/groups/"))&&f&&l(C)};return a.jsx("aside",{className:"w-full lg:w-64 lg:flex-shrink-0 order-2 lg:order-1",children:a.jsxs("div",{className:"bg-slate-800/50 rounded-lg p-4 lg:sticky lg:top-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Navigate By"}),a.jsx("button",{onClick:()=>u("all"),className:`w-full text-left px-3 py-2 rounded-md text-sm transition-colors mb-4 ${o<=1&&(n==="all"||!n)?"bg-emerald-600 text-white font-medium shadow-lg border-2 border-emerald-500":"bg-slate-700 hover:bg-slate-600 text-slate-300 border-2 border-transparent"}`,children:"All Books"}),a.jsxs("div",{className:"space-y-3",children:[i.length>0&&a.jsxs("div",{className:"border border-slate-700 rounded-lg overflow-hidden",children:[a.jsxs("button",{onClick:()=>k(!y),className:"w-full flex items-center justify-between px-3 py-2 bg-slate-700/50 hover:bg-slate-700 transition-colors",children:[a.jsx("span",{className:"text-sm font-medium text-slate-200",children:"Categories"}),a.jsx("svg",{className:`w-4 h-4 text-slate-400 transition-transform ${y?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),y&&a.jsx("nav",{className:"p-2 space-y-1 bg-slate-800/30",children:i.map((C,m)=>a.jsx("button",{onClick:()=>b(C),className:"w-full text-left px-3 py-2 rounded-md text-sm transition-colors bg-emerald-600/20 hover:bg-emerald-600/40 text-emerald-300 border border-transparent hover:border-emerald-600/30",children:C},`${C}-${m}`))})]}),r.length>0&&a.jsxs("div",{className:"border border-slate-700 rounded-lg overflow-hidden",children:[a.jsxs("button",{onClick:()=>x(!w),className:"w-full flex items-center justify-between px-3 py-2 bg-slate-700/50 hover:bg-slate-700 transition-colors",children:[a.jsx("span",{className:"text-sm font-medium text-slate-200",children:"Curated Collections"}),a.jsx("svg",{className:`w-4 h-4 text-slate-400 transition-transform ${w?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),w&&a.jsx("nav",{className:"p-2 space-y-1 bg-slate-800/30",children:r.map((C,m)=>{const S=n===C;return a.jsxs("button",{onClick:()=>u(C),className:`w-full text-left px-3 py-2 rounded-md text-sm transition-colors flex items-center gap-2 border ${S?"bg-sky-600 text-white font-medium shadow-lg border-sky-500":"bg-sky-600/20 hover:bg-sky-600/40 text-sky-300 border-transparent hover:border-sky-600/30"}`,children:[a.jsx("span",{children:S?"📁":"📂"}),C]},`${C}-${m}`)})})]})]})]})})},Nh=({message:r,title:i,variant:n="page",severity:o="error",onRetry:u,onDismiss:l,className:d=""})=>{const h=(()=>{switch(o){case"error":return{bg:"bg-red-900/20",border:"border-red-500/50",text:"text-red-400",icon:"text-red-500",button:"bg-red-600 hover:bg-red-700"};case"warning":return{bg:"bg-yellow-900/20",border:"border-yellow-500/50",text:"text-yellow-400",icon:"text-yellow-500",button:"bg-yellow-600 hover:bg-yellow-700"};case"info":return{bg:"bg-blue-900/20",border:"border-blue-500/50",text:"text-blue-400",icon:"text-blue-500",button:"bg-blue-600 hover:bg-blue-700"}}})(),y=()=>{switch(o){case"error":return a.jsx("svg",{className:`w-6 h-6 ${h.icon}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})});case"warning":return a.jsx("svg",{className:`w-6 h-6 ${h.icon}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})});case"info":return a.jsx("svg",{className:`w-6 h-6 ${h.icon}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}};return n==="inline"?a.jsxs("div",{className:`flex items-center gap-2 p-2 rounded ${h.bg} ${h.border} border ${d}`,children:[y(),a.jsx("span",{className:`text-sm ${h.text}`,children:r}),l&&a.jsx("button",{onClick:l,className:"ml-auto text-slate-400 hover:text-white","aria-label":"Dismiss",children:a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):n==="card"?a.jsx("div",{className:`rounded-lg p-6 ${h.bg} ${h.border} border ${d}`,children:a.jsxs("div",{className:"flex items-start gap-4",children:[a.jsx("div",{className:"flex-shrink-0",children:y()}),a.jsxs("div",{className:"flex-1 min-w-0",children:[i&&a.jsx("h3",{className:`text-lg font-semibold mb-2 ${h.text}`,children:i}),a.jsx("p",{className:"text-slate-300 text-sm",children:r}),(u||l)&&a.jsxs("div",{className:"flex gap-3 mt-4",children:[u&&a.jsx("button",{onClick:u,className:`px-4 py-2 rounded-lg text-white font-medium transition-colors ${h.button}`,children:"Try Again"}),l&&a.jsx("button",{onClick:l,className:"px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-white font-medium transition-colors",children:"Dismiss"})]})]}),l&&a.jsx("button",{onClick:l,className:"flex-shrink-0 text-slate-400 hover:text-white","aria-label":"Close",children:a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}):a.jsx("div",{className:`text-center py-20 ${h.bg} rounded-lg ${d}`,children:a.jsxs("div",{className:"flex flex-col items-center max-w-md mx-auto",children:[a.jsx("div",{className:"mb-4",children:y()}),a.jsx("h2",{className:`text-2xl font-semibold mb-2 ${h.text}`,children:i||"Something Went Wrong"}),a.jsx("p",{className:"text-slate-300 mb-6",children:r}),(u||l)&&a.jsxs("div",{className:"flex gap-3",children:[u&&a.jsx("button",{onClick:u,className:`px-6 py-3 rounded-lg text-white font-bold transition-colors ${h.button}`,children:"Try Again"}),l&&a.jsx("button",{onClick:l,className:"px-6 py-3 rounded-lg bg-slate-700 hover:bg-slate-600 text-white font-bold transition-colors",children:"Dismiss"})]})]})})},Eh=({variant:r="spinner",size:i="medium",message:n,className:o=""})=>{if(r==="spinner"){const u=i==="large"?"medium":i;return a.jsx("div",{className:`flex justify-center items-center ${o}`,children:a.jsx(Fn,{text:n,size:u})})}if(r==="inline"){const u={small:"w-4 h-4",medium:"w-5 h-5",large:"w-6 h-6"};return a.jsxs("div",{className:`inline-flex items-center gap-2 ${o}`,children:[a.jsxs("svg",{className:`animate-spin ${u[i]} text-sky-400`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),n&&a.jsx("span",{className:"text-sm text-slate-300",children:n})]})}if(r==="skeleton")return a.jsx("div",{className:`animate-pulse ${o}`,children:a.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6",children:Array.from({length:12}).map((u,l)=>a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"aspect-[2/3] bg-slate-700 rounded-lg"}),a.jsx("div",{className:"h-4 bg-slate-700 rounded w-3/4"}),a.jsx("div",{className:"h-3 bg-slate-700 rounded w-1/2"})]},l))})});if(r==="page"){const u=i==="large"?"medium":i;return a.jsx("div",{className:`fixed inset-0 bg-slate-900 bg-opacity-75 flex items-center justify-center z-50 ${o}`,children:a.jsx("div",{className:"bg-slate-800 p-8 rounded-lg shadow-xl text-center max-w-sm w-full",children:a.jsx(Fn,{text:n,size:u})})})}return null},_h=ps.forwardRef(({book:r,onClick:i,onContextMenu:n,className:o="",isFocused:u=!1},l)=>{const d=()=>i(r),f=m=>{n&&(m.preventDefault(),n(r,m))},h=m=>{(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),i(r))},y=m=>"downloadUrl"in m,w="coverImage"in r&&r.coverImage?r.coverImage:"cover"in r&&r.cover?r.cover:null,b=y(r)&&r.alternativeFormats&&r.alternativeFormats.length>0?r.alternativeFormats.map((m,S)=>({key:`${r.title}-${m.format}-${S}`,format:m.format,mediaType:m.mediaType})):r.format?[{key:`${r.title}-${r.format}`,format:r.format,mediaType:null}]:[],C=m=>{const S=m.toUpperCase();return S==="PDF"?"bg-red-600":S==="AUDIOBOOK"?"bg-purple-600":"bg-sky-500"};return a.jsxs("div",{ref:l,onClick:d,onContextMenu:f,onKeyDown:h,tabIndex:0,"aria-label":`${r.title} by ${r.author}`,className:`cursor-pointer group relative focus:outline-none ${u?"ring-2 ring-sky-500 ring-offset-2 ring-offset-slate-900":""} ${o}`,children:[a.jsx("div",{className:"aspect-[2/3] bg-slate-800 rounded-lg overflow-hidden shadow-lg transform group-hover:scale-105 transition-transform duration-300 book-cover-container",children:w?a.jsx("img",{src:w,alt:r.title,className:"w-full h-full object-cover",loading:"lazy",onError:m=>{const S=m.currentTarget;S.onerror=null,y(r)&&r.coverImage&&(S.src=$t(r.coverImage))}}):a.jsx("div",{className:"w-full h-full flex items-center justify-center p-4 text-center text-slate-400",children:a.jsx("span",{className:"font-semibold",children:r.title})})}),a.jsxs("div",{className:"mt-2 space-y-1",children:[a.jsx("h3",{className:"text-sm font-semibold text-white truncate group-hover:text-sky-400",children:r.title}),a.jsx("p",{className:"text-xs text-slate-400 truncate",children:r.author}),b.length>0&&a.jsx("div",{className:"flex gap-1 flex-wrap",children:b.map(m=>a.jsx("span",{className:`inline-block text-white text-[10px] font-bold px-2 py-0.5 rounded ${C(m.format)}`,title:m.mediaType?`Format: ${m.format}, MediaType: ${m.mediaType}`:`Format: ${m.format}`,children:m.format},m.key))})]})]})});_h.displayName="BookCard";const Rh=({books:r,isLoading:i=!1,onBookClick:n,onBookContextMenu:o,className:u=""})=>{const[l,d]=P.useState(-1),f=P.useRef(null),h=P.useRef(new Map),y=P.useCallback(()=>{if(typeof window>"u")return 4;const _=window.innerWidth;return _>=1280?6:_>=1024?5:_>=768?4:_>=640?3:2},[]),[k,w]=P.useState(y);P.useEffect(()=>{const _=()=>w(y());return window.addEventListener("resize",_),()=>window.removeEventListener("resize",_)},[y]);const x=P.useCallback(_=>{r.length!==0&&d(L=>{let U=L;if(L===-1)U=0;else switch(_){case"left":U=L>0?L-1:L;break;case"right":U=L<r.length-1?L+1:L;break;case"up":U=L-k,U<0&&(U=L);break;case"down":U=L+k,U>=r.length&&(U=L);break}const M=h.current.get(U);return M&&(M.focus(),M.scrollIntoView({behavior:"smooth",block:"nearest"})),U})},[r.length,k]),b=P.useCallback(()=>{l>=0&&l<r.length&&n(r[l])},[l,r,n]),[C,m]=P.useState(!1);py({enableArrowKeys:C&&r.length>0,enableActivation:C&&r.length>0,onArrowKey:x,onActivate:b,preventDefault:!0});const S=P.useCallback(()=>{if(m(!0),l===-1&&r.length>0){d(0);const _=h.current.get(0);_&&_.focus()}},[l,r.length]),j=P.useCallback(_=>{f.current?.contains(_.relatedTarget)||m(!1)},[]);return i?a.jsx("div",{className:"flex justify-center mt-20",children:a.jsx(Fn,{})}):a.jsx("div",{ref:f,className:`grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6 ${u}`,onFocus:S,onBlur:j,"aria-label":"Book collection",children:r.map((_,L)=>{const U="id"in _&&_.id?`book-${_.id}`:`catalog-${"downloadUrl"in _?_.downloadUrl:_.title}-${L}`;return a.jsx(_h,{book:_,onClick:n,onContextMenu:o,isFocused:L===l,ref:M=>{M?h.current.set(L,M):h.current.delete(L)}},U)})})},Ah=({variant:r,title:i,message:n,error:o})=>{const l=(()=>{switch(r){case"library":return{title:"Your library is empty.",message:"Import your first book or add a catalog to get started!",textColor:"text-slate-50"};case"catalog":return{title:"Empty Section",message:"No categories or books were found here.",textColor:"text-slate-50"};case"error":return{title:"Error Loading Source",message:o||"An unexpected error occurred.",textColor:"text-red-500"};default:return{title:"No Content",message:"Nothing to display here.",textColor:"text-white"}}})(),d=i||l.title,f=n||l.message,h=l.textColor;return a.jsxs("div",{className:"text-center py-20 bg-slate-700 rounded-lg",children:[a.jsx("h2",{className:`text-2xl font-semibold ${h}`,children:d}),a.jsx("p",{className:"text-slate-100 mt-2 max-w-xl mx-auto",children:f})]})},Yy=({activeOpdsSource:r,catalogNavPath:i,setCatalogNavPath:n,onShowBookDetail:o,rootLevelCollections:u,setRootLevelCollections:l})=>{const[d,f]=P.useState("all"),[h,y]=P.useState("all"),[k,w]=P.useState("all"),[x,b]=P.useState("all"),[C,m]=P.useState("subject"),[S,j]=P.useState(!1),[_,L]=P.useState(!1),[U,M]=P.useState([]),[re,J]=P.useState([]),[$,z]=P.useState([]),[Q,ae]=P.useState([]),[F,te]=P.useState([]),N=i.length>0?i[i.length-1].url:r?.url||null,K=r&&"opdsVersion"in r&&r.opdsVersion||"auto";P.useEffect(()=>{ae([]),M([]),z([]),J([]),j(!1)},[N,r?.id]),P.useEffect(()=>{te([])},[r?.id]);const{data:ge,isLoading:ne,error:le,refetch:ie}=hy(N,r?.url||"",K,!!r),ue=ge?.books||[],A=ge?.navLinks||[],B=ge?.pagination||null,me=P.useMemo(()=>{if(!B)return null;const V=B.prev||(F.length>0?F[F.length-1]:void 0);return{...B,prev:V}},[B,F]);P.useEffect(()=>{if(ue.length>0&&i.length<=1){const V=new Set;ue.forEach(G=>{G.collections&&G.collections.length>0&&G.collections.forEach(oe=>{V.add(oe.title)})}),A.forEach(G=>{(G.rel==="collection"||G.rel==="subsection")&&V.add(G.title)}),l(Array.from(V))}},[ue,A,i.length,l]);const{availableAudiences:he,availableFictionModes:se,availableMediaModes:we,availableCollections:Ee,availableGenreCategories:xe}=P.useMemo(()=>({availableAudiences:P0(ue),availableFictionModes:O0(ue),availableMediaModes:L0(ue),availableCollections:F0(ue,A),availableGenreCategories:D0(ue,A)}),[ue,A]);P.useEffect(()=>{if(ue.length===0)return;const V=ah(ue,d),G=lh(V,h),oe=ch(G,k);let Y=oe;if(x!=="all"&&i.length<=1&&(Y=oe.filter(E=>E.collections?.some(T=>T.title===x))),C==="flat")ae(Y),M([]),j(!1);else if(C==="subject")if(xe.length>0){const T=B0(Y,A,B||{},C,d,h,k,x);M(T.categoryLanes),z(T.uncategorizedBooks),ae([]),j(!0)}else ae(Y),M([]),j(!1)},[ue,A,B,d,h,k,x,C,xe.length,i.length]);const je=V=>{const G=i.slice(0,V+1);n(G),f("all"),y("all"),w("all"),b("all"),te([])},Te=V=>{n(G=>{if(G.length===0)return G;const oe=[...G];return oe[oe.length-1]={...oe[oe.length-1],url:V},oe}),te(G=>{try{if(!N)return G;const oe=G[G.length-1];return oe&&oe===V?G.slice(0,-1):[...G,N]}catch{return G}})},Fe=V=>{o(V,"catalog",r.name)},He=V=>{r&&(n(G=>[...G,{name:V.title,url:V.url}]),f("all"),y("all"),w("all"))},Me=V=>{if(V==="all"){b(V),i.length>1&&r&&n([{name:r.name,url:r.url}]);return}const G=A.find(oe=>(oe.rel==="collection"||oe.rel==="subsection")&&oe.title===V);if(G){if(r){const oe=[...i,{name:G.title,url:G.url}];n(oe),b(V),f("all"),y("all"),w("all")}}else b(V)},v=Ee.length>0?Ee:u,X=v.length>0||xe.length>0||i.length>1&&u.length>0||ne&&u.length>0;if(ne)return a.jsx(Eh,{variant:"spinner",message:"Loading catalog..."});if(le)return a.jsx(Nh,{variant:"page",title:"Failed to Load Catalog",message:le?.message||"Could not load catalog content.",onRetry:()=>ie()});const H=Q.length>0||U.length>0||$.length>0,I=A.filter(V=>V.rel!=="collection").length>0,O=ue.length>0;return!O&&!I&&!ne?a.jsx(Ah,{variant:"catalog"}):a.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[X&&a.jsx("aside",{className:"w-full lg:w-64 lg:flex-shrink-0 order-2 lg:order-1",children:a.jsx(Xy,{collections:v,categories:xe,activeCollection:x,navPathLength:i.length,onCollectionChange:Me,onCategoryNavigate:V=>{const G=A.find(oe=>(oe.rel==="collection"||oe.rel==="subsection")&&oe.title===V&&oe.url.includes("/groups/"));G&&He(G)},catalogNavLinks:A,activeOpdsSource:r,isLoading:ne})}),a.jsxs("main",{className:"flex-1 min-w-0 order-1 lg:order-2",children:[a.jsx(Zy,{navPath:i,pagination:me??B,onBreadcrumbClick:je,onPaginationClick:Te,isLoading:ne}),a.jsx(Gy,{availableAudiences:he,availableFictionModes:se,availableMediaModes:we,audienceMode:d,fictionMode:h,mediaMode:k,onAudienceChange:f,onFictionChange:y,onMediaChange:w}),xe.length>0&&a.jsxs("div",{className:"flex items-center space-x-3 mb-6 px-4",children:[a.jsx("span",{className:"text-sm text-slate-300 font-medium",children:"View By:"}),a.jsx("button",{onClick:()=>m(C==="subject"?"flat":"subject"),"aria-label":`Switch to ${C==="subject"?"grid view":"lanes view"}`,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 focus:ring-offset-slate-800 ${C==="subject"?"bg-emerald-600":"bg-slate-600"}`,children:a.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${C==="subject"?"translate-x-6":"translate-x-1"}`})}),a.jsx("span",{className:"text-sm text-slate-300",children:C==="subject"?"Lanes":"Grid"})]}),S&&U.length>0?a.jsxs("div",{className:"space-y-8",children:[U.map(V=>a.jsx(Wy,{categoryLane:V,onBookClick:Fe},V.category.label)),$.length>0&&a.jsx(Vy,{books:$,onBookClick:Fe})]}):H?a.jsx(Rh,{books:Q,onBookClick:Fe,isLoading:ne}):O?a.jsxs("div",{className:"text-center py-12",children:[a.jsx("p",{className:"text-slate-400 text-lg mb-2",children:"No books match your current filters"}),a.jsx("p",{className:"text-slate-500 text-sm",children:'Try adjusting your filters or selecting "All" to see more books'})]}):null]})]})},Jy=({isLoading:r,onFileChange:i,className:n=""})=>{const o=P.useRef(null);return a.jsxs(a.Fragment,{children:[a.jsxs("label",{htmlFor:"epub-upload",className:`cursor-pointer bg-sky-500 hover:bg-sky-600 text-white font-bold p-2 sm:py-2 sm:px-4 rounded-lg inline-flex items-center transition-colors duration-200 ${r?"opacity-50 cursor-not-allowed":""} ${n}`,children:[a.jsx(Kf,{className:"w-5 h-5 sm:mr-2"}),a.jsx("span",{className:"hidden sm:inline",children:"Import Book"})]}),a.jsx("input",{ref:o,id:"epub-upload",type:"file",accept:".epub,.pdf",className:"hidden",onChange:i,disabled:r,"aria-label":"Upload EPUB or PDF file"})]})},ev=({onOpenBook:r,onShowBookDetail:i,onFileChange:n,importStatus:o,libraryRefreshFlag:u})=>{console.log("[LocalLibraryView] mounted. libraryRefreshFlag:",u);const[l,d]=P.useState(null),[f]=jo("ebook-sort-order","added-desc"),[h,y]=P.useState(!1),{data:k=[],isLoading:w,error:x,refetch:b}=uy();ps.useEffect(()=>{console.log("[LocalLibraryView] useEffect triggered by libraryRefreshFlag:",u),b()},[u,b]);const{mutate:C}=dy(),m=ay(k,f),S=L=>{i(L,"library")},j=(L,U)=>{U.preventDefault(),d(L)},_=P.useCallback(()=>{l?.id&&C(l.id,{onSuccess:()=>{d(null)}})},[l,C]);return w?a.jsx(Eh,{variant:"skeleton",message:"Loading library..."}):x?a.jsx(Nh,{variant:"page",title:"Failed to Load Library",message:x instanceof Error?x.message:"Could not load books from the library.",onRetry:()=>b()}):a.jsxs(a.Fragment,{children:[k.length>0?a.jsx(Rh,{books:m,onBookClick:S,onBookContextMenu:j}):a.jsx(Ah,{variant:"library"}),a.jsx(Iy,{isOpen:!!l,onClose:()=>d(null),onConfirm:_,bookTitle:l?.title||""})]})},tv=({sortOrder:r,onSortChange:i,isOpen:n,onToggle:o,onClose:u})=>{const l=P.useRef(null);P.useEffect(()=>{const f=h=>{l.current&&!l.current.contains(h.target)&&u()};if(n)return document.addEventListener("mousedown",f),()=>{document.removeEventListener("mousedown",f)}},[n,u]);const d=f=>{i(f),u()};return a.jsxs("div",{ref:l,className:"relative",children:[a.jsxs("button",{onClick:o,className:"cursor-pointer bg-slate-700 hover:bg-slate-600 text-white font-bold p-2 sm:py-2 sm:px-4 rounded-lg inline-flex items-center transition-colors duration-200","aria-label":"Sort options",children:[a.jsx(Jf,{className:"w-5 h-5 sm:mr-2"}),a.jsx("span",{className:"hidden sm:inline",children:"Sort"})]}),n&&a.jsx("div",{className:"absolute top-full right-0 mt-2 w-56 bg-slate-800 border border-slate-700 rounded-lg shadow-xl z-20",children:a.jsx("ul",{className:"p-1 text-white",children:ly.map(f=>a.jsx("li",{children:a.jsx("button",{onClick:()=>d(f.key),className:`w-full text-left px-3 py-2 text-sm rounded-md transition-colors ${r===f.key?"bg-sky-600 font-medium":"hover:bg-slate-700"}`,children:f.label})},f.key))})})]})},rv=({onOpenBook:r,onShowBookDetail:i,processAndSaveBook:n,importStatus:o,setImportStatus:u,activeOpdsSource:l,setActiveOpdsSource:d,catalogNavPath:f,setCatalogNavPath:h,onOpenCloudSyncModal:y,onOpenLocalStorageModal:k,onShowAbout:w,libraryRefreshFlag:x})=>{const b=Eo(),{catalogs:C,registries:m,addCatalog:S,deleteCatalog:j,updateCatalog:_,addRegistry:L,deleteRegistry:U,updateRegistry:M}=oy(),[re,J]=P.useState(!1),[$,z]=P.useState(!1),[Q,ae]=P.useState(!1),[F,te]=P.useState(!1),[N,K]=jo("ebook-sort-order","added-desc"),[ge,ne]=P.useState([]),[le,ie]=P.useState(null),[ue,A]=P.useState(null),B=P.useRef(null),me=P.useRef(null);P.useEffect(()=>{const v=X=>{B.current&&!B.current.contains(X.target)&&J(!1),me.current&&!me.current.contains(X.target)&&ae(!1)};return document.addEventListener("mousedown",v),()=>document.removeEventListener("mousedown",v)},[]);const he=P.useCallback(v=>{v==="library"?(d(null),h([])):(d(v),h([{name:v.name,url:v.url}])),J(!1)},[d,h]),se=P.useCallback((v,X,H="auto")=>{S(v,X,H)},[S]),we=P.useCallback(v=>{j(v),l?.id===v&&he("library")},[j,l,he]),Ee=P.useCallback((v,X)=>{_(v,{name:X}),l?.id===v&&(d(H=>H?{...H,name:X}:null),h(H=>{if(H.length>0){const I=[...H];return I[0]={...I[0],name:X},I}return H}))},[_,l,d,h]),xe=P.useCallback((v,X)=>{L(v,X)},[L]),je=P.useCallback(v=>{U(v),l?.id===v&&he("library")},[U,l,he]),Te=P.useCallback((v,X)=>{M(v,{name:X}),l?.id===v&&d(H=>H?{...H,name:X}:null)},[M,l,d]),Fe=v=>{console.log("[LibraryView] handleFileChange called",v.target.files);const X=v.target.files;if(!X||X.length===0){console.log("[LibraryView] No file selected");return}const H=X[0];if(console.log("[LibraryView] File selected:",H.name,H.type,H.size),H.size===0){console.error("[LibraryView] File size is 0 - file object is invalid!");const Y=/\.(epub|pdf)$/i.test(H.name)?'Unable to access file. If this file is stored in iCloud, right-click it in Finder and select "Download Now" to make it available locally, then try again.':"Unable to access file. Please try again.";u({isLoading:!1,message:"",error:Y}),v.target.value="";return}const I=H.name;H.type;const O=I.toLowerCase().endsWith(".pdf")?"PDF":"EPUB";console.log("[LibraryView] Creating blob from file...");const V=H.slice(0,H.size,H.type),G=new FileReader;console.log("[LibraryView] Starting FileReader.readAsArrayBuffer from blob..."),G.readAsArrayBuffer(V),u({isLoading:!0,message:"Reading file...",error:null}),G.onload=async oe=>{const Y=oe.target?.result;if(!Y){u({isLoading:!1,message:"",error:"Could not read file data."});return}console.log("[LibraryView] File read successfully, calling processAndSaveBook...",{fileName:I,size:Y.byteLength});try{const E=await n(Y,I,void 0,"file",void 0,void 0,O);console.log("[LibraryView] processAndSaveBook result:",E),E.success?(console.log("[LibraryView] Invalidating books query cache..."),await b.invalidateQueries({queryKey:Jl.all}),console.log("[LibraryView] Books query cache invalidated"),u({isLoading:!1,message:"Import successful!",error:null}),setTimeout(()=>u({isLoading:!1,message:"",error:null}),2e3)):E.existingBook&&(console.log("[LibraryView] Duplicate book detected"),ie(E.bookRecord||null),A(E.existingBook),u({isLoading:!1,message:"",error:null}))}catch(E){console.error("[LibraryView] Error during processAndSaveBook:",E),u({isLoading:!1,message:"",error:E.message||"Failed to import book"})}v.target.value=""},G.onerror=oe=>{console.error("[LibraryView] FileReader error:",{error:G.error,errorName:G.error?.name,errorMessage:G.error?.message,event:oe}),u({isLoading:!1,message:"",error:`File read error: ${G.error?.message||"Unknown error"}`}),v.target.value=""}},He=l?l.name:"My Library",Me=!!l;return a.jsxs("div",{className:"container mx-auto p-4 md:p-8",children:[a.jsxs("header",{className:"flex flex-col md:flex-row md:justify-between md:items-center mb-6 gap-4",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("img",{src:qy,alt:"MeBooks Logo",className:"w-10 h-10 flex-shrink-0"}),a.jsxs("div",{ref:B,className:"relative",children:[a.jsxs("button",{onClick:()=>J(v=>!v),className:"flex items-center gap-2 text-white text-left","aria-label":"Select book source","aria-expanded":re?"true":"false","aria-haspopup":"true",children:[a.jsx("h1",{className:"text-3xl md:text-4xl font-bold tracking-tight",children:He}),a.jsx(h0,{className:`w-6 h-6 transition-transform flex-shrink-0 mt-1 md:mt-2 ${re?"rotate-180":""}`})]}),re&&a.jsx("div",{className:"absolute top-full mt-2 w-72 bg-slate-800 border border-slate-700 rounded-lg shadow-xl z-20",children:a.jsxs("ul",{className:"p-1 text-white max-h-96 overflow-y-auto",children:[a.jsx("li",{children:a.jsx("button",{onClick:()=>he("library"),className:`w-full text-left px-3 py-2 text-sm rounded-md ${Me?"hover:bg-slate-700":"bg-sky-600"}`,children:"My Library"})}),(C.length>0||m.length>0)&&a.jsx("li",{className:"my-1 border-t border-slate-700"}),C.length>0&&a.jsxs(a.Fragment,{children:[a.jsx("li",{className:"px-3 pt-2 pb-1 text-xs font-semibold text-slate-400 uppercase",children:"Catalogs"}),C.map(v=>a.jsx("li",{children:a.jsx("button",{onClick:()=>he(v),className:`w-full text-left px-3 py-2 text-sm rounded-md truncate ${Me&&l?.id===v.id?"bg-sky-600":"hover:bg-slate-700"}`,children:v.name})},v.id))]}),m.length>0&&a.jsxs(a.Fragment,{children:[a.jsx("li",{className:"px-3 pt-2 pb-1 text-xs font-semibold text-slate-400 uppercase",children:"Registries"}),m.map(v=>a.jsx("li",{children:a.jsx("button",{onClick:()=>he(v),className:`w-full text-left px-3 py-2 text-sm rounded-md truncate ${Me&&l?.id===v.id?"bg-sky-600":"hover:bg-slate-700"}`,children:v.name})},v.id))]})]})})]})]}),a.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 self-end md:self-auto",children:[!Me&&a.jsx(tv,{sortOrder:N,onSortChange:K,isOpen:F,onToggle:()=>te(v=>!v),onClose:()=>te(!1)}),!Me&&a.jsx(Jy,{isLoading:o.isLoading,onFileChange:Fe}),a.jsxs("div",{ref:me,className:"relative",children:[a.jsx("button",{onClick:()=>ae(v=>!v),className:"cursor-pointer bg-slate-700 hover:bg-slate-600 text-white font-bold p-2 rounded-lg inline-flex items-center transition-colors duration-200 h-[40px] w-[40px] justify-center","aria-label":"Open settings menu",children:a.jsx(Gf,{className:"w-5 h-5"})}),Q&&a.jsx("div",{className:"absolute top-full right-0 mt-2 w-56 bg-slate-800 border border-slate-700 rounded-lg shadow-xl z-20",children:a.jsxs("ul",{className:"p-1 text-white",children:[a.jsx("li",{children:a.jsx("button",{onClick:()=>{z(!0),ae(!1)},className:"w-full text-left px-3 py-2 text-sm rounded-md hover:bg-slate-700 block",children:"Manage Sources"})}),a.jsx("li",{className:"my-1 border-t border-slate-700/50"}),a.jsx("li",{children:a.jsx("button",{onClick:()=>{k(),ae(!1)},className:"w-full text-left px-3 py-2 text-sm rounded-md hover:bg-slate-700 block",children:"Local Storage"})}),a.jsx("li",{children:a.jsx("button",{onClick:()=>{y(),ae(!1)},className:"w-full text-left px-3 py-2 text-sm rounded-md hover:bg-slate-700 block",children:"Cloud Sync"})}),a.jsx("li",{className:"my-1 border-t border-slate-700/50"}),a.jsx("li",{children:a.jsx("button",{onClick:()=>{w(),ae(!1)},className:"w-full text-left px-3 py-2 text-sm rounded-md hover:bg-slate-700 block",children:"About"})})]})})]})]})]}),a.jsx("section",{"aria-label":"Library content",children:Me&&l?a.jsx(Yy,{activeOpdsSource:l,catalogNavPath:f,setCatalogNavPath:h,onShowBookDetail:i,rootLevelCollections:ge,setRootLevelCollections:ne}):a.jsx(ev,{onOpenBook:r,onShowBookDetail:i,onFileChange:Fe,importStatus:o})}),a.jsx(By,{isOpen:$,onClose:()=>z(!1),catalogs:C,onAddCatalog:se,onDeleteCatalog:we,onUpdateCatalog:Ee,registries:m,onAddRegistry:xe,onDeleteRegistry:je,onUpdateRegistry:Te}),a.jsx(mh,{isOpen:!!le,onClose:()=>{ie(null),A(null)},onReplace:()=>{ie(null),A(null)},onAddAnyway:()=>{ie(null),A(null)},bookTitle:le?.title||""})]})},nv=({currentView:r,selectedBookId:i,coverAnimationData:n,onCloseReader:o,detailViewData:u,onReturnToLibrary:l,onReadBook:d,onImportFromCatalog:f,onOpenBook:h,onShowBookDetail:y,processAndSaveBook:k,activeOpdsSource:w,setActiveOpdsSource:x,catalogNavPath:b,setCatalogNavPath:C,onOpenCloudSyncModal:m,onOpenLocalStorageModal:S,onShowAbout:j,importStatus:_,setImportStatus:L,libraryRefreshFlag:U})=>{switch(r){case"reader":return i!==null?a.jsx(ri,{onReset:o,fallbackMessage:"There was an error while trying to display this book. Returning to the library.",children:a.jsx(Oy,{bookId:i,onClose:o,animationData:n})}):null;case"bookDetail":return u?a.jsx(ri,{onReset:l,fallbackMessage:"There was an error showing the book details. Returning to the library.",children:a.jsx(wy,{book:u.book,source:u.source,catalogName:u.catalogName,onBack:l,onReadBook:d,onImportFromCatalog:f,importStatus:_,setImportStatus:L})}):null;case"about":return a.jsx(g0,{onBack:l});case"library":default:return a.jsx(ri,{onReset:()=>window.location.reload(),fallbackMessage:"There was a critical error in the library. Please try reloading the application.",children:a.jsx(rv,{onOpenBook:h,onShowBookDetail:y,processAndSaveBook:k,importStatus:_,setImportStatus:L,activeOpdsSource:w,setActiveOpdsSource:x,catalogNavPath:b,setCatalogNavPath:C,onOpenCloudSyncModal:m,onOpenLocalStorageModal:S,onShowAbout:j,libraryRefreshFlag:U})})}};class sv{async resolveOPDS2(i,n,o=5){try{ce.info("Resolving OPDS 2 acquisition chain",{href:i});const u=await G0(i,n,o);return u?(ce.info("OPDS 2 acquisition resolved",{finalUrl:u}),{success:!0,data:u}):{success:!1,error:"Failed to resolve acquisition chain"}}catch(u){const l=u instanceof Error?u.message:"Unknown error resolving acquisition";return ce.error("OPDS 2 acquisition error:",l),{success:!1,error:l,status:u?.status,proxyUsed:u?.proxyUsed}}}async resolveOPDS1(i,n,o=5){try{ce.info("Resolving OPDS 1 acquisition chain",{href:i});const u=await ti(i,n,o);return u?(ce.info("OPDS 1 acquisition resolved",{finalUrl:u}),{success:!0,data:u}):{success:!1,error:"Failed to resolve acquisition chain"}}catch(u){const l=u instanceof Error?u.message:"Unknown error resolving acquisition";return ce.error("OPDS 1 acquisition error:",l),{success:!1,error:l,status:u?.status,proxyUsed:u?.proxyUsed}}}async resolve(i,n="auto",o,u=5){if(n==="2")return this.resolveOPDS2(i,o,u);if(n==="1")return this.resolveOPDS1(i,o,u);ce.info("Auto-detecting OPDS version for acquisition",{href:i});const l=await this.resolveOPDS2(i,o,u);return l.success?l:(ce.info("OPDS 2 resolution failed, trying OPDS 1",{href:i}),this.resolveOPDS1(i,o,u))}}const _l=new sv;var ds={},Rl={},mf;function iv(){return mf||(mf=1,Rl.entityMap={lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"À",Aacute:"Á",Acirc:"Â",Atilde:"Ã",Auml:"Ä",Aring:"Å",AElig:"Æ",Ccedil:"Ç",Egrave:"È",Eacute:"É",Ecirc:"Ê",Euml:"Ë",Igrave:"Ì",Iacute:"Í",Icirc:"Î",Iuml:"Ï",ETH:"Ð",Ntilde:"Ñ",Ograve:"Ò",Oacute:"Ó",Ocirc:"Ô",Otilde:"Õ",Ouml:"Ö",Oslash:"Ø",Ugrave:"Ù",Uacute:"Ú",Ucirc:"Û",Uuml:"Ü",Yacute:"Ý",THORN:"Þ",szlig:"ß",agrave:"à",aacute:"á",acirc:"â",atilde:"ã",auml:"ä",aring:"å",aelig:"æ",ccedil:"ç",egrave:"è",eacute:"é",ecirc:"ê",euml:"ë",igrave:"ì",iacute:"í",icirc:"î",iuml:"ï",eth:"ð",ntilde:"ñ",ograve:"ò",oacute:"ó",ocirc:"ô",otilde:"õ",ouml:"ö",oslash:"ø",ugrave:"ù",uacute:"ú",ucirc:"û",uuml:"ü",yacute:"ý",thorn:"þ",yuml:"ÿ",nbsp:" ",iexcl:"¡",cent:"¢",pound:"£",curren:"¤",yen:"¥",brvbar:"¦",sect:"§",uml:"¨",copy:"©",ordf:"ª",laquo:"«",not:"¬",shy:"­­",reg:"®",macr:"¯",deg:"°",plusmn:"±",sup2:"²",sup3:"³",acute:"´",micro:"µ",para:"¶",middot:"·",cedil:"¸",sup1:"¹",ordm:"º",raquo:"»",frac14:"¼",frac12:"½",frac34:"¾",iquest:"¿",times:"×",divide:"÷",forall:"∀",part:"∂",exist:"∃",empty:"∅",nabla:"∇",isin:"∈",notin:"∉",ni:"∋",prod:"∏",sum:"∑",minus:"−",lowast:"∗",radic:"√",prop:"∝",infin:"∞",ang:"∠",and:"∧",or:"∨",cap:"∩",cup:"∪",int:"∫",there4:"∴",sim:"∼",cong:"≅",asymp:"≈",ne:"≠",equiv:"≡",le:"≤",ge:"≥",sub:"⊂",sup:"⊃",nsub:"⊄",sube:"⊆",supe:"⊇",oplus:"⊕",otimes:"⊗",perp:"⊥",sdot:"⋅",Alpha:"Α",Beta:"Β",Gamma:"Γ",Delta:"Δ",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Theta:"Θ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nu:"Ν",Xi:"Ξ",Omicron:"Ο",Pi:"Π",Rho:"Ρ",Sigma:"Σ",Tau:"Τ",Upsilon:"Υ",Phi:"Φ",Chi:"Χ",Psi:"Ψ",Omega:"Ω",alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ε",zeta:"ζ",eta:"η",theta:"θ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",omicron:"ο",pi:"π",rho:"ρ",sigmaf:"ς",sigma:"σ",tau:"τ",upsilon:"υ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",thetasym:"ϑ",upsih:"ϒ",piv:"ϖ",OElig:"Œ",oelig:"œ",Scaron:"Š",scaron:"š",Yuml:"Ÿ",fnof:"ƒ",circ:"ˆ",tilde:"˜",ensp:" ",emsp:" ",thinsp:" ",zwnj:"‌",zwj:"‍",lrm:"‎",rlm:"‏",ndash:"–",mdash:"—",lsquo:"‘",rsquo:"’",sbquo:"‚",ldquo:"“",rdquo:"”",bdquo:"„",dagger:"†",Dagger:"‡",bull:"•",hellip:"…",permil:"‰",prime:"′",Prime:"″",lsaquo:"‹",rsaquo:"›",oline:"‾",euro:"€",trade:"™",larr:"←",uarr:"↑",rarr:"→",darr:"↓",harr:"↔",crarr:"↵",lceil:"⌈",rceil:"⌉",lfloor:"⌊",rfloor:"⌋",loz:"◊",spades:"♠",clubs:"♣",hearts:"♥",diams:"♦"}),Rl}var vo={},gf;function ov(){if(gf)return vo;gf=1;var r=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,i=new RegExp("[\\-\\.0-9"+r.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),n=new RegExp("^"+r.source+i.source+"*(?::"+r.source+i.source+"*)?$"),o=0,u=1,l=2,d=3,f=4,h=5,y=6,k=7;function w($,z){this.message=$,this.locator=z,Error.captureStackTrace&&Error.captureStackTrace(this,w)}w.prototype=new Error,w.prototype.name=w.name;function x(){}x.prototype={parse:function($,z,Q){var ae=this.domBuilder;ae.startDocument(),L(z,z={}),b($,z,Q,ae,this.errorHandler),ae.endDocument()}};function b($,z,Q,ae,F){function te(G){if(G>65535){G-=65536;var oe=55296+(G>>10),Y=56320+(G&1023);return String.fromCharCode(oe,Y)}else return String.fromCharCode(G)}function N(G){var oe=G.slice(1,-1);return oe in Q?Q[oe]:oe.charAt(0)==="#"?te(parseInt(oe.substr(1).replace("x","0x"))):(F.error("entity not found:"+G),G)}function K(G){if(G>me){var oe=$.substring(me,G).replace(/&#?\w+;/g,N);ue&&ge(me),ae.characters(oe,0,G-me),me=G}}function ge(G,oe){for(;G>=le&&(oe=ie.exec($));)ne=oe.index,le=ne+oe[0].length,ue.lineNumber++;ue.columnNumber=G-ne+1}for(var ne=0,le=0,ie=/.*(?:\r\n?|\n)|.*$/g,ue=ae.locator,A=[{currentNSMap:z}],B={},me=0;;){try{var he=$.indexOf("<",me);if(he<0){if(!$.substr(me).match(/^\s*$/)){var se=ae.doc,we=se.createTextNode($.substr(me));se.appendChild(we),ae.currentElement=we}return}switch(he>me&&K(he),$.charAt(he+1)){case"/":var X=$.indexOf(">",he+3),Ee=$.substring(he+2,X),xe=A.pop();X<0?(Ee=$.substring(he+2).replace(/[\s<].*/,""),F.error("end tag name: "+Ee+" is not complete:"+xe.tagName),X=he+1+Ee.length):Ee.match(/\s</)&&(Ee=Ee.replace(/[\s<].*/,""),F.error("end tag name: "+Ee+" maybe not complete"),X=he+1+Ee.length);var je=xe.localNSMap,Te=xe.tagName==Ee,Fe=Te||xe.tagName&&xe.tagName.toLowerCase()==Ee.toLowerCase();if(Fe){if(ae.endElement(xe.uri,xe.localName,Ee),je)for(var He in je)ae.endPrefixMapping(He);Te||F.fatalError("end tag name: "+Ee+" is not match the current start tagName:"+xe.tagName)}else A.push(xe);X++;break;case"?":ue&&ge(he),X=M($,he,ae);break;case"!":ue&&ge(he),X=U($,he,ae,F);break;default:ue&&ge(he);var Me=new re,v=A[A.length-1].currentNSMap,X=m($,he,Me,v,N,F),H=Me.length;if(!Me.closed&&_($,X,Me.tagName,B)&&(Me.closed=!0,Q.nbsp||F.warning("unclosed xml attribute")),ue&&H){for(var I=C(ue,{}),O=0;O<H;O++){var V=Me[O];ge(V.offset),V.locator=C(ue,{})}ae.locator=I,S(Me,ae,v)&&A.push(Me),ae.locator=ue}else S(Me,ae,v)&&A.push(Me);Me.uri==="http://www.w3.org/1999/xhtml"&&!Me.closed?X=j($,X,Me.tagName,N,ae):X++}}catch(G){if(G instanceof w)throw G;F.error("element parse error: "+G),X=-1}X>me?me=X:K(Math.max(he,me)+1)}}function C($,z){return z.lineNumber=$.lineNumber,z.columnNumber=$.columnNumber,z}function m($,z,Q,ae,F,te){function N(ue,A,B){ue in Q.attributeNames&&te.fatalError("Attribute "+ue+" redefined"),Q.addValue(ue,A,B)}for(var K,ge,ne=++z,le=o;;){var ie=$.charAt(ne);switch(ie){case"=":if(le===u)K=$.slice(z,ne),le=d;else if(le===l)le=d;else throw new Error("attribute equal must after attrName");break;case"'":case'"':if(le===d||le===u)if(le===u&&(te.warning('attribute value must after "="'),K=$.slice(z,ne)),z=ne+1,ne=$.indexOf(ie,z),ne>0)ge=$.slice(z,ne).replace(/&#?\w+;/g,F),N(K,ge,z-1),le=h;else throw new Error("attribute value no end '"+ie+"' match");else if(le==f)ge=$.slice(z,ne).replace(/&#?\w+;/g,F),N(K,ge,z),te.warning('attribute "'+K+'" missed start quot('+ie+")!!"),z=ne+1,le=h;else throw new Error('attribute value must after "="');break;case"/":switch(le){case o:Q.setTagName($.slice(z,ne));case h:case y:case k:le=k,Q.closed=!0;case f:case u:case l:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return te.error("unexpected end of input"),le==o&&Q.setTagName($.slice(z,ne)),ne;case">":switch(le){case o:Q.setTagName($.slice(z,ne));case h:case y:case k:break;case f:case u:ge=$.slice(z,ne),ge.slice(-1)==="/"&&(Q.closed=!0,ge=ge.slice(0,-1));case l:le===l&&(ge=K),le==f?(te.warning('attribute "'+ge+'" missed quot(")!'),N(K,ge.replace(/&#?\w+;/g,F),z)):((ae[""]!=="http://www.w3.org/1999/xhtml"||!ge.match(/^(?:disabled|checked|selected)$/i))&&te.warning('attribute "'+ge+'" missed value!! "'+ge+'" instead!!'),N(ge,ge,z));break;case d:throw new Error("attribute value missed!!")}return ne;case"":ie=" ";default:if(ie<=" ")switch(le){case o:Q.setTagName($.slice(z,ne)),le=y;break;case u:K=$.slice(z,ne),le=l;break;case f:var ge=$.slice(z,ne).replace(/&#?\w+;/g,F);te.warning('attribute "'+ge+'" missed quot(")!!'),N(K,ge,z);case h:le=y;break}else switch(le){case l:Q.tagName,(ae[""]!=="http://www.w3.org/1999/xhtml"||!K.match(/^(?:disabled|checked|selected)$/i))&&te.warning('attribute "'+K+'" missed value!! "'+K+'" instead2!!'),N(K,K,z),z=ne,le=u;break;case h:te.warning('attribute space is required"'+K+'"!!');case y:le=u,z=ne;break;case d:le=f,z=ne;break;case k:throw new Error("elements closed character '/' and '>' must be connected to")}}ne++}}function S($,z,Q){for(var ae=$.tagName,F=null,ie=$.length;ie--;){var te=$[ie],N=te.qName,K=te.value,ue=N.indexOf(":");if(ue>0)var ge=te.prefix=N.slice(0,ue),ne=N.slice(ue+1),le=ge==="xmlns"&&ne;else ne=N,ge=null,le=N==="xmlns"&&"";te.localName=ne,le!==!1&&(F==null&&(F={},L(Q,Q={})),Q[le]=F[le]=K,te.uri="http://www.w3.org/2000/xmlns/",z.startPrefixMapping(le,K))}for(var ie=$.length;ie--;){te=$[ie];var ge=te.prefix;ge&&(ge==="xml"&&(te.uri="http://www.w3.org/XML/1998/namespace"),ge!=="xmlns"&&(te.uri=Q[ge||""]))}var ue=ae.indexOf(":");ue>0?(ge=$.prefix=ae.slice(0,ue),ne=$.localName=ae.slice(ue+1)):(ge=null,ne=$.localName=ae);var A=$.uri=Q[ge||""];if(z.startElement(A,ne,ae,$),$.closed){if(z.endElement(A,ne,ae),F)for(ge in F)z.endPrefixMapping(ge)}else return $.currentNSMap=Q,$.localNSMap=F,!0}function j($,z,Q,ae,F){if(/^(?:script|textarea)$/i.test(Q)){var te=$.indexOf("</"+Q+">",z),N=$.substring(z+1,te);if(/[&<]/.test(N))return/^script$/i.test(Q)?(F.characters(N,0,N.length),te):(N=N.replace(/&#?\w+;/g,ae),F.characters(N,0,N.length),te)}return z+1}function _($,z,Q,ae){var F=ae[Q];return F==null&&(F=$.lastIndexOf("</"+Q+">"),F<z&&(F=$.lastIndexOf("</"+Q)),ae[Q]=F),F<z}function L($,z){for(var Q in $)z[Q]=$[Q]}function U($,z,Q,ae){var F=$.charAt(z+2);switch(F){case"-":if($.charAt(z+3)==="-"){var te=$.indexOf("-->",z+4);return te>z?(Q.comment($,z+4,te-z-4),te+3):(ae.error("Unclosed comment"),-1)}else return-1;default:if($.substr(z+3,6)=="CDATA["){var te=$.indexOf("]]>",z+9);return Q.startCDATA(),Q.characters($,z+9,te-z-9),Q.endCDATA(),te+3}var N=J($,z),K=N.length;if(K>1&&/!doctype/i.test(N[0][0])){var ge=N[1][0],ne=!1,le=!1;K>3&&(/^public$/i.test(N[2][0])?(ne=N[3][0],le=K>4&&N[4][0]):/^system$/i.test(N[2][0])&&(le=N[3][0]));var ie=N[K-1];return Q.startDTD(ge,ne,le),Q.endDTD(),ie.index+ie[0].length}}return-1}function M($,z,Q){var ae=$.indexOf("?>",z);if(ae){var F=$.substring(z,ae).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return F?(F[0].length,Q.processingInstruction(F[1],F[2]),ae+2):-1}return-1}function re(){this.attributeNames={}}re.prototype={setTagName:function($){if(!n.test($))throw new Error("invalid tagName:"+$);this.tagName=$},addValue:function($,z,Q){if(!n.test($))throw new Error("invalid attribute:"+$);this.attributeNames[$]=this.length,this[this.length++]={qName:$,value:z,offset:Q}},length:0,getLocalName:function($){return this[$].localName},getLocator:function($){return this[$].locator},getQName:function($){return this[$].qName},getURI:function($){return this[$].uri},getValue:function($){return this[$].value}};function J($,z){var Q,ae=[],F=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(F.lastIndex=z,F.exec($);Q=F.exec($);)if(ae.push(Q),Q[1])return ae}return vo.XMLReader=x,vo.ParseError=w,vo}var fs={},yf;function vf(){if(yf)return fs;yf=1;function r(E,T){for(var D in E)T[D]=E[D]}function i(E,T){var D=E.prototype;if(!(D instanceof T)){let q=function(){};q.prototype=T.prototype,q=new q,r(D,q),E.prototype=D=q}D.constructor!=E&&(typeof E!="function"&&console.error("unknow Class:"+E),D.constructor=E)}var n="http://www.w3.org/1999/xhtml",o={},u=o.ELEMENT_NODE=1,l=o.ATTRIBUTE_NODE=2,d=o.TEXT_NODE=3,f=o.CDATA_SECTION_NODE=4,h=o.ENTITY_REFERENCE_NODE=5,y=o.ENTITY_NODE=6,k=o.PROCESSING_INSTRUCTION_NODE=7,w=o.COMMENT_NODE=8,x=o.DOCUMENT_NODE=9,b=o.DOCUMENT_TYPE_NODE=10,C=o.DOCUMENT_FRAGMENT_NODE=11,m=o.NOTATION_NODE=12,S={},j={};S.INDEX_SIZE_ERR=(j[1]="Index size error",1),S.DOMSTRING_SIZE_ERR=(j[2]="DOMString size error",2);var _=S.HIERARCHY_REQUEST_ERR=(j[3]="Hierarchy request error",3);S.WRONG_DOCUMENT_ERR=(j[4]="Wrong document",4),S.INVALID_CHARACTER_ERR=(j[5]="Invalid character",5),S.NO_DATA_ALLOWED_ERR=(j[6]="No data allowed",6),S.NO_MODIFICATION_ALLOWED_ERR=(j[7]="No modification allowed",7);var L=S.NOT_FOUND_ERR=(j[8]="Not found",8);S.NOT_SUPPORTED_ERR=(j[9]="Not supported",9);var U=S.INUSE_ATTRIBUTE_ERR=(j[10]="Attribute in use",10);S.INVALID_STATE_ERR=(j[11]="Invalid state",11),S.SYNTAX_ERR=(j[12]="Syntax error",12),S.INVALID_MODIFICATION_ERR=(j[13]="Invalid modification",13),S.NAMESPACE_ERR=(j[14]="Invalid namespace",14),S.INVALID_ACCESS_ERR=(j[15]="Invalid access",15);function M(E,T){if(T instanceof Error)var D=T;else D=this,Error.call(this,j[E]),this.message=j[E],Error.captureStackTrace&&Error.captureStackTrace(this,M);return D.code=E,T&&(this.message=this.message+": "+T),D}M.prototype=Error.prototype,r(S,M);function re(){}re.prototype={length:0,item:function(E){return this[E]||null},toString:function(E,T){for(var D=[],q=0;q<this.length;q++)V(this[q],D,E,T);return D.join("")}};function J(E,T){this._node=E,this._refresh=T,$(this)}function $(E){var T=E._node._inc||E._node.ownerDocument._inc;if(E._inc!=T){var D=E._refresh(E._node);Y(E,"length",D.length),r(D,E),E._inc=T}}J.prototype.item=function(E){return $(this),this[E]},i(J,re);function z(){}function Q(E,T){for(var D=E.length;D--;)if(E[D]===T)return D}function ae(E,T,D,q){if(q?T[Q(T,q)]=D:T[T.length++]=D,E){D.ownerElement=E;var ve=E.ownerDocument;ve&&(q&&ie(ve,E,q),le(ve,E,D))}}function F(E,T,D){var q=Q(T,D);if(q>=0){for(var ve=T.length-1;q<ve;)T[q]=T[++q];if(T.length=ve,E){var Ce=E.ownerDocument;Ce&&(ie(Ce,E,D),D.ownerElement=null)}}else throw M(L,new Error(E.tagName+"@"+D))}z.prototype={length:0,item:re.prototype.item,getNamedItem:function(E){for(var T=this.length;T--;){var D=this[T];if(D.nodeName==E)return D}},setNamedItem:function(E){var T=E.ownerElement;if(T&&T!=this._ownerElement)throw new M(U);var D=this.getNamedItem(E.nodeName);return ae(this._ownerElement,this,E,D),D},setNamedItemNS:function(E){var T=E.ownerElement,D;if(T&&T!=this._ownerElement)throw new M(U);return D=this.getNamedItemNS(E.namespaceURI,E.localName),ae(this._ownerElement,this,E,D),D},removeNamedItem:function(E){var T=this.getNamedItem(E);return F(this._ownerElement,this,T),T},removeNamedItemNS:function(E,T){var D=this.getNamedItemNS(E,T);return F(this._ownerElement,this,D),D},getNamedItemNS:function(E,T){for(var D=this.length;D--;){var q=this[D];if(q.localName==T&&q.namespaceURI==E)return q}return null}};function te(E){if(this._features={},E)for(var T in E)this._features=E[T]}te.prototype={hasFeature:function(E,T){var D=this._features[E.toLowerCase()];return!!(D&&(!T||T in D))},createDocument:function(E,T,D){var q=new ne;if(q.implementation=this,q.childNodes=new re,q.doctype=D,D&&q.appendChild(D),T){var ve=q.createElementNS(E,T);q.appendChild(ve)}return q},createDocumentType:function(E,T,D){var q=new Te;return q.name=E,q.nodeName=E,q.publicId=T,q.systemId=D,q}};function N(){}N.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(E,T){return B(this,E,T)},replaceChild:function(E,T){this.insertBefore(E,T),T&&this.removeChild(T)},removeChild:function(E){return A(this,E)},appendChild:function(E){return this.insertBefore(E,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(E){return oe(this.ownerDocument||this,this,E)},normalize:function(){for(var E=this.firstChild;E;){var T=E.nextSibling;T&&T.nodeType==d&&E.nodeType==d?(this.removeChild(T),E.appendData(T.data)):(E.normalize(),E=T)}},isSupported:function(E,T){return this.ownerDocument.implementation.hasFeature(E,T)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(E){for(var T=this;T;){var D=T._nsMap;if(D){for(var q in D)if(D[q]==E)return q}T=T.nodeType==l?T.ownerDocument:T.parentNode}return null},lookupNamespaceURI:function(E){for(var T=this;T;){var D=T._nsMap;if(D&&E in D)return D[E];T=T.nodeType==l?T.ownerDocument:T.parentNode}return null},isDefaultNamespace:function(E){var T=this.lookupPrefix(E);return T==null}};function K(E){return E=="<"&&"&lt;"||E==">"&&"&gt;"||E=="&"&&"&amp;"||E=='"'&&"&quot;"||"&#"+E.charCodeAt()+";"}r(o,N),r(o,N.prototype);function ge(E,T){if(T(E))return!0;if(E=E.firstChild)do if(ge(E,T))return!0;while(E=E.nextSibling)}function ne(){}function le(E,T,D){E&&E._inc++;var q=D.namespaceURI;q=="http://www.w3.org/2000/xmlns/"&&(T._nsMap[D.prefix?D.localName:""]=D.value)}function ie(E,T,D,q){E&&E._inc++;var ve=D.namespaceURI;ve=="http://www.w3.org/2000/xmlns/"&&delete T._nsMap[D.prefix?D.localName:""]}function ue(E,T,D){if(E&&E._inc){E._inc++;var q=T.childNodes;if(D)q[q.length++]=D;else{for(var ve=T.firstChild,Ce=0;ve;)q[Ce++]=ve,ve=ve.nextSibling;q.length=Ce}}}function A(E,T){var D=T.previousSibling,q=T.nextSibling;return D?D.nextSibling=q:E.firstChild=q,q?q.previousSibling=D:E.lastChild=D,ue(E.ownerDocument,E),T}function B(E,T,D){var q=T.parentNode;if(q&&q.removeChild(T),T.nodeType===C){var ve=T.firstChild;if(ve==null)return T;var Ce=T.lastChild}else ve=Ce=T;var $e=D?D.previousSibling:E.lastChild;ve.previousSibling=$e,Ce.nextSibling=D,$e?$e.nextSibling=ve:E.firstChild=ve,D==null?E.lastChild=Ce:D.previousSibling=Ce;do ve.parentNode=E;while(ve!==Ce&&(ve=ve.nextSibling));return ue(E.ownerDocument||E,E),T.nodeType==C&&(T.firstChild=T.lastChild=null),T}function me(E,T){var D=T.parentNode;if(D){var q=E.lastChild;D.removeChild(T);var q=E.lastChild}var q=E.lastChild;return T.parentNode=E,T.previousSibling=q,T.nextSibling=null,q?q.nextSibling=T:E.firstChild=T,E.lastChild=T,ue(E.ownerDocument,E,T),T}ne.prototype={nodeName:"#document",nodeType:x,doctype:null,documentElement:null,_inc:1,insertBefore:function(E,T){if(E.nodeType==C){for(var D=E.firstChild;D;){var q=D.nextSibling;this.insertBefore(D,T),D=q}return E}return this.documentElement==null&&E.nodeType==u&&(this.documentElement=E),B(this,E,T),E.ownerDocument=this,E},removeChild:function(E){return this.documentElement==E&&(this.documentElement=null),A(this,E)},importNode:function(E,T){return G(this,E,T)},getElementById:function(E){var T=null;return ge(this.documentElement,function(D){if(D.nodeType==u&&D.getAttribute("id")==E)return T=D,!0}),T},getElementsByClassName:function(E){var T=new RegExp("(^|\\s)"+E+"(\\s|$)");return new J(this,function(D){var q=[];return ge(D.documentElement,function(ve){ve!==D&&ve.nodeType==u&&T.test(ve.getAttribute("class"))&&q.push(ve)}),q})},createElement:function(E){var T=new he;T.ownerDocument=this,T.nodeName=E,T.tagName=E,T.childNodes=new re;var D=T.attributes=new z;return D._ownerElement=T,T},createDocumentFragment:function(){var E=new v;return E.ownerDocument=this,E.childNodes=new re,E},createTextNode:function(E){var T=new Ee;return T.ownerDocument=this,T.appendData(E),T},createComment:function(E){var T=new xe;return T.ownerDocument=this,T.appendData(E),T},createCDATASection:function(E){var T=new je;return T.ownerDocument=this,T.appendData(E),T},createProcessingInstruction:function(E,T){var D=new X;return D.ownerDocument=this,D.tagName=D.target=E,D.nodeValue=D.data=T,D},createAttribute:function(E){var T=new se;return T.ownerDocument=this,T.name=E,T.nodeName=E,T.localName=E,T.specified=!0,T},createEntityReference:function(E){var T=new Me;return T.ownerDocument=this,T.nodeName=E,T},createElementNS:function(E,T){var D=new he,q=T.split(":"),ve=D.attributes=new z;return D.childNodes=new re,D.ownerDocument=this,D.nodeName=T,D.tagName=T,D.namespaceURI=E,q.length==2?(D.prefix=q[0],D.localName=q[1]):D.localName=T,ve._ownerElement=D,D},createAttributeNS:function(E,T){var D=new se,q=T.split(":");return D.ownerDocument=this,D.nodeName=T,D.name=T,D.namespaceURI=E,D.specified=!0,q.length==2?(D.prefix=q[0],D.localName=q[1]):D.localName=T,D}},i(ne,N);function he(){this._nsMap={}}he.prototype={nodeType:u,hasAttribute:function(E){return this.getAttributeNode(E)!=null},getAttribute:function(E){var T=this.getAttributeNode(E);return T&&T.value||""},getAttributeNode:function(E){return this.attributes.getNamedItem(E)},setAttribute:function(E,T){var D=this.ownerDocument.createAttribute(E);D.value=D.nodeValue=""+T,this.setAttributeNode(D)},removeAttribute:function(E){var T=this.getAttributeNode(E);T&&this.removeAttributeNode(T)},appendChild:function(E){return E.nodeType===C?this.insertBefore(E,null):me(this,E)},setAttributeNode:function(E){return this.attributes.setNamedItem(E)},setAttributeNodeNS:function(E){return this.attributes.setNamedItemNS(E)},removeAttributeNode:function(E){return this.attributes.removeNamedItem(E.nodeName)},removeAttributeNS:function(E,T){var D=this.getAttributeNodeNS(E,T);D&&this.removeAttributeNode(D)},hasAttributeNS:function(E,T){return this.getAttributeNodeNS(E,T)!=null},getAttributeNS:function(E,T){var D=this.getAttributeNodeNS(E,T);return D&&D.value||""},setAttributeNS:function(E,T,D){var q=this.ownerDocument.createAttributeNS(E,T);q.value=q.nodeValue=""+D,this.setAttributeNode(q)},getAttributeNodeNS:function(E,T){return this.attributes.getNamedItemNS(E,T)},getElementsByTagName:function(E){return new J(this,function(T){var D=[];return ge(T,function(q){q!==T&&q.nodeType==u&&(E==="*"||q.tagName==E)&&D.push(q)}),D})},getElementsByTagNameNS:function(E,T){return new J(this,function(D){var q=[];return ge(D,function(ve){ve!==D&&ve.nodeType===u&&(E==="*"||ve.namespaceURI===E)&&(T==="*"||ve.localName==T)&&q.push(ve)}),q})}},ne.prototype.getElementsByTagName=he.prototype.getElementsByTagName,ne.prototype.getElementsByTagNameNS=he.prototype.getElementsByTagNameNS,i(he,N);function se(){}se.prototype.nodeType=l,i(se,N);function we(){}we.prototype={data:"",substringData:function(E,T){return this.data.substring(E,E+T)},appendData:function(E){E=this.data+E,this.nodeValue=this.data=E,this.length=E.length},insertData:function(E,T){this.replaceData(E,0,T)},appendChild:function(E){throw new Error(j[_])},deleteData:function(E,T){this.replaceData(E,T,"")},replaceData:function(E,T,D){var q=this.data.substring(0,E),ve=this.data.substring(E+T);D=q+D+ve,this.nodeValue=this.data=D,this.length=D.length}},i(we,N);function Ee(){}Ee.prototype={nodeName:"#text",nodeType:d,splitText:function(E){var T=this.data,D=T.substring(E);T=T.substring(0,E),this.data=this.nodeValue=T,this.length=T.length;var q=this.ownerDocument.createTextNode(D);return this.parentNode&&this.parentNode.insertBefore(q,this.nextSibling),q}},i(Ee,we);function xe(){}xe.prototype={nodeName:"#comment",nodeType:w},i(xe,we);function je(){}je.prototype={nodeName:"#cdata-section",nodeType:f},i(je,we);function Te(){}Te.prototype.nodeType=b,i(Te,N);function Fe(){}Fe.prototype.nodeType=m,i(Fe,N);function He(){}He.prototype.nodeType=y,i(He,N);function Me(){}Me.prototype.nodeType=h,i(Me,N);function v(){}v.prototype.nodeName="#document-fragment",v.prototype.nodeType=C,i(v,N);function X(){}X.prototype.nodeType=k,i(X,N);function H(){}H.prototype.serializeToString=function(E,T,D){return I.call(E,T,D)},N.prototype.toString=I;function I(E,T){var D=[],q=this.nodeType==9&&this.documentElement||this,ve=q.prefix,Ce=q.namespaceURI;if(Ce&&ve==null){var ve=q.lookupPrefix(Ce);if(ve==null)var $e=[{namespace:Ce,prefix:null}]}return V(this,D,E,T,$e),D.join("")}function O(E,T,D){var q=E.prefix||"",ve=E.namespaceURI;if(!q&&!ve||q==="xml"&&ve==="http://www.w3.org/XML/1998/namespace"||ve=="http://www.w3.org/2000/xmlns/")return!1;for(var Ce=D.length;Ce--;){var $e=D[Ce];if($e.prefix==q)return $e.namespace!=ve}return!0}function V(E,T,D,q,ve){if(q)if(E=q(E),E){if(typeof E=="string"){T.push(E);return}}else return;switch(E.nodeType){case u:ve||(ve=[]),ve.length;var Ce=E.attributes,$e=Ce.length,Ze=E.firstChild,We=E.tagName;D=n===E.namespaceURI||D,T.push("<",We);for(var Qe=0;Qe<$e;Qe++){var Je=Ce.item(Qe);Je.prefix=="xmlns"?ve.push({prefix:Je.localName,namespace:Je.value}):Je.nodeName=="xmlns"&&ve.push({prefix:"",namespace:Je.value})}for(var Qe=0;Qe<$e;Qe++){var Je=Ce.item(Qe);if(O(Je,D,ve)){var Be=Je.prefix||"",ut=Je.namespaceURI,Lt=Be?" xmlns:"+Be:" xmlns";T.push(Lt,'="',ut,'"'),ve.push({prefix:Be,namespace:ut})}V(Je,T,D,q,ve)}if(O(E,D,ve)){var Be=E.prefix||"",ut=E.namespaceURI;if(ut){var Lt=Be?" xmlns:"+Be:" xmlns";T.push(Lt,'="',ut,'"'),ve.push({prefix:Be,namespace:ut})}}if(Ze||D&&!/^(?:meta|link|img|br|hr|input)$/i.test(We)){if(T.push(">"),D&&/^script$/i.test(We))for(;Ze;)Ze.data?T.push(Ze.data):V(Ze,T,D,q,ve),Ze=Ze.nextSibling;else for(;Ze;)V(Ze,T,D,q,ve),Ze=Ze.nextSibling;T.push("</",We,">")}else T.push("/>");return;case x:case C:for(var Ze=E.firstChild;Ze;)V(Ze,T,D,q,ve),Ze=Ze.nextSibling;return;case l:return T.push(" ",E.name,'="',E.value.replace(/[<&"]/g,K),'"');case d:return T.push(E.data.replace(/[<&]/g,K).replace(/]]>/g,"]]&gt;"));case f:return T.push("<![CDATA[",E.data,"]]>");case w:return T.push("<!--",E.data,"-->");case b:var Jt=E.publicId,It=E.systemId;if(T.push("<!DOCTYPE ",E.name),Jt)T.push(" PUBLIC ",Jt),It&&It!="."&&T.push(" ",It),T.push(">");else if(It&&It!=".")T.push(" SYSTEM ",It,">");else{var kr=E.internalSubset;kr&&T.push(" [",kr,"]"),T.push(">")}return;case k:return T.push("<?",E.target," ",E.data,"?>");case h:return T.push("&",E.nodeName,";");default:T.push("??",E.nodeName)}}function G(E,T,D){var q;switch(T.nodeType){case u:q=T.cloneNode(!1),q.ownerDocument=E;case C:break;case l:D=!0;break}if(q||(q=T.cloneNode(!1)),q.ownerDocument=E,q.parentNode=null,D)for(var ve=T.firstChild;ve;)q.appendChild(G(E,ve,D)),ve=ve.nextSibling;return q}function oe(E,T,D){var q=new T.constructor;for(var ve in T){var Ce=T[ve];typeof Ce!="object"&&Ce!=q[ve]&&(q[ve]=Ce)}switch(T.childNodes&&(q.childNodes=new re),q.ownerDocument=E,q.nodeType){case u:var $e=T.attributes,We=q.attributes=new z,Qe=$e.length;We._ownerElement=q;for(var Je=0;Je<Qe;Je++)q.setAttributeNode(oe(E,$e.item(Je),!0));break;case l:D=!0}if(D)for(var Be=T.firstChild;Be;)q.appendChild(oe(E,Be,D)),Be=Be.nextSibling;return q}function Y(E,T,D){E[T]=D}try{if(Object.defineProperty){let E=function(T){switch(T.nodeType){case u:case C:var D=[];for(T=T.firstChild;T;)T.nodeType!==7&&T.nodeType!==8&&D.push(E(T)),T=T.nextSibling;return D.join("");default:return T.nodeValue}};Object.defineProperty(J.prototype,"length",{get:function(){return $(this),this.$$length}}),Object.defineProperty(N.prototype,"textContent",{get:function(){return E(this)},set:function(T){switch(this.nodeType){case u:case C:for(;this.firstChild;)this.removeChild(this.firstChild);(T||String(T))&&this.appendChild(this.ownerDocument.createTextNode(T));break;default:this.data=T,this.value=T,this.nodeValue=T}}}),Y=function(T,D,q){T["$$"+D]=q}}}catch{}return fs.Node=N,fs.DOMException=M,fs.DOMImplementation=te,fs.XMLSerializer=H,fs}var xf;function av(){if(xf)return ds;xf=1;function r(x){this.options=x||{locator:{}}}r.prototype.parseFromString=function(x,b){var C=this.options,m=new y,S=C.domBuilder||new n,j=C.errorHandler,_=C.locator,L=C.xmlns||{},U=/\/x?html?$/.test(b),M=U?f.entityMap:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return _&&S.setDocumentLocator(_),m.errorHandler=i(j,S,_),m.domBuilder=C.domBuilder||S,U&&(L[""]="http://www.w3.org/1999/xhtml"),L.xml=L.xml||"http://www.w3.org/XML/1998/namespace",x&&typeof x=="string"?m.parse(x,L,M):m.errorHandler.error("invalid doc source"),S.doc};function i(x,b,C){if(!x){if(b instanceof n)return b;x=b}var m={},S=x instanceof Function;C=C||{};function j(_){var L=x[_];!L&&S&&(L=x.length==2?function(U){x(_,U)}:x),m[_]=L&&function(U){L("[xmldom "+_+"]	"+U+u(C))}||function(){}}return j("warning"),j("error"),j("fatalError"),m}function n(){this.cdata=!1}function o(x,b){b.lineNumber=x.lineNumber,b.columnNumber=x.columnNumber}n.prototype={startDocument:function(){this.doc=new w().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(x,b,C,m){var S=this.doc,j=S.createElementNS(x,C||b),_=m.length;d(this,j),this.currentElement=j,this.locator&&o(this.locator,j);for(var L=0;L<_;L++){var x=m.getURI(L),U=m.getValue(L),C=m.getQName(L),M=S.createAttributeNS(x,C);this.locator&&o(m.getLocator(L),M),M.value=M.nodeValue=U,j.setAttributeNode(M)}},endElement:function(x,b,C){var m=this.currentElement;m.tagName,this.currentElement=m.parentNode},startPrefixMapping:function(x,b){},endPrefixMapping:function(x){},processingInstruction:function(x,b){var C=this.doc.createProcessingInstruction(x,b);this.locator&&o(this.locator,C),d(this,C)},ignorableWhitespace:function(x,b,C){},characters:function(x,b,C){if(x=l.apply(this,arguments),x){if(this.cdata)var m=this.doc.createCDATASection(x);else var m=this.doc.createTextNode(x);this.currentElement?this.currentElement.appendChild(m):/^\s*$/.test(x)&&this.doc.appendChild(m),this.locator&&o(this.locator,m)}},skippedEntity:function(x){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(x){(this.locator=x)&&(x.lineNumber=0)},comment:function(x,b,C){x=l.apply(this,arguments);var m=this.doc.createComment(x);this.locator&&o(this.locator,m),d(this,m)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(x,b,C){var m=this.doc.implementation;if(m&&m.createDocumentType){var S=m.createDocumentType(x,b,C);this.locator&&o(this.locator,S),d(this,S)}},warning:function(x){console.warn("[xmldom warning]	"+x,u(this.locator))},error:function(x){console.error("[xmldom error]	"+x,u(this.locator))},fatalError:function(x){throw new k(x,this.locator)}};function u(x){if(x)return`
@`+(x.systemId||"")+"#[line:"+x.lineNumber+",col:"+x.columnNumber+"]"}function l(x,b,C){return typeof x=="string"?x.substr(b,C):x.length>=b+C||b?new java.lang.String(x,b,C)+"":x}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(x){n.prototype[x]=function(){return null}});function d(x,b){x.currentElement?x.currentElement.appendChild(b):x.doc.appendChild(b)}var f=iv(),h=ov(),y=h.XMLReader,k=h.ParseError,w=ds.DOMImplementation=vf().DOMImplementation;return ds.XMLSerializer=vf().XMLSerializer,ds.DOMParser=r,ds.__DOMHandler=n,ds}var lv=av();const cv={},uv={},dv={},fv={};function hv(r){const n=new lv.DOMParser().parseFromString(r,"application/xml"),o=re=>n.getElementsByTagName(re)[0]?.textContent?.trim()||void 0,u=re=>Array.from(n.getElementsByTagName(re)).map(J=>J.textContent?.trim()||"").filter(Boolean),l=re=>{const J=n.getElementsByTagName("meta"),$=[];for(let z=0;z<J.length;z++){const Q=J[z];if(Q.getAttribute("property")===re){const ae=Q.textContent?.trim();ae&&$.push(ae)}}return $},d=o("dc:title")||l("schema:title")[0],f=o("dc:creator")||l("schema:creator")[0],h=o("dc:publisher")||l("schema:publisher")[0],y=o("dc:date")||l("schema:date")[0],k=o("dc:language")||l("schema:language")[0],w=o("dc:rights")||l("schema:rights")[0],x=o("dc:description")||l("schema:description")[0],b=u("dc:subject").concat(l("schema:subject")),C=u("dc:identifier").concat(l("schema:identifier")),m=l("schema:accessMode").concat(u("dcterms:accessMode"),u("schema:accessMode")),S=l("schema:accessibilityFeature").concat(u("dcterms:accessibilityFeature"),u("schema:accessibilityFeature")),j=l("schema:accessibilityHazard").concat(u("dcterms:accessibilityHazard"),u("schema:accessibilityHazard")),_=l("schema:accessibilitySummary")[0]||o("schema:accessibilitySummary")||o("dcterms:accessibilitySummary"),L=l("schema:accessModeSufficient").concat(u("schema:accessModeSufficient"),u("dcterms:accessModeSufficient")),U=l("schema:accessibilityConformsTo").concat(u("dcterms:conformsTo"),u("schema:accessibilityConformsTo")),M=l("schema:accessibilityCertification")[0]||o("dcterms:certifiedBy")||o("schema:accessibilityCertification");return{title:d,author:f,publisher:h,publicationDate:y,language:k,rights:w,description:x,subjects:b.length?b:void 0,identifiers:C.length?C:void 0,accessModes:m.length?m:void 0,accessibilityFeatures:S.length?S:void 0,hazards:j.length?j:void 0,accessibilitySummary:_,accessModesSufficient:L.length?L:void 0,certificationConformsTo:U.length?U:void 0,certification:M}}function pv(r){const i=(r.accessibilityFeature||[]).map(d=>cv[d]||d).join(", "),n=(r.accessibilityHazard||[]).map(d=>uv[d]||d).join(", "),o=(r.accessMode||[]).map(d=>dv[d]||d).join(", "),u=(r.accessibilityConformsTo||[]).map(d=>fv[d]||d).join(", ");let l="";return i&&(l+=`Features: ${i}. `),n&&(l+=`Hazards: ${n}. `),o&&(l+=`Access Modes: ${o}. `),u&&(l+=`Conforms to: ${u}. `),r.accessibilitySummary&&(l+=`Summary: ${r.accessibilitySummary}`),l.trim()}function mv(r){const i=hv(r),n=pv(i);return{...i,accessibilityFeedback:n,opfRaw:r}}function xo(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Al={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var wf;function gv(){return wf||(wf=1,(function(r,i){(function(n){r.exports=n()})(function(){return(function n(o,u,l){function d(y,k){if(!u[y]){if(!o[y]){var w=typeof xo=="function"&&xo;if(!k&&w)return w(y,!0);if(f)return f(y,!0);var x=new Error("Cannot find module '"+y+"'");throw x.code="MODULE_NOT_FOUND",x}var b=u[y]={exports:{}};o[y][0].call(b.exports,function(C){var m=o[y][1][C];return d(m||C)},b,b.exports,n,o,u,l)}return u[y].exports}for(var f=typeof xo=="function"&&xo,h=0;h<l.length;h++)d(l[h]);return d})({1:[function(n,o,u){var l=n("./utils"),d=n("./support"),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";u.encode=function(h){for(var y,k,w,x,b,C,m,S=[],j=0,_=h.length,L=_,U=l.getTypeOf(h)!=="string";j<h.length;)L=_-j,w=U?(y=h[j++],k=j<_?h[j++]:0,j<_?h[j++]:0):(y=h.charCodeAt(j++),k=j<_?h.charCodeAt(j++):0,j<_?h.charCodeAt(j++):0),x=y>>2,b=(3&y)<<4|k>>4,C=1<L?(15&k)<<2|w>>6:64,m=2<L?63&w:64,S.push(f.charAt(x)+f.charAt(b)+f.charAt(C)+f.charAt(m));return S.join("")},u.decode=function(h){var y,k,w,x,b,C,m=0,S=0,j="data:";if(h.substr(0,j.length)===j)throw new Error("Invalid base64 input, it looks like a data url.");var _,L=3*(h=h.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(h.charAt(h.length-1)===f.charAt(64)&&L--,h.charAt(h.length-2)===f.charAt(64)&&L--,L%1!=0)throw new Error("Invalid base64 input, bad content length.");for(_=d.uint8array?new Uint8Array(0|L):new Array(0|L);m<h.length;)y=f.indexOf(h.charAt(m++))<<2|(x=f.indexOf(h.charAt(m++)))>>4,k=(15&x)<<4|(b=f.indexOf(h.charAt(m++)))>>2,w=(3&b)<<6|(C=f.indexOf(h.charAt(m++))),_[S++]=y,b!==64&&(_[S++]=k),C!==64&&(_[S++]=w);return _}},{"./support":30,"./utils":32}],2:[function(n,o,u){var l=n("./external"),d=n("./stream/DataWorker"),f=n("./stream/Crc32Probe"),h=n("./stream/DataLengthProbe");function y(k,w,x,b,C){this.compressedSize=k,this.uncompressedSize=w,this.crc32=x,this.compression=b,this.compressedContent=C}y.prototype={getContentWorker:function(){var k=new d(l.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new h("data_length")),w=this;return k.on("end",function(){if(this.streamInfo.data_length!==w.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),k},getCompressedWorker:function(){return new d(l.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},y.createWorkerFrom=function(k,w,x){return k.pipe(new f).pipe(new h("uncompressedSize")).pipe(w.compressWorker(x)).pipe(new h("compressedSize")).withStreamInfo("compression",w)},o.exports=y},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,o,u){var l=n("./stream/GenericWorker");u.STORE={magic:"\0\0",compressWorker:function(){return new l("STORE compression")},uncompressWorker:function(){return new l("STORE decompression")}},u.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,o,u){var l=n("./utils"),d=(function(){for(var f,h=[],y=0;y<256;y++){f=y;for(var k=0;k<8;k++)f=1&f?3988292384^f>>>1:f>>>1;h[y]=f}return h})();o.exports=function(f,h){return f!==void 0&&f.length?l.getTypeOf(f)!=="string"?(function(y,k,w,x){var b=d,C=x+w;y^=-1;for(var m=x;m<C;m++)y=y>>>8^b[255&(y^k[m])];return-1^y})(0|h,f,f.length,0):(function(y,k,w,x){var b=d,C=x+w;y^=-1;for(var m=x;m<C;m++)y=y>>>8^b[255&(y^k.charCodeAt(m))];return-1^y})(0|h,f,f.length,0):0}},{"./utils":32}],5:[function(n,o,u){u.base64=!1,u.binary=!1,u.dir=!1,u.createFolders=!0,u.date=null,u.compression=null,u.compressionOptions=null,u.comment=null,u.unixPermissions=null,u.dosPermissions=null},{}],6:[function(n,o,u){var l=null;l=typeof Promise<"u"?Promise:n("lie"),o.exports={Promise:l}},{lie:37}],7:[function(n,o,u){var l=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",d=n("pako"),f=n("./utils"),h=n("./stream/GenericWorker"),y=l?"uint8array":"array";function k(w,x){h.call(this,"FlateWorker/"+w),this._pako=null,this._pakoAction=w,this._pakoOptions=x,this.meta={}}u.magic="\b\0",f.inherits(k,h),k.prototype.processChunk=function(w){this.meta=w.meta,this._pako===null&&this._createPako(),this._pako.push(f.transformTo(y,w.data),!1)},k.prototype.flush=function(){h.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},k.prototype.cleanUp=function(){h.prototype.cleanUp.call(this),this._pako=null},k.prototype._createPako=function(){this._pako=new d[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var w=this;this._pako.onData=function(x){w.push({data:x,meta:w.meta})}},u.compressWorker=function(w){return new k("Deflate",w)},u.uncompressWorker=function(){return new k("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,o,u){function l(b,C){var m,S="";for(m=0;m<C;m++)S+=String.fromCharCode(255&b),b>>>=8;return S}function d(b,C,m,S,j,_){var L,U,M=b.file,re=b.compression,J=_!==y.utf8encode,$=f.transformTo("string",_(M.name)),z=f.transformTo("string",y.utf8encode(M.name)),Q=M.comment,ae=f.transformTo("string",_(Q)),F=f.transformTo("string",y.utf8encode(Q)),te=z.length!==M.name.length,N=F.length!==Q.length,K="",ge="",ne="",le=M.dir,ie=M.date,ue={crc32:0,compressedSize:0,uncompressedSize:0};C&&!m||(ue.crc32=b.crc32,ue.compressedSize=b.compressedSize,ue.uncompressedSize=b.uncompressedSize);var A=0;C&&(A|=8),J||!te&&!N||(A|=2048);var B=0,me=0;le&&(B|=16),j==="UNIX"?(me=798,B|=(function(se,we){var Ee=se;return se||(Ee=we?16893:33204),(65535&Ee)<<16})(M.unixPermissions,le)):(me=20,B|=(function(se){return 63&(se||0)})(M.dosPermissions)),L=ie.getUTCHours(),L<<=6,L|=ie.getUTCMinutes(),L<<=5,L|=ie.getUTCSeconds()/2,U=ie.getUTCFullYear()-1980,U<<=4,U|=ie.getUTCMonth()+1,U<<=5,U|=ie.getUTCDate(),te&&(ge=l(1,1)+l(k($),4)+z,K+="up"+l(ge.length,2)+ge),N&&(ne=l(1,1)+l(k(ae),4)+F,K+="uc"+l(ne.length,2)+ne);var he="";return he+=`
\0`,he+=l(A,2),he+=re.magic,he+=l(L,2),he+=l(U,2),he+=l(ue.crc32,4),he+=l(ue.compressedSize,4),he+=l(ue.uncompressedSize,4),he+=l($.length,2),he+=l(K.length,2),{fileRecord:w.LOCAL_FILE_HEADER+he+$+K,dirRecord:w.CENTRAL_FILE_HEADER+l(me,2)+he+l(ae.length,2)+"\0\0\0\0"+l(B,4)+l(S,4)+$+K+ae}}var f=n("../utils"),h=n("../stream/GenericWorker"),y=n("../utf8"),k=n("../crc32"),w=n("../signature");function x(b,C,m,S){h.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=C,this.zipPlatform=m,this.encodeFileName=S,this.streamFiles=b,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}f.inherits(x,h),x.prototype.push=function(b){var C=b.meta.percent||0,m=this.entriesCount,S=this._sources.length;this.accumulate?this.contentBuffer.push(b):(this.bytesWritten+=b.data.length,h.prototype.push.call(this,{data:b.data,meta:{currentFile:this.currentFile,percent:m?(C+100*(m-S-1))/m:100}}))},x.prototype.openedSource=function(b){this.currentSourceOffset=this.bytesWritten,this.currentFile=b.file.name;var C=this.streamFiles&&!b.file.dir;if(C){var m=d(b,C,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},x.prototype.closedSource=function(b){this.accumulate=!1;var C=this.streamFiles&&!b.file.dir,m=d(b,C,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),C)this.push({data:(function(S){return w.DATA_DESCRIPTOR+l(S.crc32,4)+l(S.compressedSize,4)+l(S.uncompressedSize,4)})(b),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},x.prototype.flush=function(){for(var b=this.bytesWritten,C=0;C<this.dirRecords.length;C++)this.push({data:this.dirRecords[C],meta:{percent:100}});var m=this.bytesWritten-b,S=(function(j,_,L,U,M){var re=f.transformTo("string",M(U));return w.CENTRAL_DIRECTORY_END+"\0\0\0\0"+l(j,2)+l(j,2)+l(_,4)+l(L,4)+l(re.length,2)+re})(this.dirRecords.length,m,b,this.zipComment,this.encodeFileName);this.push({data:S,meta:{percent:100}})},x.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},x.prototype.registerPrevious=function(b){this._sources.push(b);var C=this;return b.on("data",function(m){C.processChunk(m)}),b.on("end",function(){C.closedSource(C.previous.streamInfo),C._sources.length?C.prepareNextSource():C.end()}),b.on("error",function(m){C.error(m)}),this},x.prototype.resume=function(){return!!h.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},x.prototype.error=function(b){var C=this._sources;if(!h.prototype.error.call(this,b))return!1;for(var m=0;m<C.length;m++)try{C[m].error(b)}catch{}return!0},x.prototype.lock=function(){h.prototype.lock.call(this);for(var b=this._sources,C=0;C<b.length;C++)b[C].lock()},o.exports=x},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,o,u){var l=n("../compressions"),d=n("./ZipFileWorker");u.generateWorker=function(f,h,y){var k=new d(h.streamFiles,y,h.platform,h.encodeFileName),w=0;try{f.forEach(function(x,b){w++;var C=(function(_,L){var U=_||L,M=l[U];if(!M)throw new Error(U+" is not a valid compression method !");return M})(b.options.compression,h.compression),m=b.options.compressionOptions||h.compressionOptions||{},S=b.dir,j=b.date;b._compressWorker(C,m).withStreamInfo("file",{name:x,dir:S,date:j,comment:b.comment||"",unixPermissions:b.unixPermissions,dosPermissions:b.dosPermissions}).pipe(k)}),k.entriesCount=w}catch(x){k.error(x)}return k}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,o,u){function l(){if(!(this instanceof l))return new l;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var d=new l;for(var f in this)typeof this[f]!="function"&&(d[f]=this[f]);return d}}(l.prototype=n("./object")).loadAsync=n("./load"),l.support=n("./support"),l.defaults=n("./defaults"),l.version="3.10.1",l.loadAsync=function(d,f){return new l().loadAsync(d,f)},l.external=n("./external"),o.exports=l},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,o,u){var l=n("./utils"),d=n("./external"),f=n("./utf8"),h=n("./zipEntries"),y=n("./stream/Crc32Probe"),k=n("./nodejsUtils");function w(x){return new d.Promise(function(b,C){var m=x.decompressed.getContentWorker().pipe(new y);m.on("error",function(S){C(S)}).on("end",function(){m.streamInfo.crc32!==x.decompressed.crc32?C(new Error("Corrupted zip : CRC32 mismatch")):b()}).resume()})}o.exports=function(x,b){var C=this;return b=l.extend(b||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:f.utf8decode}),k.isNode&&k.isStream(x)?d.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):l.prepareContent("the loaded zip file",x,!0,b.optimizedBinaryString,b.base64).then(function(m){var S=new h(b);return S.load(m),S}).then(function(m){var S=[d.Promise.resolve(m)],j=m.files;if(b.checkCRC32)for(var _=0;_<j.length;_++)S.push(w(j[_]));return d.Promise.all(S)}).then(function(m){for(var S=m.shift(),j=S.files,_=0;_<j.length;_++){var L=j[_],U=L.fileNameStr,M=l.resolve(L.fileNameStr);C.file(M,L.decompressed,{binary:!0,optimizedBinaryString:!0,date:L.date,dir:L.dir,comment:L.fileCommentStr.length?L.fileCommentStr:null,unixPermissions:L.unixPermissions,dosPermissions:L.dosPermissions,createFolders:b.createFolders}),L.dir||(C.file(M).unsafeOriginalName=U)}return S.zipComment.length&&(C.comment=S.zipComment),C})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,o,u){var l=n("../utils"),d=n("../stream/GenericWorker");function f(h,y){d.call(this,"Nodejs stream input adapter for "+h),this._upstreamEnded=!1,this._bindStream(y)}l.inherits(f,d),f.prototype._bindStream=function(h){var y=this;(this._stream=h).pause(),h.on("data",function(k){y.push({data:k,meta:{percent:0}})}).on("error",function(k){y.isPaused?this.generatedError=k:y.error(k)}).on("end",function(){y.isPaused?y._upstreamEnded=!0:y.end()})},f.prototype.pause=function(){return!!d.prototype.pause.call(this)&&(this._stream.pause(),!0)},f.prototype.resume=function(){return!!d.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},o.exports=f},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,o,u){var l=n("readable-stream").Readable;function d(f,h,y){l.call(this,h),this._helper=f;var k=this;f.on("data",function(w,x){k.push(w)||k._helper.pause(),y&&y(x)}).on("error",function(w){k.emit("error",w)}).on("end",function(){k.push(null)})}n("../utils").inherits(d,l),d.prototype._read=function(){this._helper.resume()},o.exports=d},{"../utils":32,"readable-stream":16}],14:[function(n,o,u){o.exports={isNode:typeof Buffer<"u",newBufferFrom:function(l,d){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(l,d);if(typeof l=="number")throw new Error('The "data" argument must not be a number');return new Buffer(l,d)},allocBuffer:function(l){if(Buffer.alloc)return Buffer.alloc(l);var d=new Buffer(l);return d.fill(0),d},isBuffer:function(l){return Buffer.isBuffer(l)},isStream:function(l){return l&&typeof l.on=="function"&&typeof l.pause=="function"&&typeof l.resume=="function"}}},{}],15:[function(n,o,u){function l(M,re,J){var $,z=f.getTypeOf(re),Q=f.extend(J||{},k);Q.date=Q.date||new Date,Q.compression!==null&&(Q.compression=Q.compression.toUpperCase()),typeof Q.unixPermissions=="string"&&(Q.unixPermissions=parseInt(Q.unixPermissions,8)),Q.unixPermissions&&16384&Q.unixPermissions&&(Q.dir=!0),Q.dosPermissions&&16&Q.dosPermissions&&(Q.dir=!0),Q.dir&&(M=j(M)),Q.createFolders&&($=S(M))&&_.call(this,$,!0);var ae=z==="string"&&Q.binary===!1&&Q.base64===!1;J&&J.binary!==void 0||(Q.binary=!ae),(re instanceof w&&re.uncompressedSize===0||Q.dir||!re||re.length===0)&&(Q.base64=!1,Q.binary=!0,re="",Q.compression="STORE",z="string");var F=null;F=re instanceof w||re instanceof h?re:C.isNode&&C.isStream(re)?new m(M,re):f.prepareContent(M,re,Q.binary,Q.optimizedBinaryString,Q.base64);var te=new x(M,F,Q);this.files[M]=te}var d=n("./utf8"),f=n("./utils"),h=n("./stream/GenericWorker"),y=n("./stream/StreamHelper"),k=n("./defaults"),w=n("./compressedObject"),x=n("./zipObject"),b=n("./generate"),C=n("./nodejsUtils"),m=n("./nodejs/NodejsStreamInputAdapter"),S=function(M){M.slice(-1)==="/"&&(M=M.substring(0,M.length-1));var re=M.lastIndexOf("/");return 0<re?M.substring(0,re):""},j=function(M){return M.slice(-1)!=="/"&&(M+="/"),M},_=function(M,re){return re=re!==void 0?re:k.createFolders,M=j(M),this.files[M]||l.call(this,M,null,{dir:!0,createFolders:re}),this.files[M]};function L(M){return Object.prototype.toString.call(M)==="[object RegExp]"}var U={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(M){var re,J,$;for(re in this.files)$=this.files[re],(J=re.slice(this.root.length,re.length))&&re.slice(0,this.root.length)===this.root&&M(J,$)},filter:function(M){var re=[];return this.forEach(function(J,$){M(J,$)&&re.push($)}),re},file:function(M,re,J){if(arguments.length!==1)return M=this.root+M,l.call(this,M,re,J),this;if(L(M)){var $=M;return this.filter(function(Q,ae){return!ae.dir&&$.test(Q)})}var z=this.files[this.root+M];return z&&!z.dir?z:null},folder:function(M){if(!M)return this;if(L(M))return this.filter(function(z,Q){return Q.dir&&M.test(z)});var re=this.root+M,J=_.call(this,re),$=this.clone();return $.root=J.name,$},remove:function(M){M=this.root+M;var re=this.files[M];if(re||(M.slice(-1)!=="/"&&(M+="/"),re=this.files[M]),re&&!re.dir)delete this.files[M];else for(var J=this.filter(function(z,Q){return Q.name.slice(0,M.length)===M}),$=0;$<J.length;$++)delete this.files[J[$].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(M){var re,J={};try{if((J=f.extend(M||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:d.utf8encode})).type=J.type.toLowerCase(),J.compression=J.compression.toUpperCase(),J.type==="binarystring"&&(J.type="string"),!J.type)throw new Error("No output type specified.");f.checkSupport(J.type),J.platform!=="darwin"&&J.platform!=="freebsd"&&J.platform!=="linux"&&J.platform!=="sunos"||(J.platform="UNIX"),J.platform==="win32"&&(J.platform="DOS");var $=J.comment||this.comment||"";re=b.generateWorker(this,J,$)}catch(z){(re=new h("error")).error(z)}return new y(re,J.type||"string",J.mimeType)},generateAsync:function(M,re){return this.generateInternalStream(M).accumulate(re)},generateNodeStream:function(M,re){return(M=M||{}).type||(M.type="nodebuffer"),this.generateInternalStream(M).toNodejsStream(re)}};o.exports=U},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,o,u){o.exports=n("stream")},{stream:void 0}],17:[function(n,o,u){var l=n("./DataReader");function d(f){l.call(this,f);for(var h=0;h<this.data.length;h++)f[h]=255&f[h]}n("../utils").inherits(d,l),d.prototype.byteAt=function(f){return this.data[this.zero+f]},d.prototype.lastIndexOfSignature=function(f){for(var h=f.charCodeAt(0),y=f.charCodeAt(1),k=f.charCodeAt(2),w=f.charCodeAt(3),x=this.length-4;0<=x;--x)if(this.data[x]===h&&this.data[x+1]===y&&this.data[x+2]===k&&this.data[x+3]===w)return x-this.zero;return-1},d.prototype.readAndCheckSignature=function(f){var h=f.charCodeAt(0),y=f.charCodeAt(1),k=f.charCodeAt(2),w=f.charCodeAt(3),x=this.readData(4);return h===x[0]&&y===x[1]&&k===x[2]&&w===x[3]},d.prototype.readData=function(f){if(this.checkOffset(f),f===0)return[];var h=this.data.slice(this.zero+this.index,this.zero+this.index+f);return this.index+=f,h},o.exports=d},{"../utils":32,"./DataReader":18}],18:[function(n,o,u){var l=n("../utils");function d(f){this.data=f,this.length=f.length,this.index=0,this.zero=0}d.prototype={checkOffset:function(f){this.checkIndex(this.index+f)},checkIndex:function(f){if(this.length<this.zero+f||f<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+f+"). Corrupted zip ?")},setIndex:function(f){this.checkIndex(f),this.index=f},skip:function(f){this.setIndex(this.index+f)},byteAt:function(){},readInt:function(f){var h,y=0;for(this.checkOffset(f),h=this.index+f-1;h>=this.index;h--)y=(y<<8)+this.byteAt(h);return this.index+=f,y},readString:function(f){return l.transformTo("string",this.readData(f))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var f=this.readInt(4);return new Date(Date.UTC(1980+(f>>25&127),(f>>21&15)-1,f>>16&31,f>>11&31,f>>5&63,(31&f)<<1))}},o.exports=d},{"../utils":32}],19:[function(n,o,u){var l=n("./Uint8ArrayReader");function d(f){l.call(this,f)}n("../utils").inherits(d,l),d.prototype.readData=function(f){this.checkOffset(f);var h=this.data.slice(this.zero+this.index,this.zero+this.index+f);return this.index+=f,h},o.exports=d},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,o,u){var l=n("./DataReader");function d(f){l.call(this,f)}n("../utils").inherits(d,l),d.prototype.byteAt=function(f){return this.data.charCodeAt(this.zero+f)},d.prototype.lastIndexOfSignature=function(f){return this.data.lastIndexOf(f)-this.zero},d.prototype.readAndCheckSignature=function(f){return f===this.readData(4)},d.prototype.readData=function(f){this.checkOffset(f);var h=this.data.slice(this.zero+this.index,this.zero+this.index+f);return this.index+=f,h},o.exports=d},{"../utils":32,"./DataReader":18}],21:[function(n,o,u){var l=n("./ArrayReader");function d(f){l.call(this,f)}n("../utils").inherits(d,l),d.prototype.readData=function(f){if(this.checkOffset(f),f===0)return new Uint8Array(0);var h=this.data.subarray(this.zero+this.index,this.zero+this.index+f);return this.index+=f,h},o.exports=d},{"../utils":32,"./ArrayReader":17}],22:[function(n,o,u){var l=n("../utils"),d=n("../support"),f=n("./ArrayReader"),h=n("./StringReader"),y=n("./NodeBufferReader"),k=n("./Uint8ArrayReader");o.exports=function(w){var x=l.getTypeOf(w);return l.checkSupport(x),x!=="string"||d.uint8array?x==="nodebuffer"?new y(w):d.uint8array?new k(l.transformTo("uint8array",w)):new f(l.transformTo("array",w)):new h(w)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,o,u){u.LOCAL_FILE_HEADER="PK",u.CENTRAL_FILE_HEADER="PK",u.CENTRAL_DIRECTORY_END="PK",u.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",u.ZIP64_CENTRAL_DIRECTORY_END="PK",u.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,o,u){var l=n("./GenericWorker"),d=n("../utils");function f(h){l.call(this,"ConvertWorker to "+h),this.destType=h}d.inherits(f,l),f.prototype.processChunk=function(h){this.push({data:d.transformTo(this.destType,h.data),meta:h.meta})},o.exports=f},{"../utils":32,"./GenericWorker":28}],25:[function(n,o,u){var l=n("./GenericWorker"),d=n("../crc32");function f(){l.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(f,l),f.prototype.processChunk=function(h){this.streamInfo.crc32=d(h.data,this.streamInfo.crc32||0),this.push(h)},o.exports=f},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,o,u){var l=n("../utils"),d=n("./GenericWorker");function f(h){d.call(this,"DataLengthProbe for "+h),this.propName=h,this.withStreamInfo(h,0)}l.inherits(f,d),f.prototype.processChunk=function(h){if(h){var y=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=y+h.data.length}d.prototype.processChunk.call(this,h)},o.exports=f},{"../utils":32,"./GenericWorker":28}],27:[function(n,o,u){var l=n("../utils"),d=n("./GenericWorker");function f(h){d.call(this,"DataWorker");var y=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,h.then(function(k){y.dataIsReady=!0,y.data=k,y.max=k&&k.length||0,y.type=l.getTypeOf(k),y.isPaused||y._tickAndRepeat()},function(k){y.error(k)})}l.inherits(f,d),f.prototype.cleanUp=function(){d.prototype.cleanUp.call(this),this.data=null},f.prototype.resume=function(){return!!d.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,l.delay(this._tickAndRepeat,[],this)),!0)},f.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(l.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},f.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var h=null,y=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":h=this.data.substring(this.index,y);break;case"uint8array":h=this.data.subarray(this.index,y);break;case"array":case"nodebuffer":h=this.data.slice(this.index,y)}return this.index=y,this.push({data:h,meta:{percent:this.max?this.index/this.max*100:0}})},o.exports=f},{"../utils":32,"./GenericWorker":28}],28:[function(n,o,u){function l(d){this.name=d||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}l.prototype={push:function(d){this.emit("data",d)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(d){this.emit("error",d)}return!0},error:function(d){return!this.isFinished&&(this.isPaused?this.generatedError=d:(this.isFinished=!0,this.emit("error",d),this.previous&&this.previous.error(d),this.cleanUp()),!0)},on:function(d,f){return this._listeners[d].push(f),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(d,f){if(this._listeners[d])for(var h=0;h<this._listeners[d].length;h++)this._listeners[d][h].call(this,f)},pipe:function(d){return d.registerPrevious(this)},registerPrevious:function(d){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=d.streamInfo,this.mergeStreamInfo(),this.previous=d;var f=this;return d.on("data",function(h){f.processChunk(h)}),d.on("end",function(){f.end()}),d.on("error",function(h){f.error(h)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var d=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),d=!0),this.previous&&this.previous.resume(),!d},flush:function(){},processChunk:function(d){this.push(d)},withStreamInfo:function(d,f){return this.extraStreamInfo[d]=f,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var d in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,d)&&(this.streamInfo[d]=this.extraStreamInfo[d])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var d="Worker "+this.name;return this.previous?this.previous+" -> "+d:d}},o.exports=l},{}],29:[function(n,o,u){var l=n("../utils"),d=n("./ConvertWorker"),f=n("./GenericWorker"),h=n("../base64"),y=n("../support"),k=n("../external"),w=null;if(y.nodestream)try{w=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function x(C,m){return new k.Promise(function(S,j){var _=[],L=C._internalType,U=C._outputType,M=C._mimeType;C.on("data",function(re,J){_.push(re),m&&m(J)}).on("error",function(re){_=[],j(re)}).on("end",function(){try{var re=(function(J,$,z){switch(J){case"blob":return l.newBlob(l.transformTo("arraybuffer",$),z);case"base64":return h.encode($);default:return l.transformTo(J,$)}})(U,(function(J,$){var z,Q=0,ae=null,F=0;for(z=0;z<$.length;z++)F+=$[z].length;switch(J){case"string":return $.join("");case"array":return Array.prototype.concat.apply([],$);case"uint8array":for(ae=new Uint8Array(F),z=0;z<$.length;z++)ae.set($[z],Q),Q+=$[z].length;return ae;case"nodebuffer":return Buffer.concat($);default:throw new Error("concat : unsupported type '"+J+"'")}})(L,_),M);S(re)}catch(J){j(J)}_=[]}).resume()})}function b(C,m,S){var j=m;switch(m){case"blob":case"arraybuffer":j="uint8array";break;case"base64":j="string"}try{this._internalType=j,this._outputType=m,this._mimeType=S,l.checkSupport(j),this._worker=C.pipe(new d(j)),C.lock()}catch(_){this._worker=new f("error"),this._worker.error(_)}}b.prototype={accumulate:function(C){return x(this,C)},on:function(C,m){var S=this;return C==="data"?this._worker.on(C,function(j){m.call(S,j.data,j.meta)}):this._worker.on(C,function(){l.delay(m,arguments,S)}),this},resume:function(){return l.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(C){if(l.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new w(this,{objectMode:this._outputType!=="nodebuffer"},C)}},o.exports=b},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,o,u){if(u.base64=!0,u.array=!0,u.string=!0,u.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",u.nodebuffer=typeof Buffer<"u",u.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")u.blob=!1;else{var l=new ArrayBuffer(0);try{u.blob=new Blob([l],{type:"application/zip"}).size===0}catch{try{var d=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);d.append(l),u.blob=d.getBlob("application/zip").size===0}catch{u.blob=!1}}}try{u.nodestream=!!n("readable-stream").Readable}catch{u.nodestream=!1}},{"readable-stream":16}],31:[function(n,o,u){for(var l=n("./utils"),d=n("./support"),f=n("./nodejsUtils"),h=n("./stream/GenericWorker"),y=new Array(256),k=0;k<256;k++)y[k]=252<=k?6:248<=k?5:240<=k?4:224<=k?3:192<=k?2:1;y[254]=y[254]=1;function w(){h.call(this,"utf-8 decode"),this.leftOver=null}function x(){h.call(this,"utf-8 encode")}u.utf8encode=function(b){return d.nodebuffer?f.newBufferFrom(b,"utf-8"):(function(C){var m,S,j,_,L,U=C.length,M=0;for(_=0;_<U;_++)(64512&(S=C.charCodeAt(_)))==55296&&_+1<U&&(64512&(j=C.charCodeAt(_+1)))==56320&&(S=65536+(S-55296<<10)+(j-56320),_++),M+=S<128?1:S<2048?2:S<65536?3:4;for(m=d.uint8array?new Uint8Array(M):new Array(M),_=L=0;L<M;_++)(64512&(S=C.charCodeAt(_)))==55296&&_+1<U&&(64512&(j=C.charCodeAt(_+1)))==56320&&(S=65536+(S-55296<<10)+(j-56320),_++),S<128?m[L++]=S:(S<2048?m[L++]=192|S>>>6:(S<65536?m[L++]=224|S>>>12:(m[L++]=240|S>>>18,m[L++]=128|S>>>12&63),m[L++]=128|S>>>6&63),m[L++]=128|63&S);return m})(b)},u.utf8decode=function(b){return d.nodebuffer?l.transformTo("nodebuffer",b).toString("utf-8"):(function(C){var m,S,j,_,L=C.length,U=new Array(2*L);for(m=S=0;m<L;)if((j=C[m++])<128)U[S++]=j;else if(4<(_=y[j]))U[S++]=65533,m+=_-1;else{for(j&=_===2?31:_===3?15:7;1<_&&m<L;)j=j<<6|63&C[m++],_--;1<_?U[S++]=65533:j<65536?U[S++]=j:(j-=65536,U[S++]=55296|j>>10&1023,U[S++]=56320|1023&j)}return U.length!==S&&(U.subarray?U=U.subarray(0,S):U.length=S),l.applyFromCharCode(U)})(b=l.transformTo(d.uint8array?"uint8array":"array",b))},l.inherits(w,h),w.prototype.processChunk=function(b){var C=l.transformTo(d.uint8array?"uint8array":"array",b.data);if(this.leftOver&&this.leftOver.length){if(d.uint8array){var m=C;(C=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),C.set(m,this.leftOver.length)}else C=this.leftOver.concat(C);this.leftOver=null}var S=(function(_,L){var U;for((L=L||_.length)>_.length&&(L=_.length),U=L-1;0<=U&&(192&_[U])==128;)U--;return U<0||U===0?L:U+y[_[U]]>L?U:L})(C),j=C;S!==C.length&&(d.uint8array?(j=C.subarray(0,S),this.leftOver=C.subarray(S,C.length)):(j=C.slice(0,S),this.leftOver=C.slice(S,C.length))),this.push({data:u.utf8decode(j),meta:b.meta})},w.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:u.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},u.Utf8DecodeWorker=w,l.inherits(x,h),x.prototype.processChunk=function(b){this.push({data:u.utf8encode(b.data),meta:b.meta})},u.Utf8EncodeWorker=x},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,o,u){var l=n("./support"),d=n("./base64"),f=n("./nodejsUtils"),h=n("./external");function y(m){return m}function k(m,S){for(var j=0;j<m.length;++j)S[j]=255&m.charCodeAt(j);return S}n("setimmediate"),u.newBlob=function(m,S){u.checkSupport("blob");try{return new Blob([m],{type:S})}catch{try{var j=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return j.append(m),j.getBlob(S)}catch{throw new Error("Bug : can't construct the Blob.")}}};var w={stringifyByChunk:function(m,S,j){var _=[],L=0,U=m.length;if(U<=j)return String.fromCharCode.apply(null,m);for(;L<U;)S==="array"||S==="nodebuffer"?_.push(String.fromCharCode.apply(null,m.slice(L,Math.min(L+j,U)))):_.push(String.fromCharCode.apply(null,m.subarray(L,Math.min(L+j,U)))),L+=j;return _.join("")},stringifyByChar:function(m){for(var S="",j=0;j<m.length;j++)S+=String.fromCharCode(m[j]);return S},applyCanBeUsed:{uint8array:(function(){try{return l.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return l.nodebuffer&&String.fromCharCode.apply(null,f.allocBuffer(1)).length===1}catch{return!1}})()}};function x(m){var S=65536,j=u.getTypeOf(m),_=!0;if(j==="uint8array"?_=w.applyCanBeUsed.uint8array:j==="nodebuffer"&&(_=w.applyCanBeUsed.nodebuffer),_)for(;1<S;)try{return w.stringifyByChunk(m,j,S)}catch{S=Math.floor(S/2)}return w.stringifyByChar(m)}function b(m,S){for(var j=0;j<m.length;j++)S[j]=m[j];return S}u.applyFromCharCode=x;var C={};C.string={string:y,array:function(m){return k(m,new Array(m.length))},arraybuffer:function(m){return C.string.uint8array(m).buffer},uint8array:function(m){return k(m,new Uint8Array(m.length))},nodebuffer:function(m){return k(m,f.allocBuffer(m.length))}},C.array={string:x,array:y,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return f.newBufferFrom(m)}},C.arraybuffer={string:function(m){return x(new Uint8Array(m))},array:function(m){return b(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:y,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return f.newBufferFrom(new Uint8Array(m))}},C.uint8array={string:x,array:function(m){return b(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:y,nodebuffer:function(m){return f.newBufferFrom(m)}},C.nodebuffer={string:x,array:function(m){return b(m,new Array(m.length))},arraybuffer:function(m){return C.nodebuffer.uint8array(m).buffer},uint8array:function(m){return b(m,new Uint8Array(m.length))},nodebuffer:y},u.transformTo=function(m,S){if(S=S||"",!m)return S;u.checkSupport(m);var j=u.getTypeOf(S);return C[j][m](S)},u.resolve=function(m){for(var S=m.split("/"),j=[],_=0;_<S.length;_++){var L=S[_];L==="."||L===""&&_!==0&&_!==S.length-1||(L===".."?j.pop():j.push(L))}return j.join("/")},u.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":l.nodebuffer&&f.isBuffer(m)?"nodebuffer":l.uint8array&&m instanceof Uint8Array?"uint8array":l.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},u.checkSupport=function(m){if(!l[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},u.MAX_VALUE_16BITS=65535,u.MAX_VALUE_32BITS=-1,u.pretty=function(m){var S,j,_="";for(j=0;j<(m||"").length;j++)_+="\\x"+((S=m.charCodeAt(j))<16?"0":"")+S.toString(16).toUpperCase();return _},u.delay=function(m,S,j){setImmediate(function(){m.apply(j||null,S||[])})},u.inherits=function(m,S){function j(){}j.prototype=S.prototype,m.prototype=new j},u.extend=function(){var m,S,j={};for(m=0;m<arguments.length;m++)for(S in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],S)&&j[S]===void 0&&(j[S]=arguments[m][S]);return j},u.prepareContent=function(m,S,j,_,L){return h.Promise.resolve(S).then(function(U){return l.blob&&(U instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(U))!==-1)&&typeof FileReader<"u"?new h.Promise(function(M,re){var J=new FileReader;J.onload=function($){M($.target.result)},J.onerror=function($){re($.target.error)},J.readAsArrayBuffer(U)}):U}).then(function(U){var M=u.getTypeOf(U);return M?(M==="arraybuffer"?U=u.transformTo("uint8array",U):M==="string"&&(L?U=d.decode(U):j&&_!==!0&&(U=(function(re){return k(re,l.uint8array?new Uint8Array(re.length):new Array(re.length))})(U))),U):h.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,o,u){var l=n("./reader/readerFor"),d=n("./utils"),f=n("./signature"),h=n("./zipEntry"),y=n("./support");function k(w){this.files=[],this.loadOptions=w}k.prototype={checkSignature:function(w){if(!this.reader.readAndCheckSignature(w)){this.reader.index-=4;var x=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+d.pretty(x)+", expected "+d.pretty(w)+")")}},isSignature:function(w,x){var b=this.reader.index;this.reader.setIndex(w);var C=this.reader.readString(4)===x;return this.reader.setIndex(b),C},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var w=this.reader.readData(this.zipCommentLength),x=y.uint8array?"uint8array":"array",b=d.transformTo(x,w);this.zipComment=this.loadOptions.decodeFileName(b)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var w,x,b,C=this.zip64EndOfCentralSize-44;0<C;)w=this.reader.readInt(2),x=this.reader.readInt(4),b=this.reader.readData(x),this.zip64ExtensibleData[w]={id:w,length:x,value:b}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var w,x;for(w=0;w<this.files.length;w++)x=this.files[w],this.reader.setIndex(x.localHeaderOffset),this.checkSignature(f.LOCAL_FILE_HEADER),x.readLocalPart(this.reader),x.handleUTF8(),x.processAttributes()},readCentralDir:function(){var w;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(f.CENTRAL_FILE_HEADER);)(w=new h({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(w);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var w=this.reader.lastIndexOfSignature(f.CENTRAL_DIRECTORY_END);if(w<0)throw this.isSignature(0,f.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(w);var x=w;if(this.checkSignature(f.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===d.MAX_VALUE_16BITS||this.diskWithCentralDirStart===d.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===d.MAX_VALUE_16BITS||this.centralDirRecords===d.MAX_VALUE_16BITS||this.centralDirSize===d.MAX_VALUE_32BITS||this.centralDirOffset===d.MAX_VALUE_32BITS){if(this.zip64=!0,(w=this.reader.lastIndexOfSignature(f.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(w),this.checkSignature(f.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,f.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(f.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(f.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var b=this.centralDirOffset+this.centralDirSize;this.zip64&&(b+=20,b+=12+this.zip64EndOfCentralSize);var C=x-b;if(0<C)this.isSignature(x,f.CENTRAL_FILE_HEADER)||(this.reader.zero=C);else if(C<0)throw new Error("Corrupted zip: missing "+Math.abs(C)+" bytes.")},prepareReader:function(w){this.reader=l(w)},load:function(w){this.prepareReader(w),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},o.exports=k},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,o,u){var l=n("./reader/readerFor"),d=n("./utils"),f=n("./compressedObject"),h=n("./crc32"),y=n("./utf8"),k=n("./compressions"),w=n("./support");function x(b,C){this.options=b,this.loadOptions=C}x.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(b){var C,m;if(b.skip(22),this.fileNameLength=b.readInt(2),m=b.readInt(2),this.fileName=b.readData(this.fileNameLength),b.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((C=(function(S){for(var j in k)if(Object.prototype.hasOwnProperty.call(k,j)&&k[j].magic===S)return k[j];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+d.pretty(this.compressionMethod)+" unknown (inner file : "+d.transformTo("string",this.fileName)+")");this.decompressed=new f(this.compressedSize,this.uncompressedSize,this.crc32,C,b.readData(this.compressedSize))},readCentralPart:function(b){this.versionMadeBy=b.readInt(2),b.skip(2),this.bitFlag=b.readInt(2),this.compressionMethod=b.readString(2),this.date=b.readDate(),this.crc32=b.readInt(4),this.compressedSize=b.readInt(4),this.uncompressedSize=b.readInt(4);var C=b.readInt(2);if(this.extraFieldsLength=b.readInt(2),this.fileCommentLength=b.readInt(2),this.diskNumberStart=b.readInt(2),this.internalFileAttributes=b.readInt(2),this.externalFileAttributes=b.readInt(4),this.localHeaderOffset=b.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");b.skip(C),this.readExtraFields(b),this.parseZIP64ExtraField(b),this.fileComment=b.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var b=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),b==0&&(this.dosPermissions=63&this.externalFileAttributes),b==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var b=l(this.extraFields[1].value);this.uncompressedSize===d.MAX_VALUE_32BITS&&(this.uncompressedSize=b.readInt(8)),this.compressedSize===d.MAX_VALUE_32BITS&&(this.compressedSize=b.readInt(8)),this.localHeaderOffset===d.MAX_VALUE_32BITS&&(this.localHeaderOffset=b.readInt(8)),this.diskNumberStart===d.MAX_VALUE_32BITS&&(this.diskNumberStart=b.readInt(4))}},readExtraFields:function(b){var C,m,S,j=b.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});b.index+4<j;)C=b.readInt(2),m=b.readInt(2),S=b.readData(m),this.extraFields[C]={id:C,length:m,value:S};b.setIndex(j)},handleUTF8:function(){var b=w.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=y.utf8decode(this.fileName),this.fileCommentStr=y.utf8decode(this.fileComment);else{var C=this.findExtraFieldUnicodePath();if(C!==null)this.fileNameStr=C;else{var m=d.transformTo(b,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var S=this.findExtraFieldUnicodeComment();if(S!==null)this.fileCommentStr=S;else{var j=d.transformTo(b,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(j)}}},findExtraFieldUnicodePath:function(){var b=this.extraFields[28789];if(b){var C=l(b.value);return C.readInt(1)!==1||h(this.fileName)!==C.readInt(4)?null:y.utf8decode(C.readData(b.length-5))}return null},findExtraFieldUnicodeComment:function(){var b=this.extraFields[25461];if(b){var C=l(b.value);return C.readInt(1)!==1||h(this.fileComment)!==C.readInt(4)?null:y.utf8decode(C.readData(b.length-5))}return null}},o.exports=x},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,o,u){function l(C,m,S){this.name=C,this.dir=S.dir,this.date=S.date,this.comment=S.comment,this.unixPermissions=S.unixPermissions,this.dosPermissions=S.dosPermissions,this._data=m,this._dataBinary=S.binary,this.options={compression:S.compression,compressionOptions:S.compressionOptions}}var d=n("./stream/StreamHelper"),f=n("./stream/DataWorker"),h=n("./utf8"),y=n("./compressedObject"),k=n("./stream/GenericWorker");l.prototype={internalStream:function(C){var m=null,S="string";try{if(!C)throw new Error("No output type specified.");var j=(S=C.toLowerCase())==="string"||S==="text";S!=="binarystring"&&S!=="text"||(S="string"),m=this._decompressWorker();var _=!this._dataBinary;_&&!j&&(m=m.pipe(new h.Utf8EncodeWorker)),!_&&j&&(m=m.pipe(new h.Utf8DecodeWorker))}catch(L){(m=new k("error")).error(L)}return new d(m,S,"")},async:function(C,m){return this.internalStream(C).accumulate(m)},nodeStream:function(C,m){return this.internalStream(C||"nodebuffer").toNodejsStream(m)},_compressWorker:function(C,m){if(this._data instanceof y&&this._data.compression.magic===C.magic)return this._data.getCompressedWorker();var S=this._decompressWorker();return this._dataBinary||(S=S.pipe(new h.Utf8EncodeWorker)),y.createWorkerFrom(S,C,m)},_decompressWorker:function(){return this._data instanceof y?this._data.getContentWorker():this._data instanceof k?this._data:new f(this._data)}};for(var w=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],x=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},b=0;b<w.length;b++)l.prototype[w[b]]=x;o.exports=l},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,o,u){(function(l){var d,f,h=l.MutationObserver||l.WebKitMutationObserver;if(h){var y=0,k=new h(C),w=l.document.createTextNode("");k.observe(w,{characterData:!0}),d=function(){w.data=y=++y%2}}else if(l.setImmediate||l.MessageChannel===void 0)d="document"in l&&"onreadystatechange"in l.document.createElement("script")?function(){var m=l.document.createElement("script");m.onreadystatechange=function(){C(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},l.document.documentElement.appendChild(m)}:function(){setTimeout(C,0)};else{var x=new l.MessageChannel;x.port1.onmessage=C,d=function(){x.port2.postMessage(0)}}var b=[];function C(){var m,S;f=!0;for(var j=b.length;j;){for(S=b,b=[],m=-1;++m<j;)S[m]();j=b.length}f=!1}o.exports=function(m){b.push(m)!==1||f||d()}}).call(this,typeof ho<"u"?ho:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,o,u){var l=n("immediate");function d(){}var f={},h=["REJECTED"],y=["FULFILLED"],k=["PENDING"];function w(j){if(typeof j!="function")throw new TypeError("resolver must be a function");this.state=k,this.queue=[],this.outcome=void 0,j!==d&&m(this,j)}function x(j,_,L){this.promise=j,typeof _=="function"&&(this.onFulfilled=_,this.callFulfilled=this.otherCallFulfilled),typeof L=="function"&&(this.onRejected=L,this.callRejected=this.otherCallRejected)}function b(j,_,L){l(function(){var U;try{U=_(L)}catch(M){return f.reject(j,M)}U===j?f.reject(j,new TypeError("Cannot resolve promise with itself")):f.resolve(j,U)})}function C(j){var _=j&&j.then;if(j&&(typeof j=="object"||typeof j=="function")&&typeof _=="function")return function(){_.apply(j,arguments)}}function m(j,_){var L=!1;function U(J){L||(L=!0,f.reject(j,J))}function M(J){L||(L=!0,f.resolve(j,J))}var re=S(function(){_(M,U)});re.status==="error"&&U(re.value)}function S(j,_){var L={};try{L.value=j(_),L.status="success"}catch(U){L.status="error",L.value=U}return L}(o.exports=w).prototype.finally=function(j){if(typeof j!="function")return this;var _=this.constructor;return this.then(function(L){return _.resolve(j()).then(function(){return L})},function(L){return _.resolve(j()).then(function(){throw L})})},w.prototype.catch=function(j){return this.then(null,j)},w.prototype.then=function(j,_){if(typeof j!="function"&&this.state===y||typeof _!="function"&&this.state===h)return this;var L=new this.constructor(d);return this.state!==k?b(L,this.state===y?j:_,this.outcome):this.queue.push(new x(L,j,_)),L},x.prototype.callFulfilled=function(j){f.resolve(this.promise,j)},x.prototype.otherCallFulfilled=function(j){b(this.promise,this.onFulfilled,j)},x.prototype.callRejected=function(j){f.reject(this.promise,j)},x.prototype.otherCallRejected=function(j){b(this.promise,this.onRejected,j)},f.resolve=function(j,_){var L=S(C,_);if(L.status==="error")return f.reject(j,L.value);var U=L.value;if(U)m(j,U);else{j.state=y,j.outcome=_;for(var M=-1,re=j.queue.length;++M<re;)j.queue[M].callFulfilled(_)}return j},f.reject=function(j,_){j.state=h,j.outcome=_;for(var L=-1,U=j.queue.length;++L<U;)j.queue[L].callRejected(_);return j},w.resolve=function(j){return j instanceof this?j:f.resolve(new this(d),j)},w.reject=function(j){var _=new this(d);return f.reject(_,j)},w.all=function(j){var _=this;if(Object.prototype.toString.call(j)!=="[object Array]")return this.reject(new TypeError("must be an array"));var L=j.length,U=!1;if(!L)return this.resolve([]);for(var M=new Array(L),re=0,J=-1,$=new this(d);++J<L;)z(j[J],J);return $;function z(Q,ae){_.resolve(Q).then(function(F){M[ae]=F,++re!==L||U||(U=!0,f.resolve($,M))},function(F){U||(U=!0,f.reject($,F))})}},w.race=function(j){var _=this;if(Object.prototype.toString.call(j)!=="[object Array]")return this.reject(new TypeError("must be an array"));var L=j.length,U=!1;if(!L)return this.resolve([]);for(var M=-1,re=new this(d);++M<L;)J=j[M],_.resolve(J).then(function($){U||(U=!0,f.resolve(re,$))},function($){U||(U=!0,f.reject(re,$))});var J;return re}},{immediate:36}],38:[function(n,o,u){var l={};(0,n("./lib/utils/common").assign)(l,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),o.exports=l},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,o,u){var l=n("./zlib/deflate"),d=n("./utils/common"),f=n("./utils/strings"),h=n("./zlib/messages"),y=n("./zlib/zstream"),k=Object.prototype.toString,w=0,x=-1,b=0,C=8;function m(j){if(!(this instanceof m))return new m(j);this.options=d.assign({level:x,method:C,chunkSize:16384,windowBits:15,memLevel:8,strategy:b,to:""},j||{});var _=this.options;_.raw&&0<_.windowBits?_.windowBits=-_.windowBits:_.gzip&&0<_.windowBits&&_.windowBits<16&&(_.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new y,this.strm.avail_out=0;var L=l.deflateInit2(this.strm,_.level,_.method,_.windowBits,_.memLevel,_.strategy);if(L!==w)throw new Error(h[L]);if(_.header&&l.deflateSetHeader(this.strm,_.header),_.dictionary){var U;if(U=typeof _.dictionary=="string"?f.string2buf(_.dictionary):k.call(_.dictionary)==="[object ArrayBuffer]"?new Uint8Array(_.dictionary):_.dictionary,(L=l.deflateSetDictionary(this.strm,U))!==w)throw new Error(h[L]);this._dict_set=!0}}function S(j,_){var L=new m(_);if(L.push(j,!0),L.err)throw L.msg||h[L.err];return L.result}m.prototype.push=function(j,_){var L,U,M=this.strm,re=this.options.chunkSize;if(this.ended)return!1;U=_===~~_?_:_===!0?4:0,typeof j=="string"?M.input=f.string2buf(j):k.call(j)==="[object ArrayBuffer]"?M.input=new Uint8Array(j):M.input=j,M.next_in=0,M.avail_in=M.input.length;do{if(M.avail_out===0&&(M.output=new d.Buf8(re),M.next_out=0,M.avail_out=re),(L=l.deflate(M,U))!==1&&L!==w)return this.onEnd(L),!(this.ended=!0);M.avail_out!==0&&(M.avail_in!==0||U!==4&&U!==2)||(this.options.to==="string"?this.onData(f.buf2binstring(d.shrinkBuf(M.output,M.next_out))):this.onData(d.shrinkBuf(M.output,M.next_out)))}while((0<M.avail_in||M.avail_out===0)&&L!==1);return U===4?(L=l.deflateEnd(this.strm),this.onEnd(L),this.ended=!0,L===w):U!==2||(this.onEnd(w),!(M.avail_out=0))},m.prototype.onData=function(j){this.chunks.push(j)},m.prototype.onEnd=function(j){j===w&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=d.flattenChunks(this.chunks)),this.chunks=[],this.err=j,this.msg=this.strm.msg},u.Deflate=m,u.deflate=S,u.deflateRaw=function(j,_){return(_=_||{}).raw=!0,S(j,_)},u.gzip=function(j,_){return(_=_||{}).gzip=!0,S(j,_)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,o,u){var l=n("./zlib/inflate"),d=n("./utils/common"),f=n("./utils/strings"),h=n("./zlib/constants"),y=n("./zlib/messages"),k=n("./zlib/zstream"),w=n("./zlib/gzheader"),x=Object.prototype.toString;function b(m){if(!(this instanceof b))return new b(m);this.options=d.assign({chunkSize:16384,windowBits:0,to:""},m||{});var S=this.options;S.raw&&0<=S.windowBits&&S.windowBits<16&&(S.windowBits=-S.windowBits,S.windowBits===0&&(S.windowBits=-15)),!(0<=S.windowBits&&S.windowBits<16)||m&&m.windowBits||(S.windowBits+=32),15<S.windowBits&&S.windowBits<48&&(15&S.windowBits)==0&&(S.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new k,this.strm.avail_out=0;var j=l.inflateInit2(this.strm,S.windowBits);if(j!==h.Z_OK)throw new Error(y[j]);this.header=new w,l.inflateGetHeader(this.strm,this.header)}function C(m,S){var j=new b(S);if(j.push(m,!0),j.err)throw j.msg||y[j.err];return j.result}b.prototype.push=function(m,S){var j,_,L,U,M,re,J=this.strm,$=this.options.chunkSize,z=this.options.dictionary,Q=!1;if(this.ended)return!1;_=S===~~S?S:S===!0?h.Z_FINISH:h.Z_NO_FLUSH,typeof m=="string"?J.input=f.binstring2buf(m):x.call(m)==="[object ArrayBuffer]"?J.input=new Uint8Array(m):J.input=m,J.next_in=0,J.avail_in=J.input.length;do{if(J.avail_out===0&&(J.output=new d.Buf8($),J.next_out=0,J.avail_out=$),(j=l.inflate(J,h.Z_NO_FLUSH))===h.Z_NEED_DICT&&z&&(re=typeof z=="string"?f.string2buf(z):x.call(z)==="[object ArrayBuffer]"?new Uint8Array(z):z,j=l.inflateSetDictionary(this.strm,re)),j===h.Z_BUF_ERROR&&Q===!0&&(j=h.Z_OK,Q=!1),j!==h.Z_STREAM_END&&j!==h.Z_OK)return this.onEnd(j),!(this.ended=!0);J.next_out&&(J.avail_out!==0&&j!==h.Z_STREAM_END&&(J.avail_in!==0||_!==h.Z_FINISH&&_!==h.Z_SYNC_FLUSH)||(this.options.to==="string"?(L=f.utf8border(J.output,J.next_out),U=J.next_out-L,M=f.buf2string(J.output,L),J.next_out=U,J.avail_out=$-U,U&&d.arraySet(J.output,J.output,L,U,0),this.onData(M)):this.onData(d.shrinkBuf(J.output,J.next_out)))),J.avail_in===0&&J.avail_out===0&&(Q=!0)}while((0<J.avail_in||J.avail_out===0)&&j!==h.Z_STREAM_END);return j===h.Z_STREAM_END&&(_=h.Z_FINISH),_===h.Z_FINISH?(j=l.inflateEnd(this.strm),this.onEnd(j),this.ended=!0,j===h.Z_OK):_!==h.Z_SYNC_FLUSH||(this.onEnd(h.Z_OK),!(J.avail_out=0))},b.prototype.onData=function(m){this.chunks.push(m)},b.prototype.onEnd=function(m){m===h.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=d.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},u.Inflate=b,u.inflate=C,u.inflateRaw=function(m,S){return(S=S||{}).raw=!0,C(m,S)},u.ungzip=C},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,o,u){var l=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";u.assign=function(h){for(var y=Array.prototype.slice.call(arguments,1);y.length;){var k=y.shift();if(k){if(typeof k!="object")throw new TypeError(k+"must be non-object");for(var w in k)k.hasOwnProperty(w)&&(h[w]=k[w])}}return h},u.shrinkBuf=function(h,y){return h.length===y?h:h.subarray?h.subarray(0,y):(h.length=y,h)};var d={arraySet:function(h,y,k,w,x){if(y.subarray&&h.subarray)h.set(y.subarray(k,k+w),x);else for(var b=0;b<w;b++)h[x+b]=y[k+b]},flattenChunks:function(h){var y,k,w,x,b,C;for(y=w=0,k=h.length;y<k;y++)w+=h[y].length;for(C=new Uint8Array(w),y=x=0,k=h.length;y<k;y++)b=h[y],C.set(b,x),x+=b.length;return C}},f={arraySet:function(h,y,k,w,x){for(var b=0;b<w;b++)h[x+b]=y[k+b]},flattenChunks:function(h){return[].concat.apply([],h)}};u.setTyped=function(h){h?(u.Buf8=Uint8Array,u.Buf16=Uint16Array,u.Buf32=Int32Array,u.assign(u,d)):(u.Buf8=Array,u.Buf16=Array,u.Buf32=Array,u.assign(u,f))},u.setTyped(l)},{}],42:[function(n,o,u){var l=n("./common"),d=!0,f=!0;try{String.fromCharCode.apply(null,[0])}catch{d=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{f=!1}for(var h=new l.Buf8(256),y=0;y<256;y++)h[y]=252<=y?6:248<=y?5:240<=y?4:224<=y?3:192<=y?2:1;function k(w,x){if(x<65537&&(w.subarray&&f||!w.subarray&&d))return String.fromCharCode.apply(null,l.shrinkBuf(w,x));for(var b="",C=0;C<x;C++)b+=String.fromCharCode(w[C]);return b}h[254]=h[254]=1,u.string2buf=function(w){var x,b,C,m,S,j=w.length,_=0;for(m=0;m<j;m++)(64512&(b=w.charCodeAt(m)))==55296&&m+1<j&&(64512&(C=w.charCodeAt(m+1)))==56320&&(b=65536+(b-55296<<10)+(C-56320),m++),_+=b<128?1:b<2048?2:b<65536?3:4;for(x=new l.Buf8(_),m=S=0;S<_;m++)(64512&(b=w.charCodeAt(m)))==55296&&m+1<j&&(64512&(C=w.charCodeAt(m+1)))==56320&&(b=65536+(b-55296<<10)+(C-56320),m++),b<128?x[S++]=b:(b<2048?x[S++]=192|b>>>6:(b<65536?x[S++]=224|b>>>12:(x[S++]=240|b>>>18,x[S++]=128|b>>>12&63),x[S++]=128|b>>>6&63),x[S++]=128|63&b);return x},u.buf2binstring=function(w){return k(w,w.length)},u.binstring2buf=function(w){for(var x=new l.Buf8(w.length),b=0,C=x.length;b<C;b++)x[b]=w.charCodeAt(b);return x},u.buf2string=function(w,x){var b,C,m,S,j=x||w.length,_=new Array(2*j);for(b=C=0;b<j;)if((m=w[b++])<128)_[C++]=m;else if(4<(S=h[m]))_[C++]=65533,b+=S-1;else{for(m&=S===2?31:S===3?15:7;1<S&&b<j;)m=m<<6|63&w[b++],S--;1<S?_[C++]=65533:m<65536?_[C++]=m:(m-=65536,_[C++]=55296|m>>10&1023,_[C++]=56320|1023&m)}return k(_,C)},u.utf8border=function(w,x){var b;for((x=x||w.length)>w.length&&(x=w.length),b=x-1;0<=b&&(192&w[b])==128;)b--;return b<0||b===0?x:b+h[w[b]]>x?b:x}},{"./common":41}],43:[function(n,o,u){o.exports=function(l,d,f,h){for(var y=65535&l|0,k=l>>>16&65535|0,w=0;f!==0;){for(f-=w=2e3<f?2e3:f;k=k+(y=y+d[h++]|0)|0,--w;);y%=65521,k%=65521}return y|k<<16|0}},{}],44:[function(n,o,u){o.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,o,u){var l=(function(){for(var d,f=[],h=0;h<256;h++){d=h;for(var y=0;y<8;y++)d=1&d?3988292384^d>>>1:d>>>1;f[h]=d}return f})();o.exports=function(d,f,h,y){var k=l,w=y+h;d^=-1;for(var x=y;x<w;x++)d=d>>>8^k[255&(d^f[x])];return-1^d}},{}],46:[function(n,o,u){var l,d=n("../utils/common"),f=n("./trees"),h=n("./adler32"),y=n("./crc32"),k=n("./messages"),w=0,x=4,b=0,C=-2,m=-1,S=4,j=2,_=8,L=9,U=286,M=30,re=19,J=2*U+1,$=15,z=3,Q=258,ae=Q+z+1,F=42,te=113,N=1,K=2,ge=3,ne=4;function le(v,X){return v.msg=k[X],X}function ie(v){return(v<<1)-(4<v?9:0)}function ue(v){for(var X=v.length;0<=--X;)v[X]=0}function A(v){var X=v.state,H=X.pending;H>v.avail_out&&(H=v.avail_out),H!==0&&(d.arraySet(v.output,X.pending_buf,X.pending_out,H,v.next_out),v.next_out+=H,X.pending_out+=H,v.total_out+=H,v.avail_out-=H,X.pending-=H,X.pending===0&&(X.pending_out=0))}function B(v,X){f._tr_flush_block(v,0<=v.block_start?v.block_start:-1,v.strstart-v.block_start,X),v.block_start=v.strstart,A(v.strm)}function me(v,X){v.pending_buf[v.pending++]=X}function he(v,X){v.pending_buf[v.pending++]=X>>>8&255,v.pending_buf[v.pending++]=255&X}function se(v,X){var H,I,O=v.max_chain_length,V=v.strstart,G=v.prev_length,oe=v.nice_match,Y=v.strstart>v.w_size-ae?v.strstart-(v.w_size-ae):0,E=v.window,T=v.w_mask,D=v.prev,q=v.strstart+Q,ve=E[V+G-1],Ce=E[V+G];v.prev_length>=v.good_match&&(O>>=2),oe>v.lookahead&&(oe=v.lookahead);do if(E[(H=X)+G]===Ce&&E[H+G-1]===ve&&E[H]===E[V]&&E[++H]===E[V+1]){V+=2,H++;do;while(E[++V]===E[++H]&&E[++V]===E[++H]&&E[++V]===E[++H]&&E[++V]===E[++H]&&E[++V]===E[++H]&&E[++V]===E[++H]&&E[++V]===E[++H]&&E[++V]===E[++H]&&V<q);if(I=Q-(q-V),V=q-Q,G<I){if(v.match_start=X,oe<=(G=I))break;ve=E[V+G-1],Ce=E[V+G]}}while((X=D[X&T])>Y&&--O!=0);return G<=v.lookahead?G:v.lookahead}function we(v){var X,H,I,O,V,G,oe,Y,E,T,D=v.w_size;do{if(O=v.window_size-v.lookahead-v.strstart,v.strstart>=D+(D-ae)){for(d.arraySet(v.window,v.window,D,D,0),v.match_start-=D,v.strstart-=D,v.block_start-=D,X=H=v.hash_size;I=v.head[--X],v.head[X]=D<=I?I-D:0,--H;);for(X=H=D;I=v.prev[--X],v.prev[X]=D<=I?I-D:0,--H;);O+=D}if(v.strm.avail_in===0)break;if(G=v.strm,oe=v.window,Y=v.strstart+v.lookahead,E=O,T=void 0,T=G.avail_in,E<T&&(T=E),H=T===0?0:(G.avail_in-=T,d.arraySet(oe,G.input,G.next_in,T,Y),G.state.wrap===1?G.adler=h(G.adler,oe,T,Y):G.state.wrap===2&&(G.adler=y(G.adler,oe,T,Y)),G.next_in+=T,G.total_in+=T,T),v.lookahead+=H,v.lookahead+v.insert>=z)for(V=v.strstart-v.insert,v.ins_h=v.window[V],v.ins_h=(v.ins_h<<v.hash_shift^v.window[V+1])&v.hash_mask;v.insert&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[V+z-1])&v.hash_mask,v.prev[V&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=V,V++,v.insert--,!(v.lookahead+v.insert<z)););}while(v.lookahead<ae&&v.strm.avail_in!==0)}function Ee(v,X){for(var H,I;;){if(v.lookahead<ae){if(we(v),v.lookahead<ae&&X===w)return N;if(v.lookahead===0)break}if(H=0,v.lookahead>=z&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+z-1])&v.hash_mask,H=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),H!==0&&v.strstart-H<=v.w_size-ae&&(v.match_length=se(v,H)),v.match_length>=z)if(I=f._tr_tally(v,v.strstart-v.match_start,v.match_length-z),v.lookahead-=v.match_length,v.match_length<=v.max_lazy_match&&v.lookahead>=z){for(v.match_length--;v.strstart++,v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+z-1])&v.hash_mask,H=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart,--v.match_length!=0;);v.strstart++}else v.strstart+=v.match_length,v.match_length=0,v.ins_h=v.window[v.strstart],v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+1])&v.hash_mask;else I=f._tr_tally(v,0,v.window[v.strstart]),v.lookahead--,v.strstart++;if(I&&(B(v,!1),v.strm.avail_out===0))return N}return v.insert=v.strstart<z-1?v.strstart:z-1,X===x?(B(v,!0),v.strm.avail_out===0?ge:ne):v.last_lit&&(B(v,!1),v.strm.avail_out===0)?N:K}function xe(v,X){for(var H,I,O;;){if(v.lookahead<ae){if(we(v),v.lookahead<ae&&X===w)return N;if(v.lookahead===0)break}if(H=0,v.lookahead>=z&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+z-1])&v.hash_mask,H=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),v.prev_length=v.match_length,v.prev_match=v.match_start,v.match_length=z-1,H!==0&&v.prev_length<v.max_lazy_match&&v.strstart-H<=v.w_size-ae&&(v.match_length=se(v,H),v.match_length<=5&&(v.strategy===1||v.match_length===z&&4096<v.strstart-v.match_start)&&(v.match_length=z-1)),v.prev_length>=z&&v.match_length<=v.prev_length){for(O=v.strstart+v.lookahead-z,I=f._tr_tally(v,v.strstart-1-v.prev_match,v.prev_length-z),v.lookahead-=v.prev_length-1,v.prev_length-=2;++v.strstart<=O&&(v.ins_h=(v.ins_h<<v.hash_shift^v.window[v.strstart+z-1])&v.hash_mask,H=v.prev[v.strstart&v.w_mask]=v.head[v.ins_h],v.head[v.ins_h]=v.strstart),--v.prev_length!=0;);if(v.match_available=0,v.match_length=z-1,v.strstart++,I&&(B(v,!1),v.strm.avail_out===0))return N}else if(v.match_available){if((I=f._tr_tally(v,0,v.window[v.strstart-1]))&&B(v,!1),v.strstart++,v.lookahead--,v.strm.avail_out===0)return N}else v.match_available=1,v.strstart++,v.lookahead--}return v.match_available&&(I=f._tr_tally(v,0,v.window[v.strstart-1]),v.match_available=0),v.insert=v.strstart<z-1?v.strstart:z-1,X===x?(B(v,!0),v.strm.avail_out===0?ge:ne):v.last_lit&&(B(v,!1),v.strm.avail_out===0)?N:K}function je(v,X,H,I,O){this.good_length=v,this.max_lazy=X,this.nice_length=H,this.max_chain=I,this.func=O}function Te(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new d.Buf16(2*J),this.dyn_dtree=new d.Buf16(2*(2*M+1)),this.bl_tree=new d.Buf16(2*(2*re+1)),ue(this.dyn_ltree),ue(this.dyn_dtree),ue(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new d.Buf16($+1),this.heap=new d.Buf16(2*U+1),ue(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new d.Buf16(2*U+1),ue(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Fe(v){var X;return v&&v.state?(v.total_in=v.total_out=0,v.data_type=j,(X=v.state).pending=0,X.pending_out=0,X.wrap<0&&(X.wrap=-X.wrap),X.status=X.wrap?F:te,v.adler=X.wrap===2?0:1,X.last_flush=w,f._tr_init(X),b):le(v,C)}function He(v){var X=Fe(v);return X===b&&(function(H){H.window_size=2*H.w_size,ue(H.head),H.max_lazy_match=l[H.level].max_lazy,H.good_match=l[H.level].good_length,H.nice_match=l[H.level].nice_length,H.max_chain_length=l[H.level].max_chain,H.strstart=0,H.block_start=0,H.lookahead=0,H.insert=0,H.match_length=H.prev_length=z-1,H.match_available=0,H.ins_h=0})(v.state),X}function Me(v,X,H,I,O,V){if(!v)return C;var G=1;if(X===m&&(X=6),I<0?(G=0,I=-I):15<I&&(G=2,I-=16),O<1||L<O||H!==_||I<8||15<I||X<0||9<X||V<0||S<V)return le(v,C);I===8&&(I=9);var oe=new Te;return(v.state=oe).strm=v,oe.wrap=G,oe.gzhead=null,oe.w_bits=I,oe.w_size=1<<oe.w_bits,oe.w_mask=oe.w_size-1,oe.hash_bits=O+7,oe.hash_size=1<<oe.hash_bits,oe.hash_mask=oe.hash_size-1,oe.hash_shift=~~((oe.hash_bits+z-1)/z),oe.window=new d.Buf8(2*oe.w_size),oe.head=new d.Buf16(oe.hash_size),oe.prev=new d.Buf16(oe.w_size),oe.lit_bufsize=1<<O+6,oe.pending_buf_size=4*oe.lit_bufsize,oe.pending_buf=new d.Buf8(oe.pending_buf_size),oe.d_buf=1*oe.lit_bufsize,oe.l_buf=3*oe.lit_bufsize,oe.level=X,oe.strategy=V,oe.method=H,He(v)}l=[new je(0,0,0,0,function(v,X){var H=65535;for(H>v.pending_buf_size-5&&(H=v.pending_buf_size-5);;){if(v.lookahead<=1){if(we(v),v.lookahead===0&&X===w)return N;if(v.lookahead===0)break}v.strstart+=v.lookahead,v.lookahead=0;var I=v.block_start+H;if((v.strstart===0||v.strstart>=I)&&(v.lookahead=v.strstart-I,v.strstart=I,B(v,!1),v.strm.avail_out===0)||v.strstart-v.block_start>=v.w_size-ae&&(B(v,!1),v.strm.avail_out===0))return N}return v.insert=0,X===x?(B(v,!0),v.strm.avail_out===0?ge:ne):(v.strstart>v.block_start&&(B(v,!1),v.strm.avail_out),N)}),new je(4,4,8,4,Ee),new je(4,5,16,8,Ee),new je(4,6,32,32,Ee),new je(4,4,16,16,xe),new je(8,16,32,32,xe),new je(8,16,128,128,xe),new je(8,32,128,256,xe),new je(32,128,258,1024,xe),new je(32,258,258,4096,xe)],u.deflateInit=function(v,X){return Me(v,X,_,15,8,0)},u.deflateInit2=Me,u.deflateReset=He,u.deflateResetKeep=Fe,u.deflateSetHeader=function(v,X){return v&&v.state?v.state.wrap!==2?C:(v.state.gzhead=X,b):C},u.deflate=function(v,X){var H,I,O,V;if(!v||!v.state||5<X||X<0)return v?le(v,C):C;if(I=v.state,!v.output||!v.input&&v.avail_in!==0||I.status===666&&X!==x)return le(v,v.avail_out===0?-5:C);if(I.strm=v,H=I.last_flush,I.last_flush=X,I.status===F)if(I.wrap===2)v.adler=0,me(I,31),me(I,139),me(I,8),I.gzhead?(me(I,(I.gzhead.text?1:0)+(I.gzhead.hcrc?2:0)+(I.gzhead.extra?4:0)+(I.gzhead.name?8:0)+(I.gzhead.comment?16:0)),me(I,255&I.gzhead.time),me(I,I.gzhead.time>>8&255),me(I,I.gzhead.time>>16&255),me(I,I.gzhead.time>>24&255),me(I,I.level===9?2:2<=I.strategy||I.level<2?4:0),me(I,255&I.gzhead.os),I.gzhead.extra&&I.gzhead.extra.length&&(me(I,255&I.gzhead.extra.length),me(I,I.gzhead.extra.length>>8&255)),I.gzhead.hcrc&&(v.adler=y(v.adler,I.pending_buf,I.pending,0)),I.gzindex=0,I.status=69):(me(I,0),me(I,0),me(I,0),me(I,0),me(I,0),me(I,I.level===9?2:2<=I.strategy||I.level<2?4:0),me(I,3),I.status=te);else{var G=_+(I.w_bits-8<<4)<<8;G|=(2<=I.strategy||I.level<2?0:I.level<6?1:I.level===6?2:3)<<6,I.strstart!==0&&(G|=32),G+=31-G%31,I.status=te,he(I,G),I.strstart!==0&&(he(I,v.adler>>>16),he(I,65535&v.adler)),v.adler=1}if(I.status===69)if(I.gzhead.extra){for(O=I.pending;I.gzindex<(65535&I.gzhead.extra.length)&&(I.pending!==I.pending_buf_size||(I.gzhead.hcrc&&I.pending>O&&(v.adler=y(v.adler,I.pending_buf,I.pending-O,O)),A(v),O=I.pending,I.pending!==I.pending_buf_size));)me(I,255&I.gzhead.extra[I.gzindex]),I.gzindex++;I.gzhead.hcrc&&I.pending>O&&(v.adler=y(v.adler,I.pending_buf,I.pending-O,O)),I.gzindex===I.gzhead.extra.length&&(I.gzindex=0,I.status=73)}else I.status=73;if(I.status===73)if(I.gzhead.name){O=I.pending;do{if(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>O&&(v.adler=y(v.adler,I.pending_buf,I.pending-O,O)),A(v),O=I.pending,I.pending===I.pending_buf_size)){V=1;break}V=I.gzindex<I.gzhead.name.length?255&I.gzhead.name.charCodeAt(I.gzindex++):0,me(I,V)}while(V!==0);I.gzhead.hcrc&&I.pending>O&&(v.adler=y(v.adler,I.pending_buf,I.pending-O,O)),V===0&&(I.gzindex=0,I.status=91)}else I.status=91;if(I.status===91)if(I.gzhead.comment){O=I.pending;do{if(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>O&&(v.adler=y(v.adler,I.pending_buf,I.pending-O,O)),A(v),O=I.pending,I.pending===I.pending_buf_size)){V=1;break}V=I.gzindex<I.gzhead.comment.length?255&I.gzhead.comment.charCodeAt(I.gzindex++):0,me(I,V)}while(V!==0);I.gzhead.hcrc&&I.pending>O&&(v.adler=y(v.adler,I.pending_buf,I.pending-O,O)),V===0&&(I.status=103)}else I.status=103;if(I.status===103&&(I.gzhead.hcrc?(I.pending+2>I.pending_buf_size&&A(v),I.pending+2<=I.pending_buf_size&&(me(I,255&v.adler),me(I,v.adler>>8&255),v.adler=0,I.status=te)):I.status=te),I.pending!==0){if(A(v),v.avail_out===0)return I.last_flush=-1,b}else if(v.avail_in===0&&ie(X)<=ie(H)&&X!==x)return le(v,-5);if(I.status===666&&v.avail_in!==0)return le(v,-5);if(v.avail_in!==0||I.lookahead!==0||X!==w&&I.status!==666){var oe=I.strategy===2?(function(Y,E){for(var T;;){if(Y.lookahead===0&&(we(Y),Y.lookahead===0)){if(E===w)return N;break}if(Y.match_length=0,T=f._tr_tally(Y,0,Y.window[Y.strstart]),Y.lookahead--,Y.strstart++,T&&(B(Y,!1),Y.strm.avail_out===0))return N}return Y.insert=0,E===x?(B(Y,!0),Y.strm.avail_out===0?ge:ne):Y.last_lit&&(B(Y,!1),Y.strm.avail_out===0)?N:K})(I,X):I.strategy===3?(function(Y,E){for(var T,D,q,ve,Ce=Y.window;;){if(Y.lookahead<=Q){if(we(Y),Y.lookahead<=Q&&E===w)return N;if(Y.lookahead===0)break}if(Y.match_length=0,Y.lookahead>=z&&0<Y.strstart&&(D=Ce[q=Y.strstart-1])===Ce[++q]&&D===Ce[++q]&&D===Ce[++q]){ve=Y.strstart+Q;do;while(D===Ce[++q]&&D===Ce[++q]&&D===Ce[++q]&&D===Ce[++q]&&D===Ce[++q]&&D===Ce[++q]&&D===Ce[++q]&&D===Ce[++q]&&q<ve);Y.match_length=Q-(ve-q),Y.match_length>Y.lookahead&&(Y.match_length=Y.lookahead)}if(Y.match_length>=z?(T=f._tr_tally(Y,1,Y.match_length-z),Y.lookahead-=Y.match_length,Y.strstart+=Y.match_length,Y.match_length=0):(T=f._tr_tally(Y,0,Y.window[Y.strstart]),Y.lookahead--,Y.strstart++),T&&(B(Y,!1),Y.strm.avail_out===0))return N}return Y.insert=0,E===x?(B(Y,!0),Y.strm.avail_out===0?ge:ne):Y.last_lit&&(B(Y,!1),Y.strm.avail_out===0)?N:K})(I,X):l[I.level].func(I,X);if(oe!==ge&&oe!==ne||(I.status=666),oe===N||oe===ge)return v.avail_out===0&&(I.last_flush=-1),b;if(oe===K&&(X===1?f._tr_align(I):X!==5&&(f._tr_stored_block(I,0,0,!1),X===3&&(ue(I.head),I.lookahead===0&&(I.strstart=0,I.block_start=0,I.insert=0))),A(v),v.avail_out===0))return I.last_flush=-1,b}return X!==x?b:I.wrap<=0?1:(I.wrap===2?(me(I,255&v.adler),me(I,v.adler>>8&255),me(I,v.adler>>16&255),me(I,v.adler>>24&255),me(I,255&v.total_in),me(I,v.total_in>>8&255),me(I,v.total_in>>16&255),me(I,v.total_in>>24&255)):(he(I,v.adler>>>16),he(I,65535&v.adler)),A(v),0<I.wrap&&(I.wrap=-I.wrap),I.pending!==0?b:1)},u.deflateEnd=function(v){var X;return v&&v.state?(X=v.state.status)!==F&&X!==69&&X!==73&&X!==91&&X!==103&&X!==te&&X!==666?le(v,C):(v.state=null,X===te?le(v,-3):b):C},u.deflateSetDictionary=function(v,X){var H,I,O,V,G,oe,Y,E,T=X.length;if(!v||!v.state||(V=(H=v.state).wrap)===2||V===1&&H.status!==F||H.lookahead)return C;for(V===1&&(v.adler=h(v.adler,X,T,0)),H.wrap=0,T>=H.w_size&&(V===0&&(ue(H.head),H.strstart=0,H.block_start=0,H.insert=0),E=new d.Buf8(H.w_size),d.arraySet(E,X,T-H.w_size,H.w_size,0),X=E,T=H.w_size),G=v.avail_in,oe=v.next_in,Y=v.input,v.avail_in=T,v.next_in=0,v.input=X,we(H);H.lookahead>=z;){for(I=H.strstart,O=H.lookahead-(z-1);H.ins_h=(H.ins_h<<H.hash_shift^H.window[I+z-1])&H.hash_mask,H.prev[I&H.w_mask]=H.head[H.ins_h],H.head[H.ins_h]=I,I++,--O;);H.strstart=I,H.lookahead=z-1,we(H)}return H.strstart+=H.lookahead,H.block_start=H.strstart,H.insert=H.lookahead,H.lookahead=0,H.match_length=H.prev_length=z-1,H.match_available=0,v.next_in=oe,v.input=Y,v.avail_in=G,H.wrap=V,b},u.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,o,u){o.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,o,u){o.exports=function(l,d){var f,h,y,k,w,x,b,C,m,S,j,_,L,U,M,re,J,$,z,Q,ae,F,te,N,K;f=l.state,h=l.next_in,N=l.input,y=h+(l.avail_in-5),k=l.next_out,K=l.output,w=k-(d-l.avail_out),x=k+(l.avail_out-257),b=f.dmax,C=f.wsize,m=f.whave,S=f.wnext,j=f.window,_=f.hold,L=f.bits,U=f.lencode,M=f.distcode,re=(1<<f.lenbits)-1,J=(1<<f.distbits)-1;e:do{L<15&&(_+=N[h++]<<L,L+=8,_+=N[h++]<<L,L+=8),$=U[_&re];t:for(;;){if(_>>>=z=$>>>24,L-=z,(z=$>>>16&255)===0)K[k++]=65535&$;else{if(!(16&z)){if((64&z)==0){$=U[(65535&$)+(_&(1<<z)-1)];continue t}if(32&z){f.mode=12;break e}l.msg="invalid literal/length code",f.mode=30;break e}Q=65535&$,(z&=15)&&(L<z&&(_+=N[h++]<<L,L+=8),Q+=_&(1<<z)-1,_>>>=z,L-=z),L<15&&(_+=N[h++]<<L,L+=8,_+=N[h++]<<L,L+=8),$=M[_&J];r:for(;;){if(_>>>=z=$>>>24,L-=z,!(16&(z=$>>>16&255))){if((64&z)==0){$=M[(65535&$)+(_&(1<<z)-1)];continue r}l.msg="invalid distance code",f.mode=30;break e}if(ae=65535&$,L<(z&=15)&&(_+=N[h++]<<L,(L+=8)<z&&(_+=N[h++]<<L,L+=8)),b<(ae+=_&(1<<z)-1)){l.msg="invalid distance too far back",f.mode=30;break e}if(_>>>=z,L-=z,(z=k-w)<ae){if(m<(z=ae-z)&&f.sane){l.msg="invalid distance too far back",f.mode=30;break e}if(te=j,(F=0)===S){if(F+=C-z,z<Q){for(Q-=z;K[k++]=j[F++],--z;);F=k-ae,te=K}}else if(S<z){if(F+=C+S-z,(z-=S)<Q){for(Q-=z;K[k++]=j[F++],--z;);if(F=0,S<Q){for(Q-=z=S;K[k++]=j[F++],--z;);F=k-ae,te=K}}}else if(F+=S-z,z<Q){for(Q-=z;K[k++]=j[F++],--z;);F=k-ae,te=K}for(;2<Q;)K[k++]=te[F++],K[k++]=te[F++],K[k++]=te[F++],Q-=3;Q&&(K[k++]=te[F++],1<Q&&(K[k++]=te[F++]))}else{for(F=k-ae;K[k++]=K[F++],K[k++]=K[F++],K[k++]=K[F++],2<(Q-=3););Q&&(K[k++]=K[F++],1<Q&&(K[k++]=K[F++]))}break}}break}}while(h<y&&k<x);h-=Q=L>>3,_&=(1<<(L-=Q<<3))-1,l.next_in=h,l.next_out=k,l.avail_in=h<y?y-h+5:5-(h-y),l.avail_out=k<x?x-k+257:257-(k-x),f.hold=_,f.bits=L}},{}],49:[function(n,o,u){var l=n("../utils/common"),d=n("./adler32"),f=n("./crc32"),h=n("./inffast"),y=n("./inftrees"),k=1,w=2,x=0,b=-2,C=1,m=852,S=592;function j(F){return(F>>>24&255)+(F>>>8&65280)+((65280&F)<<8)+((255&F)<<24)}function _(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new l.Buf16(320),this.work=new l.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function L(F){var te;return F&&F.state?(te=F.state,F.total_in=F.total_out=te.total=0,F.msg="",te.wrap&&(F.adler=1&te.wrap),te.mode=C,te.last=0,te.havedict=0,te.dmax=32768,te.head=null,te.hold=0,te.bits=0,te.lencode=te.lendyn=new l.Buf32(m),te.distcode=te.distdyn=new l.Buf32(S),te.sane=1,te.back=-1,x):b}function U(F){var te;return F&&F.state?((te=F.state).wsize=0,te.whave=0,te.wnext=0,L(F)):b}function M(F,te){var N,K;return F&&F.state?(K=F.state,te<0?(N=0,te=-te):(N=1+(te>>4),te<48&&(te&=15)),te&&(te<8||15<te)?b:(K.window!==null&&K.wbits!==te&&(K.window=null),K.wrap=N,K.wbits=te,U(F))):b}function re(F,te){var N,K;return F?(K=new _,(F.state=K).window=null,(N=M(F,te))!==x&&(F.state=null),N):b}var J,$,z=!0;function Q(F){if(z){var te;for(J=new l.Buf32(512),$=new l.Buf32(32),te=0;te<144;)F.lens[te++]=8;for(;te<256;)F.lens[te++]=9;for(;te<280;)F.lens[te++]=7;for(;te<288;)F.lens[te++]=8;for(y(k,F.lens,0,288,J,0,F.work,{bits:9}),te=0;te<32;)F.lens[te++]=5;y(w,F.lens,0,32,$,0,F.work,{bits:5}),z=!1}F.lencode=J,F.lenbits=9,F.distcode=$,F.distbits=5}function ae(F,te,N,K){var ge,ne=F.state;return ne.window===null&&(ne.wsize=1<<ne.wbits,ne.wnext=0,ne.whave=0,ne.window=new l.Buf8(ne.wsize)),K>=ne.wsize?(l.arraySet(ne.window,te,N-ne.wsize,ne.wsize,0),ne.wnext=0,ne.whave=ne.wsize):(K<(ge=ne.wsize-ne.wnext)&&(ge=K),l.arraySet(ne.window,te,N-K,ge,ne.wnext),(K-=ge)?(l.arraySet(ne.window,te,N-K,K,0),ne.wnext=K,ne.whave=ne.wsize):(ne.wnext+=ge,ne.wnext===ne.wsize&&(ne.wnext=0),ne.whave<ne.wsize&&(ne.whave+=ge))),0}u.inflateReset=U,u.inflateReset2=M,u.inflateResetKeep=L,u.inflateInit=function(F){return re(F,15)},u.inflateInit2=re,u.inflate=function(F,te){var N,K,ge,ne,le,ie,ue,A,B,me,he,se,we,Ee,xe,je,Te,Fe,He,Me,v,X,H,I,O=0,V=new l.Buf8(4),G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!F||!F.state||!F.output||!F.input&&F.avail_in!==0)return b;(N=F.state).mode===12&&(N.mode=13),le=F.next_out,ge=F.output,ue=F.avail_out,ne=F.next_in,K=F.input,ie=F.avail_in,A=N.hold,B=N.bits,me=ie,he=ue,X=x;e:for(;;)switch(N.mode){case C:if(N.wrap===0){N.mode=13;break}for(;B<16;){if(ie===0)break e;ie--,A+=K[ne++]<<B,B+=8}if(2&N.wrap&&A===35615){V[N.check=0]=255&A,V[1]=A>>>8&255,N.check=f(N.check,V,2,0),B=A=0,N.mode=2;break}if(N.flags=0,N.head&&(N.head.done=!1),!(1&N.wrap)||(((255&A)<<8)+(A>>8))%31){F.msg="incorrect header check",N.mode=30;break}if((15&A)!=8){F.msg="unknown compression method",N.mode=30;break}if(B-=4,v=8+(15&(A>>>=4)),N.wbits===0)N.wbits=v;else if(v>N.wbits){F.msg="invalid window size",N.mode=30;break}N.dmax=1<<v,F.adler=N.check=1,N.mode=512&A?10:12,B=A=0;break;case 2:for(;B<16;){if(ie===0)break e;ie--,A+=K[ne++]<<B,B+=8}if(N.flags=A,(255&N.flags)!=8){F.msg="unknown compression method",N.mode=30;break}if(57344&N.flags){F.msg="unknown header flags set",N.mode=30;break}N.head&&(N.head.text=A>>8&1),512&N.flags&&(V[0]=255&A,V[1]=A>>>8&255,N.check=f(N.check,V,2,0)),B=A=0,N.mode=3;case 3:for(;B<32;){if(ie===0)break e;ie--,A+=K[ne++]<<B,B+=8}N.head&&(N.head.time=A),512&N.flags&&(V[0]=255&A,V[1]=A>>>8&255,V[2]=A>>>16&255,V[3]=A>>>24&255,N.check=f(N.check,V,4,0)),B=A=0,N.mode=4;case 4:for(;B<16;){if(ie===0)break e;ie--,A+=K[ne++]<<B,B+=8}N.head&&(N.head.xflags=255&A,N.head.os=A>>8),512&N.flags&&(V[0]=255&A,V[1]=A>>>8&255,N.check=f(N.check,V,2,0)),B=A=0,N.mode=5;case 5:if(1024&N.flags){for(;B<16;){if(ie===0)break e;ie--,A+=K[ne++]<<B,B+=8}N.length=A,N.head&&(N.head.extra_len=A),512&N.flags&&(V[0]=255&A,V[1]=A>>>8&255,N.check=f(N.check,V,2,0)),B=A=0}else N.head&&(N.head.extra=null);N.mode=6;case 6:if(1024&N.flags&&(ie<(se=N.length)&&(se=ie),se&&(N.head&&(v=N.head.extra_len-N.length,N.head.extra||(N.head.extra=new Array(N.head.extra_len)),l.arraySet(N.head.extra,K,ne,se,v)),512&N.flags&&(N.check=f(N.check,K,se,ne)),ie-=se,ne+=se,N.length-=se),N.length))break e;N.length=0,N.mode=7;case 7:if(2048&N.flags){if(ie===0)break e;for(se=0;v=K[ne+se++],N.head&&v&&N.length<65536&&(N.head.name+=String.fromCharCode(v)),v&&se<ie;);if(512&N.flags&&(N.check=f(N.check,K,se,ne)),ie-=se,ne+=se,v)break e}else N.head&&(N.head.name=null);N.length=0,N.mode=8;case 8:if(4096&N.flags){if(ie===0)break e;for(se=0;v=K[ne+se++],N.head&&v&&N.length<65536&&(N.head.comment+=String.fromCharCode(v)),v&&se<ie;);if(512&N.flags&&(N.check=f(N.check,K,se,ne)),ie-=se,ne+=se,v)break e}else N.head&&(N.head.comment=null);N.mode=9;case 9:if(512&N.flags){for(;B<16;){if(ie===0)break e;ie--,A+=K[ne++]<<B,B+=8}if(A!==(65535&N.check)){F.msg="header crc mismatch",N.mode=30;break}B=A=0}N.head&&(N.head.hcrc=N.flags>>9&1,N.head.done=!0),F.adler=N.check=0,N.mode=12;break;case 10:for(;B<32;){if(ie===0)break e;ie--,A+=K[ne++]<<B,B+=8}F.adler=N.check=j(A),B=A=0,N.mode=11;case 11:if(N.havedict===0)return F.next_out=le,F.avail_out=ue,F.next_in=ne,F.avail_in=ie,N.hold=A,N.bits=B,2;F.adler=N.check=1,N.mode=12;case 12:if(te===5||te===6)break e;case 13:if(N.last){A>>>=7&B,B-=7&B,N.mode=27;break}for(;B<3;){if(ie===0)break e;ie--,A+=K[ne++]<<B,B+=8}switch(N.last=1&A,B-=1,3&(A>>>=1)){case 0:N.mode=14;break;case 1:if(Q(N),N.mode=20,te!==6)break;A>>>=2,B-=2;break e;case 2:N.mode=17;break;case 3:F.msg="invalid block type",N.mode=30}A>>>=2,B-=2;break;case 14:for(A>>>=7&B,B-=7&B;B<32;){if(ie===0)break e;ie--,A+=K[ne++]<<B,B+=8}if((65535&A)!=(A>>>16^65535)){F.msg="invalid stored block lengths",N.mode=30;break}if(N.length=65535&A,B=A=0,N.mode=15,te===6)break e;case 15:N.mode=16;case 16:if(se=N.length){if(ie<se&&(se=ie),ue<se&&(se=ue),se===0)break e;l.arraySet(ge,K,ne,se,le),ie-=se,ne+=se,ue-=se,le+=se,N.length-=se;break}N.mode=12;break;case 17:for(;B<14;){if(ie===0)break e;ie--,A+=K[ne++]<<B,B+=8}if(N.nlen=257+(31&A),A>>>=5,B-=5,N.ndist=1+(31&A),A>>>=5,B-=5,N.ncode=4+(15&A),A>>>=4,B-=4,286<N.nlen||30<N.ndist){F.msg="too many length or distance symbols",N.mode=30;break}N.have=0,N.mode=18;case 18:for(;N.have<N.ncode;){for(;B<3;){if(ie===0)break e;ie--,A+=K[ne++]<<B,B+=8}N.lens[G[N.have++]]=7&A,A>>>=3,B-=3}for(;N.have<19;)N.lens[G[N.have++]]=0;if(N.lencode=N.lendyn,N.lenbits=7,H={bits:N.lenbits},X=y(0,N.lens,0,19,N.lencode,0,N.work,H),N.lenbits=H.bits,X){F.msg="invalid code lengths set",N.mode=30;break}N.have=0,N.mode=19;case 19:for(;N.have<N.nlen+N.ndist;){for(;je=(O=N.lencode[A&(1<<N.lenbits)-1])>>>16&255,Te=65535&O,!((xe=O>>>24)<=B);){if(ie===0)break e;ie--,A+=K[ne++]<<B,B+=8}if(Te<16)A>>>=xe,B-=xe,N.lens[N.have++]=Te;else{if(Te===16){for(I=xe+2;B<I;){if(ie===0)break e;ie--,A+=K[ne++]<<B,B+=8}if(A>>>=xe,B-=xe,N.have===0){F.msg="invalid bit length repeat",N.mode=30;break}v=N.lens[N.have-1],se=3+(3&A),A>>>=2,B-=2}else if(Te===17){for(I=xe+3;B<I;){if(ie===0)break e;ie--,A+=K[ne++]<<B,B+=8}B-=xe,v=0,se=3+(7&(A>>>=xe)),A>>>=3,B-=3}else{for(I=xe+7;B<I;){if(ie===0)break e;ie--,A+=K[ne++]<<B,B+=8}B-=xe,v=0,se=11+(127&(A>>>=xe)),A>>>=7,B-=7}if(N.have+se>N.nlen+N.ndist){F.msg="invalid bit length repeat",N.mode=30;break}for(;se--;)N.lens[N.have++]=v}}if(N.mode===30)break;if(N.lens[256]===0){F.msg="invalid code -- missing end-of-block",N.mode=30;break}if(N.lenbits=9,H={bits:N.lenbits},X=y(k,N.lens,0,N.nlen,N.lencode,0,N.work,H),N.lenbits=H.bits,X){F.msg="invalid literal/lengths set",N.mode=30;break}if(N.distbits=6,N.distcode=N.distdyn,H={bits:N.distbits},X=y(w,N.lens,N.nlen,N.ndist,N.distcode,0,N.work,H),N.distbits=H.bits,X){F.msg="invalid distances set",N.mode=30;break}if(N.mode=20,te===6)break e;case 20:N.mode=21;case 21:if(6<=ie&&258<=ue){F.next_out=le,F.avail_out=ue,F.next_in=ne,F.avail_in=ie,N.hold=A,N.bits=B,h(F,he),le=F.next_out,ge=F.output,ue=F.avail_out,ne=F.next_in,K=F.input,ie=F.avail_in,A=N.hold,B=N.bits,N.mode===12&&(N.back=-1);break}for(N.back=0;je=(O=N.lencode[A&(1<<N.lenbits)-1])>>>16&255,Te=65535&O,!((xe=O>>>24)<=B);){if(ie===0)break e;ie--,A+=K[ne++]<<B,B+=8}if(je&&(240&je)==0){for(Fe=xe,He=je,Me=Te;je=(O=N.lencode[Me+((A&(1<<Fe+He)-1)>>Fe)])>>>16&255,Te=65535&O,!(Fe+(xe=O>>>24)<=B);){if(ie===0)break e;ie--,A+=K[ne++]<<B,B+=8}A>>>=Fe,B-=Fe,N.back+=Fe}if(A>>>=xe,B-=xe,N.back+=xe,N.length=Te,je===0){N.mode=26;break}if(32&je){N.back=-1,N.mode=12;break}if(64&je){F.msg="invalid literal/length code",N.mode=30;break}N.extra=15&je,N.mode=22;case 22:if(N.extra){for(I=N.extra;B<I;){if(ie===0)break e;ie--,A+=K[ne++]<<B,B+=8}N.length+=A&(1<<N.extra)-1,A>>>=N.extra,B-=N.extra,N.back+=N.extra}N.was=N.length,N.mode=23;case 23:for(;je=(O=N.distcode[A&(1<<N.distbits)-1])>>>16&255,Te=65535&O,!((xe=O>>>24)<=B);){if(ie===0)break e;ie--,A+=K[ne++]<<B,B+=8}if((240&je)==0){for(Fe=xe,He=je,Me=Te;je=(O=N.distcode[Me+((A&(1<<Fe+He)-1)>>Fe)])>>>16&255,Te=65535&O,!(Fe+(xe=O>>>24)<=B);){if(ie===0)break e;ie--,A+=K[ne++]<<B,B+=8}A>>>=Fe,B-=Fe,N.back+=Fe}if(A>>>=xe,B-=xe,N.back+=xe,64&je){F.msg="invalid distance code",N.mode=30;break}N.offset=Te,N.extra=15&je,N.mode=24;case 24:if(N.extra){for(I=N.extra;B<I;){if(ie===0)break e;ie--,A+=K[ne++]<<B,B+=8}N.offset+=A&(1<<N.extra)-1,A>>>=N.extra,B-=N.extra,N.back+=N.extra}if(N.offset>N.dmax){F.msg="invalid distance too far back",N.mode=30;break}N.mode=25;case 25:if(ue===0)break e;if(se=he-ue,N.offset>se){if((se=N.offset-se)>N.whave&&N.sane){F.msg="invalid distance too far back",N.mode=30;break}we=se>N.wnext?(se-=N.wnext,N.wsize-se):N.wnext-se,se>N.length&&(se=N.length),Ee=N.window}else Ee=ge,we=le-N.offset,se=N.length;for(ue<se&&(se=ue),ue-=se,N.length-=se;ge[le++]=Ee[we++],--se;);N.length===0&&(N.mode=21);break;case 26:if(ue===0)break e;ge[le++]=N.length,ue--,N.mode=21;break;case 27:if(N.wrap){for(;B<32;){if(ie===0)break e;ie--,A|=K[ne++]<<B,B+=8}if(he-=ue,F.total_out+=he,N.total+=he,he&&(F.adler=N.check=N.flags?f(N.check,ge,he,le-he):d(N.check,ge,he,le-he)),he=ue,(N.flags?A:j(A))!==N.check){F.msg="incorrect data check",N.mode=30;break}B=A=0}N.mode=28;case 28:if(N.wrap&&N.flags){for(;B<32;){if(ie===0)break e;ie--,A+=K[ne++]<<B,B+=8}if(A!==(4294967295&N.total)){F.msg="incorrect length check",N.mode=30;break}B=A=0}N.mode=29;case 29:X=1;break e;case 30:X=-3;break e;case 31:return-4;case 32:default:return b}return F.next_out=le,F.avail_out=ue,F.next_in=ne,F.avail_in=ie,N.hold=A,N.bits=B,(N.wsize||he!==F.avail_out&&N.mode<30&&(N.mode<27||te!==4))&&ae(F,F.output,F.next_out,he-F.avail_out)?(N.mode=31,-4):(me-=F.avail_in,he-=F.avail_out,F.total_in+=me,F.total_out+=he,N.total+=he,N.wrap&&he&&(F.adler=N.check=N.flags?f(N.check,ge,he,F.next_out-he):d(N.check,ge,he,F.next_out-he)),F.data_type=N.bits+(N.last?64:0)+(N.mode===12?128:0)+(N.mode===20||N.mode===15?256:0),(me==0&&he===0||te===4)&&X===x&&(X=-5),X)},u.inflateEnd=function(F){if(!F||!F.state)return b;var te=F.state;return te.window&&(te.window=null),F.state=null,x},u.inflateGetHeader=function(F,te){var N;return F&&F.state?(2&(N=F.state).wrap)==0?b:((N.head=te).done=!1,x):b},u.inflateSetDictionary=function(F,te){var N,K=te.length;return F&&F.state?(N=F.state).wrap!==0&&N.mode!==11?b:N.mode===11&&d(1,te,K,0)!==N.check?-3:ae(F,te,K,K)?(N.mode=31,-4):(N.havedict=1,x):b},u.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,o,u){var l=n("../utils/common"),d=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],f=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],h=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],y=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];o.exports=function(k,w,x,b,C,m,S,j){var _,L,U,M,re,J,$,z,Q,ae=j.bits,F=0,te=0,N=0,K=0,ge=0,ne=0,le=0,ie=0,ue=0,A=0,B=null,me=0,he=new l.Buf16(16),se=new l.Buf16(16),we=null,Ee=0;for(F=0;F<=15;F++)he[F]=0;for(te=0;te<b;te++)he[w[x+te]]++;for(ge=ae,K=15;1<=K&&he[K]===0;K--);if(K<ge&&(ge=K),K===0)return C[m++]=20971520,C[m++]=20971520,j.bits=1,0;for(N=1;N<K&&he[N]===0;N++);for(ge<N&&(ge=N),F=ie=1;F<=15;F++)if(ie<<=1,(ie-=he[F])<0)return-1;if(0<ie&&(k===0||K!==1))return-1;for(se[1]=0,F=1;F<15;F++)se[F+1]=se[F]+he[F];for(te=0;te<b;te++)w[x+te]!==0&&(S[se[w[x+te]]++]=te);if(J=k===0?(B=we=S,19):k===1?(B=d,me-=257,we=f,Ee-=257,256):(B=h,we=y,-1),F=N,re=m,le=te=A=0,U=-1,M=(ue=1<<(ne=ge))-1,k===1&&852<ue||k===2&&592<ue)return 1;for(;;){for($=F-le,Q=S[te]<J?(z=0,S[te]):S[te]>J?(z=we[Ee+S[te]],B[me+S[te]]):(z=96,0),_=1<<F-le,N=L=1<<ne;C[re+(A>>le)+(L-=_)]=$<<24|z<<16|Q|0,L!==0;);for(_=1<<F-1;A&_;)_>>=1;if(_!==0?(A&=_-1,A+=_):A=0,te++,--he[F]==0){if(F===K)break;F=w[x+S[te]]}if(ge<F&&(A&M)!==U){for(le===0&&(le=ge),re+=N,ie=1<<(ne=F-le);ne+le<K&&!((ie-=he[ne+le])<=0);)ne++,ie<<=1;if(ue+=1<<ne,k===1&&852<ue||k===2&&592<ue)return 1;C[U=A&M]=ge<<24|ne<<16|re-m|0}}return A!==0&&(C[re+A]=F-le<<24|64<<16|0),j.bits=ge,0}},{"../utils/common":41}],51:[function(n,o,u){o.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,o,u){var l=n("../utils/common"),d=0,f=1;function h(O){for(var V=O.length;0<=--V;)O[V]=0}var y=0,k=29,w=256,x=w+1+k,b=30,C=19,m=2*x+1,S=15,j=16,_=7,L=256,U=16,M=17,re=18,J=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],$=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Q=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ae=new Array(2*(x+2));h(ae);var F=new Array(2*b);h(F);var te=new Array(512);h(te);var N=new Array(256);h(N);var K=new Array(k);h(K);var ge,ne,le,ie=new Array(b);function ue(O,V,G,oe,Y){this.static_tree=O,this.extra_bits=V,this.extra_base=G,this.elems=oe,this.max_length=Y,this.has_stree=O&&O.length}function A(O,V){this.dyn_tree=O,this.max_code=0,this.stat_desc=V}function B(O){return O<256?te[O]:te[256+(O>>>7)]}function me(O,V){O.pending_buf[O.pending++]=255&V,O.pending_buf[O.pending++]=V>>>8&255}function he(O,V,G){O.bi_valid>j-G?(O.bi_buf|=V<<O.bi_valid&65535,me(O,O.bi_buf),O.bi_buf=V>>j-O.bi_valid,O.bi_valid+=G-j):(O.bi_buf|=V<<O.bi_valid&65535,O.bi_valid+=G)}function se(O,V,G){he(O,G[2*V],G[2*V+1])}function we(O,V){for(var G=0;G|=1&O,O>>>=1,G<<=1,0<--V;);return G>>>1}function Ee(O,V,G){var oe,Y,E=new Array(S+1),T=0;for(oe=1;oe<=S;oe++)E[oe]=T=T+G[oe-1]<<1;for(Y=0;Y<=V;Y++){var D=O[2*Y+1];D!==0&&(O[2*Y]=we(E[D]++,D))}}function xe(O){var V;for(V=0;V<x;V++)O.dyn_ltree[2*V]=0;for(V=0;V<b;V++)O.dyn_dtree[2*V]=0;for(V=0;V<C;V++)O.bl_tree[2*V]=0;O.dyn_ltree[2*L]=1,O.opt_len=O.static_len=0,O.last_lit=O.matches=0}function je(O){8<O.bi_valid?me(O,O.bi_buf):0<O.bi_valid&&(O.pending_buf[O.pending++]=O.bi_buf),O.bi_buf=0,O.bi_valid=0}function Te(O,V,G,oe){var Y=2*V,E=2*G;return O[Y]<O[E]||O[Y]===O[E]&&oe[V]<=oe[G]}function Fe(O,V,G){for(var oe=O.heap[G],Y=G<<1;Y<=O.heap_len&&(Y<O.heap_len&&Te(V,O.heap[Y+1],O.heap[Y],O.depth)&&Y++,!Te(V,oe,O.heap[Y],O.depth));)O.heap[G]=O.heap[Y],G=Y,Y<<=1;O.heap[G]=oe}function He(O,V,G){var oe,Y,E,T,D=0;if(O.last_lit!==0)for(;oe=O.pending_buf[O.d_buf+2*D]<<8|O.pending_buf[O.d_buf+2*D+1],Y=O.pending_buf[O.l_buf+D],D++,oe===0?se(O,Y,V):(se(O,(E=N[Y])+w+1,V),(T=J[E])!==0&&he(O,Y-=K[E],T),se(O,E=B(--oe),G),(T=$[E])!==0&&he(O,oe-=ie[E],T)),D<O.last_lit;);se(O,L,V)}function Me(O,V){var G,oe,Y,E=V.dyn_tree,T=V.stat_desc.static_tree,D=V.stat_desc.has_stree,q=V.stat_desc.elems,ve=-1;for(O.heap_len=0,O.heap_max=m,G=0;G<q;G++)E[2*G]!==0?(O.heap[++O.heap_len]=ve=G,O.depth[G]=0):E[2*G+1]=0;for(;O.heap_len<2;)E[2*(Y=O.heap[++O.heap_len]=ve<2?++ve:0)]=1,O.depth[Y]=0,O.opt_len--,D&&(O.static_len-=T[2*Y+1]);for(V.max_code=ve,G=O.heap_len>>1;1<=G;G--)Fe(O,E,G);for(Y=q;G=O.heap[1],O.heap[1]=O.heap[O.heap_len--],Fe(O,E,1),oe=O.heap[1],O.heap[--O.heap_max]=G,O.heap[--O.heap_max]=oe,E[2*Y]=E[2*G]+E[2*oe],O.depth[Y]=(O.depth[G]>=O.depth[oe]?O.depth[G]:O.depth[oe])+1,E[2*G+1]=E[2*oe+1]=Y,O.heap[1]=Y++,Fe(O,E,1),2<=O.heap_len;);O.heap[--O.heap_max]=O.heap[1],(function(Ce,$e){var We,Qe,Je,Be,ut,Lt,Ze=$e.dyn_tree,Jt=$e.max_code,It=$e.stat_desc.static_tree,kr=$e.stat_desc.has_stree,Rr=$e.stat_desc.extra_bits,Dt=$e.stat_desc.extra_base,Ct=$e.stat_desc.max_length,Wt=0;for(Be=0;Be<=S;Be++)Ce.bl_count[Be]=0;for(Ze[2*Ce.heap[Ce.heap_max]+1]=0,We=Ce.heap_max+1;We<m;We++)Ct<(Be=Ze[2*Ze[2*(Qe=Ce.heap[We])+1]+1]+1)&&(Be=Ct,Wt++),Ze[2*Qe+1]=Be,Jt<Qe||(Ce.bl_count[Be]++,ut=0,Dt<=Qe&&(ut=Rr[Qe-Dt]),Lt=Ze[2*Qe],Ce.opt_len+=Lt*(Be+ut),kr&&(Ce.static_len+=Lt*(It[2*Qe+1]+ut)));if(Wt!==0){do{for(Be=Ct-1;Ce.bl_count[Be]===0;)Be--;Ce.bl_count[Be]--,Ce.bl_count[Be+1]+=2,Ce.bl_count[Ct]--,Wt-=2}while(0<Wt);for(Be=Ct;Be!==0;Be--)for(Qe=Ce.bl_count[Be];Qe!==0;)Jt<(Je=Ce.heap[--We])||(Ze[2*Je+1]!==Be&&(Ce.opt_len+=(Be-Ze[2*Je+1])*Ze[2*Je],Ze[2*Je+1]=Be),Qe--)}})(O,V),Ee(E,ve,O.bl_count)}function v(O,V,G){var oe,Y,E=-1,T=V[1],D=0,q=7,ve=4;for(T===0&&(q=138,ve=3),V[2*(G+1)+1]=65535,oe=0;oe<=G;oe++)Y=T,T=V[2*(oe+1)+1],++D<q&&Y===T||(D<ve?O.bl_tree[2*Y]+=D:Y!==0?(Y!==E&&O.bl_tree[2*Y]++,O.bl_tree[2*U]++):D<=10?O.bl_tree[2*M]++:O.bl_tree[2*re]++,E=Y,ve=(D=0)===T?(q=138,3):Y===T?(q=6,3):(q=7,4))}function X(O,V,G){var oe,Y,E=-1,T=V[1],D=0,q=7,ve=4;for(T===0&&(q=138,ve=3),oe=0;oe<=G;oe++)if(Y=T,T=V[2*(oe+1)+1],!(++D<q&&Y===T)){if(D<ve)for(;se(O,Y,O.bl_tree),--D!=0;);else Y!==0?(Y!==E&&(se(O,Y,O.bl_tree),D--),se(O,U,O.bl_tree),he(O,D-3,2)):D<=10?(se(O,M,O.bl_tree),he(O,D-3,3)):(se(O,re,O.bl_tree),he(O,D-11,7));E=Y,ve=(D=0)===T?(q=138,3):Y===T?(q=6,3):(q=7,4)}}h(ie);var H=!1;function I(O,V,G,oe){he(O,(y<<1)+(oe?1:0),3),(function(Y,E,T,D){je(Y),me(Y,T),me(Y,~T),l.arraySet(Y.pending_buf,Y.window,E,T,Y.pending),Y.pending+=T})(O,V,G)}u._tr_init=function(O){H||((function(){var V,G,oe,Y,E,T=new Array(S+1);for(Y=oe=0;Y<k-1;Y++)for(K[Y]=oe,V=0;V<1<<J[Y];V++)N[oe++]=Y;for(N[oe-1]=Y,Y=E=0;Y<16;Y++)for(ie[Y]=E,V=0;V<1<<$[Y];V++)te[E++]=Y;for(E>>=7;Y<b;Y++)for(ie[Y]=E<<7,V=0;V<1<<$[Y]-7;V++)te[256+E++]=Y;for(G=0;G<=S;G++)T[G]=0;for(V=0;V<=143;)ae[2*V+1]=8,V++,T[8]++;for(;V<=255;)ae[2*V+1]=9,V++,T[9]++;for(;V<=279;)ae[2*V+1]=7,V++,T[7]++;for(;V<=287;)ae[2*V+1]=8,V++,T[8]++;for(Ee(ae,x+1,T),V=0;V<b;V++)F[2*V+1]=5,F[2*V]=we(V,5);ge=new ue(ae,J,w+1,x,S),ne=new ue(F,$,0,b,S),le=new ue(new Array(0),z,0,C,_)})(),H=!0),O.l_desc=new A(O.dyn_ltree,ge),O.d_desc=new A(O.dyn_dtree,ne),O.bl_desc=new A(O.bl_tree,le),O.bi_buf=0,O.bi_valid=0,xe(O)},u._tr_stored_block=I,u._tr_flush_block=function(O,V,G,oe){var Y,E,T=0;0<O.level?(O.strm.data_type===2&&(O.strm.data_type=(function(D){var q,ve=4093624447;for(q=0;q<=31;q++,ve>>>=1)if(1&ve&&D.dyn_ltree[2*q]!==0)return d;if(D.dyn_ltree[18]!==0||D.dyn_ltree[20]!==0||D.dyn_ltree[26]!==0)return f;for(q=32;q<w;q++)if(D.dyn_ltree[2*q]!==0)return f;return d})(O)),Me(O,O.l_desc),Me(O,O.d_desc),T=(function(D){var q;for(v(D,D.dyn_ltree,D.l_desc.max_code),v(D,D.dyn_dtree,D.d_desc.max_code),Me(D,D.bl_desc),q=C-1;3<=q&&D.bl_tree[2*Q[q]+1]===0;q--);return D.opt_len+=3*(q+1)+5+5+4,q})(O),Y=O.opt_len+3+7>>>3,(E=O.static_len+3+7>>>3)<=Y&&(Y=E)):Y=E=G+5,G+4<=Y&&V!==-1?I(O,V,G,oe):O.strategy===4||E===Y?(he(O,2+(oe?1:0),3),He(O,ae,F)):(he(O,4+(oe?1:0),3),(function(D,q,ve,Ce){var $e;for(he(D,q-257,5),he(D,ve-1,5),he(D,Ce-4,4),$e=0;$e<Ce;$e++)he(D,D.bl_tree[2*Q[$e]+1],3);X(D,D.dyn_ltree,q-1),X(D,D.dyn_dtree,ve-1)})(O,O.l_desc.max_code+1,O.d_desc.max_code+1,T+1),He(O,O.dyn_ltree,O.dyn_dtree)),xe(O),oe&&je(O)},u._tr_tally=function(O,V,G){return O.pending_buf[O.d_buf+2*O.last_lit]=V>>>8&255,O.pending_buf[O.d_buf+2*O.last_lit+1]=255&V,O.pending_buf[O.l_buf+O.last_lit]=255&G,O.last_lit++,V===0?O.dyn_ltree[2*G]++:(O.matches++,V--,O.dyn_ltree[2*(N[G]+w+1)]++,O.dyn_dtree[2*B(V)]++),O.last_lit===O.lit_bufsize-1},u._tr_align=function(O){he(O,2,3),se(O,L,ae),(function(V){V.bi_valid===16?(me(V,V.bi_buf),V.bi_buf=0,V.bi_valid=0):8<=V.bi_valid&&(V.pending_buf[V.pending++]=255&V.bi_buf,V.bi_buf>>=8,V.bi_valid-=8)})(O)}},{"../utils/common":41}],53:[function(n,o,u){o.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,o,u){(function(l){(function(d,f){if(!d.setImmediate){var h,y,k,w,x=1,b={},C=!1,m=d.document,S=Object.getPrototypeOf&&Object.getPrototypeOf(d);S=S&&S.setTimeout?S:d,h={}.toString.call(d.process)==="[object process]"?function(U){process.nextTick(function(){_(U)})}:(function(){if(d.postMessage&&!d.importScripts){var U=!0,M=d.onmessage;return d.onmessage=function(){U=!1},d.postMessage("","*"),d.onmessage=M,U}})()?(w="setImmediate$"+Math.random()+"$",d.addEventListener?d.addEventListener("message",L,!1):d.attachEvent("onmessage",L),function(U){d.postMessage(w+U,"*")}):d.MessageChannel?((k=new MessageChannel).port1.onmessage=function(U){_(U.data)},function(U){k.port2.postMessage(U)}):m&&"onreadystatechange"in m.createElement("script")?(y=m.documentElement,function(U){var M=m.createElement("script");M.onreadystatechange=function(){_(U),M.onreadystatechange=null,y.removeChild(M),M=null},y.appendChild(M)}):function(U){setTimeout(_,0,U)},S.setImmediate=function(U){typeof U!="function"&&(U=new Function(""+U));for(var M=new Array(arguments.length-1),re=0;re<M.length;re++)M[re]=arguments[re+1];var J={callback:U,args:M};return b[x]=J,h(x),x++},S.clearImmediate=j}function j(U){delete b[U]}function _(U){if(C)setTimeout(_,0,U);else{var M=b[U];if(M){C=!0;try{(function(re){var J=re.callback,$=re.args;switch($.length){case 0:J();break;case 1:J($[0]);break;case 2:J($[0],$[1]);break;case 3:J($[0],$[1],$[2]);break;default:J.apply(f,$)}})(M)}finally{j(U),C=!1}}}}function L(U){U.source===d&&typeof U.data=="string"&&U.data.indexOf(w)===0&&_(+U.data.slice(w.length))}})(typeof self>"u"?l===void 0?this:l:self)}).call(this,typeof ho<"u"?ho:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Al)),Al.exports}var yv=gv();const Th=$l(yv);async function Ph(r){const i=await Th.loadAsync(r),n=await i.file("META-INF/container.xml")?.async("string");if(!n)throw new Error("container.xml not found in EPUB");const o=n.match(/full-path="([^"]+\.opf)"/);if(!o)throw new Error("OPF path not found in container.xml");const u=o[1],l=await i.file(u)?.async("string");if(!l)throw new Error(`OPF file not found at ${u}`);return l}async function vv(r){const i=await Th.loadAsync(r),n=await i.file("META-INF/container.xml")?.async("string");if(!n)return null;const o=n.match(/full-path="([^"]+\.opf)"/);if(!o)return null;const u=o[1],l=await i.file(u)?.async("string");if(!l)return null;const d=u.substring(0,u.lastIndexOf("/")+1),f=C=>d+C;let h=null,y=null;const k=l.match(/<meta[^>]+name=["']cover["'][^>]+content=["']([^"']+)["'][^>]*>/i);if(k&&(h=k[1]),!h){const C=l.match(/<item[^>]+properties=["'][^"']*cover-image[^"']*["'][^>]+id=["']([^"']+)["'][^>]*href=["']([^"']+)["'][^>]+media-type=["']([^"']+)["'][^>]*>/i);C&&(h=C[1],y=C[2],C[3])}if(!h){const C=l.match(/<item[^>]+id=["']([^"']*cover[^"']*)["'][^>]*href=["']([^"']+)["'][^>]+media-type=["']([^"']+)["'][^>]*>/i);C&&(h=C[1],y=C[2],C[3])}if(h&&!y){const C=new RegExp(`<item[^>]+id=["']${h}["'][^>]+href=["']([^"']+)["'][^>]+media-type=["']([^"']+)["'][^>]*>`,"i"),m=l.match(C);m&&(y=m[1],m[2])}if(!y){const C=l.match(/<item[^>]+href=["']([^"']+)["'][^>]+media-type=["'](image\/(jpeg|png|gif|jpg))["'][^>]*>/i);C&&(y=C[1],C[2])}if(!y){const C=l.match(/<spine[\s\S]*?<itemref[^>]+idref=["']([^"']+)["'][^>]*>/i);if(C){const m=C[1],S=new RegExp(`<item[^>]+id=["']${m}["'][^>]+href=["']([^"']+)["'][^>]+media-type=["']application/xhtml+xml["'][^>]*>`,"i"),j=l.match(S);if(j){const _=j[1],L=f(_),U=i.file(L);if(U){const re=(await U.async("string")).match(/<img[^>]+src=["']([^"']+)["'][^>]*>/i);re&&(y=re[1],y.endsWith(".png")||y.endsWith(".jpg")||y.endsWith(".jpeg")||y.endsWith(".gif"))}}}}if(!y)return null;const w=f(y),x=i.file(w);if(!x)return null;const b=await x.async("blob");return await new Promise((C,m)=>{const S=new FileReader;S.onloadend=()=>C(S.result),S.onerror=m,S.readAsDataURL(b)})}const xv=Object.freeze(Object.defineProperty({__proto__:null,extractCoverImageFromEpub:vv,extractOpfXmlFromEpub:Ph},Symbol.toStringTag,{value:"Module"})),wv=P.lazy(()=>kf(()=>import("./PdfReaderView-BdV66Lcs.js"),[])),bv=new Zm({defaultOptions:{queries:{staleTime:300*1e3,gcTime:600*1e3,retry:1,refetchOnWindowFocus:!0,refetchOnMount:!1,throwOnError:!1},mutations:{retry:1,throwOnError:!1}}}),kv=()=>{const r=ec(),[i,n]=P.useState("library"),[o,u]=P.useState(null),[l,d]=P.useState(null),[f,h]=P.useState(null),[y,k]=P.useState([]),[w,x]=P.useState(!0),[b,C]=P.useState(!1),[m,S]=P.useState(!1),[j,_]=P.useState(!1),{tokenClient:L}=jh(),[U,M]=P.useState({state:"idle",message:""}),[re,J]=P.useState(null),[$,z]=P.useState({isLoading:!1,message:"",error:null}),[Q,ae]=P.useState({isOpen:!1,host:null,pendingHref:null,pendingBook:null,pendingCatalogName:void 0,authDocument:null}),[F,te]=P.useState(0);P.useEffect(()=>{it.init();const v=setTimeout(()=>{x(!1)},2500);return()=>clearTimeout(v)},[]),my({shortcuts:[{key:"?",description:"Show keyboard shortcuts",category:"global",action:()=>_(!0)},{key:"Escape",description:"Close active modal or return to library",category:"global",action:()=>{j?_(!1):b?C(!1):m?S(!1):Q.isOpen?ae({...Q,isOpen:!1}):i==="bookDetail"&&n("library")}}],enabled:!w});const N=Vf(),K=Zl();P.useEffect(()=>{new URLSearchParams(K.search).get("autoOpen")==="first"&&(async()=>{try{const H=await it.getAllBooks();if(!H||H.length===0)return;const I=H[0];if(!I||!I.id)return;(I.format||"EPUB")==="PDF"?N(`/pdf/${I.id}`):(u(I.id),n("reader"))}catch(H){ce.warn("Auto-open failed",H)}})()},[K.search,N]);const ge=P.useCallback((v,X,H="EPUB")=>{u(v),H==="PDF"?(d(null),N(`/pdf/${v}`)):(d(X),n("reader"))},[N]),ne=Sh(),le=P.useCallback(()=>{u(null),n("library"),d(null);try{N("/")}catch{}},[N]),ie=P.useCallback((v,X,H)=>{J({book:v,source:X,catalogName:H}),n("bookDetail")},[]),ue=P.useCallback(()=>{J(null),n("library")},[]),A=P.useCallback(()=>{n("about")},[]),B=P.useCallback(async(v,X="Untitled Book",H,I="file",O,V,G,oe,Y)=>{let E=null;if(oe&&(E=await tf(oe)),(G||(X.toLowerCase().endsWith(".pdf")?"PDF":"EPUB"))==="PDF"){z({isLoading:!0,message:"Saving PDF to library...",error:null});try{const Ce=X.replace(/\.(pdf)$/i,""),$e=H||"Unknown Author";!E&&I==="file"&&(E=await _0(Ce,$e));const We=new Uint8Array(v).slice(0,5),Qe=We[0]===37&&We[1]===80&&We[2]===68&&We[3]===70&&We[4]===45;if(!Qe||!v||v instanceof ArrayBuffer&&v.byteLength<1e3)return z({isLoading:!1,message:"",error:"Downloaded file is not a valid PDF or is empty. Import aborted."}),{success:!1};let Je=E;Je&&typeof Je=="string"&&(/^data:image\/(png|jpeg|jpg);base64,/.test(Je)||(Je=null));let Be={};if(I==="catalog"&&Y&&(Be={summary:Y.summary,publisher:Y.publisher,publicationDate:Y.publicationDate,subjects:Y.subjects,coverImage:Je||(Y.coverImage?await tf(Y.coverImage):null)}),!Qe||!v||v instanceof ArrayBuffer&&v.byteLength<1e3)return z({isLoading:!1,message:"",error:"Downloaded file is not a valid PDF or is empty. Import aborted."}),{success:!1};if(I==="catalog"&&!Be.coverImage)return z({isLoading:!1,message:"",error:"No valid cover image found for this book. Import aborted."}),{success:!1};const ut={title:Ce,author:$e,coverImage:Be.coverImage||Je,epubData:v,format:"PDF",providerName:O,providerId:V,description:Be.summary,publisher:Be.publisher,publicationDate:Be.publicationDate,subjects:Be.subjects};return await it.saveBook(ut),z({isLoading:!1,message:"Import successful!",error:null}),te(Lt=>{const Ze=Lt+1;return console.log("[App] setLibraryRefreshFlag called. Previous:",Lt,"Next:",Ze),Ze}),setTimeout(()=>z({isLoading:!1,message:"",error:null}),2e3),{success:!0}}catch(Ce){ce.error("Error saving PDF:",Ce);let $e="Failed to save the PDF file to the library.";return Ce instanceof Error&&($e=Ce.message),z({isLoading:!1,message:"",error:$e}),{success:!1}}}z({isLoading:!0,message:"Extracting EPUB metadata...",error:null});let D,q,ve=null;try{try{D=await Ph(v),console.log("[processAndSaveBook] OPF XML extracted:",D?.slice(0,200))}catch(We){console.error("[processAndSaveBook] Failed to extract OPF XML:",We),z({isLoading:!1,message:"",error:"Failed to extract EPUB metadata (OPF not found). Importing with minimal info."})}if(D)try{q=mv(D),console.log("[processAndSaveBook] OPF metadata extracted:",q)}catch(We){console.error("[processAndSaveBook] Failed to parse OPF metadata:",We),z({isLoading:!1,message:"",error:"Failed to parse EPUB metadata. Importing with minimal info."})}if(z(We=>({...We,message:"Extracting cover..."})),!E)try{const{extractCoverImageFromEpub:We}=await kf(async()=>{const{extractCoverImageFromEpub:Qe}=await Promise.resolve().then(()=>xv);return{extractCoverImageFromEpub:Qe}},void 0);ve=await We(v),ve?(E=ve,console.log("[processAndSaveBook] Cover image extracted from EPUB.")):console.log("[processAndSaveBook] No cover image found in EPUB.")}catch(We){console.error("[processAndSaveBook] Failed to extract cover image:",We)}const Ce=V||q?.identifiers?.[0],$e={title:q?.title||X,author:q?.author||H||"Unknown Author",coverImage:E,epubData:v,publisher:q?.publisher,publicationDate:q?.publicationDate,providerId:Ce,providerName:O,description:q?.description,subjects:q?.subjects,format:"EPUB",language:q?.language,rights:q?.rights,identifiers:q?.identifiers,opfRaw:D,accessModes:q?.accessModes,accessModesSufficient:q?.accessModesSufficient,accessibilityFeatures:q?.accessibilityFeatures,hazards:q?.hazards,accessibilitySummary:q?.accessibilitySummary,certificationConformsTo:q?.certificationConformsTo,certification:q?.certification,accessibilityFeedback:q?.accessibilityFeedback};if(console.log("[processAndSaveBook] BookRecord to save:",$e),Ce){const We=await it.findBookByIdentifier(Ce);if(We)return z({isLoading:!1,message:"",error:null}),{success:!1,bookRecord:$e,existingBook:We}}return z(We=>({...We,message:"Saving to library..."})),await it.saveBook($e),console.log("[processAndSaveBook] Book saved successfully"),z({isLoading:!1,message:"Import successful!",error:null}),te(We=>{const Qe=We+1;return console.log("[App] setLibraryRefreshFlag called. Previous:",We,"Next:",Qe),Qe}),setTimeout(()=>z({isLoading:!1,message:"",error:null}),2e3),I==="catalog"&&ue(),{success:!0}}catch(Ce){ce.error("Error processing EPUB:",Ce);let $e="Failed to import the EPUB file. It might be corrupted or in an unsupported format.";return Ce instanceof Error&&Ce.message.includes("File is not a zip")&&($e="The provided file is not a valid EPUB (it's not a zip archive). Please try a different file."),z({isLoading:!1,message:"",error:$e}),{success:!1}}},[ue]),me=P.useCallback(async(v,X)=>{if(v.format&&v.format.toUpperCase()!=="EPUB"&&v.format.toUpperCase()!=="PDF"){const H=`Cannot import this book. The application currently only supports EPUB and PDF formats, but this book is a ${v.format}.`;return z({isLoading:!1,message:"",error:H}),{success:!1}}z({isLoading:!0,message:`Downloading ${v.title}...`,error:null});try{let H=v.downloadUrl;if(ce.info("Book isOpenAccess flag:",v.isOpenAccess,"for book:",v.title),ce.info("About to call maybeProxyForCors with skipProbe=",v.isOpenAccess===!0,"for URL:",H),v.isOpenAccess)ce.info("Skipping acquisition chain resolution for open-access book:",v.title);else{const T=await zl(v.downloadUrl),D=await _l.resolve(v.downloadUrl,"auto",T?{username:T.username,password:T.password}:null);if(D.success)H=D.data;else{const q=D;if(q.status===401||q.status===403)return z({isLoading:!1,message:"",error:null}),ae({isOpen:!0,host:new URL(v.downloadUrl).host,pendingHref:v.downloadUrl,pendingBook:v,pendingCatalogName:X}),ae(ve=>({...ve,authDocument:void 0})),{success:!1};ce.warn("Failed to resolve acquisition chain, using original URL",q.error)}}let I=await wr(H,v.isOpenAccess===!0);const O=await zl(v.downloadUrl),V={};O&&(V.Authorization=`Basic ${btoa(`${O.username}:${O.password}`)}`);let G;if(v.isOpenAccess)try{console.log("[App] Attempting direct fetch for open-access book:",H),console.log("[App] Book downloadUrl from catalog:",v.downloadUrl),console.log("[App] Download headers:",V),G=await fetch(H,{headers:V,credentials:"include",redirect:"follow"}),console.log("[App] Direct fetch succeeded, status:",G.status,"final URL:",G.url)}catch(T){console.log("[App] Direct fetch failed (likely CORS), trying proxy:",T),I=await wr(H,!0),console.log("[App] Using proxy URL:",I),G=await fetch(I,{headers:{},credentials:"omit",redirect:"follow"}),console.log("[App] Proxy fetch completed, status:",G.status,"final URL:",G.url)}else G=await fetch(I,{headers:V,credentials:I===H?"include":"omit"});if(!G.ok){const T=`${G.status}${G.statusText?` ${G.statusText}`:""}`;let D=`Download failed. The server responded with an error (${T}). The book might not be available at this address.`;throw(G.status===401||G.status===403)&&(D=`Download failed (${T}). This catalog or book requires authentication (a login or password), which is not supported by this application.`),G.status===429&&(D=`Download failed (${T}). The request was rate-limited by the server or the proxy. Please wait a moment and try again.`),new Error(D)}const oe=await G.arrayBuffer();let Y;v.format&&v.format.toUpperCase()==="PDF"&&(Y={summary:v.summary,publisher:v.publisher,publicationDate:v.publicationDate,subjects:v.subjects,coverImage:v.coverImage});const E=await B(oe,v.title,v.author,"catalog",X,v.providerId,v.format,v.coverImage,Y);return E.success?(console.log("[App] Import successful, switching to My Library view and resetting activeOpdsSource."),h(null),n("library")):console.log("[App] Import failed or duplicate, not switching to My Library."),E}catch(H){ce.error("Error importing from catalog:",H);let I="Download failed. The file may no longer be available or there was a network issue.";return H instanceof TypeError&&H.message==="Failed to fetch"?I="Download failed due to a network error. This could be due to your internet connection or the public CORS proxy being temporarily down.":H instanceof Error&&(I=H.message),z({isLoading:!1,message:"",error:I}),{success:!1}}},[B]),he=P.useCallback(async(v,X,H)=>{if(!Q.pendingHref){ae({isOpen:!1,host:null,pendingHref:null,pendingBook:null});return}const I=Q.pendingHref;try{const O=await _l.resolve(I,"auto",{username:v,password:X});if(O.success&&Q.pendingBook){H&&Q.host&&fh(Q.host,v,X),ae({isOpen:!1,host:null,pendingHref:null,pendingBook:null,pendingCatalogName:void 0}),z({isLoading:!0,message:`Downloading ${Q.pendingBook.title}...`,error:null});const V=await wr(O.data),G={};v&&X&&(G.Authorization=`Basic ${btoa(`${v}:${X}`)}`);const oe=await fetch(V,{headers:G,credentials:V===O.data?"include":"omit"});if(!oe.ok)throw new Error(`Download failed: ${oe.status}`);const Y=await oe.arrayBuffer();await B(Y,Q.pendingBook.title,Q.pendingBook.author,"catalog",Q.pendingCatalogName,Q.pendingBook.providerId,Q.pendingBook.format,Q.pendingBook.coverImage)}else z({isLoading:!1,message:"",error:"Failed to resolve acquisition URL."}),ae({isOpen:!1,host:null,pendingHref:null,pendingBook:null,pendingCatalogName:void 0}),Q.authDocument}catch(O){ce.error("Credential resolve/import failed",O),z({isLoading:!1,message:"",error:O instanceof Error?O.message:"Failed to authenticate and download the book."}),ae({isOpen:!1,host:null,pendingHref:null,pendingBook:null,pendingCatalogName:void 0})}},[Q,B]),[se,we]=P.useState(null),[Ee,xe]=P.useState(!1),je=P.useCallback(v=>{we(v)},[]),Te=P.useCallback(async()=>{if(!(!Q.pendingHref||!Q.pendingBook)){z({isLoading:!0,message:"Retrying download after provider login...",error:null});try{const v=await _l.resolve(Q.pendingHref,"auto",null);if(!v.success)throw new Error("Failed to resolve after login");const X=await wr(v.data);if(typeof X=="string"&&X.includes("corsproxy.io")){try{r.pushToast("The retry would use a public CORS proxy which commonly strips authentication. Configure an owned proxy via VITE_OWN_PROXY_URL and retry.",12e3)}catch{}throw new Error("Retry aborted: public CORS proxy would be used and may block authenticated downloads.")}const H=await fetch(X,{credentials:X===v.data?"include":"omit"});if(!H.ok)throw new Error(`Download failed: ${H.status}`);const I=await H.arrayBuffer();await B(I,Q.pendingBook.title,Q.pendingBook.author,"catalog",Q.pendingCatalogName,Q.pendingBook.providerId,Q.pendingBook.format,Q.pendingBook.coverImage),ae({isOpen:!1,host:null,pendingHref:null,pendingBook:null,pendingCatalogName:void 0})}catch(v){if(ce.error("Retry after provider login failed",v),v?.proxyUsed)try{r.pushToast("Retry after login failed because the request used a public CORS proxy that may strip authentication. Configure VITE_OWN_PROXY_URL to use an owned proxy that preserves credentials.",1e4)}catch{}z({isLoading:!1,message:"",error:v instanceof Error?v.message:"Retry failed"})}}},[Q,B]),Fe=async()=>{const v=await it.getAllBooks(),X=v.map(({epubData:oe,...Y})=>Y),H=JSON.parse(localStorage.getItem("ebook-catalogs")||"[]"),I=JSON.parse(localStorage.getItem("ebook-reader-settings-global")||"{}"),O={},V={},G={};return v.forEach(oe=>{oe.id&&(O[oe.id]=JSON.parse(localStorage.getItem(`ebook-reader-bookmarks-${oe.id}`)||"[]"),V[oe.id]=JSON.parse(localStorage.getItem(`ebook-reader-citations-${oe.id}`)||"[]"),G[oe.id]=localStorage.getItem(`ebook-reader-pos-${oe.id}`))}),{payload:{library:X,catalogs:H,bookmarks:O,citations:V,positions:G,settings:I},booksWithData:v}},He=async()=>{if(L){M({state:"syncing",message:"Gathering local data..."});try{const{payload:v,booksWithData:X}=await Fe();M({state:"syncing",message:"Uploading to Google Drive... This may take a while."}),await ey(v,X,H=>{M({state:"syncing",message:H})}),localStorage.setItem("ebook-reader-last-sync",new Date().toISOString()),M({state:"success",message:"Library successfully uploaded!"})}catch(v){ce.error("Upload failed:",v),M({state:"error",message:v instanceof Error?v.message:"An unknown error occurred."})}}},Me=async()=>{if(!(!L||!await ne({message:`DANGER: This will replace your entire local library with the version from Google Drive.

Any local books or changes not uploaded to Drive will be permanently lost.

Are you absolutely sure you want to continue?`,title:"Dangerous Operation",confirmLabel:"Yes, replace",cancelLabel:"Cancel"}))){M({state:"syncing",message:"Downloading from Google Drive..."});try{const X=await ty(H=>{M({state:"syncing",message:H})});if(!X)throw new Error("No data found in Google Drive.");M({state:"syncing",message:"Clearing local library..."}),await it.clearAllBooks(),Object.keys(localStorage).filter(H=>H.startsWith("ebook-reader-")).forEach(H=>localStorage.removeItem(H)),M({state:"syncing",message:"Importing downloaded library..."}),localStorage.setItem("ebook-catalogs",JSON.stringify(X.payload.catalogs||[])),localStorage.setItem("ebook-reader-settings-global",JSON.stringify(X.payload.settings||{}));for(const H of X.booksWithData)if(await it.saveBook(H),H.id){const I=H.id;X.payload.bookmarks[I]&&localStorage.setItem(`ebook-reader-bookmarks-${I}`,JSON.stringify(X.payload.bookmarks[I])),X.payload.citations[I]&&localStorage.setItem(`ebook-reader-citations-${I}`,JSON.stringify(X.payload.citations[I])),X.payload.positions[I]&&localStorage.setItem(`ebook-reader-pos-${I}`,X.payload.positions[I])}localStorage.setItem("ebook-reader-last-sync",new Date().toISOString()),M({state:"success",message:"Library successfully downloaded! Reloading app..."}),setTimeout(()=>window.location.reload(),2e3)}catch(X){ce.error("Download failed:",X),M({state:"error",message:X instanceof Error?X.message:"An unknown error occurred."})}}};return console.log("[AppInner] render",{currentView:i,activeOpdsSource:f}),a.jsxs("div",{className:"min-h-screen bg-slate-900 font-sans",children:[a.jsx("a",{href:"#main-content",className:"sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-sky-500 focus:text-white focus:rounded-md focus:font-semibold focus:shadow-lg",children:"Skip to main content"}),a.jsx(Qy,{isVisible:w}),!w&&a.jsxs("main",{id:"main-content",children:[a.jsx(nv,{currentView:i,selectedBookId:o,coverAnimationData:l,onCloseReader:le,detailViewData:re,onReturnToLibrary:ue,onReadBook:ge,onImportFromCatalog:me,onOpenBook:ge,onShowBookDetail:ie,processAndSaveBook:B,activeOpdsSource:f,setActiveOpdsSource:h,catalogNavPath:y,setCatalogNavPath:k,onOpenCloudSyncModal:()=>C(!0),onOpenLocalStorageModal:()=>S(!0),onShowAbout:A,importStatus:$,setImportStatus:z,libraryRefreshFlag:F}),console.log("[App] Rendering ViewRenderer with props:",{currentView:i,libraryRefreshFlag:F,activeOpdsSource:f,catalogNavPath:y})]}),a.jsx(Ky,{isCloudSyncModalOpen:b,onCloseCloudSyncModal:()=>C(!1),onUploadToDrive:He,onDownloadFromDrive:Me,syncStatus:U,setSyncStatus:M,isLocalStorageModalOpen:m,onCloseLocalStorageModal:()=>S(!1),credentialPrompt:Q,onCloseCredentialPrompt:()=>ae({isOpen:!1,host:null,pendingHref:null,pendingBook:null,pendingCatalogName:void 0,authDocument:null}),onCredentialSubmit:he,onOpenAuthLink:je,onRetryAfterProviderLogin:Te,showNetworkDebug:Ee,onCloseNetworkDebug:()=>xe(!1),onOpenNetworkDebug:()=>xe(!0),isShortcutHelpOpen:j,onCloseShortcutHelp:()=>_(!1)}),a.jsx(pf,{message:$.isLoading?$.message:$.error||null,politeness:$.error?"assertive":"polite"}),a.jsx(pf,{message:U.state!=="idle"?U.message:null,politeness:U.state==="error"?"assertive":"polite"})]})},Sv=()=>a.jsxs(Xm,{client:bv,children:[a.jsx(eg,{children:({reset:r})=>a.jsx(s0,{children:a.jsxs(t0,{children:[a.jsx(wo,{path:"/debug/db",element:a.jsx(jv,{})}),a.jsx(wo,{path:"/pdf/:id",element:a.jsx(P.Suspense,{fallback:a.jsx("div",{className:"w-full h-full flex items-center justify-center",children:"Loading PDF viewer..."}),children:a.jsx(ri,{onReset:()=>{r(),window.location.replace("/")},fallbackMessage:"There was an error loading the PDF viewer.",children:a.jsx(Cv,{})})})}),a.jsx(wo,{path:"/*",element:a.jsx(ri,{onReset:()=>{r(),window.location.reload()},fallbackMessage:"There was an error loading the application.",children:a.jsx(kv,{})})})]})})}),a.jsx(cg,{initialIsOpen:!1})]}),Cv=()=>{const r=Vf();return a.jsx(wv,{onClose:()=>r("/")})},jv=()=>(P.useEffect(()=>{(async()=>{try{const r=await it.getAllBooks();ce.debug("All books loaded from database",r)}catch(r){ce.error("Error loading books from database",r)}})()},[]),a.jsx("div",{className:"p-4 text-white",children:"Debugging DB: check console for output."})),Oh=document.getElementById("root");if(!Oh)throw new Error("Could not find root element to mount to");const Nv=jm.createRoot(Oh);Nv.render(a.jsx(ps.StrictMode,{children:a.jsx(zy,{children:a.jsx(yy,{children:a.jsx(Dy,{children:a.jsx(Sv,{})})})})}));export{a0 as A,o0 as B,ir as C,i0 as L,ps as R,vh as S,Ty as T,Py as Z,kf as _,Vf as a,Sh as b,Dv as c,Rv as d,Tv as e,Pv as f,df as g,Av as h,Cy as i,a as j,jy as k,it as l,Fn as m,To as n,Zf as o,Ov as p,Iv as q,P as r,Lv as s,$l as t,_v as u};
